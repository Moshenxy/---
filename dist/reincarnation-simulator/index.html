<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>轮回-诸天万界</title><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet"/><script type="module">import{GoldenLayout as e}from'https://testingcf.jsdelivr.net/npm/golden-layout/+esm';import{AdditiveBlending as t,BackSide as n,Color as o,Group as a,Mesh as l,MeshBasicMaterial as r,PerspectiveCamera as i,Raycaster as c,Scene as s,ShaderMaterial as d,SphereGeometry as m,Vector2 as u,WebGLRenderer as p}from'https://testingcf.jsdelivr.net/npm/three/+esm';import{OrbitControls as v}from'https://testingcf.jsdelivr.net/npm/three/addons/controls/OrbitControls.js/+esm';import{color as g,scaleLinear as f,scaleOrdinal as h,schemeCategory10 as y,select as k,transition as E,zoom as N,zoomIdentity as b}from'https://testingcf.jsdelivr.net/npm/d3/+esm';import{default as V}from'https://testingcf.jsdelivr.net/npm/screenfull/+esm';import'https://testingcf.jsdelivr.net/npm/golden-layout/dist/css/goldenlayout-base.css/+esm';import'https://testingcf.jsdelivr.net/npm/golden-layout/dist/css/themes/goldenlayout-dark-theme.css/+esm';var S={455(e,t){t.A=(e,t)=>{const n=e.__vccOpts||e;for(const[e,o]of t)n[e]=o;return n}}},B={};function w(e){var t=B[e];if(void 0!==t)return t.exports;var n=B[e]={exports:{}};return S[e](n,n.exports,w),n.exports}w.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return w.d(t,{a:t}),t},w.d=(e,t)=>{for(var n in t)w.o(t,n)&&!w.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},w.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),w.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};var C={};w.r(C),w.d(C,{o1:()=>jt,M_:()=>ct});var D={};w.r(D),w.d(D,{f:()=>yp});const x=Vue,I=VueRouter,L={class:'main-layout'},M={class:'modal-content confirmation-modal'},A={class:'confirmation-title'},O={class:'confirmation-message'},j={class:'confirmation-buttons'},T={class:'modal-content detail-modal'},F={class:'modal-header'},R={class:'modal-title'},W={class:'modal-body'},P={class:'modal-content detail-modal'},U={class:'modal-header'},H={class:'modal-title'},G={class:'modal-body'},J={key:4,class:'modal-overlay input-modal-overlay'},Y={class:'modal-content input-modal-content'},q={class:'input-area-container'},K={class:'input-area-with-buttons'},Q={key:2,class:'command-queue-popup',style:{'background-color':'#0a0f1e',border:'1px solid #d4af37'}},X={class:'popup-header'},Z={class:'popup-body'},ee={key:0,class:'command-list'},te={key:1,class:'empty-queue'},ne={key:0,class:'popup-footer'};const oe={class:'action-panel'},ae={class:'button-row'},le=['disabled','onClick'],re={class:'button-row'},ie=['disabled','onClick'],ce={class:'button-row'},se=['disabled','onClick'],de=(0,x.defineComponent)({__name:'ActionPanel',props:{commandCount:{},mainOptions:{},avatarOptions:{},commonOptions:{}},emits:['toggle-history','toggle-commands'],setup:e=>(t,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',oe,[(0,x.createElementVNode)('div',ae,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.mainOptions,e=>((0,x.openBlock)(),(0,x.createElementBlock)('button',{key:e.id,class:'action-button',disabled:e.disabled&&e.disabled(),onClick:e.action},(0,x.toDisplayString)(e.text),9,le))),128))]),(0,x.createElementVNode)('div',re,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.avatarOptions,e=>((0,x.openBlock)(),(0,x.createElementBlock)('button',{key:e.id,class:'action-button',disabled:e.disabled&&e.disabled(),onClick:e.action},(0,x.toDisplayString)(e.text),9,ie))),128))]),(0,x.createElementVNode)('div',ce,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.commonOptions,e=>((0,x.openBlock)(),(0,x.createElementBlock)('button',{key:e.id,class:'action-button',disabled:e.disabled&&e.disabled(),onClick:e.action},(0,x.toDisplayString)(e.text),9,se))),128)),(0,x.createElementVNode)('button',{class:'action-button',onClick:n[0]||(n[0]=e=>t.$emit('toggle-history'))},'历史'),(0,x.createElementVNode)('button',{class:'action-button',onClick:n[1]||(n[1]=e=>t.$emit('toggle-commands'))},'指令 ('+(0,x.toDisplayString)(e.commandCount)+')',1)])]))});var me=w(455);const ue=(0,me.A)(de,[['__scopeId','data-v-fa88c5d8']]);const pe=new class{commands=[];listeners=[];subscribe(e){this.listeners.push(e)}unsubscribe(e){this.listeners=this.listeners.filter(t=>t!==e)}notify(){this.listeners.forEach(e=>e([...this.commands]))}addCommand(e){this.commands.push(e),this.notify()}getCommands(){return[...this.commands]}clearCommands(){this.commands=[],this.notify()}},ve='reincarnation_input_history_recent',ge='reincarnation_input_history_saved';const fe=new class{state=(0,x.reactive)({recent:[],saved:[]});constructor(){this.loadHistory()}loadHistory(){const e=localStorage.getItem(ve),t=localStorage.getItem(ge);e&&(this.state.recent=JSON.parse(e)),t&&(this.state.saved=JSON.parse(t))}saveHistory(){localStorage.setItem(ve,JSON.stringify(this.state.recent)),localStorage.setItem(ge,JSON.stringify(this.state.saved))}add(e){if(!e||''===e.trim())return;const t=this.state.recent.indexOf(e);t>-1&&this.state.recent.splice(t,1),this.state.recent.unshift(e),this.state.recent.length>5&&this.state.recent.pop(),this.saveHistory()}save(e){this.state.saved.includes(e)||(this.state.saved.unshift(e),this.state.saved.length>5&&this.state.saved.pop(),this.saveHistory())}deleteRecent(e){this.state.recent.splice(e,1),this.saveHistory()}deleteSaved(e){this.state.saved.splice(e,1),this.saveHistory()}clearAll(){this.state.recent=[],this.state.saved=[],this.saveHistory()}},he=_;function ye(e,t,n,o){const a=e.indexOf(':');if(a>-1){const l=e.substring(0,a).trim(),r=e.substring(a+1).trim();if(''===r){const e={};t[l]=e,o.push({level:n,obj:e})}else if(r.startsWith('{')&&r.endsWith('}')){const e={};t[l]=e;const a=r.slice(1,-1).trim().split(',').map(e=>e.trim());for(const t of a)ye(t,e,n+2,o)}else t[l]=ke(r)}}function ke(e){const t=e.trim();if(t.startsWith('"')&&t.endsWith('"')){const e=t.slice(1,-1);return e.startsWith('[')&&e.endsWith(']')?ke(e):e}if(t.startsWith('[')&&t.endsWith(']'))try{const e=t.slice(1,-1).trim(),n=[];let o='',a=!1,l=0;for(let t=0;t<e.length;t++){const r=e[t];'\''!==r&&'"'!==r||(a=!a),a||('['===r&&l++,']'===r&&l--,','!==r||0!==l)?o+=r:(n.push(o.trim()),o='')}return o&&n.push(o.trim()),n.map(e=>ke(e))}catch(e){}return'true'===t.toLowerCase()||'false'!==t.toLowerCase()&&('null'===t?null:''===t||isNaN(Number(t))||t.includes('x')?t:Number(t))}const Ee='轮回-诸天万界';let Ne=null;async function be(e=!1){if(Ne&&!e)return Ne;try{const e=await TavernHelper.getLorebookEntries(Ee);return e?(Ne=e,e):(console.error(`[LorebookService] 无法获取名为 "${Ee}" 的世界书的条目，或该世界书不存在。`),Ne=null,null)}catch(e){return console.error('[LorebookService] 调用 getLorebookEntries 时出错:',e),null}}async function Ve(e,t=!1){const n=await be(t);if(!n)return null;const o=n.find(t=>t.comment===e||t.name===e);return o?o.content:null}async function Se(e,t,n={isEnabled:!0,keys:[]}){console.log(`[Roo Debug] Lorebook: Preparing to write/create entry: "${e}".`);const o=await be();if(!o)return;const a=o.find(t=>t.comment===e||t.name===e);try{if(a)console.log(`[Roo Debug] Lorebook: Entry "${e}" exists. Updating with setLorebookEntries.`),await TavernHelper.setLorebookEntries(Ee,[{uid:a.uid,content:t,enabled:n.isEnabled}]);else{console.log(`[Roo Debug] Lorebook: Entry "${e}" does not exist. Creating with createLorebookEntries.`);const a=e.replace(/\(\d+\)$/,''),l=o.find(e=>e.comment===a||e.name===a),r={comment:e,content:t,keys:[e],enabled:n.isEnabled,position:'before_character_definition',order:100};l&&Object.assign(r,{keys:[...l.keys||[],e],selective:l.selective,constant:l.constant,position:l.position,order:l.order,case_sensitive:l.case_sensitive}),console.log(`[Roo Debug] Lorebook: Calling createLorebookEntries for "${e}" with payload:`,JSON.stringify(r)),await TavernHelper.createLorebookEntries(Ee,[r])}console.log(`[LorebookService] API call for "${e}" completed successfully.`),Ne=null}catch(t){console.error(`[LorebookService] 操作条目 "${e}" 时出错:`,t)}}const Be={getEntries:be,readFromLorebook:Ve,writeToLorebook:Se,appendToEntry:async function(e,t,n='\n\n---\n\n'){console.log(`[Roo Debug] Lorebook: Appending to entry "${e}".`);try{const o=await Ve(e),a=o?`${o}${n}${t}`:t;await Se(e,a)}catch(t){console.error(`[LorebookService] 追加内容到条目 "${e}" 时出错:`,t)}},findEntryByComment:function(e){return Ne?Ne.find(t=>t.comment===e)||null:(console.warn('[LorebookService] findEntryByComment called before cache was populated.'),null)},setEntryEnabled:async function(e,t){console.log(`[LorebookService] Setting entry "${e}" enabled status to: ${t}`);try{const n=await be();if(!n)return;const o=n.find(t=>t.comment===e||t.name===e);if(o){const n={...o,enabled:t};await TavernHelper.setLorebookEntries(Ee,[n]),console.log(`[LorebookService] Successfully set "${e}" enabled=${t}.`)}else console.warn(`[LorebookService] setEntryEnabled: Entry "${e}" not found. Skipping.`)}catch(t){console.error(`[LorebookService] 操作条目 "${e}" 启用状态时出错:`,t)}},loadAndParseWorldData:async function(e='主世界'){try{const t=await Ve(e);if(!t)return console.warn(`[LorebookService] 未能读取到名为 "${e}" 的世界书条目内容。`),null;const n=function(e){if(!e)return console.warn('[WorldMapParser] Received empty or null lore content.'),null;const t=e.indexOf('自动化规则:');if(-1===t)return console.error('[WorldMapParser] "自动化规则:" block not found in the lorebook entry.'),null;const n=e.substring(t).split('\n').slice(1),o={},a=[{level:-1,obj:o}];for(const e of n){if(''===e.trim())continue;const t=e.match(/^\s*/),n=t?t[0].length:0,o=e.trim();for(;a.length>1&&n<=a[a.length-1].level;)a.pop();let l=a[a.length-1].obj;if(o.startsWith('- ')){const e=o.substring(2).trim();if(!Array.isArray(l)){const e=a[a.length-2].obj,t=Object.keys(e).pop();if(!t||e[t]!==l)continue;l=[],e[t]=l,a[a.length-1].obj=l}if(-1===e.indexOf(':'))l.push(ke(e));else{const t={};l.push(t),a.push({level:n,obj:t}),ye(e,t,n,a)}}else ye(o,l,n,a)}return o}(t);if(n&&n.历史纪元&&n.元规则){const e=n.元规则.当前纪元ID;if(e&&n.历史纪元[e])return n.历史纪元[e];const t=Object.values(n.历史纪元).find(e=>e.可扮演);if(t)return t}return console.warn(`[LorebookService] 在 "${e}" 的世界数据中未能找到激活的纪元信息。`),null}catch(t){return console.error(`[LorebookService] 解析世界数据 "${e}" 时出错:`,t),null}}};const we=new class{INSTANT_MEMORY_KEY='[系统]瞬时记忆';SHORT_TERM_MEMORY_KEY='[系统]短期记忆';LONG_TERM_MEMORY_KEY='[系统]长期记忆';config={instantMemoryCount:15,shortTermMemoryCount:30,longTermMemoryCount:60};async updateMemory(e){console.log('[MemoryService] Updating all memory tiers...');try{await this.updateInstantMemory(e),await this.updateShortTermMemory(e),await this.updateLongTermMemory(e),console.log('[MemoryService] All memory tiers updated successfully.')}catch(e){console.error('[MemoryService] Failed to update memory tiers:',e)}}async updateInstantMemory(e){const t=e.slice(-this.config.instantMemoryCount);if(0===t.length)return void await this.writeMemory(this.INSTANT_MEMORY_KEY,'暂无瞬时记忆。');const n=t.map(e=>[`序号|${e.序号}`,`日期|${e.日期}`,`标题|${e.标题}`,`地点|${e.地点}`,`人物|${e.人物}`,`描述|${e.描述}`,`人物关系|${e.人物关系}`,`标签|${Array.isArray(e.标签)?e.标签.join(', '):e.标签}`,`重要信息|${e.重要信息}`,`暗线与伏笔|${e.暗线与伏笔}`,`自动化系统|${e.自动化系统}`].join('\n')).join('\n\n---\n\n');await this.writeMemory(this.INSTANT_MEMORY_KEY,n.trim())}async updateShortTermMemory(e){const t=e.slice(-this.config.shortTermMemoryCount);if(0===t.length)return void await this.writeMemory(this.SHORT_TERM_MEMORY_KEY,'暂无短期记忆。');const n=t.map(e=>[`序号|${e.序号}`,`日期|${e.日期}`,`标题|${e.标题}`,`人物|${e.人物}`,`描述|${e.描述}`].join('\n')).join('\n\n---\n\n');await this.writeMemory(this.SHORT_TERM_MEMORY_KEY,n.trim())}async updateLongTermMemory(e){const t=e.slice(-this.config.longTermMemoryCount);if(0===t.length)return void await this.writeMemory(this.LONG_TERM_MEMORY_KEY,'暂无长期记忆。');const n=t.map(e=>`[${e.日期}] ${e.标题}: ${e.描述}`).join('\n');await this.writeMemory(this.LONG_TERM_MEMORY_KEY,n)}async writeMemory(e,t){await Be.writeToLorebook(e,t,{isEnabled:!0,keys:[e]})}getConfig(){return this.config}setConfig(e){this.config={...this.config,...e},console.log('[MemoryService] Config updated:',this.config)}},Ce=(0,x.reactive)({notifications:[]});let De=0;const xe={show(e,t,n='info',o=4e3){const a=De++;Ce.notifications.push({id:a,title:e,message:t,type:n}),o>0&&setTimeout(()=>{this.hide(a)},o)},hide(e){const t=Ce.notifications.findIndex(t=>t.id===e);-1!==t&&Ce.notifications.splice(t,1)},success(e,t,n=4e3){this.show(e,t,'success',n)},info(e,t,n=4e3){this.show(e,t,'info',n)},warn(e,t,n=5e3){this.show(e,t,'warning',n)},error(e,t,n=7e3){this.show(e,t,'error',n)}},Ie=Ce,$e=xe;const _e=new class{async fetchTavernData(){console.debug('Fetching data from Tavern...');const e=await getChatMessages(getCurrentMessageId());return console.debug('Messages received:',e),e}async generateAiResponse(e,t){const n={injects:[{role:'user',content:e,position:'in_chat',should_scan:!0}],should_stream:!1};t&&(n.variables=t);const o=await TavernHelper.generate(n);if('string'!=typeof o)throw new Error('AI未能返回有效文本。');return o}async invokeMvuScript(e,t){const n={old_variables:t};return await eventEmit('mag_invoke_mvu',e,n),n.new_variables}};const ze=new class{indexByName=new Map;indexById=new Map;isInitialized=!1;async buildIndex(e){if(!this.isInitialized&&e){console.log('[EntityIndexService] Starting to build global entity index...'),this.indexByName.clear(),this.indexById.clear(),this.indexPlayerData(e.玩家);for(const t in e.世界){const n=e.世界[t];n&&this.indexWorldData(n,t)}this.isInitialized=!0,console.log(`[EntityIndexService] Global entity index built successfully with ${this.indexById.size} entries.`)}}findByName(e){return this.indexByName.get(e)}findById(e){return this.indexById.get(e)}addEntity(e){const t=this.indexByName.get(e.name)||[];this.indexByName.set(e.name,[...t,e]),this.indexById.has(e.id)||this.indexById.set(e.id,e)}indexPlayerData(e){if(!e)return;const t=(0,he.get)(e,'本体.已解锁烙印',{});for(const e in t){if('$meta'===e)continue;const n=t[e];n&&n.名称&&this.addEntity({id:e,name:n.名称,type:'imprint',worldId:'_player',source:'player'})}}indexWorldData(e,t){const n=(0,he.get)(e,'角色',{});for(const e in n){if('$meta'===e||e.startsWith('sample_'))continue;const o=n[e];o&&o.姓名&&this.addEntity({id:e,name:o.姓名,type:'character',worldId:t,source:'world'})}const o=(0,he.get)(e,'数据库',{});for(const e in o){if('$meta'===e)continue;const n=o[e];if(n)for(const o in n){if('$meta'===o)continue;const a=n[o];a&&a.名称&&this.addEntity({id:o,name:a.名称,type:'dbItem',worldId:t,category:e,source:'world'})}}const a=(0,he.get)(e,'定义',{}),l=(0,he.get)(a,'历史纪元',{});for(const e in l){if('$meta'===e)continue;const n=l[e],o=(0,he.get)(n,'内容',{}),a=(0,he.get)(o,'空间实体',{});for(const n in a){if('$meta'===n)continue;const o=a[n];o&&o.名称&&this.addEntity({id:n,name:o.名称,type:'location',worldId:t,epochId:e,source:'world',path:`定义.历史纪元.${e}.内容.空间实体`,parentId:o.所属?.ID||null})}const r=(0,he.get)(o,'资源',{});for(const n in r){if('$meta'===n)continue;const o=r[n];o&&o.名称&&this.addEntity({id:n,name:o.名称,type:'resource',worldId:t,epochId:e,source:'world',path:`定义.历史纪元.${e}.内容.资源`})}const i=(0,he.get)(o,'文明.势力',{});for(const n in i){if('$meta'===n)continue;const o=i[n];o&&o.名称&&this.addEntity({id:n,name:o.名称,type:'faction',worldId:t,epochId:e,source:'world',path:`定义.历史纪元.${e}.内容.文明.势力`})}}}};const Le=new class{analyzeUserIntent(e,t,n){const o={actionType:'default',explicitEntities:{characters:[],locations:[],dbItems:[]},triggeredRipples:[]};if(!t)return o;const a=Object.values(t.世界||{}).find(e=>['主世界','当前化身世界'].includes((0,he.get)(e,'定义.元规则.定位',''))),l=(0,he.get)(t,'玩家.模拟器.模拟.当前化身ID'),r=l?(0,he.get)(a,`角色.${l}`):(0,he.get)(t,'玩家.本体');if(r&&a){const e=r.当前位置;if(e){o.explicitEntities.locations.push(e);let t=ze.findById(e)?.parentId;for(;t&&'WORLD_ORIGIN'!==t;)o.explicitEntities.locations.push(t),t=ze.findById(t)?.parentId;const n=(0,he.get)(a,'角色',{});for(const t in n)(0,he.get)(n,`${t}.当前位置`)===e&&o.explicitEntities.characters.push(t)}}const i={combat:0,inventory:0,social:0,exploration:0,creation:0,default:1};[{type:'combat',regex:/(攻击|战斗|防御|躲闪|释放|技能|杀|击败|对决|戒备|危险|威胁)/,weight:3},{type:'inventory',regex:/(背包|物品|整理|装备|使用|查看|烙印|道具|储物|空间)/,weight:2},{type:'social',regex:/(对话|交谈|说服|询问|关系|告诉|回答|问|交流|打听|请求|命令)/,weight:2},{type:'social',regex:/["“].*["”]/,weight:1.5},{type:'exploration',regex:/(探索|前往|调查|寻找|去|观察|看|感知|探查|追踪|周围|环境)/,weight:2},{type:'creation',regex:/(创造|合成|炼制|打造|制作|修复|附魔)/,weight:3}].forEach(({type:t,regex:n,weight:o})=>{n.test(e)&&(i[t]+=o)});let c=0,s='default';for(const[e,t]of Object.entries(i))t>c&&(c=t,s=e);o.actionType=s;const d=e.match(/[\u4e00-\u9fa5a-zA-Z]+/g)||[];for(const e of d){const n=ze.findByName(e);if(n)for(const e of n){switch(e.type){case'character':o.explicitEntities.characters.push(e.id);break;case'location':o.explicitEntities.locations.push(e.id);break;case'dbItem':case'skill':case'artifice':case'talent':o.explicitEntities.dbItems.push(e.id);break;case'imprint':'player'===e.source&&(o.loadFullPlayerData||(o.loadFullPlayerData=[]),o.loadFullPlayerData.push('已解锁烙印'))}const n=Object.keys(t.世界).find(e=>['主世界','当前化身世界'].includes((0,he.get)(t,`世界.${e}.定义.元规则.定位`)||''));e.worldId!==n&&'_player'!==e.worldId&&(o.crossContextQuery||(o.crossContextQuery={worldId:e.worldId,items:[],locations:[]}),'location'===e.type?o.crossContextQuery.locations?.push(e.id):o.crossContextQuery.items?.push(e.id))}}if(r)for(const e of n){const n=e.sphereOfInfluence;let a=!1;if(r.当前位置&&n.locationIds.includes(r.当前位置)&&(a=!0),a){console.log(`[EvoSys-Gravity] Ripple ${e.id} was triggered by narrative gravity.`,e),o.triggeredRipples.push(e);const n=this.extractEntitiesFromText(e.content,t);o.explicitEntities.characters.push(...n.characters),o.explicitEntities.locations.push(...n.locations),o.explicitEntities.dbItems.push(...n.dbItems)}}return'inventory'===o.actionType&&(o.loadFullPlayerData||(o.loadFullPlayerData=[]),o.loadFullPlayerData.push('背包','已解锁烙印')),console.log('[ContextService] User Intent Analyzed:',o),o}extractEntitiesFromText(e,t){const n={characters:[],locations:[],dbItems:[]};if(!t)return n;const o=e.match(/[\u4e00-\u9fa5a-zA-Z]+/g)||[];for(const e of o){const t=ze.findByName(e);if(t)for(const e of t)switch(e.type){case'character':n.characters.push(e.id);break;case'location':n.locations.push(e.id);break;case'dbItem':n.dbItems.push(e.id)}}return n}identifyCoreEntities(e,t,n){const o=new Set([t]);if(!n||!n.世界)return Array.from(o);const a=Object.values(n.世界).find(e=>'主世界'===(0,he.get)(e,'定义.元规则.定位')||'当前化身世界'===(0,he.get)(e,'定义.元规则.定位'));if(!a)return Array.from(o);const l=(0,he.get)(a,'角色',{}),r=(0,he.get)(l,t)||(0,he.get)(n,'玩家.本体');if(!r)return Array.from(o);const i=r.当前位置;for(const e in l)l[e].当前位置===i&&o.add(e);const c=(0,he.get)(a,'因果之网',{}),s=(0,he.get)(c,t,{}),d=Object.entries(s).map(([e,t])=>({id:e,intimacy:(0,he.get)(t,'情感层.亲近感',0),conflict:(0,he.get)(t,'利益层.利益冲突',0)})).sort((e,t)=>t.intimacy-e.intimacy);if(d.length>0){o.add(d[0].id);const e=d.sort((e,t)=>t.conflict-e.conflict)[0];e&&o.add(e.id)}for(const t in l){const n=l[t];n&&n.姓名&&e.includes(n.姓名)&&o.add(t)}return Array.from(o)}buildLeanContext(e,t,n,o){if(!n)return{stat_data:{}};const a={玩家:{本体:{},模拟器:(0,he.get)(n,'玩家.模拟器'),往世道标:(0,he.get)(n,'玩家.往世道标')},世界:{}},l=(0,he.get)(n,'玩家.本体',{}),r={...l};l.背包&&(r.背包=this.simplifyIdMap(l.背包)),l.已解锁烙印&&(r.已解锁烙印=this.simplifyIdMap(l.已解锁烙印)),e.loadFullPlayerData&&e.loadFullPlayerData.forEach(e=>{l[e]&&(r[e]=l[e])}),a.玩家.本体=r;const i=Array.from(new Set([o,...e.explicitEntities.characters])),c=Object.entries((0,he.get)(n,'世界',{})).find(([,e])=>'主世界'===(0,he.get)(e,'定义.元规则.定位')||'当前化身世界'===(0,he.get)(e,'定义.元规则.定位'));if(c){const[s,d]=c,m=(0,he.get)(d,'定义.元规则.当前纪元ID');if(m){const t=(0,he.get)(d,['定义','历史纪元',m]);if(t){const n={...t};delete n.内容,n.世界大事=(0,he.get)(t,'世界大事',{});const o=(0,he.get)(t,'内容.空间实体',{}),l={};if(e.explicitEntities.locations.length>0)for(const t of e.explicitEntities.locations){const e=o[t];if(e){l[t]=e;let n=(0,he.get)(e,'所属.ID');for(;n&&'WORLD_ORIGIN'!==n;){const e=o[n];if(!e)break;l[n]||(l[n]=e),n=(0,he.get)(e,'所属.ID')}}}Object.keys(l).length>0&&(n.内容={空间实体:l}),a.世界[s]||(a.世界[s]={}),a.世界[s].定义={元规则:(0,he.get)(d,'定义.元规则'),历史纪元:{[m]:n}}}}const u=(0,he.get)(n.世界[s],'角色',{}),p={},v=(0,he.get)(n,'玩家.模拟器.模拟.当前化身ID'),g=v?(0,he.get)(u,v):l,f=this.identifyCoreEntities(t,o,n);i.push(...f);const h=Array.from(new Set(i));for(const t of h){const n=(0,he.get)(u,t)||(t===o?l:null);n&&('combat'===e.actionType||'inventory'===e.actionType||n.当前位置===g?.当前位置?p[t]=n:p[t]={姓名:n.姓名,身份:n.身份,当前位置:n.当前位置,相貌:n.相貌,心流:n.心流,当前状态:n.当前状态})}a.世界[s].角色=p;const y=(0,he.get)(d,'因果之网',{});a.世界[s].因果之网={};const k=Object.keys(p);k.includes(o)||k.push(o);for(const e of k){const t=(0,he.get)(y,e);if(t){a.世界[s].因果之网||(a.世界[s].因果之网={}),a.世界[s].因果之网[e]={};for(const n in t)k.includes(n)&&(a.世界[s].因果之网[e][n]=t[n])}}const E=new Set([...e.explicitEntities.dbItems]),N=(0,he.get)(d,'数据库',{});if([r,...Object.values(p)].forEach(e=>{e.背包&&Object.keys(e.背包).forEach(e=>E.add(e)),e.已装备烙印&&e.已装备烙印.forEach(e=>e&&E.add(e))}),E.size>0&&N){a.世界[s].数据库||(a.世界[s].数据库={});for(const e in N){if('$meta'===e)continue;const t=(0,he.get)(N,e,{});for(const n of E)(0,he.get)(t,n)&&(a.世界[s].数据库[e]||(a.世界[s].数据库[e]={}),a.世界[s].数据库[e][n]=(0,he.get)(t,n))}}}if(e.crossContextQuery){const{worldId:t,items:o,locations:l}=e.crossContextQuery,r=(0,he.get)(n.世界,t);if(r&&(a.世界[t]||(a.世界[t]={}),o&&o.length>0)){const e=(0,he.get)(r,'数据库',{});a.世界[t].数据库||(a.世界[t].数据库={});for(const n in e){if('$meta'===n)continue;const l=e[n];o.forEach(e=>{l[e]&&(a.世界[t].数据库[n]||(a.世界[t].数据库[n]={}),a.世界[t].数据库[n][e]=l[e])})}}}return console.log('[ContextService] Built Lean Context V4:',{stat_data:a}),{stat_data:a}}simplifyIdMap(e){if(!e)return{};const t={};for(const n in e)'$meta'!==n&&(t[n]='number'!=typeof e[n]||e[n]);return t}},Me={NORMAL:['【cot】必要关键cot'],CREATION:['【cot】创世必要关键cot'],IDENTITY:['【cot】身份必要关键cot']};const Ae=new class{currentState='NORMAL';narrativeCache=null;updateScriptCache=null;preserveMode='none';constructor(){this.switchTo('NORMAL')}getCurrentState(){return this.currentState}async switchTo(e,t=!1){if(this.currentState===e&&!t)return;console.log(`[WorkflowService] Switching from ${this.currentState} to ${e} (Forced: ${t})`);const n=Object.values(Me).flat(),o=Me[e];for(const e of n){const t=o.includes(e);await Be.setEntryEnabled(e,t)}this.currentState=e,console.log(`[WorkflowService] Switched to ${e}. Enabled CoTs: ${o.join(', ')}`)}cacheNarrative(e){this.narrativeCache=e,console.log('[WorkflowService] Narrative cached.')}popNarrative(){const e=this.narrativeCache;return this.narrativeCache=null,e&&console.log('[WorkflowService] Popped cached narrative.'),e}cacheUpdateScript(e){this.updateScriptCache=e,console.log('[WorkflowService] Update script cached.')}popUpdateScript(){const e=this.updateScriptCache;return this.updateScriptCache=null,e&&console.log('[WorkflowService] Popped cached update script.'),e}setPreserveMode(e){this.preserveMode=e,console.log(`[WorkflowService] Preserve mode set to: ${e}`)}popPreservedContent(){let e='';return'gametxt'!==this.preserveMode&&'full'!==this.preserveMode||this.narrativeCache&&(e+=`\n<gametxt>${this.narrativeCache}</gametxt>`,console.log('[WorkflowService] Popped cached narrative for appending.')),'full'===this.preserveMode&&this.updateScriptCache&&(e+=`\n<UpdateVariable>${this.updateScriptCache}</UpdateVariable>`,console.log('[WorkflowService] Popped cached update script for appending.')),this.narrativeCache=null,this.updateScriptCache=null,this.preserveMode='none',e&&console.log('[WorkflowService] Final content to append length:',e.length),e}};function Oe(e){const t=e.match(/^\s*/);return t?t[0].length:0}function je(e,t,n){for(let o=t+1;o<e.length;o++){const t=e[o];if(''!==t.trim()&&Oe(t)<=n)return o}return e.length}function Te(e,t){const n=t.split('.');let o=e,a=0,l=-1,r=-1;for(const t of n){const n=t.match(/([^[]+)\[(.+?)=(.+?)\]/);let i=!1;if(n){const[,t,c,s]=n,d=new RegExp(`^\\s*${t.trim()}:`);let m=!1;for(let t=0;t<o.length;t++){const n=o[t],i=Oe(n);if(i>r&&d.test(n)){r=i,l=a+t;const n=je(e,l,r);a=l+1,o=e.slice(a,n),m=!0;break}}if(!m)return null;let u=!1;for(let t=0;t<o.length;t++){const n=o[t];if(n.trim().startsWith('-')){const i=a+t,d=Oe(n),m=je(e,i,d);for(let t=i;t<m;t++){const n=e[t],p=t===i?n.replace(/^\s*-\s*/,'  '):n;if(new RegExp(`^\\s*${c.trim()}:\\s*['"]?${s.trim()}['"]?`).test(p)){l=i,r=d,a=i+1,o=e.slice(a,m),u=!0;break}}}if(u)break}if(i=u,!i)return null}else{const n=new RegExp(`^\\s*${t.trim()}:`);for(let t=0;t<o.length;t++){const c=o[t],s=Oe(c);if(s>r&&n.test(c)){r=s,l=a+t;const n=je(e,l,r);a=l+1,o=e.slice(a,n),i=!0;break}}if(!i)return null}}if(-1!==l){return{startIndex:l,endIndex:je(e,l,r),parentIndent:r}}return null}function Fe(e,t,n){const o=Te(e,t);if(!o)return console.error(`[WorldUpdateService] ADD: 无法在内容中找到路径: ${t}`),e;const{endIndex:a,parentIndent:l}=o,r=n.split('\n');if(0===r.length)return e;const i=l+2,c=r.findIndex(e=>''!==e.trim());if(-1===c)return e;const s=i-Oe(r[c]),d=r.map(e=>{if(''===e.trim())return e;const t=Oe(e),n=Math.max(0,t+s);return' '.repeat(n)+e.trimStart()});return e.splice(a,0,...d),console.log(`[WorldUpdateService] 成功将内容智能缩进后添加到路径: ${t}`),e}function Re(e,t,n){const o=Te(e,t);if(!o)return console.error(`[WorldUpdateService] REPLACE: 无法在内容中找到路径: ${t}`),e;const{startIndex:a,endIndex:l,parentIndent:r}=o,i=r+2,c=n.split('\n').map(e=>' '.repeat(i)+e);return e.splice(a+1,l-(a+1),...c),console.log(`[WorldUpdateService] 成功替换路径内容: ${t}`),e}function We(e,t,n){const o=Te(e,t);if(!o)return console.error(`[WorldUpdateService] REMOVE: 无法在内容中找到路径: ${t}`),e;const{startIndex:a,endIndex:l}=o,r=n.trim().split('\n').map(e=>e.trim()),i=e.slice(a+1,l);let c=-1;for(let e=0;e<=i.length-r.length;e++){let t=!0;for(let n=0;n<r.length;n++)if(i[e+n].trim()!==r[n]){t=!1;break}if(t){c=e;break}}if(-1!==c){const n=a+1+c;e.splice(n,r.length),console.log(`[WorldUpdateService] 成功从路径中移除内容: ${t}`)}else console.warn(`[WorldUpdateService] REMOVE: 在路径 "${t}" 下未找到要移除的内容。`);return e}const Pe=new class{async applyModifications(e,t){if(!e||!t)return;const n=await Be.readFromLorebook(t);if(null===n)return void console.error(`[WorldUpdateService] 读取世界书条目失败: "${t}"`);let o=n.split('\n');const a=n,l=e.split(/(?=\n(?:替换 ')|(?=\n(?:添加 到 '))|(?=\n(?:从 '))|^替换 '|^添加 到 '|^从 ')/g).filter(e=>e.trim());for(const e of l){const t=e.trim(),n=t.match(/^添加 到 '([^']*)' 内容为:\s*([\s\S]*)/),l=t.match(/^替换 '([^']*)' 内容为:\s*([\s\S]*)/),r=t.match(/^从 '([^']*)' 中移除:\s*([\s\S]*)/);if(n){const[,e,t]=n,l=t.match(/ID:\s*(\S+)/);if(l){const e=l[1];if(new RegExp(`ID:\\s*${e}`).test(a)){console.warn(`[WorldUpdateService] ID "${e}" 已存在，跳过 ADD 防止重复录入。`);continue}}o=Fe(o,e,t)}else if(l){const[,e,t]=l;o=Re(o,e,t)}else if(r){const[,e,t]=r;o=We(o,e,t)}}const r=o.join('\n');r.trim()!==a.trim()?(console.log(`[WorldUpdateService] 检测到内容变更，正在写入条目: "${t}"`),await Be.writeToLorebook(t,r)):console.log('[WorldUpdateService] 内容无变更，跳过写入操作。')}},Ue=z,He=Ue.z.string().min(1),Ge=Ue.z.object({description:Ue.z.string().optional(),extensible:Ue.z.boolean().optional()}),Je=Ue.z.record(Ue.z.string(),Ue.z.union([Ue.z.coerce.number(),Ue.z.string()])),Ye=Ue.z.object({attributes_bonus:Je.optional(),percentage_bonus:Je.optional()}),qe=Ue.z.object({年:Ue.z.coerce.number().prefault(0),月:Ue.z.coerce.number().prefault(0),日:Ue.z.coerce.number().prefault(0),时:Ue.z.coerce.number().prefault(0),分:Ue.z.coerce.number().prefault(0)}),Ke=Ue.z.object({名称:He,类型:He,能级:Ue.z.coerce.number().prefault(0),描述:Ue.z.string(),子类型:Ue.z.string().optional(),持续时间:qe.optional(),effects:Ye.optional(),纪元倾向:Ue.z.array(Ue.z.string()).optional(),所属世界ID:Ue.z.string().optional()}),Qe=Ue.z.object({ID:He,名称:He,描述:Ue.z.string(),关联技艺:Ue.z.string(),类型:Ue.z.string(),基础效果:Ue.z.string(),效果等级公式:Ue.z.string()}),Xe=Ue.z.object({ID:He,名称:He,描述:Ue.z.string(),关联潜力:Ue.z.string(),等级上限:Ue.z.coerce.number().prefault(0),效果描述:Ue.z.string().optional(),效果等级公式:Ue.z.string().optional(),等级体系:Ue.z.object({$meta:Ge.optional()}).catchall(Ue.z.object({等级:Ue.z.coerce.number().prefault(0),称号:Ue.z.string(),升级所需经验:Ue.z.coerce.number().prefault(0)})).prefault({})}),Ze=Ue.z.object({认知层:Ue.z.object({可靠度:Ue.z.coerce.number().prefault(0),能力评价:Ue.z.coerce.number().prefault(0),威胁度:Ue.z.coerce.number().prefault(0)}).prefault({可靠度:0,能力评价:0,威胁度:0}),情感层:Ue.z.object({亲近感:Ue.z.coerce.number().prefault(0),仰慕度:Ue.z.coerce.number().prefault(0)}).prefault({亲近感:0,仰慕度:0}),利益层:Ue.z.object({资源价值:Ue.z.coerce.number().prefault(0),合作潜力:Ue.z.coerce.number().prefault(0),利益冲突:Ue.z.coerce.number().prefault(0)}).prefault({资源价值:0,合作潜力:0,利益冲突:0}),社会层:Ue.z.object({名义关系:Ue.z.record(Ue.z.string(),Ue.z.object({关系:Ue.z.string(),描述:Ue.z.string().optional()})).optional().prefault({}),阶级差异:Ue.z.coerce.number().prefault(0),阵营立场:Ue.z.string().prefault('中立')}).prefault({名义关系:{},阶级差异:0,阵营立场:'中立'}),印象标签:Ue.z.object({认知标签:Ue.z.string().prefault(''),情感标签:Ue.z.string().prefault(''),利益标签:Ue.z.string().prefault(''),社会标签:Ue.z.string().prefault(''),综合标签:Ue.z.string().prefault('')}).prefault({认知标签:'',情感标签:'',利益标签:'',社会标签:'',综合标签:''}),因果标签:Ue.z.record(Ue.z.string(),Ue.z.object({标签:Ue.z.string(),来源:Ue.z.string()})).optional().prefault({})}),et=Ue.z.object({名称:Ue.z.string(),动机:Ue.z.string().optional().prefault(''),状态:Ue.z.string().optional().prefault('进行中')}),tt=Ue.z.object({$meta:Ge.optional(),真名:Ue.z.string().optional(),姓名:Ue.z.string().optional(),灵魂本源:Ue.z.coerce.number().optional(),道心:Ue.z.coerce.number().optional(),出生日期:Ue.z.object({纪元ID:Ue.z.string(),年:Ue.z.coerce.number(),月:Ue.z.coerce.number(),日:Ue.z.coerce.number()}),身份:Ue.z.record(Ue.z.string(),Ue.z.string()).optional(),所属世界:Ue.z.string(),当前位置:Ue.z.string(),性别:Ue.z.string(),相貌:Ue.z.string(),着装:Ue.z.string(),背景:Ue.z.object({过去经历:Ue.z.record(Ue.z.string(),Ue.z.object({事件:Ue.z.string(),影响:Ue.z.string()})).optional(),性格特质:Ue.z.record(Ue.z.string(),Ue.z.string()).optional()}),心流:Ue.z.object({情绪状态:Ue.z.object({心绪:Ue.z.coerce.number().prefault(0),怒意:Ue.z.coerce.number().prefault(0),胆识:Ue.z.coerce.number().prefault(0),仪态:Ue.z.coerce.number().prefault(0)}),核心需求:Ue.z.string(),秘密:Ue.z.record(Ue.z.string(),Ue.z.object({内容:Ue.z.string(),揭露条件:Ue.z.string()})).optional(),短期记忆:Ue.z.record(Ue.z.string(),Ue.z.any()).optional(),驱动力:Ue.z.object({长期目标:Ue.z.object({$meta:Ge.optional()}).catchall(et).prefault({}),短期目标:Ue.z.object({$meta:Ge.optional()}).catchall(et).prefault({}),决策倾向:Ue.z.object({常规:Ue.z.string().default(''),优势时:Ue.z.string().default(''),险境时:Ue.z.string().default(''),面对利益时:Ue.z.string().default('')})})}).optional(),本世宿命:Ue.z.object({}).passthrough().optional(),技艺:Ue.z.record(Ue.z.string(),Ue.z.object({等级:Ue.z.coerce.number().prefault(0),经验值:Ue.z.coerce.number().prefault(0)})).optional(),天赋:Ue.z.record(Ue.z.string(),Ue.z.boolean()).optional(),基础潜力:Ue.z.object({精:Ue.z.coerce.number().prefault(0),气:Ue.z.coerce.number().prefault(0),神:Ue.z.coerce.number().prefault(0),运:Ue.z.coerce.number().prefault(0)}),战斗参数:Ue.z.object({权能:Ue.z.coerce.number().prefault(0),根基:Ue.z.coerce.number().prefault(0),机变:Ue.z.coerce.number().prefault(0),破法:Ue.z.coerce.number().prefault(0),御法:Ue.z.coerce.number().prefault(0)}),当前状态:Ue.z.record(Ue.z.string(),Ue.z.any()).and(Ue.z.object({$meta:Ge.optional()})).prefault({$meta:{}}),背包:Ue.z.record(Ue.z.string(),Ue.z.coerce.number()).and(Ue.z.object({$meta:Ge.optional()})).prefault({$meta:{}}),已解锁烙印:Ue.z.object({$meta:Ge.optional()}).catchall(Ue.z.boolean()).prefault({}),已装备烙印:Ue.z.array(Ue.z.string().nullable()).optional(),世界专属属性:Ue.z.object({$meta:Ge.optional()}).catchall(Ue.z.any()).prefault({})}).passthrough(),nt=Ue.z.object({纪元名称:Ue.z.string(),可扮演:Ue.z.boolean(),纪元概述:Ue.z.string(),当前时间:Ue.z.union([qe.extend({纪元名称:Ue.z.string().prefault(''),纪元顺序:Ue.z.coerce.number().prefault(1)}),Ue.z.string()]).transform(e=>'string'==typeof e?{纪元名称:'',纪元顺序:1,年:0,月:0,日:0,时:0,分:0}:e),规则:Ue.z.object({世界能级:Ue.z.coerce.number().prefault(0),时间流速:Ue.z.union([Ue.z.string(),Ue.z.coerce.number()]).transform(e=>{if('number'==typeof e)return e;if('string'==typeof e){const t=parseInt(e,10);return isNaN(t)?1:t}return 1}).pipe(Ue.z.coerce.number()).prefault(1),空间稳定性:Ue.z.coerce.number(),生命位格:Ue.z.union([Ue.z.object({基准值:Ue.z.coerce.number(),描述:Ue.z.string()}),Ue.z.coerce.number()]).transform(e=>'number'==typeof e?{基准值:e,描述:''}:e),核心法则:Ue.z.object({$meta:Ge.optional()}).catchall(Ue.z.object({名称:Ue.z.string(),描述:Ue.z.string(),体现:Ue.z.string().optional().prefault('')})).prefault({}),权柄:Ue.z.object({$meta:Ge.optional()}).catchall(Ue.z.object({名称:Ue.z.string(),类型:Ue.z.string(),描述:Ue.z.string(),显化能级:Ue.z.object({当前能级:Ue.z.coerce.number(),能级上限:Ue.z.coerce.number(),影响:Ue.z.string()})})).prefault({})}).passthrough(),世界大事:Ue.z.object({$meta:Ge.optional()}).catchall(Ue.z.any()).prefault({}),力量体系:Ue.z.object({}).passthrough()}),ot=Ue.z.object({$meta:Ge.optional(),元规则:Ue.z.object({宇宙蓝图:Ue.z.string(),物理尺度:Ue.z.string(),支持纪元穿越:Ue.z.boolean(),定位:Ue.z.string().optional(),当前纪元ID:Ue.z.string()}),历史纪元:Ue.z.object({$meta:Ge.optional()}).catchall(nt).prefault({})}),at=Ue.z.object({$meta:Ge.optional(),数据库:Ue.z.object({$meta:Ge.optional(),消耗品:Ue.z.record(Ue.z.string(),Ke).optional(),奇物:Ue.z.record(Ue.z.string(),Ke).optional(),材料:Ue.z.record(Ue.z.string(),Ke).optional(),羁绊:Ue.z.record(Ue.z.string(),Ke).optional(),烙印:Ue.z.record(Ue.z.string(),Ke).optional(),天赋:Ue.z.record(Ue.z.string(),Ke).optional(),回响:Ue.z.record(Ue.z.string(),Ke).optional(),技艺:Ue.z.record(Ue.z.string(),Xe).optional(),技能:Ue.z.record(Ue.z.string(),Qe).optional()}).passthrough().prefault({}),因果之网:Ue.z.object({$meta:Ge.optional()}).catchall(Ue.z.record(Ue.z.string().describe('客体ID'),Ze)).prefault({}),往世道标:Ue.z.object({$meta:Ge.optional()}).catchall(Ue.z.record(Ue.z.string().describe('纪元ID'),Ue.z.object({}).passthrough())).prefault({}),角色:Ue.z.object({$meta:Ge.optional()}).catchall(tt).prefault({}),世界:Ue.z.object({$meta:Ge.optional()}).catchall(ot).prefault({}),模拟器:Ue.z.object({准备:Ue.z.object({状态:Ue.z.string(),冷却时间:Ue.z.string(),已选世界ID:Ue.z.string().nullable(),已选化身模板:Ue.z.string().nullable()}),模拟:Ue.z.object({进行中:Ue.z.boolean(),当前化身ID:Ue.z.string().nullable(),干预记录:Ue.z.object({$meta:Ge.optional()}).catchall(Ue.z.any()).prefault({})}),结算:Ue.z.object({待处理:Ue.z.boolean(),本世小结:Ue.z.object({最高成就:Ue.z.string(),关键记忆:Ue.z.array(Ue.z.any())}),宿命抉择:Ue.z.object({$meta:Ge.optional()}).catchall(Ue.z.object({选项类型:Ue.z.string(),描述:Ue.z.string(),消耗:Ue.z.coerce.number(),数据:Ue.z.object({ID:Ue.z.string(),名称:Ue.z.string()}),目标路径:Ue.z.string()})).prefault({})})})}).passthrough().describe('完整的世界状态');function lt(e){if((e=e.trim()).startsWith('{')&&e.endsWith('}'))try{const t=e.slice(1,-1).split(','),n={};for(const e of t){const t=e.split(':');if(2===t.length){const e=t[0].trim().replace(/["']/g,''),o=t[1].trim().replace(/["']/g,'');n[e]=o}}return n}catch(t){return e}return e}function rt(e){if(!e)return null;const t=e.split('\n'),n={},o=[{obj:n,indent:-1}];for(const e of t){if(''===e.trim())continue;const n=(e.match(/^\s*/)||[''])[0].length,a=e.trim();for(;n<=o[o.length-1].indent;)o.pop();const l=o[o.length-1].obj;if(a.startsWith('- ')){const e=a.substring(2).trim();if(Array.isArray(l)){const t=e.indexOf(':');if(t>-1){const a=e.substring(0,t).trim(),r=e.substring(t+1).trim(),i={};i[a]=r,l.push(i),o.push({obj:i,indent:n})}else l.push(e)}}else{const r=a.indexOf(':');if(r>-1){const i=a.substring(0,r).trim(),c=a.substring(r+1).trim();if(c)l[i]=lt(c);else{const a=t.indexOf(e)+1;if(a<t.length&&t[a].trim().startsWith('-')){const e=[];l[i]=e,o.push({obj:e,indent:n})}else{const e={};l[i]=e,o.push({obj:e,indent:n})}}}}}return 1===Object.keys(n).length&&n['自动化规则']?n['自动化规则']:n}const it={isReady:!1,character:null,worldState:null,userId:'{{user}}',mainWorldNarrative:'正在连接主世界...',avatarWorldNarrative:'',activeView:'mainWorld',selectedWorldForReincarnation:null,reincarnationWorldOptions:[],reincarnationAvatarOptions:[],worldLog:[],settlementData:null,newWorldsAvailable:!1,isGenerating:!1,generationError:null},ct=(0,x.reactive)({...it,getItemNameById(e){const t=this.worldState?.数据库;if(!t)return null;for(const n in t){const o=t[n];if(o&&o[e])return o[e].名称||null}return null}});(0,x.watch)(()=>ct.character,(e,t)=>{console.log('[State Watch] Character changed:',e)},{deep:!0}),(0,x.watch)(()=>ct.isReady,e=>{console.log(`[State Watch] Store is now ${e?'ready':'not ready'}.`)});const st=(0,x.computed)(()=>ct.worldState?(0,he.get)(ct.worldState.角色,ct.userId,null):null),dt=(0,x.computed)(()=>{if(!ct.worldState?.模拟器||!ct.worldState?.角色)return null;const e=(0,he.get)(ct.worldState.模拟器,'模拟.当前化身ID');return e?(0,he.get)(ct.worldState.角色,e,null):null}),mt=(0,x.computed)(()=>ct.worldState?.模拟器),ut=((0,x.computed)(()=>ct.mainWorldNarrative),(0,x.computed)(()=>ct.avatarWorldNarrative),(0,x.computed)(()=>st.value?(0,he.get)(st.value,'灵魂本源',0):0),(0,x.computed)(()=>st.value?(0,he.get)(st.value,'道心',0):0),(0,x.computed)(()=>{const e=st.value,t=ct.worldState?.数据库;if(!e||!t?.烙印)return[];const n=(0,he.get)(e,'已解锁烙印',{}),o=[];for(const e in n)n[e]&&t.烙印[e]&&o.push({...t.烙印[e],ID:e});return o})),pt=(0,x.computed)(()=>{const e=st.value,t=ct.worldState?.数据库;if(!e||!t?.技艺)return[];const n=(0,he.get)(e,'技艺',{}),o=[];for(const e in n){const a=n[e],l=t.技艺[e];if(l&&l.等级体系){const n=Object.values(l.等级体系).filter(e=>'object'==typeof e&&null!==e&&'等级'in e),r=n.find(e=>e.等级===a.等级),i=n.find(e=>e.等级===a.等级+1),c=[];if(t.技能)for(const n in t.技能){const o=t.技能[n];o.关联技艺===e&&c.push(o)}o.push({id:e,name:l.名称,description:l.描述,level:a.等级,exp:a.经验值,expToNextLevel:i?i.升级所需经验:r?.升级所需经验||'MAX',title:r?r.称号:'',associatedSkills:c})}}return o}),vt=e=>(0,x.computed)(()=>{const t=e.value,n=ct.worldState?.数据库;if(!t||!n)return[];const o=(0,he.get)(t,'背包',{}),a=[];for(const e in o){const t=o[e];if(t<=0)continue;let l=null;for(const t in n){const o=n[t];if(o&&o[e]){l=o[e];break}}l&&a.push({...l,ID:e,数量:t})}return a}),gt=vt(st),ft=vt(dt),ht=((0,x.computed)(()=>st.value?(0,he.get)(st.value,'基础潜力',{}):{}),(0,x.computed)(()=>{const e=st.value,t=bt.value;if(!e||!e.世界专属属性)return[];const n=e.世界专属属性,o=t?.力量体系?.属性模板||{},a=[];for(const e in n){if('$meta'===e)continue;const t=n[e],l=o[e];a.push({key:e,value:t,description:l?.描述||null})}return a})),yt=(0,x.computed)(()=>{if(!mt.value)return!1;return!!(0,he.get)(mt.value,'模拟.进行中',!1)}),kt=(0,x.computed)(()=>{if(!mt.value)return{status:'未知',time:'N/A'};const e=(0,he.get)(mt.value,'准备',{});return{status:(0,he.get)(e,'状态','未知'),time:(0,he.get)(e,'冷却时间','N/A')}}),Et=(0,x.computed)(()=>{if(!ct.worldState?.世界)return null;const e=ct.worldState.世界;for(const t in e)if('$meta'!==t&&!t.includes('template')&&'主世界'===(0,he.get)(e[t],'元规则.定位'))return e[t];return null}),Nt=(0,x.computed)(()=>{if(!ct.worldState?.世界)return null;const e=ct.worldState.世界;for(const t in e)if('$meta'!==t&&!t.includes('template')&&'当前化身世界'===(0,he.get)(e[t],'元规则.定位'))return e[t];return null}),bt=(0,x.computed)(()=>{const e=Nt.value||Et.value;if(!e)return null;const t=(0,he.get)(e,'元规则.当前纪元ID');return t?(0,he.get)(e,`历史纪元.${t}`,null):null}),Vt=(e,t)=>{if(!e)return t;const n=(0,he.get)(e,'纪元名称',''),o=(0,he.get)(e,'年','----'),a=String((0,he.get)(e,'月','--')).padStart(2,'0'),l=String((0,he.get)(e,'日','--')).padStart(2,'0'),r=String((0,he.get)(e,'时','--')).padStart(2,'0'),i=(0,he.get)(e,'分');return`${n} ${o}年${a}月${l}日 ${r}:${null==i||isNaN(parseInt(String(i),10))?'--':String(parseInt(String(i),10)).padStart(2,'0')}`},St=(0,x.computed)(()=>{const e=Et.value;if(!e)return'轮回空间';const t=(0,he.get)(e,'元规则.当前纪元ID');if(!t)return'未知纪元';const n=(0,he.get)(e,`历史纪元.${t}`);return Vt((0,he.get)(n,'当前时间'),'轮回空间')}),Bt=(0,x.computed)(()=>{const e=Nt.value;if(!e)return'未知时间';const t=(0,he.get)(e,'元规则.当前纪元ID');if(!t)return'未知纪元';const n=(0,he.get)(e,`历史纪元.${t}`);return Vt((0,he.get)(n,'当前时间'),'未知时间')}),wt=(e,t)=>{if(!e||!t)return null;const n=(0,he.get)(e,'出生日期'),o=(0,he.get)(t,'元规则.当前纪元ID'),a=(0,he.get)(t,`历史纪元.${o}`),l=(0,he.get)(a,'当前时间');if(!n||!l||n.纪元ID!==o)return null;let r=l.年-n.年;return(l.月<n.月||l.月===n.月&&l.日<n.日)&&r--,r>=0?r:null},Ct=((0,x.computed)(()=>wt(st.value,Et.value)),(0,x.computed)(()=>{if('mainWorld'===ct.activeView){return`<div class="narrative-block main-world-narrative">${ct.mainWorldNarrative||'等待主世界故事的展开...'}</div>`}if('avatarWorld'===ct.activeView){if(yt.value){return`<div class="narrative-block avatar-world-narrative">${ct.avatarWorldNarrative||'化身世界暂无动静...'}</div>`}return'<div class="narrative-block narrative-placeholder">模拟未在进行中。</div>'}return'<div class="narrative-block narrative-placeholder">未知的视图...</div>'})),Dt=((0,x.computed)(()=>{const e=[],t=[],n=ct.worldState;if(!n)return{nodes:e,edges:t};if(n.世界)for(const t in n.世界){if('$meta'===t||'世界ID'===t)continue;const o=n.世界[t],a=(0,he.get)(o,'元规则.当前纪元ID');if(!a)continue;const l=(0,he.get)(o,`历史纪元.${a}`);if(!l||!l.规则)continue;const r=Be.findEntryByComment(t),i=r?.comment||(0,he.get)(o,'元规则.定位')||t,c=`\n        能级: ${l.规则?.世界能级||'未知'}<br>\n        时间流速: ${l.规则?.时间流速||'未知'}x<br>\n        空间稳定性: ${l.规则?.空间稳定性||'未知'}\n      `.trim();e.push({id:t,label:i,group:'world',title:c})}if(n.角色)for(const o in n.角色){if('$meta'===o||'sample_npc_id'===o)continue;const a=n.角色[o];if(!a.姓名&&!a.真名)continue;const l=o===ct.userId,r=a.基础潜力,i=r?`精: ${r.精} | 气: ${r.气} | 神: ${r.神} | 运: ${r.运}`:'',c=`\n        ${a.身份?Object.values(a.身份).filter(e=>'string'==typeof e).join(', '):''}<br>\n        ${i}\n      `.trim();e.push({id:o,label:a.姓名||a.真名||o,group:l?'player':'npc',title:c}),a.所属世界&&n.世界?.[a.所属世界]&&t.push({from:o,to:a.所属世界,arrows:'to'})}if(n.因果之网)for(const e in n.因果之网){if(!n.角色[e])continue;const o=n.因果之网[e];for(const a in o){if(!n.角色[a])continue;const l=o[a],r=((0,he.get)(l,'情感层.亲近感',0)||0)+((0,he.get)(l,'情感层.仰慕度',0)||0),i=(0,he.get)(l,'利益层.利益冲突',0)||0;t.push({from:e,to:a,label:(0,he.get)(l,'印象标签.综合标签',''),color:r>50?'#4caf50':r<-50?'#f44336':'#9e9e9e',dashes:i>50,arrows:'to'})}}return{nodes:e,edges:t}}),(0,x.computed)(()=>ct.worldState?.模拟器?.结算?ct.worldState.模拟器.结算:null));const xt=new class{timerId=null;isRunning=!1;isUpdating=!1;updateCallback=null;start(e,t=5e3){this.isRunning?console.log('[SilentUpdater] Updater is already running.'):(this.updateCallback=e,this.timerId=window.setInterval(()=>this.runUpdate(),t),this.isRunning=!0,console.log(`[SilentUpdater] Started with an interval of ${t/1e3} seconds.`))}stop(){this.timerId&&(window.clearInterval(this.timerId),this.timerId=null),this.isRunning=!1,this.updateCallback=null,console.log('[SilentUpdater] Stopped.')}reset(){if(!this.isRunning||!this.updateCallback)return;this.timerId&&window.clearInterval(this.timerId);const e=this.timerId?this.timerId.__interval:5e3;this.timerId=window.setInterval(()=>this.runUpdate(),e)}async runUpdate(){if(!this.isUpdating&&this.updateCallback){this.isUpdating=!0;try{await this.updateCallback(),console.debug('[SilentUpdater] Silent update check completed.')}catch(e){console.error('[SilentUpdater] Error during silent update:',e)}finally{this.isUpdating=!1}}else console.log('[SilentUpdater] Update in progress or callback not set. Skipping.')}};let It=null,$t=!1;function _t(e,t){if(!e||!t)return;const n=Object.keys((0,he.get)(e,'角色',{})).filter(e=>e.startsWith('npc_')),o=Object.keys((0,he.get)(t,'角色',{})).filter(e=>e.startsWith('npc_'));for(const e of o)if(!n.includes(e)){const n=(0,he.get)(t,`角色.${e}.姓名[0]`,e);$e.info('新角色登场',`你遇到了 ${n}。`)}const a=(0,he.get)(e,`角色.${ct.userId}.背包`,{}),l=(0,he.get)(t,`角色.${ct.userId}.背包`,{}),r=new Set([...Object.keys(a),...Object.keys(l)].filter(e=>'$meta'!==e));for(const e of r){const t=a[e]||0,n=(l[e]||0)-t;if(0!==n){const t=ct.getItemNameById(e)||e,o=n>0?'获得':'失去';$e.success('物品变更',`${o} ${t} x${Math.abs(n)}`)}}const i=(0,he.get)(e,`角色.${ct.userId}`,{}),c=(0,he.get)(t,`角色.${ct.userId}`,{}),s=(e,t)=>{const n=(0,he.get)(i,e),o=(0,he.get)(c,e);if(JSON.stringify(n)!==JSON.stringify(o))if('object'==typeof o&&null!==o)for(const e in o)(0,he.get)(n,e)!==(0,he.get)(o,e)&&$e.info('属性变化',`${t} - ${e} 变更为 ${(0,he.get)(o,e)}`);else $e.info('属性变化',`${t} 变更为 ${o}`)};s('灵魂本源','灵魂本源'),s('道心','道心'),s('基础潜力','基础潜力'),s('战斗参数','战斗参数'),s('世界专属属性','世界专属属性');const d=(0,he.get)(e,'世界',{}),m=(0,he.get)(t,'世界',{});for(const e in m){const t=(0,he.get)(d,`${e}.历史纪元`,{}),n=(0,he.get)(m,`${e}.历史纪元`,{});for(const e in n){const o=(0,he.get)(t,`${e}.世界大事`,{}),a=(0,he.get)(n,`${e}.世界大事`,{}),l=Object.keys(a).filter(e=>!o[e]);for(const e of l)$e.warn('世界大事',a[e].事件)}}}async function zt(){try{const e=await _e.fetchTavernData();if(e&&e.length>0&&e[0].data){const t=e[0].data.stat_data||e[0].data,n=e[0].message,o=e[0].id,a=JSON.parse(JSON.stringify(ct.worldState)),l=(0,he.get)(t,'角色');if(l){const e=Object.keys(l).filter(e=>e&&'$meta'!==e&&'sample_npc_id'!==e);e.length>0&&(ct.userId=e[0])}try{ct.worldState=at.parse(t)}catch(e){console.error('Zod validation failed for rawStateData:',e),$e.error('数据校验失败','从后端接收的世界数据格式不正确，请检查控制台。'),ct.worldState=t}ct.character=(0,he.get)(ct.worldState,['角色',ct.userId])||null,_t(a,ct.worldState);const r=n?.match(/<gametxt>([\s\S]*?)<\/gametxt>/i)?.[1].trim();if(r&&('mainWorld'===ct.activeView?ct.mainWorldNarrative=r:'avatarWorld'===ct.activeView?ct.avatarWorldNarrative=r:ct.mainWorldNarrative=r),n&&o!==It){const e=/<摘要 a_id="(.+?)">([\s\S]+?)<\/摘要>/g,t=/<主世界摘要>([\s\S]+?)<\/主世界摘要>/g,a=/<化身世界摘要>([\s\S]+?)<\/化身世界摘要>/g;let l;const r=e=>{if(!e)return(new Date).toLocaleString('zh-CN',{hour12:!1});return`${(0,he.get)(e,'纪元名称','')} ${(0,he.get)(e,'年','----')}年${String((0,he.get)(e,'月','--')).padStart(2,'0')}月${String((0,he.get)(e,'日','--')).padStart(2,'0')}日 ${String((0,he.get)(e,'时','--')).padStart(2,'0')}:${String((0,he.get)(e,'分','--')).padStart(2,'0')}`},i=async(e,t,n)=>{const o=await Be.readFromLorebook(t);if(o&&o.includes(e))return void console.log(`[Actions] Summary content already exists in "${t}". Skipping.`);const a='主世界摘要'===t?'主世界':'当前化身世界',l=Object.values((0,he.get)(ct.worldState,'世界',{})).find(e=>(0,he.get)(e,'元规则.定位')===a);let i=(new Date).toLocaleString('zh-CN',{hour12:!1});if(l){const e=(0,he.get)(l,'元规则.当前纪元ID');if(e){const t=(0,he.get)(l,`历史纪元.${e}.当前时间`);i=r(t)}}$e.info(n,e);const c=`【${i}】\n${e}`;await Be.appendToEntry(t,c,'\n\n---\n\n')};for(;null!==(l=e.exec(n));){const e=l[1],t=l[2].trim(),n=(0,he.get)(ct.worldState,`世界.${e}`);if(n){const e=(0,he.get)(n,'名称','未知世界'),o='主世界'===(0,he.get)(n,'状态.定位[0]')?'主世界摘要':'化身世界摘要';r((0,he.get)(n,'状态.当前时间'));await i(t,o,`${e} 动态`)}}if(null!==(l=t.exec(n))){const e=Object.values((0,he.get)(ct.worldState,'世界',{})).find(e=>'主世界'===(0,he.get)(e,'状态.定位[0]'));r((0,he.get)(e,'状态.当前时间'));await i(l[1].trim(),'主世界摘要','主世界动态')}if(null!==(l=a.exec(n))){const e=Object.values((0,he.get)(ct.worldState,'世界',{})).find(e=>'当前化身世界'===(0,he.get)(e,'状态.定位[0]'));r((0,he.get)(e,'状态.当前时间'));await i(l[1].trim(),'化身世界摘要','化身世界动态')}const c=n.match(/<可选化身>([\s\S]+?)<\/可选化身>/i);if(c){const e=(new DOMParser).parseFromString(`<root>${c[1]}</root>`,'application/xml'),t=Array.from(e.getElementsByTagName('化身')).map(e=>({姓名:e.getElementsByTagName('姓名')[0]?.textContent||'未知',身份:e.getElementsByTagName('身份')[0]?.textContent||'未知',简介:e.getElementsByTagName('简介')[0]?.textContent||'未知'}));ct.reincarnationAvatarOptions=t}console.log('[Roo Debug] fetchCoreData: New message content detected. Processing world tags...'),console.log('[Roo Debug] fetchCoreData: New message content detected. Processing world tags...');const s=/<新世界>([\s\S]*?)<\/新世界>/g,d=/<世界日志>([\s\S]+?)<\/世界日志>/g,m=/<本世历程>([\s\S]+?)<\/本世历程>/g,u=/<往世涟漪>([\s\S]+?)<\/往世涟漪>/g,p=/<主世界修改>([\s\S]+?)<\/主世界修改>/g,v=/<化身世界修改>([\s\S]+?)<\/化身世界修改>/g;if(null!==(l=/<主世界>([\s\S]*?)<\/主世界>/g.exec(n))){const e=l[1].trim();console.log('[Actions] Found <主世界> tag. Overwriting "主世界" lorebook entry.'),await Be.writeToLorebook('主世界',e,{isEnabled:!0,keys:['主世界']})}if(null!==(l=s.exec(n))){const e=l[1].trim().split(/(?=世界ID\|)/g).filter(e=>e.trim());for(const t of e){const e=t.match(/世界名称\|(.*?)\n/),n=t.match(/世界ID\|(.*?)\n/),o=e?e[1].trim():null,a=n?n[1].trim():null,l=`【诸天】${o||a||'未知世界'}`,r=t.match(/自动化规则:([\s\S]*)/);let i=t;r&&r[1]&&(i=`自动化规则:${r[1]}`);const c=(await Be.getEntries(!0)).find(e=>e.name===l||e.comment===l);c?await Be.writeToLorebook(l,i,{isEnabled:c.enabled,keys:c.keys}):await Be.writeToLorebook(l,i,{isEnabled:!1,keys:[l]})}}if(null!==(l=d.exec(n))){const e=l[1].trim(),t=await Be.readFromLorebook('世界日志');t&&t.includes(e)||await Be.appendToEntry('世界日志',e)}for(;null!==(l=m.exec(n));){const e=Tt(l[1]),t={...e,序号:parseInt(e['序号'],10),标签:e['标签']?e['标签'].replace(/[[\]"]/g,'').split(',').map(e=>e.trim()).filter(e=>e):[]};ct.worldLog.some(e=>e.序号===t.序号)||ct.worldLog.push(t)}ct.worldLog.sort((e,t)=>e.序号-t.序号);const g=ct.worldLog.length>0?ct.worldLog[ct.worldLog.length-1]:null;if(g){const e=await Be.readFromLorebook('本世历程'),t=Object.entries(g).map(([e,t])=>'object'==typeof t&&null!==t?`${e}|${JSON.stringify(t,null,2)}`:`${e}|${t}`).join('\n');e&&e.includes(`序号|${g.序号}`)||(console.log(`[Actions] Appending new log (序号: ${g.序号}) to "本世历程".`),await Be.appendToEntry('本世历程',t,'\n\n---\n\n'))}if(null!==(l=u.exec(n))){const e=Tt(l[1]),t={第x世:parseInt(e['第x世'],10)||0,事件脉络:e['事件脉络']||'',本世概述:e['本世概述']||'',本世成就:e['本世成就']||'',本世获得物品:e['本世获得物品']||'',本世人物关系网:e['本世人物关系网']||'',死亡原因:e['死亡原因']||'',本世总结:e['本世总结']||'',本世评价:e['本世评价']||''};ct.settlementData=t;const n=Object.entries(t).map(([e,t])=>`${e}|${t}`).join('\n');await Be.writeToLorebook('往世涟漪',n,{isEnabled:!0,keys:['往世涟漪']}),await Be.writeToLorebook('本世历程','',{isEnabled:!0,keys:['本世历程']}),ct.worldLog=[]}null!==(l=p.exec(n))&&(console.log('[Actions] Found <主世界修改> tag. Applying modifications...'),await Pe.applyModifications(l[1].trim(),'主世界')),null!==(l=v.exec(n))&&(console.log('[Actions] Found <化身世界修改> tag. Applying modifications...'),await Pe.applyModifications(l[1].trim(),'化身世界')),await async function(){console.log('[Roo Debug] Syncing world entries based on World ID...');const e=(0,he.get)(ct.worldState,'世界',{}),t=await Be.getEntries(!0);if(!t)return;const n=t.find(e=>'化身世界'===e.name);if(n&&n.content&&''!==n.content.trim()){const e=n.content.match(/ID:\s*(\S+)/),t=n.content.match(/名称:\s*(.*)/);if(e&&t){const o=e[1].trim(),a=`【诸天】${t[1].trim()||o}`;console.log(`[Actions] Archiving '化身世界' to '${a}'...`),await Be.writeToLorebook(a,n.content,{isEnabled:!1,keys:[a]}),await Be.writeToLorebook('化身世界','',{isEnabled:!0,keys:['化身世界']}),console.log('[Actions] \'化身世界\' has been cleared and archived.')}}const o={};for(const t in e){if('$meta'===t)continue;const n=(0,he.get)(e[t],'状态.定位[0]');'主世界'!==n&&'当前化身世界'!==n||(o[t]=n)}for(const e of t){const t=e.comment||e.name;if(!t||'string'!=typeof t||!t.startsWith('【诸天】'))continue;if(!e.content)continue;const n=e.content.match(/ID:\s*(\S+)/);if(n&&n[1]){const a=n[1].trim(),l=o[a];if(l){const n='主世界'===l?'主世界':'化身世界';t!==n&&(console.log(`[Roo Debug] Found match: Moving content from "${t}" to "${n}"`),await Be.writeToLorebook(n,e.content,{isEnabled:!0,keys:[n]}),await Be.writeToLorebook(t,'',{isEnabled:!1,keys:[t]}),delete o[a])}}}}(),It=o,await we.updateMemory(ct.worldLog)}}}catch(e){console.error('获取核心数据时出错:',e)}}async function Lt(){$t||(await async function(){try{const e=await Be.readFromLorebook('本世历程');if(!e||!e.trim())return console.log('[Store] "本世历程" lorebook is empty. Skipping log population.'),void(ct.worldLog=[]);const t=e.split('\n\n---\n\n').map(e=>{if(!e.trim())return null;try{const t=Tt(e);return t&&t['序号']?{序号:parseInt(t['序号'],10),日期:t['日期']||'未知日期',标题:t['标题']||'无标题',地点:t['地点']||'未知地点',人物:t['人物']||'未知人物',描述:t['描述']||'',人物关系:t['人物关系']||'',标签:t['标签']?t['标签'].replace(/[[\]"]/g,'').split(',').map(e=>e.trim()).filter(e=>e):[],重要信息:t['重要信息']||'',暗线与伏笔:t['暗线与伏笔']||'',自动化系统:t['自动化系统']||''}:null}catch(t){return console.error('Failed to parse log block:',e,t),null}}).filter(e=>e&&!isNaN(e.序号)),n=[],o=new Set;for(const e of t)e&&!o.has(e.序号)&&(o.add(e.序号),n.push(e));ct.worldLog=n.sort((e,t)=>e.序号-t.序号),console.log(`[Store] Loaded ${ct.worldLog.length} entries from "本世历程" lorebook.`)}catch(e){console.error('Error loading world log from lorebook:',e),ct.worldLog=[]}}(),$t=!0),await zt(),await Be.getEntries(!0),ct.isReady=!0,console.log('[Store] Core data loaded and lorebook cache refreshed.')}async function Mt(e){if(e.trim()){ct.isReady||await Lt(),ct.isGenerating=!0;try{const t=Ae.getCurrentState(),n=yt.value?ct.worldState?.模拟器.模拟.当前化身ID:ct.userId,o=n?Le.identifyCoreEntities(e,n,ct.worldState):[],a=`${Le.buildGuidingInstruction(o,ct.worldState)}\n\n${e}`,l=function(e){let t=e;t=t.replace(/<\/?think(ing)?>/g,e=>e.startsWith('</')?'</thinking>':'<thinking>'),t=t.replace(/<\/?(game-?txt|gamet-?xt|gametxtt)>/g,e=>e.startsWith('</')?'</gametxt>':'<gametxt>'),t.includes('<thinking>')||(t='<thinking>\n</thinking>\n'+t);const n=t.indexOf('<thinking>'),o=t.indexOf('</thinking>'),a=t.indexOf('<gametxt>');-1!==n&&-1===o&&(-1!==a&&a>n?t=t.slice(0,a)+'</thinking>\n'+t.slice(a):t+='\n</thinking>'),t=t.replace(/<thinking>([\s\S]*?)<\/thinking>/g,(e,t)=>`<thinking>${t.replace(/<|>/g,'')}</thinking>`);const l=t.indexOf('</thinking>');-1===l||t.includes('<gametxt>')||(t=t.slice(0,l+11)+'\n<gametxt></gametxt>'+t.slice(l+11));const r=t.indexOf('<gametxt>'),i=t.indexOf('</gametxt>');if(-1!==r&&-1===i){const e=t.indexOf('<',r+9);-1!==e?t=t.slice(0,e)+'</gametxt>\n'+t.slice(e):t+='\n</gametxt>'}return t}(await _e.generateAiResponse(a)),r=l+Ae.popPreservedContent();await async function(e,t){if(!e)return;const n=e.match(/<gametxt>([\s\S]+?)<\/gametxt>/i),o=n?n[1].trim():null;if(o)t.startsWith('【主世界】')?ct.mainWorldNarrative=o:t.startsWith('【化身世界】')?ct.avatarWorldNarrative=o:ct.mainWorldNarrative=o;else{const e=Ae.popNarrative();e&&('mainWorld'===ct.activeView?ct.mainWorldNarrative=e:ct.avatarWorldNarrative=e)}const a=/<摘要 a_id="(.+?)">([\s\S]+?)<\/摘要>/g;let l;for(;null!==(l=a.exec(e));){const e=l[1],t=l[2],n=(0,he.get)(ct.worldState,`世界.${e}.名称`,'未知世界');$e.info(`${n} 动态`,t)}const r=e.match(/<可选化身>([\s\S]+?)<\/可选化身>/i);if(r){const e=(new DOMParser).parseFromString(`<root>${r[1]}</root>`,'application/xml'),t=Array.from(e.getElementsByTagName('化身')).map(e=>({姓名:e.getElementsByTagName('姓名')[0]?.textContent||'未知',身份:e.getElementsByTagName('身份')[0]?.textContent||'未知',简介:e.getElementsByTagName('简介')[0]?.textContent||'未知'}));ct.reincarnationAvatarOptions=t}const i=e.match(/<UpdateVariable>([\s\S]+?)<\/UpdateVariable>/i);let c=i?i[1].trim():null;if(o&&Ae.cacheNarrative(o),c&&Ae.cacheUpdateScript(c),c){const e=c.split('\n').map(e=>e.includes('.当前时间.')&&e.includes('[0]')?e.replace('[0]',''):e).join('\n');e!==c&&(console.log('[PATCH] Corrected invalid [0] access in UpdateVariable script for 当前时间.'),c=e);const t=c.split(';').map(e=>e.trim()).filter(Boolean),n=t.filter(e=>e.startsWith('_.assign(\'角色\',')),o=t.filter(e=>e.startsWith('_.assign(\'角色.')&&e.includes('.人际关系\'')),a=t.filter(e=>!n.includes(e)&&!o.includes(e)),l=[...n,...o,...a].join(';\n')+';';l!==c&&(console.log('[PATCH] Reordered UpdateVariable script to ensure correct execution order.'),c=l);const r=(await _e.fetchTavernData())?.[0]?.data??ct.worldState,i=JSON.parse(JSON.stringify(ct.worldState)),s=await _e.invokeMvuScript(c,r);if(s){try{ct.worldState=at.parse(s)}catch(e){console.error('Zod validation failed for newVariables from MVU script:',e),$e.error('数据校验失败','变量更新脚本返回的数据格式不正确，请检查控制台。'),ct.worldState=s}ct.character=(0,he.get)(ct.worldState,['角色',ct.userId])||null,_t(i,ct.worldState)}}}(r,e),await we.updateMemory(ct.worldLog);const i=await _e.fetchTavernData();if(i&&i.length>0){const e=i[0];e.message=r,e.data=JSON.parse(JSON.stringify(ct.worldState)),await TavernHelper.setChatMessages([e],{refresh:'none'})}'CREATION'!==t&&'NORMAL'!==t||window.location.reload()}catch(e){console.error('处理动作时出错:',e);const t=e instanceof Error?e.message:String(e);ct.generationError=`AI响应失败: ${t}`,$e.error('操作失败','与AI交互失败，请检查控制台。')}finally{ct.generationError?setTimeout(()=>{ct.isGenerating=!1,ct.generationError=null},5e3):ct.isGenerating=!1}}}let At=!1;async function Ot(e){if(e){const t=e.content.match(/ID:\s*(.*)/);if(t&&t[1]){const n=t[1].trim();Mt(`<轮回行动 世界ID="${n}">`),ct.selectedWorldForReincarnation=e,$e.success('准备轮回',`已发送轮回指令【${e.name||n}】`)}else $e.error('错误','无法从世界书中解析出世界ID。')}}const jt={loadAllData:Lt,handleAction:Mt,initializeEventListeners:function(){At||(console.log('[Store] Initializing data synchronization...'),eventOn(tavern_events.GENERATION_ENDED,async()=>{console.log('[Store] Generation ended. Fetching all data.'),await Lt()}),xt.start(Lt,5e3),At=!0,console.log('[Store] Data synchronization listeners and polling are active.'))},fetchReincarnationWorlds:async function(){if(yt.value||ct.reincarnationWorldOptions.length>0)return;const e=await Be.getEntries();if(!e)return;const t=e.filter(e=>(e.name||e.comment||'').startsWith('【诸天】')&&e.content&&''!==e.content.trim()).sort(()=>.5-Math.random()).slice(0,3);ct.reincarnationWorldOptions=t},prepareReincarnation:Ot,clearSettlementData:async function(){try{const e=(await _e.fetchTavernData())?.[0]?.data??ct.worldState,t=await _e.invokeMvuScript('\n    _.set(\'模拟器.结算.待处理\', false);\n    _.set(\'模拟器.结算.宿命抉择\', {});\n  ',e);t&&(ct.worldState=t,$e.success('结算完成','轮回结算数据已清除。'))}catch(e){console.error('Failed to clear settlement data:',e),$e.error('操作失败','清除结算数据时出错。')}},triggerCreationWorkflow:async()=>{console.log('[Actions] Triggering CREATION workflow...');const e='mainWorld'===ct.activeView?ct.mainWorldNarrative:ct.avatarWorldNarrative;e&&Ae.cacheNarrative(e),await Ae.switchTo('CREATION'),Ae.setPreserveMode('gametxt'),await Be.getEntries(!0),$e.info('创世','已发送“重演天机”指令，等待AI创造新世界...'),await Mt('<重演天机>')},triggerIdentityWorkflow:async e=>{console.log('[Actions] Triggering IDENTITY workflow...');const t='mainWorld'===ct.activeView?ct.mainWorldNarrative:ct.avatarWorldNarrative;if(t&&Ae.cacheNarrative(t),await Ae.switchTo('IDENTITY'),Ae.setPreserveMode('full'),e&&e.content){await Be.writeToLorebook('化身世界',e.content,{isEnabled:!0,keys:['化身世界']});const t=e.name||e.comment||'';t&&await Be.writeToLorebook(t,'',{isEnabled:!1,keys:[t]})}await Ot(e)},selectAvatarAndStart:async e=>{console.log(`[Actions] Avatar "${e}" selected. Switching to NORMAL workflow and sending action...`);const t='mainWorld'===ct.activeView?ct.mainWorldNarrative:ct.avatarWorldNarrative;t&&Ae.cacheNarrative(t),await Ae.switchTo('NORMAL'),await Be.getEntries(!0);const n=`<选择化身 “${e}”>`;$e.info('轮回开始',`已选定化身【${e}】，轮回开始...`),await Mt(n),ct.reincarnationAvatarOptions=[]},setActiveView(e){ct.activeView=e},switchFocus(e){ct.activeView=e;const t='mainWorld'===e?'主世界':'化身世界',n=`<意识切换至 ${t}>`;pe.addCommand(n),$e.info('行动队列',`已将“意识切换至${t}”加入行动队列`)},addActionToQueue(e){console.warn('[Actions] addActionToQueue is not implemented yet.',e)},resetReincarnationSelection:function(){ct.reincarnationWorldOptions=[],ct.selectedWorldForReincarnation=null,console.log('[Actions] Reincarnation selection has been reset.')}};function Tt(e){const t={},n=e.trim().split('\n');let o='';for(const e of n){const n=e.indexOf('|');if(-1!==n){const a=e.substring(0,n).trim(),l=e.substring(n+1).trim();t[a]=l,o=a}else o&&e.trim()&&(t[o]+='\n'+e)}for(const e in t)t[e]=t[e].trim();return t}const Ft='reincarnation-simulator-input-value',Rt='reincarnation-simulator-last-submitted',Wt=(0,x.reactive)({isVisible:!1,inputValue:localStorage.getItem(Ft)||'',lastSubmittedValue:localStorage.getItem(Rt)||''}),Pt={show(){ct.generationError&&(Wt.inputValue=Wt.lastSubmittedValue),Wt.isVisible=!0},hide(){Wt.isVisible=!1},setValue(e){Wt.inputValue=e,localStorage.setItem(Ft,e)},setLastSubmittedValue(e){Wt.lastSubmittedValue=e,localStorage.setItem(Rt,e)},clearValue(){Wt.inputValue='',localStorage.removeItem(Ft)}},Ut=(0,x.readonly)(Wt),Ht=Pt,Gt={class:'enhanced-input-box-container'},Jt={class:'input-wrapper'},Yt=['value','placeholder','onKeypress'],qt=(0,x.defineComponent)({__name:'EnhancedInputBox',props:{placeholder:{type:String,default:'请输入行动...'}},emits:['submit-action','toggle-action-panel'],setup(e,{emit:t}){const n=t,o=(0,x.computed)(()=>Ut.inputValue),a=(0,x.computed)(()=>pe.getCommands()),l=e=>{const t=e.target;Ht.setValue(t.value)},r=()=>{const e=o.value.trim(),t=a.value.length>0;if(!e&&!t)return;e&&fe.add(e);let l='';t&&(l+='[本轮行动指令]\n'+a.value.map(e=>`- ${e}`).join('\n')),e&&(t&&(l+='\n'),l+=`<行动选择>\n${e}\n</行动选择>`),Ae.switchTo('NORMAL',!0),n('submit-action',l),pe.clearCommands()};return(t,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Gt,[(0,x.createElementVNode)('div',Jt,[(0,x.createElementVNode)('button',{class:'action-button activator',onClick:n[0]||(n[0]=e=>t.$emit('toggle-action-panel'))},'∇'),(0,x.createElementVNode)('textarea',{value:o.value,onInput:l,placeholder:e.placeholder,onKeypress:(0,x.withKeys)((0,x.withModifiers)(r,['exact','prevent']),['enter'])},null,40,Yt),(0,x.createElementVNode)('button',{class:'action-button primary',onClick:r},'执行')])]))}}),Kt=(0,me.A)(qt,[['__scopeId','data-v-1eccedfd']]),Qt={class:'input-history-popup'},Xt={class:'history-section'},Zt={key:0},en=['onClick'],tn={class:'actions'},nn=['onClick','disabled'],on=['onClick'],an={key:1,class:'empty-text'},ln={class:'history-section'},rn={key:0},cn=['onClick'],sn={class:'actions'},dn=['onClick'],mn={key:1,class:'empty-text'},un=(0,x.defineComponent)({__name:'InputHistoryPopup',emits:['select-entry','close'],setup(e,{emit:t}){const n=fe.state,o=t,a=e=>{o('select-entry',e)},l=e=>n.saved.includes(e);return(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Qt,[(0,x.createElementVNode)('div',Xt,[t[1]||(t[1]=(0,x.createElementVNode)('h4',null,'最近输入',-1)),(0,x.unref)(n).recent.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('ul',Zt,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)((0,x.unref)(n).recent,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:`recent-${t}`},[(0,x.createElementVNode)('span',{class:'entry-text',onClick:t=>a(e)},(0,x.toDisplayString)(e),9,en),(0,x.createElementVNode)('div',tn,[(0,x.createElementVNode)('button',{onClick:t=>(e=>{fe.save(e)})(e),disabled:l(e)},'收藏',8,nn),(0,x.createElementVNode)('button',{onClick:e=>(e=>{fe.deleteRecent(e)})(t)},'删除',8,on)])]))),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('p',an,'暂无历史记录。'))]),(0,x.createElementVNode)('div',ln,[t[2]||(t[2]=(0,x.createElementVNode)('h4',null,'收藏内容',-1)),(0,x.unref)(n).saved.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('ul',rn,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)((0,x.unref)(n).saved,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:`saved-${t}`},[(0,x.createElementVNode)('span',{class:'entry-text',onClick:t=>a(e)},(0,x.toDisplayString)(e),9,cn),(0,x.createElementVNode)('div',sn,[(0,x.createElementVNode)('button',{onClick:e=>(e=>{fe.deleteSaved(e)})(t)},'取消收藏',8,dn)])]))),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('p',mn,'暂无收藏内容。'))]),(0,x.createElementVNode)('button',{onClick:t[0]||(t[0]=t=>e.$emit('close')),class:'close-button-popup'},'关闭')]))}}),pn=(0,me.A)(un,[['__scopeId','data-v-4ad5c044']]),vn={class:'notification__content'},gn={class:'notification__title'},fn={class:'notification__message'},hn=(0,x.defineComponent)({__name:'Notification',props:{notification:{}},setup(e){const t=e,n=()=>{$e.hide(t.notification.id)};return(t,o)=>((0,x.openBlock)(),(0,x.createBlock)(x.Transition,{name:'notification-fade'},{default:(0,x.withCtx)(()=>[(0,x.createElementVNode)('div',{class:(0,x.normalizeClass)(['notification',`notification--${e.notification.type}`]),onClick:n},[(0,x.createElementVNode)('div',vn,[(0,x.createElementVNode)('h4',gn,(0,x.toDisplayString)(e.notification.title),1),(0,x.createElementVNode)('p',fn,(0,x.toDisplayString)(e.notification.message),1)]),o[0]||(o[0]=(0,x.createElementVNode)('div',{class:'notification__arrow'},null,-1))],2)]),_:1}))}}),yn={class:'notification-container'},kn=(0,x.defineComponent)({__name:'NotificationContainer',setup:e=>(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',yn,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)((0,x.unref)(Ie).notifications,e=>((0,x.openBlock)(),(0,x.createBlock)(hn,{key:e.id,notification:e},null,8,['notification']))),128))]))}),En={class:'icon'},Nn=(0,x.defineComponent)({__name:'SideMenuButton',props:{icon:{}},emits:['open'],setup(e,{emit:t}){const n=t,o=e=>{n('open',{x:e.clientX,y:e.clientY})};return(t,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('button',{class:'side-menu-button',onClick:o},[(0,x.createElementVNode)('span',En,(0,x.toDisplayString)(e.icon),1)]))}}),bn=(0,me.A)(Nn,[['__scopeId','data-v-5fd70906']]),Vn=(0,x.reactive)(new Map),Sn=(0,x.computed)(()=>{const e=ct.worldState;if(!e?.世界)return[];const t=['本体',(0,he.get)(e,'玩家.模拟器.模拟.当前化身ID')].filter(Boolean),n=[];for(const o in e.世界){const a=e.世界[o];if(a&&a.角色)for(const o in a.角色)'$meta'===o||t.includes(o)||'本体'===o||e.玩家&&e.玩家.本体&&a.角色[o]===e.玩家.本体||n.push(a.角色[o])}return n});const Bn={getNpcsByWorld:function(e){return e?Sn.value.filter(t=>t.所属世界===e):[]},allNpcs:Sn,initializeWorldAndLocationData:async function(){const e=ct.worldState?.世界;if(!e)return console.warn('[NpcService] worldState.世界 is not available for initialization.'),[];const t=[];for(const n in e){if('$meta'===n)continue;const o=e[n],a=(0,he.get)(o,'名称');n&&a&&t.push({id:n,name:a});const l=(0,he.get)(o,'定义.历史纪元',{});for(const e in l){if('$meta'===e)continue;const t=l[e],n=(0,he.get)(t,'内容.空间实体');if('object'==typeof n&&null!==n)for(const e in n){if('$meta'===e)continue;const t=n[e];t&&t.名称&&Vn.set(e,{name:t.名称,parentId:t.所属?.ID||null})}}}return console.log('[NpcService] Initialized worlds and locations from worldState.',t),t},getLocationName:function(e){return Vn.get(e)?.name||e},getNpcNameById:function(e){if('本体'===e)return ct.worldState?.玩家?.本体?.真名||'本体';const t=ct.worldState?.世界;if(!t)return e;for(const n in t){const o=t[n],a=(0,he.get)(o,`角色.${e}`);if(a&&a.姓名)return a.姓名}return e},getNpcId:function(e){const t=ct.worldState;if(!t?.世界)return null;for(const n in t.世界){const o=t.世界[n],a=(0,he.get)(o,'角色');if(a)for(const t in a)if(a[t]===e)return t}return null},locationCache:Vn,getParentLocationName:function(e){const t=Vn.get(e)?.parentId;return t?'WORLD_ORIGIN'===t?'世界本身':Vn.get(t)?.name||'未知':'未知'},cacheLocationData:function(e){if(Array.isArray(e))for(const t of e)t.ID&&t.名称&&Vn.set(t.ID,{name:t.名称,parentId:t.所属?.ID||null})}},wn=(0,x.reactive)({isVisible:!1,component:null,props:{},title:''}),Cn={state:(0,x.readonly)(wn),show(e,t,n={}){wn.title=e,wn.component=(0,x.markRaw)(t),wn.props=n,wn.isVisible=!0},hide(){wn.isVisible=!1,setTimeout(()=>{wn.component=null,wn.props={},wn.title=''},300)}},Dn={class:'npc-info-card'},xn={class:'info-grid'},In={class:'info-item'},$n={class:'info-item'},_n={class:'info-item'},zn={class:'info-item'},Ln={class:'info-item full-width'},Mn={class:'info-item full-width'},An={class:'info-item full-width'},On=(0,x.defineComponent)({__name:'NpcInfoCard',props:{npc:{type:Object,required:!0}},setup(e){const t=e,n=(0,x.computed)(()=>t.npc.身份?Object.values(t.npc.身份).filter(e=>'string'==typeof e).join('，'):'无'),o=(0,x.computed)(()=>{if(!t.npc.出生日期||!ct.worldState?.世界)return'未知';const e=Array.isArray(t.npc.所属世界)?t.npc.所属世界[0]:t.npc.所属世界,n=ct.worldState.世界[e];if(!n)return'未知';const o=n.元规则?.当前纪元ID;if(!o)return'未知';const a=n.历史纪元?.[o],l=a?.当前时间;if(!l)return'未知';return l.年-t.npc.出生日期.年}),a=(0,x.computed)(()=>{const e=t.npc.心流?.情绪状态;return e?(e=>{if(!e)return'未知';const t={心绪:{100:'极乐',90:'心花怒放',80:'狂喜',70:'振奋',60:'兴奋',50:'愉悦',40:'欣喜',30:'高兴',20:'愉快',10:'开心',0:'平静','-10':'低落','-20':'郁闷','-30':'失落','-40':'沮丧','-50':'悲伤','-60':'痛苦','-70':'心碎','-80':'悲痛欲绝','-90':'万念俱灰','-100':'绝望'},怒意:{100:'憎恨',90:'雷霆之怒',80:'暴怒',70:'大怒',60:'怒火中烧',50:'愤怒',40:'烦躁',30:'恼火',20:'不满',10:'微愠',0:'中立','-10':'平静','-20':'耐心','-30':'淡然','-40':'平和','-50':'镇定','-60':'冷静','-70':'沉着','-80':'波澜不惊','-90':'心如止水','-100':'绝对理智'},胆识:{100:'英勇无双',90:'悍不畏死',80:'奋勇',70:'果敢',60:'无畏',50:'勇敢',40:'从容',30:'沉着',20:'安定',10:'镇定',0:'平静','-10':'警惕','-20':'紧张','-30':'担忧','-40':'不安','-50':'畏惧','-60':'害怕','-70':'恐惧','-80':'惊恐万状','-90':'魂飞魄散','-100':'崩溃'},仪态:{100:'傲视群雄',90:'意气风发',80:'神采飞扬',70:'挥洒自如',60:'自信',50:'从容',40:'大方',30:'放松',20:'自在',10:'自然',0:'平静','-10':'拘谨','-20':'不自在','-30':'局促','-40':'腼腆','-50':'害羞','-60':'难为情','-70':'窘迫','-80':'羞愧难当','-90':'极度羞耻','-100':'无地自容'}},n=(e,n)=>{const o=t[e],a=Object.keys(o).map(Number).sort((e,t)=>e-t);return n>=0?o[a.reverse().find(e=>e>=0&&n>=e)??0]:o[a.find(e=>e<0&&n<=e)??0]},o=Object.keys(e).map(t=>({name:t,value:Number(Array.isArray(e[t])?e[t][0]:e[t])})).filter(e=>0!==e.value).sort((e,t)=>Math.abs(t.value)-Math.abs(e.value));if(0===o.length)return'平静';const a=o[0],l=n(a.name,a.value);if(1===o.length||Math.abs(o[1].value)<25)return l;const r=o[1];return`${l}，并感到${n(r.name,r.value).toLowerCase()}`})(e):'未知'});return(t,l)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Dn,[(0,x.createElementVNode)('div',xn,[(0,x.createElementVNode)('div',In,[l[0]||(l[0]=(0,x.createElementVNode)('strong',null,'生日',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(e.npc.出生日期?`${e.npc.出生日期.年}年${e.npc.出生日期.月}月${e.npc.出生日期.日}日`:'未知'),1)]),(0,x.createElementVNode)('div',$n,[l[1]||(l[1]=(0,x.createElementVNode)('strong',null,'性别',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(e.npc.性别?e.npc.性别:'未知'),1)]),(0,x.createElementVNode)('div',_n,[l[2]||(l[2]=(0,x.createElementVNode)('strong',null,'年龄',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(o.value),1)]),(0,x.createElementVNode)('div',zn,[l[3]||(l[3]=(0,x.createElementVNode)('strong',null,'心情',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(a.value),1)]),(0,x.createElementVNode)('div',Ln,[l[4]||(l[4]=(0,x.createElementVNode)('strong',null,'身份',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(n.value),1)]),(0,x.createElementVNode)('div',Mn,[l[5]||(l[5]=(0,x.createElementVNode)('strong',null,'相貌',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(e.npc.相貌?e.npc.相貌:'无详细描述。'),1)]),(0,x.createElementVNode)('div',An,[l[6]||(l[6]=(0,x.createElementVNode)('strong',null,'着装',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(e.npc.着装?e.npc.着装:'无详细描述。'),1)])])]))}}),jn=(0,me.A)(On,[['__scopeId','data-v-40dc9d07']]),Tn={key:0,class:'location-info-card'},Fn={class:'info-grid'},Rn={class:'info-item'},Wn={class:'info-item'},Pn={class:'info-item'},Un={class:'info-item'},Hn={class:'info-item full-width'},Gn={key:1,class:'loading-placeholder'},Jn=(0,x.defineComponent)({__name:'LocationInfoCard',props:{locationId:{type:String,required:!0}},setup(e){const t=e,n=(0,x.ref)(null),o=(0,x.computed)(()=>n.value?Bn.getParentLocationName(t.locationId):'未知'),a=e=>'string'!=typeof e?e:e.replace(/["'\[\]]/g,''),l=e=>{if(!e)return'未知';return a(String(e)).split(',').join(' ')},r=e=>{if(!e)return'未知';try{const t=a(e.参考ID),n=Bn.getLocationName(t),o=a(e.方位).split(','),l=o[0]||'',r=o[1]||'',i=a(String(e.距离)).split(','),c=i[0]||'';return`距 ${n} ${c}${i[1]||''} ${l}${r}°`}catch(e){return console.error('Error formatting coordinates:',e),'解析错误'}};return(0,x.onMounted)(async()=>{const e=await Be.getEntries();if(!e)return;const o=[];for(const t of e)if(t.content)try{const e=rt(t.content);if(e?.历史纪元)for(const t in e.历史纪元){const n=e.历史纪元[t],a=n?.内容?.空间实体;Array.isArray(a)&&o.push(...a)}}catch(e){}Bn.cacheLocationData(o);const a=o.find(e=>e.ID===t.locationId);a&&(n.value=a)}),(e,t)=>n.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',Tn,[(0,x.createElementVNode)('div',Fn,[(0,x.createElementVNode)('div',Rn,[t[0]||(t[0]=(0,x.createElementVNode)('strong',null,'类型',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(a(n.value.层级类型)),1)]),(0,x.createElementVNode)('div',Wn,[t[1]||(t[1]=(0,x.createElementVNode)('strong',null,'所属',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(o.value),1)]),(0,x.createElementVNode)('div',Pn,[t[2]||(t[2]=(0,x.createElementVNode)('strong',null,'面积',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(l(n.value.面积)),1)]),(0,x.createElementVNode)('div',Un,[t[3]||(t[3]=(0,x.createElementVNode)('strong',null,'相对坐标',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(r(n.value.相对坐标)),1)]),(0,x.createElementVNode)('div',Hn,[t[4]||(t[4]=(0,x.createElementVNode)('strong',null,'描述',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(a(n.value.描述)),1)])])])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Gn,'正在获取地点信息...'))}}),Yn=(0,me.A)(Jn,[['__scopeId','data-v-d56cb894']]),qn={class:'database-item-card'},Kn={class:'info-grid'},Qn={class:'info-item'},Xn={class:'info-item'},Zn={class:'info-item'},eo={class:'info-item full-width'},to={key:0,class:'info-item full-width'},no=(0,x.defineComponent)({__name:'DatabaseItemCard',props:{item:{type:Object,required:!0}},setup(e){const t=e,n=(0,x.computed)(()=>{if(!t.item.effects)return null;const{attributes_bonus:e,percentage_bonus:n}=t.item.effects,o=[];if(e)for(const t in e)'$meta'!==t&&o.push(`${t} +${e[t]}`);if(n)for(const e in n)'$meta'!==e&&o.push(`${e} +${n[e]}`);return o.join('；')});return(t,o)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',qn,[(0,x.createElementVNode)('div',Kn,[(0,x.createElementVNode)('div',Qn,[o[0]||(o[0]=(0,x.createElementVNode)('strong',null,'类型',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(e.item.类型||'未知'),1)]),(0,x.createElementVNode)('div',Xn,[o[1]||(o[1]=(0,x.createElementVNode)('strong',null,'子类型',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(e.item.子类型||'无'),1)]),(0,x.createElementVNode)('div',Zn,[o[2]||(o[2]=(0,x.createElementVNode)('strong',null,'能级',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(e.item.能级??'未知'),1)]),(0,x.createElementVNode)('div',eo,[o[3]||(o[3]=(0,x.createElementVNode)('strong',null,'描述',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(e.item.描述||'无详细描述。'),1)]),n.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',to,[o[4]||(o[4]=(0,x.createElementVNode)('strong',null,'效果',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(n.value),1)])):(0,x.createCommentVNode)('v-if',!0)])]))}}),oo=(0,me.A)(no,[['__scopeId','data-v-7d2511ac']]),ao={class:'game-text-container'},lo=['onClick'],ro=(0,x.defineComponent)({__name:'FormattedTextRenderer',props:{text:{type:String,required:!0}},setup(e){const t=e,n=(0,x.computed)(()=>{const e=Bn.allNpcs.value.map(e=>Array.isArray(e.姓名)?e.姓名[0]:e.姓名).filter(Boolean);if(0===e.length)return null;const t=e.map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'));return new RegExp(`(${t.join('|')})`,'g')}),o=(0,x.computed)(()=>{const e=Array.from(Bn.locationCache.values()).map(e=>e.name);if(0===e.length)return null;const t=e.map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'));return new RegExp(`(${t.join('|')})`,'g')}),a=(0,x.computed)(()=>{const e=ct.worldState?.数据库;if(!e)return null;const t=[];for(const n in e){if('$meta'===n)continue;const o=e[n];if(o)for(const e in o){if('$meta'===e)continue;const n=o[e];n&&n.名称&&t.push(n.名称)}}if(0===t.length)return null;const n=t.map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'));return new RegExp(`(${n.join('|')})`,'g')}),l=(0,x.computed)(()=>{if(!t.text)return[];return function(e){const t=[],n=/(【【.*?】】)|(【.*?】)|(「.*?」)|(\*.*?\*)/g;let o,a=0;for(;null!==(o=n.exec(e));){o.index>a&&t.push(...r(e.substring(a,o.index)));const n=o[0];let l='',i='';o[1]?(l=n.slice(2,-2),i='text-system-highlight'):o[2]?(l=n.slice(1,-1),i='text-scenery'):o[3]?(l=n.slice(1,-1),i='text-dialogue'):o[4]&&(l=n.slice(1,-1),i='text-psychology');r(l).forEach(e=>{const n=Array.isArray(e.class)?[i,...e.class]:[i,e.class].filter(Boolean);t.push({...e,class:n})}),a=o.index+n.length}a<e.length&&t.push(...r(e.substring(a)));return t}(t.text.replace(/<[^>]*>/g,''))});function r(e){const t=[],l=[];if(n.value&&l.push(n.value.source),o.value&&l.push(o.value.source),a.value&&l.push(a.value.source),0===l.length)return[{text:e,class:''}];const r=new RegExp(l.join('|'),'g');let s,d=0;for(;null!==(s=r.exec(e));){s.index>d&&t.push({text:e.substring(d,s.index),class:''});const n=s[0],o=Bn.allNpcs.value.find(e=>(Array.isArray(e.姓名)?e.姓名[0]:e.姓名)===n),a=[...Bn.locationCache.entries()].find(([e,t])=>t.name===n)?.[0],l=i(n);if(o){const e=c(o);t.push({text:n,class:['npc-name',e],npc:o})}else a?t.push({text:n,class:'location-name',locationId:a}):l?t.push({text:n,class:'database-item-name',item:l}):t.push({text:n,class:''});d=s.index+n.length}return d<e.length&&t.push({text:e.substring(d),class:''}),t}function i(e){const t=ct.worldState?.数据库;if(!t)return null;for(const n in t){if('$meta'===n)continue;const o=t[n];if(o)for(const t in o){if('$meta'===t)continue;const n=o[t];if(n&&n.名称===e)return n}}return null}function c(e){const t=Bn.getNpcId(e);if(!t||!ct.worldState?.因果之网||!ct.worldState.因果之网[t]?.[ct.userId])return'npc-unknown';const n=ct.worldState.因果之网[t][ct.userId],o=(n.情感层?.亲近感||0)+(n.情感层?.仰慕度||0);return o<=-150?'npc-hostile-intense':o<=-50?'npc-hostile':o<0?'npc-unfriendly':o<50?'npc-neutral':o<100?'npc-friendly':o<150?'npc-devoted':'npc-fanatical'}return(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',ao,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(l.value,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('span',{key:t,class:(0,x.normalizeClass)(e.class),onClick:t=>{return e.npc?(e=>{if(!e)return;const t=Array.isArray(e.姓名)?e.姓名[0]:e.姓名;Cn.show(t,jn,{npc:e})})(e.npc):e.locationId?(e=>{if(!e)return;const t=Bn.getLocationName(e);Cn.show(t,Yn,{locationId:e})})(e.locationId):e.item?void((n=e.item)&&Cn.show(n.名称,oo,{item:n})):null;var n}},(0,x.toDisplayString)(e.text),11,lo))),128))]))}}),io=(0,me.A)(ro,[['__scopeId','data-v-9156fca4']]),co={class:'main-content-wrapper',ref:'mainContentWrapper'},so=(0,x.defineComponent)({__name:'MainView',setup:e=>(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',co,[(0,x.createVNode)(io,{text:(0,x.unref)(Ct)},null,8,['text'])],512))}),mo={class:'destiny-plate-container'},uo={class:'destiny-plate'},po={class:'plate-center'},vo={class:'plate-core'},go={class:'core-title'},fo={class:'core-description'},ho={class:'inner-ring'},yo=['onMouseenter'],ko={class:'node-name'},Eo={class:'node-value'},No={class:'middle-ring'},bo=['onMouseenter'],Vo={class:'node-name'},So={class:'node-value'},Bo={class:'outer-ring'},wo={class:'orbit-svg',viewBox:'0 0 100 100'},Co=['onMouseenter'],Do=['onMouseenter'],xo={class:'node-name'},Io={key:0,class:'node-value'},$o='窥见命运的轨迹',_o=(0,x.defineComponent)({__name:'DestinyPlate',props:{character:{type:Object,default:null}},setup(e){const t=e,n=(0,x.ref)('命盘'),o=(0,x.ref)($o),a=(e,t=0)=>null==e?t:e,l=(0,x.computed)(()=>t.character||ct.character),r=(0,x.computed)(()=>{const e=l.value;return[{id:'name',name:'真名',value:a(e?.真名,'无'),description:'于此世的真正名讳'},{id:'soul',name:'本源',value:a(e?.灵魂本源,0),description:'穿梭诸天的核心能量'},{id:'dao',name:'道心',value:a(e?.道心,0),description:'对抗侵蚀的意志壁垒'},{id:'jing',name:'精',value:a(e?.基础潜力?.精),description:'灵魂对物理存在的干涉与塑造潜力'},{id:'qi',name:'气',value:a(e?.基础潜力?.气),description:'灵魂与外界能量的交互潜力'},{id:'shen',name:'神',value:a(e?.基础潜力?.神),description:'灵魂的感知、计算与意志潜力'},{id:'yun',name:'运',value:a(e?.基础潜力?.运),description:'灵魂与命运、因果的神秘联系'}]}),i=(0,x.computed)(()=>{const e=l.value;return[{id:'quanneng',name:'权能',value:a(e?.战斗参数?.权能),description:'角色对外界现实施加影响、改变事物的综合能力'},{id:'genji',name:'根基',value:a(e?.战斗参数?.根基),description:'角色维持自身存在、抵抗外界侵蚀的综合能力'},{id:'jibian',name:'机变',value:a(e?.战斗参数?.机变),description:'角色在冲突中把握时机、创造变数的能力'},{id:'pofa',name:'破法',value:a(e?.战斗参数?.破法),description:'角色无视、穿透、或破解对方防御规则的能力'},{id:'yufa',name:'御法',value:a(e?.战斗参数?.御法),description:'角色运用规则来强化自身防御的能力'}]}),c=(0,x.computed)(()=>{const e=l.value?.世界专属属性||{},t=['修为信息','命途契合度'];return Object.entries(e).filter(([e])=>'$meta'!==e).map(([e,n])=>{const o=t.includes(e);let l=`世界属性: ${e}`,r=null,i='node',c='MAX';if('object'==typeof n&&null!==n){l=n.description||l;const t=Object.keys(n).filter(e=>'$meta'!==e&&'description'!==e);('current'in n||'当前'in n)&&('max'in n||'上限'in n)?(i='orbit',r=a(n.当前??n.current,0),c=a(n.上限??n.max,100),l=`${e}: ${r} / ${c}`):'value'in n?r=a(n.value,'-'):t.length>0&&t.every(e=>'object'==typeof n[e]&&n[e]?.名称)?r=t.map(e=>n[e].名称).join('、'):t.length>0&&(r='...',l=t.map(e=>`${e}: ${a(n[e])}`).join(' | '))}else r=a(n,'-');return{id:e,name:e,value:r,max:c,type:i,description:l,isSpecial:o}})}),s=e=>{n.value=e.name,o.value=e.description||''},d=()=>{n.value='命盘',o.value=$o};return(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',mo,[(0,x.createElementVNode)('div',uo,[(0,x.createCommentVNode)(' 静态装饰性星轨 '),t[1]||(t[1]=(0,x.createElementVNode)('div',{class:'static-orbit orbit-1'},null,-1)),t[2]||(t[2]=(0,x.createElementVNode)('div',{class:'static-orbit orbit-2'},null,-1)),t[3]||(t[3]=(0,x.createElementVNode)('div',{class:'static-orbit orbit-3'},null,-1)),t[4]||(t[4]=(0,x.createElementVNode)('div',{class:'static-orbit orbit-4'},null,-1)),(0,x.createCommentVNode)(' 中央核心区域 '),(0,x.createElementVNode)('div',po,[(0,x.createElementVNode)('div',vo,[(0,x.createElementVNode)('span',go,(0,x.toDisplayString)(n.value),1),(0,x.createElementVNode)('div',fo,(0,x.toDisplayString)(o.value),1)])]),(0,x.createCommentVNode)(' 内环: 核心本质 '),(0,x.createElementVNode)('div',ho,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(r.value,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:e.id,class:'node inner-node',style:(0,x.normalizeStyle)({'--angle':t/r.value.length*360+'deg'}),onMouseenter:t=>s(e),onMouseleave:d},[(0,x.createElementVNode)('span',ko,(0,x.toDisplayString)(e.name),1),(0,x.createElementVNode)('span',Eo,(0,x.toDisplayString)(e.value),1)],44,yo))),128))]),(0,x.createCommentVNode)(' 中环: 战斗参数 '),(0,x.createElementVNode)('div',No,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(i.value,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:e.id,class:'node param-node',style:(0,x.normalizeStyle)({'--angle':t/i.value.length*360+18+'deg'}),onMouseenter:t=>s(e),onMouseleave:d},[(0,x.createElementVNode)('span',Vo,(0,x.toDisplayString)(e.name),1),(0,x.createElementVNode)('span',So,(0,x.toDisplayString)(e.value),1)],44,bo))),128))]),(0,x.createCommentVNode)(' 外环: 世界专属属性 '),(0,x.createElementVNode)('div',Bo,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(c.value,(e,n)=>((0,x.openBlock)(),(0,x.createElementBlock)(x.Fragment,{key:e.id},[(0,x.createCommentVNode)(' 类型为 \'orbit\' 的星轨 '),'orbit'===e.type?((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:0,class:'orbit-track',style:(0,x.normalizeStyle)({'--angle':n/c.value.length*360+'deg'})},[((0,x.openBlock)(),(0,x.createElementBlock)('svg',wo,[t[0]||(t[0]=(0,x.createElementVNode)('circle',{class:'track',cx:'50',cy:'50',r:'45'},null,-1)),(0,x.createElementVNode)('circle',{class:'progress',cx:'50',cy:'50',r:'45',style:(0,x.normalizeStyle)({'stroke-dashoffset':283*(1-('number'==typeof e.value&&'number'==typeof e.max&&e.max>0?e.value/e.max:0))})},null,4)])),(0,x.createElementVNode)('div',{class:'orbit-label',onMouseenter:t=>s(e),onMouseleave:d},(0,x.toDisplayString)(e.name),41,Co)],4)):((0,x.openBlock)(),(0,x.createElementBlock)(x.Fragment,{key:1},[(0,x.createCommentVNode)(' 类型为 \'node\' 的普通节点 '),(0,x.createElementVNode)('div',{class:'node world-node',style:(0,x.normalizeStyle)({'--angle':n/c.value.length*360+'deg'}),onMouseenter:t=>s(e),onMouseleave:d},[(0,x.createElementVNode)('span',xo,(0,x.toDisplayString)(e.name),1),null!==e.value?((0,x.openBlock)(),(0,x.createElementBlock)('span',Io,(0,x.toDisplayString)(e.value),1)):(0,x.createCommentVNode)('v-if',!0)],44,Do)],2112))],64))),128))])])]))}}),zo=(0,me.A)(_o,[['__scopeId','data-v-0f9cb796']]),Lo={class:'panel-wrapper character-panel-container'},Mo={key:0,class:'character-sheet'},Ao={class:'drawer-content'},Oo={class:'world-attributes-section'},jo={key:0,class:'attributes-list'},To={class:'label'},Fo={class:'value'},Ro={key:1,class:'empty-state'},Wo={class:'combat-attributes-section'},Po={key:0,class:'attributes-list'},Uo={class:'label'},Ho={class:'value'},Go={key:1,class:'empty-state'},Jo={key:1,class:'loading-state'},Yo=(0,x.defineComponent)({__name:'AvatarCharacterPanel',setup(e){const t=(e,t=0)=>null==e?t:e,n=e=>{if(null==e)return'-';if('object'==typeof e&&!Array.isArray(e)){if(void 0!==e.当前&&void 0!==e.上限)return`${e.当前} / ${e.上限}`;return Object.keys(e).filter(e=>'$meta'!==e).length>0?Object.entries(e).filter(([e])=>'$meta'!==e).map(([e,n])=>`${e}: ${t(n)}`).join(', '):'复杂属性'}return String(t(e))},o=(0,x.computed)(()=>dt.value?.世界专属属性||{}),a=(0,x.computed)(()=>dt.value?.战斗参数||{}),l=(0,x.ref)(!1);return(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Lo,[(0,x.unref)(dt)?((0,x.openBlock)(),(0,x.createElementBlock)('div',Mo,[(0,x.createCommentVNode)(' 命盘 '),(0,x.createVNode)(zo,{character:(0,x.unref)(dt)},null,8,['character']),(0,x.createCommentVNode)(' 抽屉 '),(0,x.createElementVNode)('div',{class:(0,x.normalizeClass)(['additional-info-drawer',{'is-open':l.value}])},[(0,x.createElementVNode)('button',{class:'drawer-toggle',onClick:t[0]||(t[0]=e=>l.value=!l.value)},[...t[1]||(t[1]=[(0,x.createElementVNode)('i',{class:'drawer-icon'},null,-1),(0,x.createElementVNode)('span',null,'详情',-1)])]),(0,x.createElementVNode)('div',Ao,[(0,x.createCommentVNode)(' 世界专属属性 '),(0,x.createElementVNode)('div',Oo,[t[2]||(t[2]=(0,x.createElementVNode)('h5',{class:'section-title'},'世界专属',-1)),o.value&&Object.keys(o.value).length>0?((0,x.openBlock)(),(0,x.createElementBlock)('ul',jo,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(o.value,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:t,class:'attribute-item'},[(0,x.createElementVNode)('span',To,(0,x.toDisplayString)(t),1),(0,x.createElementVNode)('span',Fo,(0,x.toDisplayString)(n(e)),1)]))),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Ro,'无'))]),(0,x.createCommentVNode)(' 战斗参数 '),(0,x.createElementVNode)('div',Wo,[t[3]||(t[3]=(0,x.createElementVNode)('h5',{class:'section-title'},'战斗参数',-1)),a.value&&Object.keys(a.value).length>0?((0,x.openBlock)(),(0,x.createElementBlock)('ul',Po,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(a.value,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:t,class:'attribute-item'},[(0,x.createElementVNode)('span',Uo,(0,x.toDisplayString)(t),1),(0,x.createElementVNode)('span',Ho,(0,x.toDisplayString)(n(e)),1)]))),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Go,'无'))])])],2)])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Jo,'化身数据加载中...'))]))}}),qo=(0,me.A)(Yo,[['__scopeId','data-v-8e022938']]),Ko={class:'panel-wrapper inventory-panel'},Qo={class:'main-content'},Xo={class:'item-grid-container'},Zo={class:'item-grid'},ea=['onClick'],ta={class:'item-name-arc',viewBox:'0 0 100 100'},na=['id'],oa=['xlink:href'],aa={class:'item-footer'},la={key:0,class:'item-quantity'},ra={key:0,class:'empty-grid'},ia={class:'scroll-detail-view'},ca={key:0,class:'scroll-content'},sa={class:'detail-meta'},da={key:0,class:'meta-tier'},ma={key:1,class:'meta-type'},ua={class:'detail-desc'},pa={key:0,class:'detail-effects'},va={key:0},ga={key:1},fa={key:1,class:'loading'},ha=(0,x.defineComponent)({__name:'AvatarInventoryPanel',setup(e){const t=(0,x.ref)(null),n=()=>{t.value=null},o=(0,x.computed)(()=>ft.value),a={common:'128, 128, 128',rare:'45, 200, 240',epic:'138, 43, 226',legendary:'218, 165, 32'},l=e=>{let t='common';if(e&&e.能级){const n=e.能级;n>=9?t='legendary':n>=6?t='epic':n>=3&&(t='rare')}return{'--tier-color-rgb':a[t]}};return(e,a)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Ko,[(0,x.unref)(dt)?((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:0,class:(0,x.normalizeClass)(['inventory-layout',{'detail-open':t.value}])},[(0,x.createCommentVNode)(' Main Content: Categories and Grid '),(0,x.createElementVNode)('div',Qo,[(0,x.createCommentVNode)(' 画卷式物品展示 '),(0,x.createElementVNode)('div',Xo,[(0,x.createElementVNode)('div',Zo,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(o.value,(e,n)=>((0,x.openBlock)(),(0,x.createElementBlock)(x.Fragment,{key:e.ID||`item-${n}`},[(0,x.createCommentVNode)(' 渲染物品卡片 '),(0,x.createElementVNode)('div',{class:'item-cell',style:(0,x.normalizeStyle)(l(e)),onClick:n=>(e=>{t.value=e})(e)},[(0,x.createCommentVNode)(' 环绕文字SVG '),((0,x.openBlock)(),(0,x.createElementBlock)('svg',ta,[(0,x.createElementVNode)('defs',null,[(0,x.createCommentVNode)(' 定义文字环绕的路径 '),(0,x.createElementVNode)('path',{id:`arc-path-${e.ID||n}`,d:'M 12,52 a 38,38 0 1,1 76,0',fill:'none'},null,8,na)]),(0,x.createElementVNode)('text',null,[(0,x.createElementVNode)('textPath',{class:'arc-text','xlink:href':`#arc-path-${e.ID||n}`,startOffset:'50%','text-anchor':'middle'},(0,x.toDisplayString)(e.名称),9,oa)])])),(0,x.createElementVNode)('div',aa,['数量'in e&&e.数量?((0,x.openBlock)(),(0,x.createElementBlock)('span',la,'x'+(0,x.toDisplayString)(e.数量),1)):(0,x.createCommentVNode)('v-if',!0)])],12,ea)],64))),128))]),0===o.value.length?((0,x.openBlock)(),(0,x.createElementBlock)('div',ra,[...a[0]||(a[0]=[(0,x.createElementVNode)('p',null,'空空如也',-1)])])):(0,x.createCommentVNode)('v-if',!0)])]),(0,x.createCommentVNode)(' Right: Item Detail Scroll '),(0,x.createElementVNode)('div',ia,[t.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',ca,[(0,x.createElementVNode)('button',{onClick:n,class:'close-button'},'×'),(0,x.createElementVNode)('h4',{class:'detail-name',style:(0,x.normalizeStyle)(l(t.value))},(0,x.toDisplayString)(t.value.名称),5),(0,x.createElementVNode)('div',sa,[t.value.能级?((0,x.openBlock)(),(0,x.createElementBlock)('span',da,'能级 '+(0,x.toDisplayString)(t.value.能级),1)):(0,x.createCommentVNode)('v-if',!0),t.value.类型?((0,x.openBlock)(),(0,x.createElementBlock)('span',ma,(0,x.toDisplayString)(t.value.类型),1)):(0,x.createCommentVNode)('v-if',!0)]),(0,x.createElementVNode)('p',ua,(0,x.toDisplayString)(t.value.描述),1),t.value.effects?((0,x.openBlock)(),(0,x.createElementBlock)('div',pa,[a[1]||(a[1]=(0,x.createElementVNode)('h5',null,'效果:',-1)),t.value.effects.attributes_bonus&&Object.keys(t.value.effects.attributes_bonus).length>0?((0,x.openBlock)(),(0,x.createElementBlock)('ul',va,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(t.value.effects.attributes_bonus,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:t},(0,x.toDisplayString)(t)+' +'+(0,x.toDisplayString)(e),1))),128))])):(0,x.createCommentVNode)('v-if',!0),t.value.effects.percentage_bonus&&Object.keys(t.value.effects.percentage_bonus).length>0?((0,x.openBlock)(),(0,x.createElementBlock)('ul',ga,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(t.value.effects.percentage_bonus,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:t},(0,x.toDisplayString)(t)+' '+(0,x.toDisplayString)(e),1))),128))])):(0,x.createCommentVNode)('v-if',!0)])):(0,x.createCommentVNode)('v-if',!0)])):(0,x.createCommentVNode)('v-if',!0)])],2)):((0,x.openBlock)(),(0,x.createElementBlock)('div',fa,'加载中...'))]))}}),ya=(0,me.A)(ha,[['__scopeId','data-v-ca49a7a8']]),ka={class:'panel-wrapper tasks-panel-starmap'},Ea={key:0,class:'starmap-container'},Na={class:'starmap-svg'},ba=['d'],Va=['onClick'],Sa={class:'star-label'},Ba=['onClick'],wa={class:'detail-desc'},Ca={class:'detail-meta'},Da={key:0},xa={key:1},Ia={key:2},$a={key:3},_a={key:1,class:'no-data'},za=(0,x.defineComponent)({__name:'AvatarTasksPanel',setup(e){const t=(0,x.computed)(()=>(0,he.get)(dt.value,'本世宿命',null)),n=(0,x.computed)(()=>{if(!t.value)return[];const e=(0,he.get)(t.value,'宿命之网',{});return Object.values(e)}),o=(0,x.computed)(()=>t.value?(0,he.get)(t.value,'终极任务',null):null),a=(0,x.computed)(()=>n.value.filter(e=>'命运节点'===e.类型)),l=(0,x.computed)(()=>n.value.filter(e=>'衍生任务'===e.类型)),r=(0,x.ref)(null),i=(0,x.reactive)({top:'0px',left:'0px',transform:'translate(-50%, -50%)'}),c=e=>{if(!e)return'无';const t=n.value.find(t=>t.ID===e);return t?t.名称:e},s=(0,x.computed)(()=>{const e=[],t=a.value.length;e.push({top:'15%',left:'50%'});return a.value.forEach((_,n)=>{const o=t>1?n/(t-1):.5,a=85-55*o,l=50+20*Math.sin(o*Math.PI*2);e.push({top:`${a}%`,left:`${l}%`})}),e}),d=(0,x.computed)(()=>{if(s.value.length<=1)return[];const e=[];for(let t=0;t<a.value.length-1;t++){const n=s.value[t+1],o=s.value[t+2],l=`M ${parseFloat(n.left)} ${parseFloat(n.top)} Q ${(parseFloat(n.left)+parseFloat(o.left))/2} ${(parseFloat(n.top)+parseFloat(o.top))/2} ${parseFloat(o.left)} ${parseFloat(o.top)}`;e.push({d:l,class:'完成'===a.value[t+1].状态?'star-path triggered':'star-path'})}if(a.value.length>0){const t=s.value[a.value.length],n=s.value[0],o=`M ${parseFloat(t.left)} ${parseFloat(t.top)} Q ${(parseFloat(t.left)+parseFloat(n.left))/2} ${(parseFloat(t.top)+parseFloat(n.top))/2} ${parseFloat(n.left)} ${parseFloat(n.top)}`;e.push({d:o,class:'完成'===a.value[a.value.length-1].状态?'star-path triggered':'star-path'})}return l.value.forEach((t,n)=>{const o=a.value.find(e=>e.ID===t.前置任务ID);if(o){const l=a.value.indexOf(o),r=s.value[l+1],i=m(t,n),c=`M ${parseFloat(r.left)} ${parseFloat(r.top)} L ${parseFloat(i.left.replace('calc(','').replace(')',''))} ${parseFloat(i.top.replace('calc(','').replace(')',''))}`;e.push({d:c,class:'star-path derived-path'})}}),e}),m=(e,t)=>{const n=a.value.find(t=>t.ID===e.前置任务ID);if(!n)return{top:'0%',left:'0%'};const o=a.value.indexOf(n),l=s.value[o+1],r=(t%2==0?5:-5)*(Math.floor(t/2)+1),i=(t%2==0?-5:5)*(Math.floor(t/2)+1);return{top:`calc(${l.top} + ${i}%)`,left:`calc(${l.left} + ${r}%)`}},u=(e,t,n)=>{r.value={data:e,type:t,el:n.currentTarget};const o=n.currentTarget,a=`calc(${o.style.top} + 20px)`,l=`calc(${o.style.left} + 20px)`;i.top=a,i.left=l},p=e=>{const t=e.target.closest('.node-detail-modal');if(!t)return;const n=e.clientX,o=e.clientY,a=t.offsetTop,l=t.offsetLeft,r=e=>{i.top=a+e.clientY-o+'px',i.left=l+e.clientX-n+'px'},c=()=>{document.removeEventListener('mousemove',r),document.removeEventListener('mouseup',c)};document.addEventListener('mousemove',r),document.addEventListener('mouseup',c)},v=e=>s.value[e]||{top:'50%',left:'50%'};return(e,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',ka,[t.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',Ea,[((0,x.openBlock)(),(0,x.createElementBlock)('svg',Na,[n[2]||(n[2]=(0,x.createElementVNode)('defs',null,[(0,x.createElementVNode)('linearGradient',{id:'grad-triggered',x1:'0%',y1:'0%',x2:'0%',y2:'100%'},[(0,x.createElementVNode)('stop',{offset:'0%',style:{'stop-color':'rgba(0, 255, 255, 0.8)'}}),(0,x.createElementVNode)('stop',{offset:'100%',style:{'stop-color':'rgba(138, 43, 226, 0.8)'}})])],-1)),(0,x.createCommentVNode)(' 星轨 '),((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(d.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('path',{key:e.d,d:e.d,class:(0,x.normalizeClass)(e.class)},null,10,ba))),128))])),(0,x.createCommentVNode)(' 终极任务 (帝星) '),o.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:0,class:'star-node ultimate-star',style:(0,x.normalizeStyle)(v(0)),onClick:n[0]||(n[0]=e=>u(o.value,'ultimate',e))},[...n[3]||(n[3]=[(0,x.createElementVNode)('div',{class:'star-core'},null,-1),(0,x.createElementVNode)('div',{class:'star-label'},'终极宿命',-1)])],4)):(0,x.createCommentVNode)('v-if',!0),(0,x.createCommentVNode)(' 命运节点 (星宿) '),((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(a.value,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:e.ID,class:(0,x.normalizeClass)(['star-node destiny-star',{triggered:'完成'===e.状态}]),style:(0,x.normalizeStyle)(v(t+1)),onClick:t=>u(e,'destiny',t)},[n[4]||(n[4]=(0,x.createElementVNode)('div',{class:'star-core'},null,-1)),(0,x.createElementVNode)('div',Sa,(0,x.toDisplayString)(e.名称),1)],14,Va))),128)),(0,x.createCommentVNode)(' 衍生任务 (流星) '),((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(l.value,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:e.ID,class:'star-node derived-star',style:(0,x.normalizeStyle)(m(e,t)),onClick:t=>u(e,'derived',t)},[...n[5]||(n[5]=[(0,x.createElementVNode)('div',{class:'star-core'},null,-1)])],12,Ba))),128)),(0,x.createCommentVNode)(' 详情弹窗 '),r.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:1,class:'node-detail-modal',style:(0,x.normalizeStyle)(i)},[(0,x.createElementVNode)('h4',{class:'detail-title',onMousedown:p},(0,x.toDisplayString)(r.value.data.名称),33),(0,x.createElementVNode)('p',wa,(0,x.toDisplayString)(r.value.data.描述),1),(0,x.createElementVNode)('div',Ca,[r.value.data.状态?((0,x.openBlock)(),(0,x.createElementBlock)('p',Da,[n[6]||(n[6]=(0,x.createElementVNode)('strong',null,'状态:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(r.value.data.状态),1)])):(0,x.createCommentVNode)('v-if',!0),r.value.data.目标?((0,x.openBlock)(),(0,x.createElementBlock)('p',xa,[n[7]||(n[7]=(0,x.createElementVNode)('strong',null,'目标:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(r.value.data.目标),1)])):(0,x.createCommentVNode)('v-if',!0),r.value.data.前置任务ID?((0,x.openBlock)(),(0,x.createElementBlock)('p',Ia,[n[8]||(n[8]=(0,x.createElementVNode)('strong',null,'前置:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(c(r.value.data.前置任务ID)),1)])):(0,x.createCommentVNode)('v-if',!0),'ultimate'===r.value.type&&r.value.data.完成条件?((0,x.openBlock)(),(0,x.createElementBlock)('p',$a,[n[9]||(n[9]=(0,x.createElementVNode)('strong',null,'完成条件:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(r.value.data.完成条件.join(', ')),1)])):(0,x.createCommentVNode)('v-if',!0)]),(0,x.createElementVNode)('button',{class:'close-button',onClick:n[1]||(n[1]=e=>r.value=null)},'×')],4)):(0,x.createCommentVNode)('v-if',!0)])):((0,x.openBlock)(),(0,x.createElementBlock)('div',_a,[(0,x.createElementVNode)('p',null,(0,x.toDisplayString)((0,x.unref)(dt)?'当前化身没有宿命任务。':'当前没有激活的化身。'),1)]))]))}}),La=(0,me.A)(za,[['__scopeId','data-v-1f7a99f8']]),Ma={class:'panel-wrapper character-panel-container'},Aa={key:0,class:'character-sheet'},Oa={class:'drawer-content'},ja={class:'info-item'},Ta={class:'value'},Fa={class:'info-item'},Ra={class:'value'},Wa={class:'world-attributes-section'},Pa={key:0,class:'attributes-list'},Ua={class:'label'},Ha={class:'value'},Ga={key:1,class:'empty-state'},Ja={key:1,class:'loading-state'},Ya=(0,x.defineComponent)({__name:'CharacterPanel',setup(e){const t=(e,t=0)=>null==e?t:e,n=e=>{if(null==e)return'-';if('object'==typeof e&&!Array.isArray(e)){const n=Object.keys(e).filter(e=>'$meta'!==e&&'description'!==e);return void 0!==e.current&&void 0!==e.max?`${e.current} / ${e.max}`:void 0!==e.当前&&void 0!==e.上限?`${e.当前} / ${e.上限}`:void 0!==e.value&&1===n.length?String(t(e.value)):n.length>0&&n.every(t=>'object'==typeof e[t]&&e[t]?.名称)?n.map(t=>e[t].名称).join('、'):n.length>0?n.map(n=>`${n}: ${t(e[n])}`).join(' | '):'...'}return String(t(e))},o=(0,x.computed)(()=>ct.character),a=((0,x.computed)(()=>t(o.value?.灵魂本源,0)),(0,x.computed)(()=>t(o.value?.道心,0))),l=ht,r=(0,x.ref)(!1);return(e,i)=>{const c=(0,x.resolveDirective)('tooltip');return(0,x.openBlock)(),(0,x.createElementBlock)('div',Ma,[o.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',Aa,[(0,x.createCommentVNode)(' 命盘 '),(0,x.createVNode)(zo,{character:o.value},null,8,['character']),(0,x.createCommentVNode)(' 抽屉 '),(0,x.createElementVNode)('div',{class:(0,x.normalizeClass)(['additional-info-drawer',{'is-open':r.value}])},[(0,x.createElementVNode)('button',{class:'drawer-toggle',onClick:i[0]||(i[0]=e=>r.value=!r.value)},[...i[1]||(i[1]=[(0,x.createElementVNode)('i',{class:'drawer-icon'},null,-1),(0,x.createElementVNode)('span',null,'详情',-1)])]),(0,x.createElementVNode)('div',Oa,[(0,x.createElementVNode)('div',ja,[i[2]||(i[2]=(0,x.createElementVNode)('span',{class:'label'},'真名:',-1)),(0,x.createElementVNode)('span',Ta,(0,x.toDisplayString)(t(o.value.真名,'未知')),1)]),(0,x.createElementVNode)('div',Fa,[i[3]||(i[3]=(0,x.createElementVNode)('span',{class:'label'},'道心:',-1)),(0,x.createElementVNode)('span',Ra,(0,x.toDisplayString)(a.value),1)]),(0,x.createCommentVNode)(' 世界专属属性 '),(0,x.createElementVNode)('div',Wa,[i[4]||(i[4]=(0,x.createElementVNode)('h5',{class:'section-title'},'世界专属',-1)),(0,x.unref)(l).length>0?((0,x.openBlock)(),(0,x.createElementBlock)('ul',Pa,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)((0,x.unref)(l),e=>(0,x.withDirectives)(((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e.key,class:'attribute-item'},[(0,x.createElementVNode)('span',Ua,(0,x.toDisplayString)(e.key),1),(0,x.createElementVNode)('span',Ha,(0,x.toDisplayString)(n(e.value)),1)])),[[c,e.description]])),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Ga,'无'))])])],2)])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Ja,'加载中...'))])}}}),qa=(0,me.A)(Ya,[['__scopeId','data-v-75993348']]),Ka={key:0,class:'imprint-detail-modal-content'},Qa={class:'imprint-header'},Xa={class:'imprint-name'},Za={class:'imprint-tags'},el={class:'tag type-tag'},tl=['data-level'],nl={class:'imprint-body'},ol={class:'imprint-main-display'},al=['data-level'],ll={class:'imprint-description'},rl={class:'imprint-effects'},il={key:0,class:'effects-list'},cl={class:'effect-type'},sl={class:'effect-value'},dl={class:'effect-type'},ml={class:'effect-value'},ul=(0,x.defineComponent)({__name:'ImprintDetailModal',props:{imprint:{}},setup:e=>(t,n)=>e.imprint?((0,x.openBlock)(),(0,x.createElementBlock)('div',Ka,[(0,x.createElementVNode)('div',Qa,[(0,x.createElementVNode)('h2',Xa,(0,x.toDisplayString)(e.imprint.名称),1),(0,x.createElementVNode)('div',Za,[(0,x.createElementVNode)('span',el,(0,x.toDisplayString)(e.imprint.类型),1),(0,x.createElementVNode)('span',{class:'tag level-tag','data-level':e.imprint.能级},'能级 '+(0,x.toDisplayString)(e.imprint.能级),9,tl)])]),(0,x.createElementVNode)('div',nl,[(0,x.createElementVNode)('div',ol,[(0,x.createElementVNode)('div',{class:'imprint-mandala','data-level':e.imprint.能级},[(0,x.createCommentVNode)(' Central visual element, can be an icon or complex SVG '),n[0]||(n[0]=(0,x.createElementVNode)('span',{class:'mandala-icon'},'✧',-1))],8,al),(0,x.createElementVNode)('p',ll,(0,x.toDisplayString)(e.imprint.描述),1)]),(0,x.createElementVNode)('div',rl,[n[3]||(n[3]=(0,x.createElementVNode)('h3',{class:'effects-title'},'效果',-1)),e.imprint.effects?((0,x.openBlock)(),(0,x.createElementBlock)('ul',il,[e.imprint.effects.attributes_bonus?((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,{key:0},(0,x.renderList)(e.imprint.effects.attributes_bonus,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:t,class:'effect-item'},[(0,x.createElementVNode)('strong',cl,(0,x.toDisplayString)(t)+':',1),(0,x.createElementVNode)('span',sl,'+'+(0,x.toDisplayString)(e),1),n[1]||(n[1]=(0,x.createElementVNode)('p',{class:'effect-description'},'固定值加成',-1))]))),128)):(0,x.createCommentVNode)('v-if',!0),e.imprint.effects.percentage_bonus?((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,{key:1},(0,x.renderList)(e.imprint.effects.percentage_bonus,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:t,class:'effect-item'},[(0,x.createElementVNode)('strong',dl,(0,x.toDisplayString)(t)+':',1),(0,x.createElementVNode)('span',ml,(0,x.toDisplayString)(e),1),n[2]||(n[2]=(0,x.createElementVNode)('p',{class:'effect-description'},'百分比加成',-1))]))),128)):(0,x.createCommentVNode)('v-if',!0)])):(0,x.createCommentVNode)('v-if',!0)])])])):(0,x.createCommentVNode)('v-if',!0)}),pl={class:'panel-wrapper imprints-panel-container'},vl={class:'imprints-grid'},gl=['data-level','onClick'],fl={class:'imprint-name'},hl={class:'imprint-level'},yl={key:1,class:'empty-text'},kl=(0,x.defineComponent)({__name:'ImprintsPanel',setup(e){const t=(0,x.computed)(()=>ut.value),n=(0,x.computed)(()=>{const e=[...t.value||[]];for(;e.length<9;)e.push(null);return e.slice(0,9)});return(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',pl,[(0,x.createElementVNode)('div',vl,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(n.value,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:t,class:(0,x.normalizeClass)(['imprint-slot',{empty:!e,clickable:!!e}]),'data-level':e?.能级,onClick:t=>e&&(e=>{Cn.show(e.名称,ul,{imprint:e})})(e)},[e?((0,x.openBlock)(),(0,x.createElementBlock)(x.Fragment,{key:0},[(0,x.createElementVNode)('div',fl,(0,x.toDisplayString)(e.名称),1),(0,x.createElementVNode)('div',hl,'能级: '+(0,x.toDisplayString)(e.能级),1)],64)):((0,x.openBlock)(),(0,x.createElementBlock)('div',yl,'空'))],10,gl))),128))]),t[0]||(t[0]=(0,x.createElementVNode)('div',{class:'detail-placeholder'},[(0,x.createElementVNode)('p',null,'点击烙印查看详情')],-1))]))}}),El=(0,me.A)(kl,[['__scopeId','data-v-dcca238c']]),Nl={key:0,class:'item-detail-panel'},bl={class:'detail-name'},Vl={class:'detail-meta'},Sl={class:'meta-type'},Bl={class:'detail-desc'},wl={key:0,class:'detail-effects'},Cl={key:0},Dl={key:0},xl={key:1},Il={key:0},$l={key:1,class:'empty-detail'},_l=(0,x.defineComponent)({__name:'ItemDetailPanel',props:{item:{}},setup(e){const t={common:'#a0a0a0',rare:'#3a8f9d',epic:'#8a5db5',legendary:'#d4af37'},n=(e,n=!1)=>{let o='common';if(e&&e.能级){const t=e.能级;t>=9?o='legendary':t>=6?o='epic':t>=3&&(o='rare')}return n?{color:t[o]}:{'--tier-border-color':t[o]}};return(t,o)=>e.item?((0,x.openBlock)(),(0,x.createElementBlock)('div',Nl,[(0,x.createElementVNode)('h4',bl,(0,x.toDisplayString)(e.item.名称),1),(0,x.createElementVNode)('div',Vl,[(0,x.createElementVNode)('span',{class:'meta-tier',style:(0,x.normalizeStyle)(n(e.item,!0))},'能级 '+(0,x.toDisplayString)(e.item.能级),5),(0,x.createElementVNode)('span',Sl,(0,x.toDisplayString)(e.item.类型),1)]),(0,x.createElementVNode)('p',Bl,(0,x.toDisplayString)(e.item.描述),1),e.item.effects?((0,x.openBlock)(),(0,x.createElementBlock)('div',wl,[o[0]||(o[0]=(0,x.createElementVNode)('h5',null,'效果:',-1)),e.item.effects.attributes_bonus&&Object.keys(e.item.effects.attributes_bonus).length>1?((0,x.openBlock)(),(0,x.createElementBlock)('ul',Cl,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.item.effects.attributes_bonus,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:t},['$meta'!==t?((0,x.openBlock)(),(0,x.createElementBlock)('span',Dl,(0,x.toDisplayString)(t)+': +'+(0,x.toDisplayString)(e),1)):(0,x.createCommentVNode)('v-if',!0)]))),128))])):(0,x.createCommentVNode)('v-if',!0),e.item.effects.percentage_bonus&&Object.keys(e.item.effects.percentage_bonus).length>1?((0,x.openBlock)(),(0,x.createElementBlock)('ul',xl,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.item.effects.percentage_bonus,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:t},['$meta'!==t?((0,x.openBlock)(),(0,x.createElementBlock)('span',Il,(0,x.toDisplayString)(t)+': '+(0,x.toDisplayString)(e),1)):(0,x.createCommentVNode)('v-if',!0)]))),128))])):(0,x.createCommentVNode)('v-if',!0)])):(0,x.createCommentVNode)('v-if',!0)])):((0,x.openBlock)(),(0,x.createElementBlock)('div',$l,[...o[1]||(o[1]=[(0,x.createElementVNode)('p',null,'选择一个物品以查看详情',-1)])]))}}),zl=(0,me.A)(_l,[['__scopeId','data-v-11d93009']]),Ll={class:'panel-wrapper inventory-panel'},Ml={key:0,class:'inventory-layout'},Al={class:'category-header'},Ol=['onClick'],jl={class:'main-content'},Tl={class:'item-grid-container'},Fl={key:0,class:'item-grid'},Rl=['onClick'],Wl={class:'item-name'},Pl={key:0,class:'item-quantity'},Ul={key:1,class:'empty-grid'},Hl={key:1,class:'loading'},Gl=(0,x.defineComponent)({__name:'InventoryPanel',setup(e){const t=(0,x.ref)(null),n=(0,x.ref)(null),o=(0,x.computed)(()=>{const e=gt.value,t={消耗品:[],奇物:[],材料:[],羁绊:[]};if(!e)return t;if(e.forEach(e=>{const n=e.类型;t[n]&&t[n].push(e)}),!n.value){const e=Object.keys(t).find(e=>t[e].length>0);e&&(n.value=e)}return t}),a=(0,x.computed)(()=>n.value&&o.value[n.value]?o.value[n.value]:[]),l={common:'#a0a0a0',rare:'#3a8f9d',epic:'#8a5db5',legendary:'#d4af37'},r=(e,t=!1)=>{let n='common';if(e&&e.能级){const t=e.能级;t>=9?n='legendary':t>=6?n='epic':t>=3&&(n='rare')}return t?{color:l[n]}:{'--tier-border-color':l[n]}};return(e,l)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Ll,[(0,x.unref)(st)?((0,x.openBlock)(),(0,x.createElementBlock)('div',Ml,[(0,x.createCommentVNode)(' Top: Category List '),(0,x.createElementVNode)('div',Al,[(0,x.createElementVNode)('ul',null,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(Object.keys(o.value),e=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e,class:(0,x.normalizeClass)({active:n.value===e}),onClick:t=>n.value=e},(0,x.toDisplayString)(e)+' ('+(0,x.toDisplayString)(o.value[e].length)+') ',11,Ol))),128))])]),(0,x.createCommentVNode)(' Bottom: Item Grid and Detail View '),(0,x.createElementVNode)('div',jl,[(0,x.createElementVNode)('div',Tl,[a.value.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',Fl,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(a.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:e.ID,class:(0,x.normalizeClass)(['item-cell',{selected:t.value?.ID===e.ID}]),style:(0,x.normalizeStyle)(r(e)),onClick:n=>(e=>{t.value=e})(e)},[(0,x.createElementVNode)('div',Wl,(0,x.toDisplayString)(e.名称),1),e.数量?((0,x.openBlock)(),(0,x.createElementBlock)('div',Pl,'x'+(0,x.toDisplayString)(e.数量),1)):(0,x.createCommentVNode)('v-if',!0)],14,Rl))),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Ul,[...l[0]||(l[0]=[(0,x.createElementVNode)('p',null,'空空如也',-1)])]))]),(0,x.createVNode)(zl,{item:t.value},null,8,['item'])])])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Hl,'加载中...'))]))}}),Jl=(0,me.A)(Gl,[['__scopeId','data-v-484e88e6']]),Yl='reincarnation_followed_npcs',ql=(0,x.ref)(new Set(JSON.parse(localStorage.getItem(Yl)||'[]')));function Kl(){const e=e=>ql.value.has(e);return{followedNpcs:ql,toggleFollow:t=>{e(t)?(e=>{ql.value.delete(e)})(t):(e=>{ql.value.add(e)})(t)},isFollowed:e}}(0,x.watch)(ql,e=>{localStorage.setItem(Yl,JSON.stringify(Array.from(e)))},{deep:!0});const Ql=(0,x.defineComponent)({__name:'FollowButton',props:{npcId:{}},setup(e){const t=e,{toggleFollow:n,isFollowed:o}=Kl(),a=(0,x.ref)(!1);function l(){n(t.npcId)}return(0,x.watchEffect)(()=>{a.value=o(t.npcId)}),(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('button',{class:(0,x.normalizeClass)(['follow-btn',{followed:a.value}]),onClick:(0,x.withModifiers)(l,['stop'])},'★',2))}}),Xl=(0,me.A)(Ql,[['__scopeId','data-v-9ca898fa']]),Zl={class:'detail-tab-content grid-layout'},er={class:'detail-item'},tr={class:'detail-value'},nr={class:'detail-item'},or={class:'detail-value'},ar={class:'detail-item'},lr={class:'detail-value'},rr={class:'tag'},ir={class:'detail-item'},cr={class:'detail-value'},sr={class:'detail-item'},dr={class:'detail-value'},mr={class:'detail-item'},ur={class:'detail-value'},pr={class:'detail-item'},vr={class:'detail-value'},gr={class:'detail-item'},fr={class:'detail-value'},hr={class:'tag'},yr={class:'detail-item'},kr={class:'detail-value'},Er={class:'detail-item full-width'},Nr={class:'detail-value'},br={class:'history-list'},Vr={key:0},Sr={key:1,class:'influence-text'},Br=(0,x.defineComponent)({__name:'NpcArchiveTab',props:{npc:{}},setup(e){const t=e,n=(0,x.computed)(()=>{const e=wt(t.npc,Et.value);return null===e?'未知':e}),o=(0,x.computed)(()=>{const e=t.npc.出生日期;return e?`${e.年}年${e.月}月${e.日}日`:'未知'});return(t,a)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Zl,[(0,x.createElementVNode)('div',er,[a[0]||(a[0]=(0,x.createElementVNode)('strong',{class:'detail-key'},'姓名:',-1)),(0,x.createElementVNode)('div',tr,[(0,x.createElementVNode)('p',null,(0,x.toDisplayString)(e.npc.姓名),1)])]),(0,x.createElementVNode)('div',nr,[a[1]||(a[1]=(0,x.createElementVNode)('strong',{class:'detail-key'},'生日:',-1)),(0,x.createElementVNode)('div',or,[(0,x.createElementVNode)('p',null,(0,x.toDisplayString)(o.value)+' ('+(0,x.toDisplayString)(n.value)+')',1)])]),(0,x.createElementVNode)('div',ar,[a[2]||(a[2]=(0,x.createElementVNode)('strong',{class:'detail-key'},'身份:',-1)),(0,x.createElementVNode)('div',lr,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(Object.values(e.npc.身份||{}).filter(e=>'string'==typeof e),e=>((0,x.openBlock)(),(0,x.createElementBlock)('span',rr,(0,x.toDisplayString)(e),1))),256))])]),(0,x.createElementVNode)('div',ir,[a[3]||(a[3]=(0,x.createElementVNode)('strong',{class:'detail-key'},'性别:',-1)),(0,x.createElementVNode)('div',cr,[(0,x.createElementVNode)('p',null,(0,x.toDisplayString)(e.npc.性别),1)])]),(0,x.createElementVNode)('div',sr,[a[4]||(a[4]=(0,x.createElementVNode)('strong',{class:'detail-key'},'相貌:',-1)),(0,x.createElementVNode)('div',dr,[(0,x.createElementVNode)('p',null,(0,x.toDisplayString)(e.npc.相貌),1)])]),(0,x.createElementVNode)('div',mr,[a[5]||(a[5]=(0,x.createElementVNode)('strong',{class:'detail-key'},'着装:',-1)),(0,x.createElementVNode)('div',ur,[(0,x.createElementVNode)('p',null,(0,x.toDisplayString)(e.npc.着装),1)])]),(0,x.createElementVNode)('div',pr,[a[6]||(a[6]=(0,x.createElementVNode)('strong',{class:'detail-key'},'核心需求:',-1)),(0,x.createElementVNode)('div',vr,[(0,x.createElementVNode)('p',null,(0,x.toDisplayString)(e.npc.心流?.核心需求),1)])]),(0,x.createElementVNode)('div',gr,[a[7]||(a[7]=(0,x.createElementVNode)('strong',{class:'detail-key'},'性格特质:',-1)),(0,x.createElementVNode)('div',fr,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(Object.values(e.npc.背景?.性格特质||{}).filter(e=>'string'==typeof e),e=>((0,x.openBlock)(),(0,x.createElementBlock)('span',hr,(0,x.toDisplayString)(e),1))),256))])]),(0,x.createElementVNode)('div',yr,[a[8]||(a[8]=(0,x.createElementVNode)('strong',{class:'detail-key'},'行动倾向:',-1)),(0,x.createElementVNode)('div',kr,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.npc.心流?.驱动力?.决策倾向,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('span',{key:t,class:'tag'},(0,x.toDisplayString)(t)+': '+(0,x.toDisplayString)(e),1))),128))])]),(0,x.createElementVNode)('div',Er,[a[9]||(a[9]=(0,x.createElementVNode)('strong',{class:'detail-key'},'过去经历:',-1)),(0,x.createElementVNode)('div',Nr,[(0,x.createElementVNode)('ul',br,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(Object.values(e.npc.背景?.过去经历||{}).filter(e=>'object'==typeof e),(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:t},[(0,x.createElementVNode)('strong',null,(0,x.toDisplayString)(e.事件),1),e.描述?((0,x.openBlock)(),(0,x.createElementBlock)('p',Vr,(0,x.toDisplayString)(e.描述),1)):(0,x.createCommentVNode)('v-if',!0),e.影响?((0,x.openBlock)(),(0,x.createElementBlock)('p',Sr,(0,x.toDisplayString)(e.影响),1)):(0,x.createCommentVNode)('v-if',!0)]))),128))])])])]))}}),wr=(0,me.A)(Br,[['__scopeId','data-v-221487f4']]),Cr={class:'art-detail'},Dr={class:'art-name'},xr={class:'art-meta'},Ir={class:'art-description'},$r={class:'effects'},_r={key:0,class:'skills-section'},zr=(0,x.defineComponent)({__name:'ArtDetail',props:{art:{}},setup(e){const t=e,n=(0,x.computed)(()=>{const e=ct.worldState?.数据库;if(!e||!('技能'in e))return[];const n=e.技能;return Object.values(n).filter(e=>e.关联技艺===t.art.ID)});return(t,o)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Cr,[(0,x.createElementVNode)('h4',Dr,(0,x.toDisplayString)(e.art.名称),1),(0,x.createElementVNode)('div',xr,[(0,x.createElementVNode)('span',null,[o[0]||(o[0]=(0,x.createElementVNode)('strong',null,'关联潜力:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.art.关联潜力),1)]),(0,x.createElementVNode)('span',null,[o[1]||(o[1]=(0,x.createElementVNode)('strong',null,'等级上限:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.art.等级上限),1)])]),(0,x.createElementVNode)('p',Ir,(0,x.toDisplayString)(e.art.描述),1),(0,x.createElementVNode)('div',$r,[(0,x.createElementVNode)('p',null,[o[2]||(o[2]=(0,x.createElementVNode)('strong',null,'效果:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.art.效果描述),1)]),(0,x.createElementVNode)('p',null,[o[3]||(o[3]=(0,x.createElementVNode)('strong',null,'公式:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.art.效果等级公式),1)])]),n.value.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',_r,[o[4]||(o[4]=(0,x.createElementVNode)('h5',null,'下属技能',-1)),(0,x.createElementVNode)('ul',null,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(n.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e.ID},[(0,x.createElementVNode)('strong',null,(0,x.toDisplayString)(e.名称)+' ('+(0,x.toDisplayString)(e.类型)+')',1),(0,x.createElementVNode)('p',null,(0,x.toDisplayString)(e.描述),1)]))),128))])])):(0,x.createCommentVNode)('v-if',!0)]))}}),Lr=(0,me.A)(zr,[['__scopeId','data-v-4b328335']]),Mr={class:'talent-detail'},Ar={class:'talent-name'},Or={class:'talent-meta'},jr={class:'meta-item'},Tr={class:'meta-item'},Fr={class:'talent-description'},Rr=(0,x.defineComponent)({__name:'TalentDetail',props:{talent:{}},setup:e=>(t,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Mr,[(0,x.createElementVNode)('h4',Ar,(0,x.toDisplayString)(e.talent.名称),1),(0,x.createElementVNode)('div',Or,[(0,x.createElementVNode)('span',jr,[n[0]||(n[0]=(0,x.createElementVNode)('strong',null,'类型:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.talent.类型||'未知'),1)]),(0,x.createElementVNode)('span',Tr,[n[1]||(n[1]=(0,x.createElementVNode)('strong',null,'能级:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.talent.能级||'N/A'),1)])]),(0,x.createElementVNode)('p',Fr,(0,x.toDisplayString)(e.talent.描述),1)]))}),Wr=(0,me.A)(Rr,[['__scopeId','data-v-7ee5fcf5']]),Pr={class:'attribute-grid'},Ur={class:'attribute-key'},Hr={class:'attribute-value'},Gr=(0,x.defineComponent)({__name:'AttributeGrid',props:{attributes:{}},setup(e){const t=e,n=(0,x.computed)(()=>{if(!t.attributes)return{};const{$meta:e,...n}=t.attributes;return n});function o(e){if('object'==typeof e&&null!==e){if('当前'in e&&'上限'in e){let t=`${e['当前']}/${e['上限']}`;return'恢复速度'in e&&(t+=` (+${e['恢复速度']})`),t}return Object.entries(e).map(([e,t])=>`${e}: ${t}`).join('\n')}return String(e)}return(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Pr,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(n.value,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:t,class:'attribute-item'},[(0,x.createElementVNode)('span',Ur,(0,x.toDisplayString)(t),1),(0,x.createElementVNode)('span',Hr,(0,x.toDisplayString)(o(e)),1)]))),128))]))}}),Jr=(0,me.A)(Gr,[['__scopeId','data-v-3cb45dc2']]),Yr=['title'],qr={class:'value-cell'},Kr={key:0,class:'progress-bar-container'},Qr={class:'progress-text'},Xr={class:'object-value'},Zr={class:'data-item'},ei={class:'data-item-key'},ti={class:'data-item-value'},ni={class:'object-value'},oi=(0,x.defineComponent)({__name:'ObjectRendererItem',props:{itemKey:{},value:{}},setup(e){const t=e=>'object'==typeof e&&null!==e&&!Array.isArray(e),n=e=>t(e)&&'value'in e&&Object.keys(e).length<=2,o=e=>t(e)&&('ID'in e||'名称'in e)&&!('value'in e)&&!('current'in e),a=e=>{if(!e)return{};const{$meta:t,...n}=e;return n};return(l,r)=>{return(0,x.openBlock)(),(0,x.createElementBlock)('li',null,[(0,x.createElementVNode)('span',{class:'object-key',title:e.value?.description},(0,x.toDisplayString)(e.itemKey)+':',9,Yr),(0,x.createElementVNode)('div',qr,[(0,x.createCommentVNode)(' Case 1: Progress Bar (current/max) '),(i=e.value,t(i)&&'current'in i&&'max'in i?((0,x.openBlock)(),(0,x.createElementBlock)('div',Kr,[(0,x.createElementVNode)('div',{class:'progress-bar',style:(0,x.normalizeStyle)({width:e.value.current/e.value.max*100+'%'})},null,4),(0,x.createElementVNode)('span',Qr,(0,x.toDisplayString)(e.value.current)+' / '+(0,x.toDisplayString)(e.value.max),1)])):n(e.value)?((0,x.openBlock)(),(0,x.createElementBlock)(x.Fragment,{key:1},[(0,x.createCommentVNode)(' Case 2: Simple Value (value key) '),(0,x.createElementVNode)('span',Xr,(0,x.toDisplayString)(e.value.value),1)],64)):o(e.value)?((0,x.openBlock)(),(0,x.createElementBlock)(x.Fragment,{key:2},[(0,x.createCommentVNode)(' Case 3: Data Item (ID, 名称, 描述) '),(0,x.createElementVNode)('div',Zr,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.value,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:t,class:'data-item-row'},[(0,x.createElementVNode)('span',ei,(0,x.toDisplayString)(t)+':',1),(0,x.createElementVNode)('span',ti,(0,x.toDisplayString)(e),1)]))),128))])],64)):t(e.value)?((0,x.openBlock)(),(0,x.createElementBlock)(x.Fragment,{key:3},[(0,x.createCommentVNode)(' Case 4: Recursive Object '),(0,x.createElementVNode)('ul',{class:(0,x.normalizeClass)({'multi-column':Object.keys(e.value).length>4})},[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(a(e.value),(e,t)=>((0,x.openBlock)(),(0,x.createBlock)(ai,{key:t,'item-key':String(t),value:e},null,8,['item-key','value']))),128))],2)],64)):((0,x.openBlock)(),(0,x.createElementBlock)(x.Fragment,{key:4},[(0,x.createCommentVNode)(' Case 4: Primitive Value '),(0,x.createElementVNode)('span',ni,(0,x.toDisplayString)(e.value),1)],64)))])]);var i}}}),ai=(0,me.A)(oi,[['__scopeId','data-v-bf3c2c3e']]),li=(0,x.defineComponent)({__name:'ObjectRenderer',props:{data:{},isNested:{type:Boolean}},setup(e){const t=e,n=(0,x.computed)(()=>{if(!t.data)return{};const{$meta:e,...n}=t.data;return n});return(t,o)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{class:(0,x.normalizeClass)(['object-renderer',{'is-nested':e.isNested}])},[(0,x.createElementVNode)('ul',{class:(0,x.normalizeClass)({'multi-column':Object.keys(n.value).length>4})},[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(n.value,(e,t)=>((0,x.openBlock)(),(0,x.createBlock)(ai,{key:t,'item-key':String(t),value:e},null,8,['item-key','value']))),128))],2)],2))}}),ri=(0,me.A)(li,[['__scopeId','data-v-63d33886']]),ii={class:'detail-tab-content grid-layout'},ci={class:'detail-item full-width'},si={class:'detail-item full-width'},di={class:'detail-item full-width'},mi={class:'detail-item full-width'},ui={class:'detail-value'},pi={key:0,class:'tags-container'},vi=['onClick'],gi={key:1,class:'placeholder'},fi={class:'detail-item full-width'},hi={key:0,class:'skills-list'},yi=['onClick'],ki={class:'skill-header'},Ei={class:'skill-level'},Ni={key:1,class:'placeholder'},bi=(0,x.defineComponent)({__name:'NpcPowerTab',props:{npc:{}},setup(e){const t=e,n=(0,x.computed)(()=>{const e=ct.worldState?.数据库;if(!t.npc.天赋||!e||!('天赋'in e))return[];const n=e.天赋;return n?Object.keys(t.npc.天赋).map(e=>{const t=n[e];return t?{...t,ID:e}:null}).filter(Boolean):[]}),o=(0,x.computed)(()=>{const e=ct.worldState?.数据库;if(!t.npc.技艺||!e||!('技艺'in e))return[];const n=t.npc.技艺,o=e.技艺;if(!o)return[];const a=[];for(const e in n){const t=n[e],l=o[e];if(l&&l.等级体系){const n=`level_${t.等级}`,o=l.等级体系[n];a.push({id:e,name:l.名称,level:t.等级,title:o?o.称号:''})}}return a});return(t,a)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',ii,[(0,x.createElementVNode)('div',ci,[a[0]||(a[0]=(0,x.createElementVNode)('strong',{class:'detail-key'},'基础潜力',-1)),(0,x.createVNode)(Jr,{attributes:e.npc.基础潜力},null,8,['attributes'])]),(0,x.createElementVNode)('div',si,[a[1]||(a[1]=(0,x.createElementVNode)('strong',{class:'detail-key'},'战斗参数',-1)),(0,x.createVNode)(Jr,{attributes:e.npc.战斗参数},null,8,['attributes'])]),(0,x.createElementVNode)('div',di,[a[2]||(a[2]=(0,x.createElementVNode)('strong',{class:'detail-key'},'世界专属属性',-1)),(0,x.createVNode)(ri,{data:e.npc.世界专属属性},null,8,['data'])]),(0,x.createElementVNode)('div',mi,[a[3]||(a[3]=(0,x.createElementVNode)('strong',{class:'detail-key'},'天赋',-1)),(0,x.createElementVNode)('div',ui,[n.value.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',pi,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(n.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('span',{key:e.ID,class:'tag talent-tag',onClick:t=>(e=>{Cn.show(e.名称,Wr,{talent:e})})(e)},(0,x.toDisplayString)(e.名称),9,vi))),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('div',gi,'无'))])]),(0,x.createElementVNode)('div',fi,[a[4]||(a[4]=(0,x.createElementVNode)('strong',{class:'detail-key'},'技艺',-1)),o.value.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',hi,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(o.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:e.id,class:'skill-item',onClick:t=>(e=>{const t=ct.worldState?.数据库?.技艺?.[e.id];t&&Cn.show(e.name,Lr,{art:t})})(e)},[(0,x.createElementVNode)('div',ki,[(0,x.createElementVNode)('h3',null,(0,x.toDisplayString)(e.name),1),(0,x.createElementVNode)('div',Ei,'等级 '+(0,x.toDisplayString)(e.level)+' ('+(0,x.toDisplayString)(e.title)+')',1)])],8,yi))),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Ni,'无'))])]))}}),Vi=(0,me.A)(bi,[['__scopeId','data-v-4bffb608']]),Si={class:'progress-bar-container'},Bi={class:'label'},wi={class:'progress-track'},Ci={key:0,class:'center-tick'},Di={class:'value'},xi=(0,x.defineComponent)({__name:'ProgressBar',props:{label:{},value:{},max:{},min:{},color:{}},setup(e){const t=e,n=(0,x.computed)(()=>t.value),o=(0,x.computed)(()=>void 0!==t.min&&t.min<0),a=(0,x.computed)(()=>{const e=t.min||0,n=t.max||100,a=Math.max(e,Math.min(n,t.value));if(o.value){return a>0?{left:'50%',right:'auto',width:a/n*50+'%',backgroundColor:t.color}:{left:'auto',right:'50%',width:Math.abs(a)/Math.abs(e)*50+'%',backgroundColor:'#e53935'}}return{left:'0',right:'auto',width:`${n===e?0:(a-e)/(n-e)*100}%`,backgroundColor:t.color}});return(t,l)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Si,[(0,x.createElementVNode)('span',Bi,(0,x.toDisplayString)(e.label),1),(0,x.createElementVNode)('div',wi,[o.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',Ci)):(0,x.createCommentVNode)('v-if',!0),(0,x.createElementVNode)('div',{class:'progress-fill',style:(0,x.normalizeStyle)(a.value)},null,4)]),(0,x.createElementVNode)('span',Di,(0,x.toDisplayString)(n.value),1)]))}}),Ii=(0,me.A)(xi,[['__scopeId','data-v-780a870c']]),$i={class:'relations-display'},_i={class:'relation-list'},zi=['onClick'],Li={class:'relation-name'},Mi={class:'relation-tags'},Ai={key:0,class:'relation-details'},Oi={class:'group-title'},ji=(0,x.defineComponent)({__name:'RelationsDisplay',props:{subjectId:{}},setup(e){const t=[{title:'认知层',vectors:[{label:'可靠度',path:'认知层.可靠度',min:-100,max:100,color:'#3a8f9d'},{label:'能力评价',path:'认知层.能力评价',min:-100,max:100,color:'#3a8f9d'},{label:'威胁度',path:'认知层.威胁度',min:0,max:100,color:'#e53935'}]},{title:'情感层',vectors:[{label:'亲近感',path:'情感层.亲近感',min:-100,max:100,color:'#c74343'},{label:'仰慕度',path:'情感层.仰慕度',min:0,max:100,color:'#c74343'}]},{title:'利益层',vectors:[{label:'资源价值',path:'利益层.资源价值',min:0,max:100,color:'#d4af37'},{label:'合作潜力',path:'利益层.合作潜力',min:0,max:100,color:'#d4af37'},{label:'利益冲突',path:'利益层.利益冲突',min:0,max:100,color:'#e53935'}]}],n=e,o=(0,x.computed)(()=>n.subjectId&&ct.worldState?.因果之网&&ct.worldState.因果之网[n.subjectId]||{}),{getNpcNameById:a}=Bn,l=(0,x.ref)(null);function r(e){const t=(0,he.get)(e,'因果标签',{});return Object.values(t).filter(e=>'object'==typeof e&&null!==e&&e.标签).map(e=>e.标签)}return(e,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',$i,[(0,x.createElementVNode)('ul',_i,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(o.value,(e,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:n,class:'relation-item'},[(0,x.createElementVNode)('div',{class:'relation-header',onClick:e=>function(e){const t=String(e);l.value===t?l.value=null:l.value=t}(n)},[(0,x.createElementVNode)('span',Li,(0,x.toDisplayString)((0,x.unref)(a)(String(n))),1),(0,x.createElementVNode)('div',Mi,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(r(e),e=>((0,x.openBlock)(),(0,x.createElementBlock)('span',{key:e,class:'tag'},(0,x.toDisplayString)(e),1))),128))])],8,zi),l.value===n?((0,x.openBlock)(),(0,x.createElementBlock)('div',Ai,[((0,x.openBlock)(),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(t,t=>(0,x.createElementVNode)('div',{key:t.title,class:'vector-group'},[(0,x.createElementVNode)('strong',Oi,(0,x.toDisplayString)(t.title),1),((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(t.vectors,t=>((0,x.openBlock)(),(0,x.createBlock)(Ii,{key:t.label,label:t.label,value:(0,x.unref)(he.get)(e,t.path,0),min:t.min,max:t.max,color:t.color},null,8,['label','value','min','max','color']))),128))])),64))])):(0,x.createCommentVNode)('v-if',!0)]))),128))])]))}}),Ti=(0,me.A)(ji,[['__scopeId','data-v-763d7aea']]),Fi={class:'inventory-grid'},Ri={key:0,class:'grid-container'},Wi={class:'item-name'},Pi={key:0,class:'item-quantity'},Ui={key:1,class:'empty-inventory'},Hi=(0,x.defineComponent)({__name:'InventoryGrid',props:{items:{}},setup:e=>(t,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Fi,[e.items.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',Ri,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.items,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:t,class:'item-cell'},[(0,x.createElementVNode)('span',Wi,(0,x.toDisplayString)(e.名称),1),e.数量?((0,x.openBlock)(),(0,x.createElementBlock)('span',Pi,'x'+(0,x.toDisplayString)(e.数量),1)):(0,x.createCommentVNode)('v-if',!0)]))),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Ui,[...n[0]||(n[0]=[(0,x.createElementVNode)('p',null,'空无一物',-1)])]))]))}),Gi=(0,me.A)(Hi,[['__scopeId','data-v-289f38ac']]),Ji={class:'detail-tab-content grid-layout'},Yi={class:'detail-item full-width'},qi={class:'detail-item full-width'},Ki={class:'detail-item full-width'},Qi={key:0,class:'memory-list'},Xi={class:'memory-event'},Zi={class:'memory-influence'},ec={key:1,class:'placeholder'},tc=(0,x.defineComponent)({__name:'NpcCauseTab',props:{npc:{},npcId:{}},setup(e){const t=e,n=(0,x.computed)(()=>{const e=ct.worldState?.数据库;if(!t.npc||!e)return[];const n=(0,he.get)(t.npc,'背包',{}),o=[];for(const t in n){const a=n[t];if(a<=0)continue;let l=null;for(const n in e){const o=e[n];if(o&&o[t]){l=o[t];break}}l&&o.push({...l,ID:t,数量:a})}return o});return(t,o)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Ji,[(0,x.createElementVNode)('div',Yi,[o[0]||(o[0]=(0,x.createElementVNode)('strong',{class:'detail-key'},'持有物品',-1)),(0,x.createVNode)(Gi,{items:n.value},null,8,['items'])]),(0,x.createElementVNode)('div',qi,[o[1]||(o[1]=(0,x.createElementVNode)('strong',{class:'detail-key'},'人际关系',-1)),e.npcId?((0,x.openBlock)(),(0,x.createBlock)(Ti,{key:0,'subject-id':e.npcId},null,8,['subject-id'])):(0,x.createCommentVNode)('v-if',!0)]),(0,x.createElementVNode)('div',Ki,[o[4]||(o[4]=(0,x.createElementVNode)('strong',{class:'detail-key'},'短期记忆',-1)),Object.keys(e.npc.心流?.短期记忆||{}).length>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',Qi,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.npc.心流.短期记忆,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:t,class:'memory-item'},[(0,x.createElementVNode)('p',Xi,[o[2]||(o[2]=(0,x.createElementVNode)('strong',null,'事件:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.事件),1)]),(0,x.createElementVNode)('p',Zi,[o[3]||(o[3]=(0,x.createElementVNode)('strong',null,'影响:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.影响),1)])]))),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('div',ec,'无'))])]))}}),nc=(0,me.A)(tc,[['__scopeId','data-v-06bf308e']]),oc={class:'npc-detail-display'},ac={class:'tabs'},lc=['onClick'],rc={class:'tab-content'},ic={key:1,class:'placeholder'},cc=(0,x.defineComponent)({__name:'NpcDetailDisplay',props:{npc:{},npcId:{}},setup(e){const t=(0,x.ref)('archive'),n=[{id:'archive',name:'【档案】'},{id:'power',name:'【权能】'},{id:'cause',name:'【因果】'}];return(o,a)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',oc,[(0,x.createElementVNode)('div',ac,[((0,x.openBlock)(),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(n,e=>(0,x.createElementVNode)('button',{key:e.id,class:(0,x.normalizeClass)({active:t.value===e.id}),onClick:n=>t.value=e.id},(0,x.toDisplayString)(e.name),11,lc)),64))]),(0,x.createElementVNode)('div',rc,[e.npc?((0,x.openBlock)(),(0,x.createElementBlock)(x.Fragment,{key:0},['archive'===t.value?((0,x.openBlock)(),(0,x.createBlock)(wr,{key:0,npc:e.npc},null,8,['npc'])):(0,x.createCommentVNode)('v-if',!0),'power'===t.value?((0,x.openBlock)(),(0,x.createBlock)(Vi,{key:1,npc:e.npc},null,8,['npc'])):(0,x.createCommentVNode)('v-if',!0),'cause'===t.value?((0,x.openBlock)(),(0,x.createBlock)(nc,{key:2,npc:e.npc,'npc-id':e.npcId},null,8,['npc','npc-id'])):(0,x.createCommentVNode)('v-if',!0)],64)):((0,x.openBlock)(),(0,x.createElementBlock)('div',ic,[...a[0]||(a[0]=[(0,x.createElementVNode)('p',null,'暂无数据',-1)])]))])]))}}),sc=(0,me.A)(cc,[['__scopeId','data-v-7a2f4260']]),dc={class:'npc-directory-panel'},mc={class:'world-list-column'},uc=['onClick'],pc={class:'npc-list-column'},vc={key:0,class:'npc-list'},gc=['onClick'],fc={class:'npc-info'},hc={class:'npc-name'},yc={class:'npc-location'},kc={key:1,class:'placeholder'},Ec={class:'npc-detail-column'},Nc={key:0},bc={key:1,class:'placeholder'},Vc=(0,x.defineComponent)({__name:'NpcDirectoryPanel',setup(e){const t=(0,x.ref)([]),n=(0,x.ref)(null),o=(0,x.ref)(null),a=(0,x.ref)(null),l=(0,x.ref)(!1),r=(0,x.ref)(''),i=(0,x.ref)(''),c=(0,x.computed)(()=>r.value?t.value.filter(e=>e.name.includes(r.value)):t.value),s=(0,x.computed)(()=>{if(!n.value)return[];const e=Bn.getNpcsByWorld(n.value);return e.forEach(e=>{const t=e.当前位置;e.locationName=Bn.getLocationName(t)}),e}),d=(0,x.computed)(()=>i.value?s.value.filter(e=>e.姓名&&e.姓名.includes(i.value)):s.value);return(0,x.onMounted)(async()=>{t.value=await Bn.initializeWorldAndLocationData(),t.value.length>0&&!n.value&&(n.value=t.value[0].id)}),(0,x.watch)(n,()=>{o.value=null,a.value=null}),(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',dc,[(0,x.createElementVNode)('button',{class:'toggle-world-list',onClick:t[0]||(t[0]=e=>l.value=!l.value)},'世界'),(0,x.createCommentVNode)(' World List (Overlay) '),l.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:0,class:'world-list-overlay',onClick:t[2]||(t[2]=(0,x.withModifiers)(e=>l.value=!1,['self']))},[(0,x.createElementVNode)('div',mc,[t[4]||(t[4]=(0,x.createElementVNode)('h4',null,'世界列表',-1)),(0,x.withDirectives)((0,x.createElementVNode)('input',{type:'text','onUpdate:modelValue':t[1]||(t[1]=e=>r.value=e),placeholder:'搜索世界...',class:'search-input'},null,512),[[x.vModelText,r.value]]),(0,x.createElementVNode)('ul',null,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(c.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e.id,class:(0,x.normalizeClass)({active:n.value===e.id}),onClick:t=>{return o=e.id,n.value=o,void(l.value=!1);var o}},(0,x.toDisplayString)(e.name),11,uc))),128))])])])):(0,x.createCommentVNode)('v-if',!0),(0,x.createCommentVNode)(' NPC List '),(0,x.createElementVNode)('div',pc,[t[5]||(t[5]=(0,x.createElementVNode)('h4',null,'NPC列表',-1)),(0,x.withDirectives)((0,x.createElementVNode)('input',{type:'text','onUpdate:modelValue':t[3]||(t[3]=e=>i.value=e),placeholder:'搜索NPC...',class:'search-input'},null,512),[[x.vModelText,i.value]]),d.value.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('ul',vc,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(d.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e.姓名,class:(0,x.normalizeClass)({active:o.value===e}),onClick:t=>function(e){o.value=e,a.value=Bn.getNpcId(e)}(e)},[(0,x.createElementVNode)('div',fc,[(0,x.createElementVNode)('span',hc,(0,x.toDisplayString)(e.姓名),1),(0,x.createElementVNode)('span',yc,(0,x.toDisplayString)(e.locationName),1)]),e.姓名?((0,x.openBlock)(),(0,x.createBlock)(Xl,{key:0,'npc-id':e.姓名},null,8,['npc-id'])):(0,x.createCommentVNode)('v-if',!0)],10,gc))),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('div',kc,'该世界暂无NPC'))]),(0,x.createCommentVNode)(' NPC Details '),(0,x.createElementVNode)('div',Ec,[t[6]||(t[6]=(0,x.createElementVNode)('h4',null,'NPC详情',-1)),o.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',Nc,[(0,x.createVNode)(sc,{npc:o.value,'npc-id':a.value},null,8,['npc','npc-id'])])):((0,x.openBlock)(),(0,x.createElementBlock)('div',bc,'选择一个NPC以查看详情'))])]))}}),Sc=(0,me.A)(Vc,[['__scopeId','data-v-73769044']]),Bc=(0,x.reactive)({remainingSeconds:0,intervalId:null});function wc(){Bc.intervalId&&(clearInterval(Bc.intervalId),Bc.intervalId=null)}(0,x.watch)(kt,e=>{if('冷却中'===e.status){const t=function(e){if(!e)return 0;let t=0,n=0,o=0,a=e;if('string'==typeof a&&a.startsWith('[')&&a.endsWith(']'))try{a=JSON.parse(a.replace(/“|”/g,'"'))}catch(t){console.error('Failed to parse cooldown time string as JSON:',e,t),a=[]}if(Array.isArray(a)){const e=a.indexOf('天');e>0&&(t=Number(a[e-1])||0);const l=a.indexOf('小时');l>0&&(n=Number(a[l-1])||0);const r=a.indexOf('分钟');r>0&&(o=Number(a[r-1])||0)}else if('string'==typeof a){const e=a.match(/(\d+)天/),l=a.match(/(\d+)小时/),r=a.match(/(\d+)分/);t=e?parseInt(e[1],10):0,n=l?parseInt(l[1],10):0,o=r?parseInt(r[1],10):0}return 24*t*60*60+60*n*60+60*o}(e.time);(Bc.remainingSeconds<=0||Math.abs(Bc.remainingSeconds-t)>5)&&(Bc.remainingSeconds=t),Bc.intervalId||(Bc.intervalId&&clearInterval(Bc.intervalId),Bc.intervalId=window.setInterval(()=>{Bc.remainingSeconds>0?Bc.remainingSeconds--:wc()},1e3))}else Bc.remainingSeconds=0,wc()},{immediate:!0,deep:!0});const Cc={remainingTime:(0,x.computed)(()=>function(e){if(e<=0)return'冷却完毕';const t=Math.floor(e/86400);e-=24*t*60*60;const n=Math.floor(e/3600);return e-=60*n*60,`${t}天${n}小时${Math.floor(e/60)}分`}(Bc.remainingSeconds)),isCoolingDown:(0,x.computed)(()=>Bc.remainingSeconds>0&&'冷却中'===kt.value.status)},Dc={class:'log-panel-container'},xc={key:0,class:'timeline'},Ic=['onClick'],$c={class:'log-header'},_c={class:'log-title'},zc={class:'log-date'},Lc={class:'log-meta'},Mc={class:'log-description'},Ac={key:0,class:'log-details'},Oc={class:'detail-section'},jc={class:'detail-section'},Tc={class:'detail-section'},Fc={class:'detail-section automation-system'},Rc={key:0,class:'log-tags'},Wc={key:1,class:'empty-state'},Pc=(0,x.defineComponent)({__name:'LogPanel',setup(e){const t=(0,x.computed)(()=>[...ct.worldLog].sort((e,t)=>t.序号-e.序号)),n=(0,x.ref)(null);return(e,o)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Dc,[t.value.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('ul',xc,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(t.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e.序号,class:'timeline-item'},[o[6]||(o[6]=(0,x.createElementVNode)('div',{class:'timeline-marker'},null,-1)),(0,x.createElementVNode)('div',{class:'timeline-content',onClick:t=>{return o=e.序号,void(n.value===o?n.value=null:n.value=o);var o}},[(0,x.createElementVNode)('div',$c,[(0,x.createElementVNode)('span',_c,(0,x.toDisplayString)(e.标题),1),(0,x.createElementVNode)('span',zc,(0,x.toDisplayString)(e.日期),1)]),(0,x.createElementVNode)('div',Lc,[(0,x.createElementVNode)('span',null,[o[0]||(o[0]=(0,x.createElementVNode)('i',{class:'fas fa-map-marker-alt icon'},null,-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.地点),1)]),(0,x.createElementVNode)('span',null,[o[1]||(o[1]=(0,x.createElementVNode)('i',{class:'fas fa-users icon'},null,-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.人物),1)])]),(0,x.createElementVNode)('p',Mc,(0,x.toDisplayString)(e.描述),1),n.value===e.序号?((0,x.openBlock)(),(0,x.createElementBlock)('div',Ac,[(0,x.createElementVNode)('div',Oc,[o[2]||(o[2]=(0,x.createElementVNode)('strong',null,'重要信息:',-1)),(0,x.createElementVNode)('p',null,(0,x.toDisplayString)(e.重要信息),1)]),(0,x.createElementVNode)('div',jc,[o[3]||(o[3]=(0,x.createElementVNode)('strong',null,'人物关系:',-1)),(0,x.createElementVNode)('p',null,(0,x.toDisplayString)(e.人物关系),1)]),(0,x.createElementVNode)('div',Tc,[o[4]||(o[4]=(0,x.createElementVNode)('strong',null,'暗线与伏笔:',-1)),(0,x.createElementVNode)('p',null,(0,x.toDisplayString)(e.暗线与伏笔),1)]),(0,x.createElementVNode)('div',Fc,[o[5]||(o[5]=(0,x.createElementVNode)('strong',null,'自动化系统:',-1)),(0,x.createElementVNode)('pre',null,(0,x.toDisplayString)(e.自动化系统),1)]),e.标签&&e.标签.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',Rc,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.标签,e=>((0,x.openBlock)(),(0,x.createElementBlock)('span',{key:e,class:'tag'},(0,x.toDisplayString)(e),1))),128))])):(0,x.createCommentVNode)('v-if',!0)])):(0,x.createCommentVNode)('v-if',!0)],8,Ic)]))),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Wc,[...o[7]||(o[7]=[(0,x.createElementVNode)('p',null,'尚无历程记录。',-1)])]))]))}}),Uc=(0,me.A)(Pc,[['__scopeId','data-v-03bc3d58']]);function Hc(e){const t={},n=e.trim().split('\n');let o='';for(const e of n){const n=e.indexOf('|');if(-1!==n){const a=e.substring(0,n).trim(),l=e.substring(n+1).trim();t[a]=l,o=a}else o&&e.trim()&&(t[o]+='\n'+e)}for(const e in t)t[e]=t[e].trim();return t}const Gc=new class{ripples=(0,x.reactive)([]);async initialize(){await this.loadRipples()}async loadRipples(){try{const e=await Be.readFromLorebook('往世涟漪');if(!e||!e.trim())return void this.ripples.splice(0,this.ripples.length);const t=e.split('\n\n---\n\n'),n=[];for(const e of t){if(!e.trim())continue;const t=Hc(e),o=parseInt(t['第x世'],10);isNaN(o)||n.push({id:o,title:`第 ${o} 世`,rawContent:e,...t})}this.ripples.splice(0,this.ripples.length,...n.sort((e,t)=>e.id-t.id)),console.log(`[RipplesService] Loaded ${this.ripples.length} ripples.`)}catch(e){console.error('[RipplesService] Error loading ripples:',e),this.ripples.splice(0,this.ripples.length)}}getRippleById(e){return this.ripples.find(t=>t.id===e)}},Jc={class:'ripples-panel'},Yc={key:0,class:'ripples-list'},qc={key:0,class:'empty-state'},Kc={key:1},Qc=['onClick'],Xc={class:'ripple-title'},Zc={class:'ripple-summary'},es={key:1,class:'ripple-detail'},ts={class:'detail-content'},ns={class:'detail-key'},os={class:'detail-value'},as=(0,x.defineComponent)({__name:'RipplesPanel',setup(e){const t=(0,x.computed)(()=>Gc.ripples),n=(0,x.ref)(null);return(0,x.onMounted)(()=>{Gc.loadRipples()}),(e,o)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Jc,[n.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',es,[(0,x.createElementVNode)('button',{onClick:o[0]||(o[0]=e=>n.value=null),class:'back-button'},'< 返回列表'),(0,x.createElementVNode)('div',ts,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(n.value,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:t,class:'detail-item'},[(0,x.createElementVNode)('strong',ns,(0,x.toDisplayString)(t)+':',1),(0,x.createElementVNode)('pre',os,(0,x.toDisplayString)(e),1)]))),128))])])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Yc,[0===t.value.length?((0,x.openBlock)(),(0,x.createElementBlock)('div',qc,'暂无往世涟漪记录。')):((0,x.openBlock)(),(0,x.createElementBlock)('ul',Kc,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(t.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e.id,onClick:t=>(e=>{n.value=e})(e)},[(0,x.createElementVNode)('span',Xc,(0,x.toDisplayString)(e.title),1),(0,x.createElementVNode)('span',Zc,(0,x.toDisplayString)(e['本世概述']?.substring(0,50))+'...',1)],8,Qc))),128))]))]))]))}}),ls=(0,me.A)(as,[['__scopeId','data-v-c8ad07aa']]),rs={class:'avatar-selection'},is={key:0},cs=['onClick'],ss=(0,x.defineComponent)({__name:'AvatarSelection',setup(e){const t=(0,x.computed)(()=>ct.reincarnationAvatarOptions);return(e,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',rs,[0===t.value.length?((0,x.openBlock)(),(0,x.createElementBlock)('div',is,'等待AI生成化身...')):((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,{key:1},(0,x.renderList)(t.value,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:t,class:'avatar-card',onClick:t=>(e=>{jt.selectAvatarAndStart(e.姓名)})(e)},[(0,x.createElementVNode)('h4',null,(0,x.toDisplayString)(e.姓名),1),(0,x.createElementVNode)('p',null,[n[0]||(n[0]=(0,x.createElementVNode)('strong',null,'身份:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.身份),1)]),(0,x.createElementVNode)('p',null,[n[1]||(n[1]=(0,x.createElementVNode)('strong',null,'简介:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.简介),1)])],8,cs))),128))]))}}),ds=(0,me.A)(ss,[['__scopeId','data-v-375c1c96']]),ms=(0,x.reactive)({isVisible:!1,title:'',message:'',onConfirm:null,onCancel:null,hideCancel:!1}),us={get state(){return ms},show(e,t,n,o=!1){return new Promise(a=>{ms.title=e,ms.message=t,ms.onConfirm=()=>{n(),a(!0)},ms.onCancel=()=>{this.hide(),a(!1)},ms.hideCancel=o,ms.isVisible=!0})},hide(){ms.isVisible=!1,ms.title='',ms.message='',ms.onConfirm=null,ms.onCancel=null,ms.hideCancel=!1},confirm(){ms.onConfirm&&ms.onConfirm()},cancel(){ms.onCancel&&ms.onCancel()}},ps={class:'card-header'},vs={class:'choice-type'},gs={class:'card-body'},fs={class:'description'},hs={key:0,class:'data-details'},ys={class:'data-name'},ks={class:'data-description'},Es={class:'card-footer'},Ns={class:'cost'},bs=(0,x.defineComponent)({__name:'SettlementChoiceCard',props:{choice:{type:Object,required:!0},isSelected:{type:Boolean,default:!1}},emits:['select'],setup(e,{emit:t}){const n=e,o=t,a=()=>{o('select',n.choice)};return(t,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{class:(0,x.normalizeClass)(['settlement-choice-card',{'is-selected':e.isSelected}]),onClick:a},[(0,x.createElementVNode)('div',ps,[(0,x.createElementVNode)('span',vs,(0,x.toDisplayString)(e.choice.选项类型),1)]),(0,x.createElementVNode)('div',gs,[(0,x.createElementVNode)('p',fs,(0,x.toDisplayString)(e.choice.描述),1),e.choice.数据?((0,x.openBlock)(),(0,x.createElementBlock)('div',hs,[(0,x.createElementVNode)('strong',ys,(0,x.toDisplayString)(e.choice.数据.名称),1),(0,x.createElementVNode)('p',ks,(0,x.toDisplayString)(e.choice.数据.描述),1)])):(0,x.createCommentVNode)('v-if',!0)]),(0,x.createElementVNode)('div',Es,[(0,x.createElementVNode)('span',Ns,'消耗灵魂本源: '+(0,x.toDisplayString)(e.choice.消耗),1)])],2))}}),Vs=toastr,Ss={class:'settlement-view'},Bs={key:0,class:'choices-grid'},ws={key:1,class:'no-choices'},Cs={key:2,class:'actions-footer'},Ds=['disabled'],xs=(0,x.defineComponent)({__name:'SettlementView',setup(e){const t=(0,x.ref)(null),n=(0,x.computed)(()=>{const e=(0,he.get)(ct.worldState,'模拟器.结算.宿命抉择',{});return'object'==typeof e&&null!==e?Object.values(e).filter(e=>e&&e.选项类型&&e.描述&&!e.描述.includes('占位')):[]}),o=async()=>{if(!t.value)return;const e=t.value,n=(0,he.get)(ct.worldState,'角色',{}),o=Object.values(n).find(e=>e&&e.hasOwnProperty('灵魂本源'));if(!o)return Vs.error('无法确定玩家本体，操作失败。'),void console.error('Could not find the main character in the world state.');const a=(0,he.get)(o,'灵魂本源[0]',0);if(a<e.消耗)return void await us.show('灵魂本源不足',`固化此烙印需要 ${e.消耗} 灵魂本源，你当前只有 ${a}。`,()=>{},!0);if(await us.show('确认固化烙印?',`你确定要消耗 ${e.消耗} 灵魂本源来固化【${e.数据.名称}】吗？这可能会覆盖你现有的一个烙印。`,()=>{})){console.log('Confirmed choice:',e);const t=`<固化烙印 ${JSON.stringify(e.数据)}>`;pe.addCommand(t),us.hide(),Vs.success(`指令【固化烙印: ${e.数据.名称}】已添加到行动队列。`)}};return(e,a)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Ss,[n.value.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',Bs,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(n.value,(e,n)=>((0,x.openBlock)(),(0,x.createBlock)(bs,{key:n,choice:e,'is-selected':t.value===e,onSelect:a[0]||(a[0]=e=>t.value=e)},null,8,['choice','is-selected']))),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('div',ws,[...a[1]||(a[1]=[(0,x.createElementVNode)('p',null,'暂无宿命抉择。',-1),(0,x.createElementVNode)('p',null,'完成一世轮回后，此地将揭示你可继承的命运烙印。',-1)])])),n.value.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',Cs,[(0,x.createElementVNode)('button',{class:'confirm-button',onClick:o,disabled:!t.value},'固化烙印',8,Ds)])):(0,x.createCommentVNode)('v-if',!0)]))}}),Is=xs;class $s{scene;camera;renderer;controls;container;stars;skybox=null;starObjects=[];speedMultiplier=.2;constructor(e){console.log('[StarMapService] Constructor called.'),this.container=e,this.scene=new s,this.camera=new i(75,this.container.clientWidth/this.container.clientHeight,.1,1e3),this.renderer=new p({antialias:!0,alpha:!0}),this.stars=new a,this.init(),this.controls=new v(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.autoRotate=!0,this.controls.autoRotateSpeed=.1,this.controls.minDistance=5,this.controls.maxDistance=200,this.controls.enablePan=!0,this.controls.panSpeed=.5,this.animate()}init(){console.log('[StarMapService] Init started.'),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.container.appendChild(this.renderer.domElement),this.camera.position.z=50,this.scene.add(this.camera),this.scene.add(this.stars),window.addEventListener('resize',this.onWindowResize.bind(this)),this.createSkybox()}createSkybox(){const e=new d({vertexShader:'\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ',fragmentShader:'\n        varying vec2 vUv;\n        uniform float u_time;\n\n        float random(vec2 st) {\n          return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);\n        }\n\n        float noise(vec2 st) {\n          vec2 i = floor(st);\n          vec2 f = fract(st);\n          vec2 u = f * f * (3.0 - 2.0 * f);\n          return mix(mix(random(i + vec2(0.0, 0.0)), random(i + vec2(1.0, 0.0)), u.x),\n                     mix(random(i + vec2(0.0, 1.0)), random(i + vec2(1.0, 1.0)), u.x), u.y);\n        }\n\n        mat2 rotate(float a) {\n          float s = sin(a);\n          float c = cos(a);\n          return mat2(c, -s, s, c);\n        }\n\n        float fbm(vec2 st) {\n          float value = 0.0;\n          float amplitude = 0.5;\n          for (int i = 0; i < 6; i++) {\n            value += amplitude * noise(st);\n            st *= 2.0;\n            amplitude *= 0.5;\n          }\n          return value;\n        }\n\n        void main() {\n          vec2 st = vUv * 5.0;\n          st.x *= 1.5;\n          st *= rotate(u_time * 0.005);\n          \n          float f = fbm(st + u_time * 0.01);\n          f *= fbm(st * 0.5 + u_time * 0.005);\n\n          vec3 color1 = vec3(0.05, 0.0, 0.15);   // Deep Space Blue\n          vec3 color2 = vec3(0.2, 0.1, 0.5);    // Nebula Purple\n          vec3 color3 = vec3(0.8, 0.3, 0.3);    // Distant Star Red\n\n          float t = smoothstep(0.3, 0.6, f);\n          vec3 finalColor = mix(color1, color2, t);\n          finalColor = mix(finalColor, color3, smoothstep(0.5, 0.7, f));\n\n          gl_FragColor = vec4(finalColor, 1.0);\n        }\n      ',uniforms:{u_time:{value:0}},side:n}),t=new m(500,60,40);this.skybox=new l(t,e),this.scene.add(this.skybox)}getColorForEnergyLevel(e){return new o(e<=5?65535:e<=10?65280:e<=15?16776960:e<=20?16753920:8388736)}createStars(e,t){console.log(`[StarMapService] Updating stars with ${e.length} worlds.`);const n=new Set(this.starObjects.map(e=>e.userData.world.id)),a=new Set(e.map(e=>e.id));this.starObjects=this.starObjects.filter(e=>!!a.has(e.userData.world.id)||(this.stars.remove(e),!1)),e.forEach(e=>{n.has(e.id)||this.createSingleStar(e,t)}),this.starObjects.forEach(e=>{const n=e.userData.world,a=t.has(n.id),l=n.energyLevel||1,r=this.getColorForEnergyLevel(l),i=a?r:new o(4473924),c=e.children[0],s=e.children[1];c&&s&&(c.material.color.lerp(i,.1),s.material.color.lerp(i,.1))})}createSingleStar(e,n){const i=new m(.3,16,16),c=new m(.5,16,16),s=Math.acos(2*Math.random()-1),d=Math.sqrt(this.starObjects.length*Math.PI)*s,u=30*Math.cos(d)*Math.sin(s),p=30*Math.sin(d)*Math.sin(s),z=30*Math.cos(s),v=n.has(e.id),g=e.energyLevel||1,f=e.timeFlow||1,h=this.getColorForEnergyLevel(g),y=v?h:new o(4473924),k=new r({color:y}),E=new l(i,k),N=new r({color:y,transparent:!0,opacity:.4,blending:t}),b=new l(c,N);b.scale.set(1.5,1.5,1.5);const V=new a;V.add(E),V.add(b),V.position.set(u,p,z),V.userData={world:e},E.userData={world:e},b.userData={world:e},V.orbitSpeed=.015*Math.log1p(f),V.orbitRadius=Math.sqrt(u*u+z*z),V.orbitAngle=Math.atan2(z,u),this.stars.add(V),this.starObjects.push(V)}animate(){requestAnimationFrame(this.animate.bind(this)),this.skybox&&this.skybox.material instanceof d&&(this.skybox.material.uniforms.u_time.value+=.01),this.starObjects.forEach(e=>{e.orbitSpeed&&e.orbitRadius&&void 0!==e.orbitAngle&&(e.orbitAngle+=e.orbitSpeed*this.speedMultiplier,e.position.x=e.orbitRadius*Math.cos(e.orbitAngle),e.position.z=e.orbitRadius*Math.sin(e.orbitAngle))}),this.controls.update(),this.renderer.render(this.scene,this.camera)}onWindowResize(){this.camera.aspect=this.container.clientWidth/this.container.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight)}destroy(){window.removeEventListener('resize',this.onWindowResize.bind(this)),this.renderer.dispose(),this.container&&this.renderer.domElement&&this.container.removeChild(this.renderer.domElement)}pickStar(e){const t=new c,n=new u,o=this.renderer.domElement.getBoundingClientRect();n.x=(e.clientX-o.left)/o.width*2-1,n.y=-(e.clientY-o.top)/o.height*2+1,t.setFromCamera(n,this.camera);const a=t.intersectObjects(this.stars.children);return a.length>0?a[0].object.userData.world:null}setSpeedMultiplier(e){this.speedMultiplier=Math.max(0,e)}getSpeedMultiplier(){return this.speedMultiplier}}const _s={class:'world-selection-container'},zs={key:0,class:'loading-state'},Ls={class:'progress-bar-container'},Ms={class:'detail-item'},As={class:'detail-item'},Os={class:'world-description'},js={class:'panel-footer'},Ts=['disabled'],Fs={key:1,class:'unselectable-notice'},Rs={class:'map-controls'},Ws={class:'speed-controls-overlay'},Ps={class:'speed-bar-container'},Us={key:2,class:'evolving-overlay'},Hs=(0,x.defineComponent)({__name:'WorldSelection',setup(e){const t=(0,x.ref)(null);let n=null;const o=(0,x.ref)(!0),a=(0,x.ref)(null),l=(0,x.ref)(new Set),r=(0,x.ref)(0);let i=null;const c=[0,.2,.5,1,2],s=(0,x.ref)(2),d=(0,x.computed)(()=>ct.reincarnationWorldOptions.map(e=>{const t=e.content||'',n=t.match(/世界能级:\s*(\d+)/),o=t.match(/时间流速:\s*([\d.]+)x/),a=t.match(/描述:\s*([^\n]+)/);return{id:e.uid,name:(e.name||e.comment).replace(/【.*?】/g,'').trim(),energyLevel:n?parseInt(n[1],10):1,timeFlow:o?parseFloat(o[1]):1,description:a?a[1]:'一片混沌，无法窥其貌。',raw:e}})),m=(0,x.computed)(()=>kt.value),u=(0,x.computed)(()=>!yt.value&&'冷却中'!==m.value.status),p=()=>{if(yt.value)return void(l.value=new Set);const e=d.value;if(0===e.length)return;const t=e.map(e=>e.id);if(e.length<=3)l.value=new Set(t);else{const e=[...t].sort(()=>.5-Math.random());l.value=new Set(e.slice(0,3))}},v=e=>{if(!n)return;const t=n.pickStar(e);a.value=t||null};(0,x.watch)(t,e=>{e&&!n&&(console.log('[WorldSelection] starmapContainer is now available. Initializing StarMapService.'),n=new $s(e),d.value.length>0&&(console.log('[WorldSelection] Worlds already present, calling createStars from container watch.'),n.createStars(d.value,l.value)))}),(0,x.onMounted)(async()=>{console.log('[WorldSelection] Component Mounted.'),await jt.fetchReincarnationWorlds(),p(),n&&n.createStars(d.value,l.value),o.value=!1}),(0,x.onUnmounted)(()=>{n?.destroy()}),(0,x.watch)(d,e=>{console.log(`[WorldSelection] Parsed worlds watcher triggered: ${e.length} worlds.`),e.length>0&&(p(),n&&(console.log('[WorldSelection] Service exists, calling createStars from worlds watch.'),n.createStars(e,l.value)))},{deep:!0}),(0,x.watch)(yt,(e,t)=>{t&&!e&&(console.log('[WorldSelection] Simulation has ended. Re-selecting random worlds.'),p())});const g=e=>{const t=s.value+e;t>=0&&t<c.length&&(s.value=t,n&&n.setSpeedMultiplier(c[s.value]))};return(0,x.watch)(s,e=>{n&&n.setSpeedMultiplier(c[e])},{immediate:!0}),(e,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',_s,[o.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',zs,[(0,x.createElementVNode)('div',Ls,[(0,x.createElementVNode)('div',{class:'progress-bar',style:(0,x.normalizeStyle)({width:r.value+'%'})},null,4)]),(0,x.createElementVNode)('span',null,'天机重演中... '+(0,x.toDisplayString)(r.value)+'%',1)])):(0,x.createCommentVNode)('v-if',!0),o.value?(0,x.createCommentVNode)('v-if',!0):((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:1,ref_key:'starmapContainer',ref:t,class:'star-map-canvas',onClick:v},null,512)),(0,x.createElementVNode)('div',{class:(0,x.normalizeClass)(['world-detail-panel',{visible:!!a.value}])},[a.value?((0,x.openBlock)(),(0,x.createElementBlock)(x.Fragment,{key:0},[(0,x.createElementVNode)('h4',null,(0,x.toDisplayString)(a.value.name),1),(0,x.createElementVNode)('div',Ms,[(0,x.createElementVNode)('p',null,[n[4]||(n[4]=(0,x.createElementVNode)('strong',null,'能级:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(a.value.energyLevel),1)])]),(0,x.createElementVNode)('div',As,[(0,x.createElementVNode)('p',null,[n[5]||(n[5]=(0,x.createElementVNode)('strong',null,'时间流速:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(a.value.timeFlow)+'x',1)])]),(0,x.createElementVNode)('div',Os,[(0,x.createElementVNode)('p',null,(0,x.toDisplayString)(a.value.description),1)]),(0,x.createElementVNode)('div',js,[u.value?((0,x.openBlock)(),(0,x.createElementBlock)('button',{key:0,onClick:n[0]||(n[0]=e=>{return t=a.value.raw,void(yt.value||(jt.triggerIdentityWorkflow(t),a.value=null));var t}),disabled:!u.value},' 踏入此界 ',8,Ts)):((0,x.openBlock)(),(0,x.createElementBlock)('p',Fs,'缘分未至，无法进入'))])],64)):(0,x.createCommentVNode)('v-if',!0)],2),(0,x.createElementVNode)('div',Rs,[(0,x.createElementVNode)('button',{onClick:n[1]||(n[1]=e=>(o.value=!0,a.value=null,r.value=0,i&&clearInterval(i),i=window.setInterval(()=>{r.value<99?r.value++:i&&clearInterval(i)},960),jt.resetReincarnationSelection(),void jt.triggerCreationWorkflow())),class:'rescan-btn'},'重演天机')]),(0,x.createElementVNode)('div',Ws,[(0,x.createElementVNode)('button',{onClick:n[2]||(n[2]=e=>g(1)),title:'加速',class:'control-btn'},'+'),(0,x.createElementVNode)('div',Ps,[n[6]||(n[6]=(0,x.createElementVNode)('div',{class:'speed-bar-track'},null,-1)),(0,x.createElementVNode)('div',{class:'speed-bar-fill',style:(0,x.normalizeStyle)({height:25*s.value+'%'})},null,4)]),(0,x.createElementVNode)('button',{onClick:n[3]||(n[3]=e=>g(-1)),title:'减速',class:'control-btn'},'-')]),(0,x.unref)(yt)?((0,x.openBlock)(),(0,x.createElementBlock)('div',Us,[...n[7]||(n[7]=[(0,x.createElementVNode)('p',null,'世界演化中，请稍候...',-1),(0,x.createElementVNode)('div',{class:'spinner'},null,-1)])])):(0,x.createCommentVNode)('v-if',!0)]))}}),Gs=(0,me.A)(Hs,[['__scopeId','data-v-189e8ce4']]),Js={key:0,class:'settlement-overlay'},Ys={class:'settlement-panel'},qs={class:'settlement-header'},Ks={class:'settlement-content'},Qs={class:'content-grid'},Xs={class:'grid-item full-width'},Zs={class:'grid-item'},ed={class:'grid-item'},td={class:'grid-item'},nd={class:'grid-item'},od={class:'grid-item full-width'},ad={class:'cause-of-death'},ld={class:'grid-item full-width'},rd={class:'grid-item full-width'},id={class:'evaluation'},cd=(0,x.defineComponent)({__name:'SettlementPanel',setup(e){function t(){jt.clearSettlementData()}return(e,n)=>(0,x.unref)(Dt)?((0,x.openBlock)(),(0,x.createElementBlock)('div',Js,[(0,x.createElementVNode)('div',Ys,[(0,x.createElementVNode)('div',qs,[(0,x.createElementVNode)('h2',null,'第 '+(0,x.toDisplayString)((0,x.unref)(Dt).第x世)+' 世 - 往世涟漪',1)]),(0,x.createElementVNode)('div',Ks,[(0,x.createElementVNode)('div',Qs,[(0,x.createElementVNode)('div',Xs,[n[0]||(n[0]=(0,x.createElementVNode)('h3',null,'本世概述',-1)),(0,x.createElementVNode)('p',null,(0,x.toDisplayString)((0,x.unref)(Dt).本世概述),1)]),(0,x.createElementVNode)('div',Zs,[n[1]||(n[1]=(0,x.createElementVNode)('h3',null,'事件脉络',-1)),(0,x.createElementVNode)('p',null,(0,x.toDisplayString)((0,x.unref)(Dt).事件脉络),1)]),(0,x.createElementVNode)('div',ed,[n[2]||(n[2]=(0,x.createElementVNode)('h3',null,'本世成就',-1)),(0,x.createElementVNode)('p',null,(0,x.toDisplayString)((0,x.unref)(Dt).本世成就),1)]),(0,x.createElementVNode)('div',td,[n[3]||(n[3]=(0,x.createElementVNode)('h3',null,'本世遗珍',-1)),(0,x.createElementVNode)('p',null,(0,x.toDisplayString)((0,x.unref)(Dt).本世遗珍),1)]),(0,x.createElementVNode)('div',nd,[n[4]||(n[4]=(0,x.createElementVNode)('h3',null,'红尘羁绊',-1)),(0,x.createElementVNode)('p',null,(0,x.toDisplayString)((0,x.unref)(Dt).红尘羁绊),1)]),(0,x.createElementVNode)('div',od,[n[5]||(n[5]=(0,x.createElementVNode)('h3',null,'陨落之因',-1)),(0,x.createElementVNode)('p',ad,(0,x.toDisplayString)((0,x.unref)(Dt).陨落之因),1)]),(0,x.createElementVNode)('div',ld,[n[6]||(n[6]=(0,x.createElementVNode)('h3',null,'真我一念',-1)),(0,x.createElementVNode)('p',null,(0,x.toDisplayString)((0,x.unref)(Dt).真我一念),1)]),(0,x.createElementVNode)('div',rd,[n[7]||(n[7]=(0,x.createElementVNode)('h3',null,'涟漪余波',-1)),(0,x.createElementVNode)('p',id,(0,x.toDisplayString)((0,x.unref)(Dt).涟漪余波),1)])])]),(0,x.createElementVNode)('div',{class:'settlement-footer'},[(0,x.createElementVNode)('button',{onClick:t},'尘埃落定')])])])):(0,x.createCommentVNode)('v-if',!0)}}),sd=(0,me.A)(cd,[['__scopeId','data-v-fd6b92fa']]),dd={class:'reincarnation-panel'},md={class:'tabs'},ud=['disabled'],pd={class:'tab-content'},vd=(0,x.defineComponent)({__name:'ReincarnationPanel',setup(e){const t=(0,x.ref)('worldSelection'),n=(0,x.computed)(()=>Object.keys(ct.reincarnationAvatarOptions||{}).length>0),o=(0,x.computed)(()=>!0===ct.worldState?.模拟器?.结算?.待处理);return(0,x.watch)(o,e=>{e&&(t.value='settlementView')},{immediate:!0}),(e,a)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',dd,[(0,x.createElementVNode)('div',md,[(0,x.createElementVNode)('button',{class:(0,x.normalizeClass)({active:'worldSelection'===t.value}),onClick:a[0]||(a[0]=e=>t.value='worldSelection')},[a[6]||(a[6]=(0,x.createTextVNode)(' 待选择世界 ',-1)),(0,x.createElementVNode)('span',{style:(0,x.normalizeStyle)({color:(0,x.unref)(Cc).isCoolingDown.value?'#ffb74d':(0,x.unref)(yt)?'#e57373':'#81c784'})},(0,x.toDisplayString)((0,x.unref)(Cc).isCoolingDown.value?`（冷却中: ${(0,x.unref)(Cc).remainingTime.value}）`:(0,x.unref)(yt)?'（轮回中）':'（轮回待命）'),5)],2),(0,x.createElementVNode)('button',{class:(0,x.normalizeClass)({active:'avatarSelection'===t.value}),onClick:a[1]||(a[1]=e=>t.value='avatarSelection'),disabled:!n.value},' 可选化身 ',10,ud),(0,x.createElementVNode)('button',{class:(0,x.normalizeClass)({active:'settlementView'===t.value}),onClick:a[2]||(a[2]=e=>t.value='settlementView')},' 宿命抉择 ',2),(0,x.createElementVNode)('button',{class:(0,x.normalizeClass)({active:'log'===t.value}),onClick:a[3]||(a[3]=e=>t.value='log')},'本世历程',2),(0,x.createElementVNode)('button',{class:(0,x.normalizeClass)({active:'ripples'===t.value}),onClick:a[4]||(a[4]=e=>t.value='ripples')},'往世涟漪',2),o.value?((0,x.openBlock)(),(0,x.createElementBlock)('button',{key:0,class:(0,x.normalizeClass)({active:'settlement'===t.value}),onClick:a[5]||(a[5]=e=>t.value='settlement')},' 轮回结算 ',2)):(0,x.createCommentVNode)('v-if',!0)]),(0,x.createElementVNode)('div',pd,['worldSelection'===t.value?((0,x.openBlock)(),(0,x.createBlock)(Gs,{key:0})):(0,x.createCommentVNode)('v-if',!0),'avatarSelection'===t.value?((0,x.openBlock)(),(0,x.createBlock)(ds,{key:1})):(0,x.createCommentVNode)('v-if',!0),'settlementView'===t.value?((0,x.openBlock)(),(0,x.createBlock)(Is,{key:2})):(0,x.createCommentVNode)('v-if',!0),'log'===t.value?((0,x.openBlock)(),(0,x.createBlock)(Uc,{key:3})):(0,x.createCommentVNode)('v-if',!0),'ripples'===t.value?((0,x.openBlock)(),(0,x.createBlock)(ls,{key:4})):(0,x.createCommentVNode)('v-if',!0),'settlement'===t.value?((0,x.openBlock)(),(0,x.createBlock)(sd,{key:5})):(0,x.createCommentVNode)('v-if',!0)])]))}}),gd=(0,me.A)(vd,[['__scopeId','data-v-e142f334']]),fd={class:'ripple-detail-panel'},hd={key:0,class:'ripple-content'},yd={class:'detail-key'},kd={class:'detail-value'},Ed={key:1,class:'loading-message'},Nd=(0,x.defineComponent)({__name:'RippleDetailPanel',props:{rippleId:{}},setup(e){const t=e,{rippleId:n}=(0,x.toRefs)(t),o=(0,x.ref)(void 0);return(0,x.onMounted)(()=>{o.value=Gc.getRippleById(n.value)}),(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',fd,[o.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',hd,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(o.value,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:t,class:'detail-item'},[(0,x.createElementVNode)('strong',yd,(0,x.toDisplayString)(t)+':',1),(0,x.createElementVNode)('span',kd,(0,x.toDisplayString)(e),1)]))),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Ed,'正在加载往世涟漪数据...'))]))}}),bd=(0,me.A)(Nd,[['__scopeId','data-v-4e32e506']]),Vd={class:'skills-panel'},Sd={key:0,class:'empty-state'},Bd={key:1,class:'skills-list'},wd={class:'skill-header'},Cd={class:'skill-level'},Dd={class:'skill-description'},xd={class:'skill-progress'},Id={class:'progress-bar-wrapper'},$d=['value','max'],_d={class:'progress-text'},zd={key:0,class:'associated-skills'},Ld=['onClick'],Md={key:0,class:'associated-skills-list'},Ad={class:'skill-name'},Od={class:'skill-detail skill-description-detail'},jd={class:'skill-detail'},Td={class:'skill-detail'},Fd=(0,x.defineComponent)({__name:'SkillsPanel',setup(e){const t=(0,x.computed)(()=>pt.value),n=(0,x.ref)({}),o=e=>!!n.value[e];return(e,a)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Vd,[a[4]||(a[4]=(0,x.createElementVNode)('h2',null,'技艺',-1)),0===t.value.length?((0,x.openBlock)(),(0,x.createElementBlock)('div',Sd,[...a[0]||(a[0]=[(0,x.createElementVNode)('p',null,'尚未掌握任何技艺。',-1)])])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Bd,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(t.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:e.id,class:'skill-item'},[(0,x.createElementVNode)('div',wd,[(0,x.createElementVNode)('h3',null,(0,x.toDisplayString)(e.name),1),(0,x.createElementVNode)('div',Cd,'等级 '+(0,x.toDisplayString)(e.level),1)]),(0,x.createElementVNode)('p',Dd,(0,x.toDisplayString)(e.description),1),(0,x.createElementVNode)('div',xd,[(0,x.createElementVNode)('div',Id,[(0,x.createElementVNode)('progress',{value:e.exp,max:'MAX'===e.expToNextLevel?e.exp:e.expToNextLevel},null,8,$d),(0,x.createElementVNode)('span',_d,(0,x.toDisplayString)(e.exp)+' / '+(0,x.toDisplayString)(e.expToNextLevel),1)])]),e.associatedSkills&&e.associatedSkills.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',zd,[(0,x.createElementVNode)('button',{onClick:t=>{return o=e.id,void(n.value[o]=!n.value[o]);var o},class:'associated-skills-title'},[a[1]||(a[1]=(0,x.createTextVNode)(' 相关技能 ',-1)),(0,x.createElementVNode)('span',{class:(0,x.normalizeClass)(['arrow',{expanded:o(e.id)}])},null,2)],8,Ld),o(e.id)?((0,x.openBlock)(),(0,x.createElementBlock)('ul',Md,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.associatedSkills,e=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e.ID,class:'associated-skill-item'},[(0,x.createElementVNode)('div',Ad,[(0,x.createElementVNode)('strong',null,(0,x.toDisplayString)(e.名称),1),(0,x.createTextVNode)(' ('+(0,x.toDisplayString)(e.类型)+') ',1)]),(0,x.createElementVNode)('div',Od,(0,x.toDisplayString)(e.描述),1),(0,x.createElementVNode)('div',jd,[a[2]||(a[2]=(0,x.createElementVNode)('strong',null,'基础效果:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.基础效果),1)]),(0,x.createElementVNode)('div',Td,[a[3]||(a[3]=(0,x.createElementVNode)('strong',null,'成长:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.效果等级公式),1)])]))),128))])):(0,x.createCommentVNode)('v-if',!0)])):(0,x.createCommentVNode)('v-if',!0)]))),128))]))]))}}),Rd=(0,me.A)(Fd,[['__scopeId','data-v-385af6cc']]),Wd={class:'panel-wrapper memory-panel-container'},Pd={class:'panel-content'},Ud={class:'section'},Hd={class:'setting-item'},Gd={class:'section'},Jd={class:'setting-item'},Yd={class:'setting-item'},qd={class:'setting-item'},Kd={class:'section'},Qd={class:'tabs'},Xd={class:'memory-content'},Zd=['value'],em=(0,x.defineComponent)({__name:'MemoryPanel',setup(e){const t=(0,x.ref)(!0),n=(0,x.ref)({instantMemoryCount:3,shortTermMemoryCount:25,longTermMemoryCount:200}),o=(0,x.ref)('instant'),a=(0,x.ref)({instant:'加载中...',short:'加载中...',long:'加载中...'}),l=(0,x.computed)(()=>a.value[o.value]);async function r(e=!1){try{const[t,n,o]=await Promise.all([Be.readFromLorebook('[系统]瞬时记忆',e),Be.readFromLorebook('[系统]短期记忆',e),Be.readFromLorebook('[系统]长期记忆',e)]);a.value.instant=t||'暂无内容',a.value.short=n||'暂无内容',a.value.long=o||'暂无内容'}catch(e){console.error('[MemoryPanel] Failed to fetch memory content:',e),Vs.error('无法加载记忆内容')}}function i(){we.setConfig(n.value),Vs.success('记忆系统配置已应用')}async function c(){Vs.info('正在手动更新所有记忆层级...'),console.log('[MemoryPanel] Forcing update with worldLog:',JSON.stringify(ct.worldLog,null,2)),await we.updateMemory(ct.worldLog),await r(!0),Vs.success('记忆层级更新完毕')}return(0,x.onMounted)(()=>{n.value=we.getConfig(),r()}),(e,a)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Wd,[(0,x.createElementVNode)('div',Pd,[a[14]||(a[14]=(0,x.createElementVNode)('h3',{class:'panel-title'},'世界记忆系统',-1)),(0,x.createCommentVNode)(' Automation Control '),(0,x.createElementVNode)('div',Ud,[(0,x.createElementVNode)('div',Hd,[a[7]||(a[7]=(0,x.createElementVNode)('label',{for:'auto-memory-switch'},'启用自动记忆系统',-1)),(0,x.withDirectives)((0,x.createElementVNode)('input',{type:'checkbox',id:'auto-memory-switch','onUpdate:modelValue':a[0]||(a[0]=e=>t.value=e)},null,512),[[x.vModelCheckbox,t.value]])]),a[8]||(a[8]=(0,x.createElementVNode)('p',{class:'description'},'启用后，系统将在每次AI交互后自动更新所有记忆层级。',-1))]),(0,x.createCommentVNode)(' Configuration '),(0,x.createElementVNode)('div',Gd,[a[12]||(a[12]=(0,x.createElementVNode)('h4',null,'参数配置',-1)),(0,x.createElementVNode)('div',Jd,[a[9]||(a[9]=(0,x.createElementVNode)('label',{for:'instant-memory-count'},'瞬时记忆数量',-1)),(0,x.withDirectives)((0,x.createElementVNode)('input',{type:'number',id:'instant-memory-count','onUpdate:modelValue':a[1]||(a[1]=e=>n.value.instantMemoryCount=e)},null,512),[[x.vModelText,n.value.instantMemoryCount,void 0,{number:!0}]])]),(0,x.createElementVNode)('div',Yd,[a[10]||(a[10]=(0,x.createElementVNode)('label',{for:'short-term-count'},'短期记忆数量',-1)),(0,x.withDirectives)((0,x.createElementVNode)('input',{type:'number',id:'short-term-count','onUpdate:modelValue':a[2]||(a[2]=e=>n.value.shortTermMemoryCount=e)},null,512),[[x.vModelText,n.value.shortTermMemoryCount,void 0,{number:!0}]])]),(0,x.createElementVNode)('div',qd,[a[11]||(a[11]=(0,x.createElementVNode)('label',{for:'long-term-count'},'长期记忆数量',-1)),(0,x.withDirectives)((0,x.createElementVNode)('input',{type:'number',id:'long-term-count','onUpdate:modelValue':a[3]||(a[3]=e=>n.value.longTermMemoryCount=e)},null,512),[[x.vModelText,n.value.longTermMemoryCount,void 0,{number:!0}]])]),(0,x.createElementVNode)('button',{onClick:i},'应用配置'),(0,x.createElementVNode)('button',{onClick:c},'立即更新所有记忆')]),(0,x.createCommentVNode)(' Memory Review '),(0,x.createElementVNode)('div',Kd,[a[13]||(a[13]=(0,x.createElementVNode)('h4',null,'记忆审查',-1)),(0,x.createElementVNode)('div',Qd,[(0,x.createElementVNode)('button',{class:(0,x.normalizeClass)({active:'instant'===o.value}),onClick:a[4]||(a[4]=e=>o.value='instant')},'瞬时记忆',2),(0,x.createElementVNode)('button',{class:(0,x.normalizeClass)({active:'short'===o.value}),onClick:a[5]||(a[5]=e=>o.value='short')},'短期记忆',2),(0,x.createElementVNode)('button',{class:(0,x.normalizeClass)({active:'long'===o.value}),onClick:a[6]||(a[6]=e=>o.value='long')},'长期记忆',2)]),(0,x.createElementVNode)('div',Xd,[(0,x.createElementVNode)('textarea',{readonly:'',value:l.value},null,8,Zd)])])])]))}}),tm=(0,me.A)(em,[['__scopeId','data-v-5351f233']]),nm={class:'save-load-panel'},om={class:'panel-header'},am={class:'header-actions'},lm={class:'save-slots-container'},rm={class:'slot-group'},im={class:'slot-info'},cm={class:'slot-name'},sm={class:'slot-timestamp'},dm={key:0,class:'slot-world-log'},mm={class:'log-date'},um={class:'log-title'},pm={class:'slot-actions'},vm=['onClick'],gm=['onClick','disabled'],fm=['onClick','disabled'],hm={class:'slot-group'},ym={class:'slot-info'},km={class:'slot-name'},Em={class:'slot-timestamp'},Nm={key:0,class:'slot-world-log'},bm={class:'log-date'},Vm={class:'log-title'},Sm={class:'slot-actions'},Bm=['onClick','disabled'],wm={class:'auto-save-toggle'};const Cm={},Dm={register(e,t){Cm[e]=t},get(e){const t=Cm[e];if(!t)throw new Error(`Service with key "${e}" has not been registered.`);return t}},xm='轮回-诸天万界',Im='存档-',$m=['自动-A','自动-B'],_m='自动-重来',zm=['主世界','化身世界','主世界摘要','化身世界摘要','[系统]长期记忆','[系统]短期记忆','[系统]瞬时记忆','本世历程','往世涟漪'];const Lm=new class{manualSlots=[];autoSlots=[];rerollSlot=null;turnCounter=0;isAutoSaveEnabled=!0;autoSaveInterval;areSlotsLoaded=!1;constructor(){this.initializeSlots(),this.loadAutoSaveState(),this.loadTurnCounter()}async ensureSlotsLoaded(){this.areSlotsLoaded||(await this.loadAllSaveSlots(),this.areSlotsLoaded=!0)}initializeSlots(){for(let e=1;e<=5;e++)this.manualSlots.push({id:`手动-${e}`,name:`手动存档 ${e}`,timestamp:null,data:null});for(const e of $m)this.autoSlots.push({id:e,name:`自动存档 ${e.split('-')[1]}`,timestamp:null,data:null});this.rerollSlot={id:_m,name:'重来存档',timestamp:null,data:null}}async loadAllSaveSlots(){try{const e=await TavernHelper.getLorebookEntries(xm);if(!e)return;const t=t=>{const n=e.find(e=>e.comment===`${Im}${t.id}`);if(n&&n.content)try{t.data=JSON.parse(n.content),t.timestamp=t.data.timestamp,t.worldLogDate=t.data.worldLogDate,t.worldLogTitle=t.data.worldLogTitle,t.entryUid=n.uid}catch(e){console.error(`解析存档 ${t.id} 失败:`,e),t.timestamp='数据损坏',t.data=null}else t.timestamp=null,t.data=null,t.entryUid=void 0};this.manualSlots.forEach(t),this.autoSlots.forEach(t),this.rerollSlot&&t(this.rerollSlot)}catch(e){console.error('加载存档槽位时出错:',e),Vs.error('加载存档列表失败。')}}async saveGame(e,t=!1){await this.ensureSlotsLoaded(),t||Vs.info(`正在保存到槽位 [${e}]...`);try{const n=await TavernHelper.getChatMessages('0');if(!n||0===n.length)throw new Error('无法获取当前聊天状态，无法保存。');const o=n[0],a=(new Date).toISOString(),l={};for(const e of zm){const t=await Be.readFromLorebook(e);l[e]=t??''}const r=Dm.get('store'),i=r.worldLog.length>0?r.worldLog[r.worldLog.length-1]:null,c={timestamp:a,mvu_data:o.data,message_content:o.message,lorebook_backup:l,worldLogDate:i?.日期,worldLogTitle:i?.标题},s=`${Im}${e}`,d=(await TavernHelper.getLorebookEntries(xm)).find(e=>e.comment===s);d?await TavernHelper.setLorebookEntries(xm,[{uid:d.uid,content:JSON.stringify(c,null,2)}]):await TavernHelper.createLorebookEntries(xm,[{comment:s,content:JSON.stringify(c,null,2),keys:[s],position:'after_character_definition',order:200}]),await this.loadAllSaveSlots(),t?console.log(`[AutoSave] 成功自动存档至 ${e}`):Vs.success(`游戏已成功保存至 [${e}]！`)}catch(n){const o=`保存失败: ${n instanceof Error?n.message:String(n)}`;console.error(`保存游戏到槽位 ${e} 时出错:`,n),t||Vs.error(o)}}async _internalLoadGame(e){if(!e.data||!e.data.mvu_data)throw new Error('无法读取空存档或损坏的存档。');if(e.data.lorebook_backup)for(const t in e.data.lorebook_backup)await Be.writeToLorebook(t,e.data.lorebook_backup[t]);const t=(await TavernHelper.getChatMessages('0'))[0]||{};t.data=e.data.mvu_data,t.message=e.data.message_content,await TavernHelper.setChatMessages([t],{refresh:'all'})}async loadGame(e){if(confirm(`确定要读取存档 [${e.name}] 吗？当前所有未保存的进度将会被覆盖。`)){Vs.info(`正在从 [${e.name}] 读取存档...`);try{await this._internalLoadGame(e),Vs.success(`已成功从 [${e.name}] 读取存档！游戏即将刷新...`)}catch(t){const n=`读档失败: ${t instanceof Error?t.message:String(t)}`;console.error(`读取游戏存档 ${e.name} 时出错:`,t),Vs.error(n)}}}async deleteSave(e){if(e.entryUid){if(confirm(`你确定要永久删除存档 [${e.name}] 吗？\n此操作不可撤销。`)){Vs.info(`正在删除存档 [${e.name}]...`);try{await TavernHelper.deleteLorebookEntries(xm,[e.entryUid]),await this.loadAllSaveSlots(),Vs.success(`存档 [${e.name}] 已被删除。`)}catch(t){console.error(`删除存档 ${e.name} 时出错:`,t),Vs.error(`删除失败: ${t instanceof Error?t.message:String(t)}`)}}}else Vs.warning('这是一个空槽位，无需删除。')}async performAutoSave(){if(!this.isAutoSaveEnabled)return;this.turnCounter++,localStorage.setItem('tianhua_turn_counter',this.turnCounter.toString());const e=this.turnCounter%2==1?$m[0]:$m[1];await this.saveGame(e,!0)}async saveStateForReroll(){console.log('[Reroll] Saving state for potential reroll...'),await this.saveGame(_m,!0)}async loadRerollState(){if(await this.ensureSlotsLoaded(),!this.rerollSlot||!this.rerollSlot.data)throw Vs.error('没有可用于“重来”的存档点。'),new Error('No reroll save state found.');console.log('[Reroll] Loading state for reroll...'),await this._internalLoadGame(this.rerollSlot),setTimeout(()=>window.location.reload(),500)}exportSave(e){if(!e.data)return void Vs.warning('无法导出空存档。');const t=JSON.stringify(e.data,null,2),n=new Blob([t],{type:'application/json'}),o=URL.createObjectURL(n),a=document.createElement('a');a.href=o,a.download=`[轮回模拟器]存档-${e.name}-${(new Date).toISOString()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o),Vs.success(`存档 [${e.name}] 已导出。`)}async importSave(e){try{const t=JSON.parse(e);if(!t.timestamp||!t.mvu_data)throw new Error('存档文件格式不正确。');const n=this.manualSlots.find(e=>!e.data);if(!n)return void Vs.error('没有空的手动存档槽位可用于导入。');Vs.info(`正在导入存档到槽位 [${n.name}]...`);const o=`${Im}${n.id}`,a=(await TavernHelper.getLorebookEntries(xm)).find(e=>e.comment===o);a?await TavernHelper.setLorebookEntries(xm,[{uid:a.uid,content:JSON.stringify(t,null,2)}]):await TavernHelper.createLorebookEntries(xm,[{comment:o,content:JSON.stringify(t,null,2),keys:[o],position:'after_character_definition',order:200,enabled:!1}]),await this.loadAllSaveSlots(),Vs.success(`存档已成功导入至 [${n.name}]！`)}catch(e){const t=`导入失败: ${e instanceof Error?e.message:String(e)}`;console.error('导入存档时出错:',e),Vs.error(t)}}toggleAutoSave(e){this.isAutoSaveEnabled=e,localStorage.setItem('tianhua_auto_save_enabled',JSON.stringify(e)),Vs.info('自动存档已'+(e?'开启':'关闭'))}loadAutoSaveState(){const e=localStorage.getItem('tianhua_auto_save_enabled');null!==e&&(this.isAutoSaveEnabled=JSON.parse(e))}loadTurnCounter(){const e=localStorage.getItem('tianhua_turn_counter');null!==e&&(this.turnCounter=parseInt(e,10)||0)}},Mm=(0,x.defineComponent)({name:'SaveLoadPanel',setup(){const e=(0,x.ref)([]),t=(0,x.ref)([]),n=(0,x.ref)(!0),o=(0,x.ref)(null),a=async()=>{await Lm.loadAllSaveSlots(),e.value=[...Lm.manualSlots],t.value=[...Lm.autoSlots]};(0,x.onMounted)(()=>{a(),n.value=Lm.isAutoSaveEnabled});return{manualSlots:e,autoSlots:t,isAutoSaveEnabled:n,fileInput:o,formatTimestamp:e=>new Date(e).toLocaleString('zh-CN',{hour12:!1}),saveGame:async e=>{await Lm.saveGame(e),await a()},loadGame:async e=>{await Lm.loadGame(e)},deleteSave:async e=>{await Lm.deleteSave(e),await a()},toggleAutoSave:()=>{Lm.toggleAutoSave(n.value)},importSave:()=>{o.value?.click()},handleFileImport:e=>{const t=e.target;if(t.files&&t.files[0]){const e=t.files[0],n=new FileReader;n.onload=async e=>{try{const t=e.target?.result;await Lm.importSave(t),await a()}catch(e){Vs.error('导入存档失败，文件格式可能不正确。'),console.error(e)}},n.readAsText(e),t.value=''}},exportSave:async()=>{const t=e.value.find(e=>e.data);t?Lm.exportSave(t):Vs.warning('没有可导出的存档。')}}}}),Am=(0,me.A)(Mm,[['render',function(e,t,n,o,a,l){return(0,x.openBlock)(),(0,x.createElementBlock)('div',nm,[(0,x.createElementVNode)('div',om,[t[5]||(t[5]=(0,x.createElementVNode)('h2',{class:'panel-title'},'游戏存档',-1)),(0,x.createElementVNode)('div',am,[(0,x.createElementVNode)('button',{onClick:t[0]||(t[0]=(...t)=>e.importSave&&e.importSave(...t)),class:'header-btn'},'导入'),(0,x.createElementVNode)('button',{onClick:t[1]||(t[1]=(...t)=>e.exportSave&&e.exportSave(...t)),class:'header-btn'},'导出')])]),(0,x.createElementVNode)('div',lm,[(0,x.createElementVNode)('div',rm,[t[6]||(t[6]=(0,x.createElementVNode)('h3',{class:'group-title'},'手动存档',-1)),((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.manualSlots,t=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:t.id,class:'save-slot'},[(0,x.createElementVNode)('div',im,[(0,x.createElementVNode)('span',cm,(0,x.toDisplayString)(t.name),1),(0,x.createElementVNode)('span',sm,(0,x.toDisplayString)(t.timestamp?e.formatTimestamp(t.timestamp):'空槽位'),1),t.worldLogDate||t.worldLogTitle?((0,x.openBlock)(),(0,x.createElementBlock)('div',dm,[(0,x.createElementVNode)('span',mm,(0,x.toDisplayString)(t.worldLogDate),1),(0,x.createElementVNode)('span',um,(0,x.toDisplayString)(t.worldLogTitle),1)])):(0,x.createCommentVNode)('v-if',!0)]),(0,x.createElementVNode)('div',pm,[(0,x.createElementVNode)('button',{onClick:n=>e.saveGame(t.id),class:'action-btn save-btn'},'保存',8,vm),(0,x.createElementVNode)('button',{onClick:n=>e.loadGame(t),disabled:!t.data,class:'action-btn load-btn'},'读取',8,gm),(0,x.createElementVNode)('button',{onClick:n=>e.deleteSave(t),disabled:!t.data,class:'action-btn delete-btn'},'删除',8,fm)])]))),128))]),(0,x.createElementVNode)('div',hm,[t[7]||(t[7]=(0,x.createElementVNode)('h3',{class:'group-title'},'自动存档',-1)),((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.autoSlots,t=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:t.id,class:'save-slot auto-slot'},[(0,x.createElementVNode)('div',ym,[(0,x.createElementVNode)('span',km,(0,x.toDisplayString)(t.name),1),(0,x.createElementVNode)('span',Em,(0,x.toDisplayString)(t.timestamp?e.formatTimestamp(t.timestamp):'空槽位'),1),t.worldLogDate||t.worldLogTitle?((0,x.openBlock)(),(0,x.createElementBlock)('div',Nm,[(0,x.createElementVNode)('span',bm,(0,x.toDisplayString)(t.worldLogDate),1),(0,x.createElementVNode)('span',Vm,(0,x.toDisplayString)(t.worldLogTitle),1)])):(0,x.createCommentVNode)('v-if',!0)]),(0,x.createElementVNode)('div',Sm,[(0,x.createElementVNode)('button',{onClick:n=>e.loadGame(t),disabled:!t.data,class:'action-btn load-btn'},'读取',8,Bm)])]))),128))]),(0,x.createElementVNode)('div',wm,[(0,x.createElementVNode)('label',null,[(0,x.withDirectives)((0,x.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':t[2]||(t[2]=t=>e.isAutoSaveEnabled=t),onChange:t[3]||(t[3]=(...t)=>e.toggleAutoSave&&e.toggleAutoSave(...t))},null,544),[[x.vModelCheckbox,e.isAutoSaveEnabled]]),t[8]||(t[8]=(0,x.createTextVNode)(' 开启自动存档 ',-1))])])]),(0,x.createElementVNode)('input',{type:'file',ref:'fileInput',onChange:t[4]||(t[4]=(...t)=>e.handleFileImport&&e.handleFileImport(...t)),style:{display:'none'},accept:'.json'},null,544)])}],['__scopeId','data-v-1dbb5532']]),Om={class:'system-panel'},jm={class:'panel-tabs'},Tm={class:'panel-content'},Fm=(0,x.defineComponent)({__name:'SystemPanel',setup(e){const t=(0,x.ref)('saveLoad');return(e,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Om,[(0,x.createElementVNode)('div',jm,[(0,x.createElementVNode)('button',{class:(0,x.normalizeClass)({active:'saveLoad'===t.value}),onClick:n[0]||(n[0]=e=>t.value='saveLoad')},'存档管理',2),(0,x.createElementVNode)('button',{class:(0,x.normalizeClass)({active:'memory'===t.value}),onClick:n[1]||(n[1]=e=>t.value='memory')},'记忆系统',2)]),(0,x.createElementVNode)('div',Tm,[(0,x.withDirectives)((0,x.createVNode)(Am,null,null,512),[[x.vShow,'saveLoad'===t.value]]),(0,x.withDirectives)((0,x.createVNode)(tm,null,null,512),[[x.vShow,'memory'===t.value]])])]))}}),Rm=(0,me.A)(Fm,[['__scopeId','data-v-238307c0']]),Wm={key:0,class:'realm-detail-card'},Pm={class:'info-item'},Um={class:'info-item'},Hm={class:'info-item full-width'},Gm={class:'info-item full-width'},Jm={class:'info-item full-width'},Ym=(0,x.defineComponent)({__name:'RealmDetailCard',props:{realm:{type:Object,required:!0}},setup:e=>(t,n)=>e.realm?((0,x.openBlock)(),(0,x.createElementBlock)('div',Wm,[(0,x.createElementVNode)('div',Pm,[n[0]||(n[0]=(0,x.createElementVNode)('strong',null,'能级',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(e.realm.能级),1)]),(0,x.createElementVNode)('div',Um,[n[1]||(n[1]=(0,x.createElementVNode)('strong',null,'名称',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(e.realm.名称),1)]),(0,x.createElementVNode)('div',Hm,[n[2]||(n[2]=(0,x.createElementVNode)('strong',null,'描述',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(e.realm.描述),1)]),(0,x.createElementVNode)('div',Gm,[n[3]||(n[3]=(0,x.createElementVNode)('strong',null,'解锁系统',-1)),(0,x.createElementVNode)('span',null,(0,x.toDisplayString)(e.realm.解锁系统?.名称)+' - '+(0,x.toDisplayString)(e.realm.解锁系统?.描述),1)]),(0,x.createElementVNode)('div',Jm,[n[4]||(n[4]=(0,x.createElementVNode)('strong',null,'晋升需求',-1)),(0,x.createElementVNode)('ul',null,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.realm.晋升需求,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:t},(0,x.toDisplayString)(e.条件?.描述),1))),128))])])])):(0,x.createCommentVNode)('v-if',!0)}),qm=(0,me.A)(Ym,[['__scopeId','data-v-3873800d']]),Km={key:0,class:'panel-wrapper world-detail-panel-content'},Qm={class:'scroll-container'},Xm={class:'world-section'},Zm={class:'rules-grid'},eu={class:'rule-item'},tu={class:'rule-value'},nu={class:'rule-item'},ou={class:'rule-value'},au={class:'world-section epoch-selection'},lu={class:'tabs-container main-tabs'},ru=['innerHTML'],iu={class:'world-section'},cu={class:'epoch-header'},su={class:'section-title'},du={class:'epoch-overview'},mu={class:'rules-grid'},uu={class:'rule-item'},pu={class:'rule-value'},vu={class:'rule-item'},gu={class:'rule-value'},fu={class:'rule-item'},hu={class:'rule-value'},yu={class:'rule-item'},ku={class:'rule-value'},Eu={class:'world-section'},Nu={class:'system-overview'},bu={class:'subsection'},Vu={class:'ladder-container'},Su={class:'境界-ladder'},Bu=['onClick'],wu={class:'level-energy'},Cu={class:'level-name'},Du={key:1,class:'panel-wrapper loading-state'},xu=(0,x.defineComponent)({__name:'WorldDetailsPanel',props:{worldType:{}},setup(e){const t=e,n=(0,x.ref)('details'),o=(0,x.ref)('加载摘要中...'),a=(0,x.computed)(()=>'mainWorld'===t.worldType?Et.value:Nt.value),l=(0,x.computed)(()=>a.value&&a.value.历史纪元?Object.values(a.value.历史纪元).filter(e=>'object'==typeof e&&e.纪元ID):[]),r=(0,x.ref)(null);(0,x.onMounted)(async()=>{const e=await Be.readFromLorebook('主世界摘要');o.value=e?e.split('\n\n---\n\n').map(e=>`<p>${e.replace(/\n/g,'<br>')}</p>`).join(''):'未能找到主世界摘要。'}),(0,x.watch)(a,e=>{e&&(r.value=e.元规则.当前纪元ID||l.value[0]?.纪元ID||null)},{immediate:!0});const i=(0,x.computed)(()=>a.value&&r.value&&a.value.历史纪元[r.value]||null),c=(0,x.computed)(()=>{if(!i.value?.力量体系?.境界定义)return[];const e=i.value.力量体系.境界定义;return Object.keys(e).filter(e=>'$meta'!==e).map(t=>e[t]).sort((e,t)=>e.能级-t.能级)});return(e,t)=>a.value&&i.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',Km,[(0,x.createElementVNode)('div',Qm,[(0,x.createCommentVNode)(' 元规则 '),(0,x.createElementVNode)('section',Xm,[t[4]||(t[4]=(0,x.createElementVNode)('h3',{class:'section-title'},'元规则',-1)),(0,x.createElementVNode)('div',Zm,[(0,x.createElementVNode)('div',eu,[t[2]||(t[2]=(0,x.createElementVNode)('div',{class:'rule-name'},'宇宙蓝图',-1)),(0,x.createElementVNode)('div',tu,(0,x.toDisplayString)(a.value.元规则.宇宙蓝图),1)]),(0,x.createElementVNode)('div',nu,[t[3]||(t[3]=(0,x.createElementVNode)('div',{class:'rule-name'},'物理尺度',-1)),(0,x.createElementVNode)('div',ou,(0,x.toDisplayString)(a.value.元规则.物理尺度),1)])])]),(0,x.createCommentVNode)(' 纪元切换 '),(0,x.createElementVNode)('section',au,[t[5]||(t[5]=(0,x.createElementVNode)('h3',{class:'section-title'},'内容详情',-1)),(0,x.createElementVNode)('div',lu,[(0,x.createElementVNode)('button',{class:(0,x.normalizeClass)(['epoch-tab',{active:'details'===n.value}]),onClick:t[0]||(t[0]=e=>n.value='details')},' 纪元详情 ',2),(0,x.createElementVNode)('button',{class:(0,x.normalizeClass)(['epoch-tab',{active:'summary'===n.value}]),onClick:t[1]||(t[1]=e=>n.value='summary')},' 世界摘要 ',2)])]),'summary'===n.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:0,class:'summary-content',innerHTML:o.value},null,8,ru)):(0,x.createCommentVNode)('v-if',!0),'details'===n.value&&i.value?((0,x.openBlock)(),(0,x.createElementBlock)(x.Fragment,{key:1},[(0,x.createCommentVNode)(' 纪元规则 '),(0,x.createElementVNode)('section',iu,[(0,x.createElementVNode)('div',cu,[(0,x.createElementVNode)('h3',su,'纪元: '+(0,x.toDisplayString)(i.value.纪元名称),1),(0,x.createElementVNode)('p',du,(0,x.toDisplayString)(i.value.纪元概述),1)]),(0,x.createElementVNode)('div',mu,[(0,x.createElementVNode)('div',uu,[t[6]||(t[6]=(0,x.createElementVNode)('div',{class:'rule-name'},'世界能级',-1)),(0,x.createElementVNode)('div',pu,(0,x.toDisplayString)(i.value.规则.世界能级),1)]),(0,x.createElementVNode)('div',vu,[t[7]||(t[7]=(0,x.createElementVNode)('div',{class:'rule-name'},'时间流速',-1)),(0,x.createElementVNode)('div',gu,(0,x.toDisplayString)(i.value.规则.时间流速)+'x',1)]),(0,x.createElementVNode)('div',fu,[t[8]||(t[8]=(0,x.createElementVNode)('div',{class:'rule-name'},'空间稳定性',-1)),(0,x.createElementVNode)('div',hu,(0,x.toDisplayString)(i.value.规则.空间稳定性)+'%',1)]),(0,x.createElementVNode)('div',yu,[t[9]||(t[9]=(0,x.createElementVNode)('div',{class:'rule-name'},'生命位格',-1)),(0,x.createElementVNode)('div',ku,(0,x.toDisplayString)(i.value.规则.生命位格.基准值),1)])])]),(0,x.createCommentVNode)(' 力量体系 '),(0,x.createElementVNode)('section',Eu,[t[11]||(t[11]=(0,x.createElementVNode)('h3',{class:'section-title'},'力量体系',-1)),(0,x.createElementVNode)('p',Nu,(0,x.toDisplayString)(i.value.力量体系.体系概述),1),(0,x.createElementVNode)('div',bu,[t[10]||(t[10]=(0,x.createElementVNode)('h4',{class:'subsection-title'},'境界定义',-1)),(0,x.createElementVNode)('div',Vu,[(0,x.createElementVNode)('ul',Su,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(c.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e.名称,class:'ladder-step',onClick:t=>{var n;(n=e)&&Cn.show(n.名称,qm,{realm:n})}},[(0,x.createElementVNode)('span',wu,'能级 '+(0,x.toDisplayString)(e.能级),1),(0,x.createElementVNode)('span',Cu,(0,x.toDisplayString)(e.名称),1)],8,Bu))),128))])])])])],64)):(0,x.createCommentVNode)('v-if',!0)])])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Du,'加载世界信息中...'))}}),Iu=(0,me.A)(xu,[['__scopeId','data-v-19c6fefe']]);const $u=new class{colorCache=new Map;colorScale=h(y);simpleHash(e){let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t|=0}return Math.abs(t)}getColor(e){if(this.colorCache.has(e))return this.colorCache.get(e);const t=this.simpleHash(e),n=this.colorScale(String(t%10));return this.colorCache.set(e,n),n}};const _u=new class{baseAngleMap;constructor(){this.baseAngleMap=new Map([['东',0],['E',0],['东南',Math.PI/4],['SE',Math.PI/4],['南',Math.PI/2],['S',Math.PI/2],['西南',3*Math.PI/4],['SW',3*Math.PI/4],['西',Math.PI],['W',Math.PI],['西北',5*Math.PI/4],['NW',5*Math.PI/4],['北',3*Math.PI/2],['N',3*Math.PI/2],['东北',7*Math.PI/4],['NE',7*Math.PI/4],['中',0],['C',0],['上',-Math.PI/2],['Up',-Math.PI/2],['下',Math.PI/2],['Down',Math.PI/2]])}parseAzimuth(e){try{let t=[];if(Array.isArray(e))t=e;else if('string'==typeof e){const n=e.trim().slice(1,-1).match(/'[^']*'|"[^"]*"|[^,\s]+/g);n&&(t=n.map(e=>e.replace(/['"]/g,'')))}if(0===t.length)return console.warn('[CoordinateService] 无法从输入中解析出任何有效部分:',e),null;const n=String(t[0]).replace(/[[\]'"]/g,'').trim(),o=t.length>1?Number(t[1]):0;if(isNaN(o)){console.warn('[CoordinateService] 方位中的角度值不是一个有效的数字:',t[1]);const e=this.baseAngleMap.get(n);return void 0!==e?e:null}const a=this.baseAngleMap.get(n);if(void 0===a)return console.warn(`[CoordinateService] 未知的基本方位: '${n}'`),null;return a+o*Math.PI/180}catch(t){return console.error('[CoordinateService] 解析方位值时发生不可预知的错误:',{value:e,error:t}),null}}normalizeDistance(e){const t=Number(e[0]),n=e[1];if(isNaN(t))return 0;switch(n.toLowerCase()){case'km':default:return t;case'au':return 149597870.7*t;case'光年':return 9460730472580.8*t}}getCartesianCoordinates(e,t){if(void 0===e.x||void 0===e.y||!t)return null;const n=this.parseAzimuth(t.方位);if(null===n)return null;let o='';if(Array.isArray(t.方位))o=String(t.方位[0]);else if('string'==typeof t.方位){const e=t.方位.match(/'[^']*'|"[^"]*"|[^,\s]+/g);e&&e.length>0&&(o=e[0].replace(/['"[\]]/g,'').trim())}if('中'===o||'C'===o.toUpperCase())return{x:e.x,y:e.y};const a=this.normalizeDistance(t.距离);return{x:e.x+a*Math.cos(n),y:e.y+a*Math.sin(n)}}calculateRelativePositions(e,t){if(!t||0===t.length)return;const n=t.map(e=>e.data.相对坐标?this.normalizeDistance(e.data.相对坐标.距离):0).filter(e=>e>0);let o;if(n.length>0){const e=Math.min(...n),t=Math.max(...n);o=f().domain([e,t]).range([150,400]).clamp(!0)}else o=f().domain([0,1]).range([150,150]);t.forEach(t=>{const n=t.data.相对坐标;if(!n)return t.x=e.x,void(t.y=e.y);const a=n.方位.includes('中')&&0===this.normalizeDistance(n.距离),l=n.方位.includes('上')||n.方位.includes('下');if(a||l){if(t.x=e.x,t.y=e.y,l){const e=this.parseAzimuth(n.方位);if(null!==e){const a=o(this.normalizeDistance(n.距离));t.y=(t.y??0)+a*Math.sin(e)}}return}const r=this.parseAzimuth(n.方位);if(null===r)return t.x=e.x,void(t.y=e.y);const i=this.normalizeDistance(n.距离),c=o(i);t.x=e.x+c*Math.cos(r),t.y=e.y+c*Math.sin(r)})}};const zu=new class{hierarchyCache=null;getMapHierarchy(e){if(!e)return null;const t=e.纪元ID;if(this.hierarchyCache&&this.hierarchyCache.cacheKey===t)return this.hierarchyCache;const n=e.内容?.空间实体;if(!n||0===Object.keys(n).length)return console.warn(`WorldMapDataService: 在纪元 "${e.纪元名称}" 中没有找到 "空间实体" 数据。`),null;const o=this.buildHierarchy(Object.values(n));return o.cacheKey=t,this.hierarchyCache=o,this.hierarchyCache}clearCache(){this.hierarchyCache=null}buildHierarchy(e){const t=new Map,n=[];e.forEach(e=>{t.set(e.ID,{id:e.ID,name:e.名称,type:e.层级类型,parentId:e.所属?.ID,children:[],childCount:0,radius:10,data:e})});for(const e of t.values()){const o=e.parentId?t.get(e.parentId):null;o?o.children.push(e):n.push(e)}for(const e of t.values())e.childCount=e.children.length;return{id:'WORLD_ORIGIN',name:'世界',type:'Origin',parentId:null,children:n,childCount:n.length,radius:0,data:{}}}},Lu=(0,x.reactive)({currentRootId:'WORLD_ORIGIN',navigationPath:[{id:'WORLD_ORIGIN',name:'世界'}],selectedNode:null,isDetailPanelVisible:!1,worldData:null,userLocationId:null,avatarLocationId:null}),Mu={navigateToNode(e){Lu.currentRootId=e.id,Lu.navigationPath.find(t=>t.id===e.id)||Lu.navigationPath.push({id:e.id,name:e.name})},navigateBack(e){const t=Lu.navigationPath.findIndex(t=>t.id===e);t>-1&&(Lu.currentRootId=e,Lu.navigationPath.splice(t+1))},selectNode(e){Lu.selectedNode=e,Lu.isDetailPanelVisible=!0},hideDetail(){Lu.selectedNode=null,Lu.isDetailPanelVisible=!1},setNavigationPath(e){Lu.navigationPath=e},setWorldData(e){Lu.worldData=e},setPlayerLocations(e){Lu.userLocationId=e.user,Lu.avatarLocationId=e.avatar}},Au=(0,x.readonly)(Lu),Ou=Mu,ju={class:'map-navigator'},Tu=['onClick'],Fu={key:0,class:'separator'},Ru=(0,x.defineComponent)({__name:'MapNavigator',props:{path:{type:Array,required:!0}},emits:['navigate'],setup(e,{emit:t}){const n=t;return(t,o)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',ju,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.path,(t,o)=>((0,x.openBlock)(),(0,x.createElementBlock)('span',{key:t.id,class:'crumb',onClick:e=>{return o=t.id,void n('navigate',o);var o}},[(0,x.createTextVNode)((0,x.toDisplayString)(t.name)+' ',1),o<e.path.length-1?((0,x.openBlock)(),(0,x.createElementBlock)('span',Fu,' > ')):(0,x.createCommentVNode)('v-if',!0)],8,Tu))),128))]))}}),Wu=(0,me.A)(Ru,[['__scopeId','data-v-41303afe']]),Pu={class:'panel-header'},Uu={class:'panel-content'},Hu={key:0},Gu={class:'section'},Ju={key:0},Yu={key:0,class:'section'},qu={key:1,class:'section'},Ku={class:'section-title'},Qu={class:'item-list'},Xu=['onClick'],Zu={key:2,class:'section'},ep={class:'item-list'},tp={key:3,class:'section'},np={class:'item-list'},op={key:1},ap=(0,x.defineComponent)({__name:'NodeDetailPanel',props:{node:{type:Object,default:null}},emits:['close'],setup(e){const t=e,n=(0,x.computed)(()=>t.node?.children||[]),o=(0,x.computed)(()=>{if(!t.node||!Au.worldData?.内容?.资源)return[];const e=Au.worldData.内容.资源;return(Array.isArray(e)?e:[]).filter(e=>e.所属实体ID===t.node?.id)}),a=(0,x.computed)(()=>{if(!t.node||!Au.worldData?.内容?.文明?.势力)return[];const e=Au.worldData.内容.文明.势力;return(Array.isArray(e)?e:Object.values(e)).filter(e=>{if(!e||'object'!=typeof e)return!1;return JSON.stringify(e).includes(t.node.name)})}),l=(0,x.ref)(null);return(0,x.onMounted)(()=>{const e=l.value;if(!e)return;e.querySelector('.panel-header').addEventListener('mousedown',t=>{let n=!0;const o=t.clientX,a=t.clientY,l=e.offsetLeft,r=e.offsetTop,i=t=>{if(!n)return;const i=t.clientX-o,c=t.clientY-a;e.style.left=`${l+i}px`,e.style.top=`${r+c}px`},c=()=>{n=!1,document.removeEventListener('mousemove',i),document.removeEventListener('mouseup',c)};document.addEventListener('mousemove',i),document.addEventListener('mouseup',c)});e.querySelectorAll('.resize-handle').forEach(t=>{t.addEventListener('mousedown',n=>{n.stopPropagation();const o=t.dataset.direction;if(!o)return;let a=!0;const l=n.clientX,r=n.clientY,i=e.offsetWidth,c=e.offsetHeight,s=e.offsetLeft,d=e.offsetTop,m=t=>{if(!a)return;const n=t.clientX-l,m=t.clientY-r;o.includes('right')&&(e.style.width=`${i+n}px`),o.includes('bottom')&&(e.style.height=`${c+m}px`),o.includes('left')&&(e.style.width=i-n+'px',e.style.left=`${s+n}px`),o.includes('top')&&(e.style.height=c-m+'px',e.style.top=`${d+m}px`)},u=()=>{a=!1,document.removeEventListener('mousemove',m),document.removeEventListener('mouseup',u)};document.addEventListener('mousemove',m),document.addEventListener('mouseup',u)})})}),(t,r)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{class:'node-detail-panel',ref_key:'panelRef',ref:l},[(0,x.createElementVNode)('div',Pu,[(0,x.createElementVNode)('h3',null,(0,x.toDisplayString)(e.node?.name||'详情'),1),(0,x.createElementVNode)('button',{class:'close-btn',onClick:r[0]||(r[0]=e=>t.$emit('close'))},'×')]),(0,x.createElementVNode)('div',Uu,[e.node?((0,x.openBlock)(),(0,x.createElementBlock)('div',Hu,[(0,x.createCommentVNode)(' 类型 '),(0,x.createElementVNode)('div',Gu,[(0,x.createElementVNode)('p',null,[r[1]||(r[1]=(0,x.createElementVNode)('strong',null,'类型:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.node.type),1)]),e.node.data.面积?((0,x.openBlock)(),(0,x.createElementBlock)('p',Ju,[r[2]||(r[2]=(0,x.createElementVNode)('strong',null,'面积:',-1)),(0,x.createTextVNode)(' '+(0,x.toDisplayString)(e.node.data.面积[0])+' '+(0,x.toDisplayString)(e.node.data.面积[1]),1)])):(0,x.createCommentVNode)('v-if',!0)]),(0,x.createCommentVNode)(' 描述 '),e.node.data.描述?((0,x.openBlock)(),(0,x.createElementBlock)('div',Yu,[r[3]||(r[3]=(0,x.createElementVNode)('h4',{class:'section-title'},'描述',-1)),(0,x.createElementVNode)('pre',null,(0,x.toDisplayString)(e.node.data.描述),1)])):(0,x.createCommentVNode)('v-if',!0),(0,x.createCommentVNode)(' 子节点 '),n.value.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',qu,[(0,x.createElementVNode)('h4',Ku,'子节点 ('+(0,x.toDisplayString)(n.value.length)+')',1),(0,x.createElementVNode)('ul',Qu,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(n.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e.id,class:'interactive list-item',onClick:t=>{var n;(n=e).childCount>0&&Ou.navigateToNode(n)}},(0,x.toDisplayString)(e.name)+' ('+(0,x.toDisplayString)(e.type)+') ',9,Xu))),128))])])):(0,x.createCommentVNode)('v-if',!0),(0,x.createCommentVNode)(' 关联资源 '),o.value.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',Zu,[r[4]||(r[4]=(0,x.createElementVNode)('h4',{class:'section-title'},'关联资源',-1)),(0,x.createElementVNode)('ul',ep,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(o.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e.ID,class:'list-item'},[(0,x.createTextVNode)((0,x.toDisplayString)(e.名称)+' ',1),(0,x.createElementVNode)('span',{class:(0,x.normalizeClass)(['rarity',`rarity-${e.稀有度}`])},'['+(0,x.toDisplayString)(e.稀有度)+']',3)]))),128))])])):(0,x.createCommentVNode)('v-if',!0),(0,x.createCommentVNode)(' 盘踞势力 (暂未实现) '),a.value.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',tp,[r[5]||(r[5]=(0,x.createElementVNode)('h4',{class:'section-title'},'盘踞势力',-1)),(0,x.createElementVNode)('ul',np,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(a.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e.ID,class:'list-item'},(0,x.toDisplayString)(e.名称)+' ('+(0,x.toDisplayString)(e.类型)+') ',1))),128))])])):(0,x.createCommentVNode)('v-if',!0)])):((0,x.openBlock)(),(0,x.createElementBlock)('div',op,[...r[6]||(r[6]=[(0,x.createElementVNode)('p',null,'没有选中的节点。',-1)])]))]),r[7]||(r[7]=(0,x.createStaticVNode)('<div class="resize-handle top" data-direction="top" data-v-22e5bfcd></div><div class="resize-handle right" data-direction="right" data-v-22e5bfcd></div><div class="resize-handle bottom" data-direction="bottom" data-v-22e5bfcd></div><div class="resize-handle left" data-direction="left" data-v-22e5bfcd></div><div class="resize-handle top-left" data-direction="top-left" data-v-22e5bfcd></div><div class="resize-handle top-right" data-direction="top-right" data-v-22e5bfcd></div><div class="resize-handle bottom-left" data-direction="bottom-left" data-v-22e5bfcd></div><div class="resize-handle bottom-right" data-direction="bottom-right" data-v-22e5bfcd></div>',8))],512))}}),lp=(0,me.A)(ap,[['__scopeId','data-v-22e5bfcd']]),rp={class:'world-map-view'},ip={key:0,class:'search-panel'},cp={key:0,class:'search-results'},sp=['onClick'],dp=(0,x.defineComponent)({__name:'AvatarWorldMapView',setup(e){const t=(0,x.ref)(null),n=(0,x.ref)(null),o=(0,x.ref)([]),a=(0,x.ref)([]),l=(0,x.ref)(''),r=(0,x.ref)([]),i=(0,x.ref)(!1),c=(0,x.computed)(()=>Au.navigationPath),s=(0,x.computed)(()=>Au.isDetailPanelVisible),d=(0,x.computed)(()=>Au.selectedNode),m=(0,x.computed)(()=>Au.currentRootId),u=(e,t)=>{if(e.id===t)return e;for(const n of e.children){const e=u(n,t);if(e)return e}return null},p=(0,x.computed)(()=>n.value?u(n.value,m.value):null),v=(0,x.computed)(()=>{const e=[];return n.value&&function t(n){e.push(n),n.children.forEach(t)}(n.value),e}),f=(0,x.computed)(()=>l.value?v.value.filter(e=>e.name.toLowerCase().includes(l.value.toLowerCase())).slice(0,10):[]),h=e=>{const t=[];let n=e;for(;n&&n.parentId&&'WORLD_ORIGIN'!==n.id;)t.unshift(n),n=v.value.find(e=>e.id===n.parentId);n&&t.unshift(n);const o=t.map(e=>({id:e.id,name:e.name}));Ou.setNavigationPath(o),e.parentId?Ou.navigateBack(e.parentId):Ou.navigateBack('WORLD_ORIGIN'),l.value=''},y=()=>{f.value.length>0&&h(f.value[0])},V=(0,x.ref)(null);(0,x.computed)(()=>p.value?p.value.children:[]);function S(e,n,o){const a=new Map;if(!t.value)return;const l=k(t.value),i=l.selectAll('g.zoom-container').data([null]),c=i.enter().append('g').attr('class','zoom-container'),s=i.merge(c);c.append('g').selectAll('circle.star').data(r.value).join('circle').attr('class','star').attr('cx',e=>e.x).attr('cy',e=>e.y).attr('r',e=>e.r).attr('fill','white').attr('opacity',e=>e.o);const d=N().scaleExtent([.01,10]).on('zoom',e=>{s.attr('transform',e.transform)});l.call(d).on('dblclick.zoom',null),l.transition().duration(750).call(d.transform,o);const u=E().duration(750),p=e.find(e=>e.id===m.value)||e[0];if(p){const t=e.filter(e=>e.id!==p.id).map(e=>{const t=(e.x??0)-(p.x??0),n=(e.y??0)-(p.y??0);return Math.sqrt(t*t+n*n)}).filter(e=>e>0);s.selectAll('circle.orbit-line').data(t).join(e=>e.append('circle').attr('class','orbit-line').attr('cx',p.x??0).attr('cy',p.y??0).attr('r',0).attr('fill','none').attr('stroke','rgba(255, 255, 255, 0.1)').call(e=>e.transition(u).attr('r',e=>e)),e=>e.call(e=>e.transition(u).attr('cx',p.x??0).attr('cy',p.y??0).attr('r',e=>e)),e=>e.call(e=>e.transition(u).attr('r',0).remove()))}s.selectAll('line.link').data(n,e=>`${e.source.id}-${e.target.id}`).join(e=>e.append('line').attr('class','link').attr('stroke','#999').attr('stroke-opacity',0).attr('x1',e=>e.source.x||0).attr('y1',e=>e.source.y||0).attr('x2',e=>e.target.x||0).attr('y2',e=>e.target.y||0).call(e=>e.transition(u).attr('stroke-opacity',.4)),e=>e.call(e=>e.transition(u).attr('x1',e=>e.source.x||0).attr('y1',e=>e.source.y||0).attr('x2',e=>e.target.x||0).attr('y2',e=>e.target.y||0)),e=>e.call(e=>e.transition(u).attr('stroke-opacity',0).remove()));const v=s.selectAll('g.node-group').data(e,e=>e.id),f=v.enter().append('g').attr('class','node-group').attr('transform',e=>`translate(${e.x||0},${e.y||0})`).attr('opacity',0);f.append('circle').attr('r',e=>e.radius).attr('fill',e=>$u.getColor(e.type)).attr('stroke',e=>g($u.getColor(e.type))?.brighter(1.5).toString()??'#fff').attr('stroke-width',2),f.append('text').text(e=>e.name).attr('text-anchor','middle').attr('dy',e=>e.radius+15).attr('fill','white').style('font-size','12px'),v.merge(f).on('click',function(e,t){const n=a.get(t.id);if(n)clearTimeout(n),a.delete(t.id),Ou.selectNode(t);else{const e=window.setTimeout(()=>{t.childCount>0?Ou.navigateToNode(t):Ou.selectNode(t),a.delete(t.id)},250);a.set(t.id,e)}}).transition(u).attr('transform',e=>`translate(${e.x||0},${e.y||0})`).attr('opacity',1),v.exit().transition(u).attr('opacity',0).remove()}(0,x.watch)(p,e=>{if(e&&t.value){const n=JSON.parse(JSON.stringify(e)),{width:l,height:r}=t.value.getBoundingClientRect();let i=[],c=[],s=null;'WORLD_ORIGIN'===n.id?(s=n.children[0],s&&(s.x=l/2,s.y=r/2,_u.calculateRelativePositions(s,n.children)),i=n.children,c=n.children.slice(1).map(e=>({source:s,target:e}))):(s=n,n.x=l/2,n.y=r/2,_u.calculateRelativePositions(n,n.children),i=[n,...n.children],c=n.children.map(e=>({source:n,target:e})));const d=b;o.value=i.filter(e=>'WORLD_ORIGIN'!==e.id),a.value=c,(0,x.nextTick)(()=>{S(o.value,a.value,d)})}else o.value=[],a.value=[],S([],[],b)},{immediate:!0}),(0,x.onMounted)(async()=>{const e=await Be.loadAndParseWorldData('化身世界');if(e&&(Ou.setWorldData(e),n.value=zu.getMapHierarchy(e)),ct.worldState){const e=ct.worldState.模拟器?.模拟?.当前化身ID?.[0],t=ct.worldState.角色?.[ct.userId]?.当前位置?.[0]||null,n=e&&ct.worldState.角色?.[e]&&ct.worldState.角色[e].当前位置?.[0]||null;Ou.setPlayerLocations({user:t,avatar:n})}if(t.value){const{width:e,height:n}=t.value.getBoundingClientRect(),o=4*Math.max(e,n);r.value=Array.from({length:1e3},(_,t)=>({id:t,x:(Math.random()-.5)*o+e/2,y:(Math.random()-.5)*o+n/2,r:1.2*Math.random(),o:.8*Math.random()+.2}));const a=k(t.value),l=N().scaleExtent([.01,10]).on('zoom',e=>{k(t.value).select('g.zoom-container').attr('transform',e.transform)});a.call(l).on('dblclick.zoom',null)}(()=>{const e=V.value;if(!e)return;let t=!1,n=0,o=0;const a=a=>{if(!t)return;const l=e.parentElement;if(!l)return;let r=a.clientX-n,i=a.clientY-o;const c=l.getBoundingClientRect();r=Math.max(0,Math.min(r,c.width-e.offsetWidth)),i=Math.max(0,Math.min(i,c.height-e.offsetHeight)),e.style.left=`${r}px`,e.style.top=`${i}px`},l=()=>{if(!t)return;t=!1,document.removeEventListener('mousemove',a),document.removeEventListener('mouseup',l);const n=e.parentElement.getBoundingClientRect(),o=e.getBoundingClientRect();o.left-n.left<50?e.style.left='10px':n.right-o.right<50&&(e.style.left=n.width-o.width-10+'px'),o.top-n.top<50?e.style.top='10px':n.bottom-o.bottom<50&&(e.style.top=n.height-o.height-10+'px')};e.onmousedown=r=>{t=!0,n=r.clientX-e.offsetLeft,o=r.clientY-e.offsetTop,document.addEventListener('mousemove',a),document.addEventListener('mouseup',l)}})();const o=e=>{const t=document.querySelector('.search-panel');!t||t.contains(e.target)||V.value?.contains(e.target)||(i.value=!1)};document.addEventListener('click',o,!0),(0,x.onUnmounted)(()=>{document.removeEventListener('click',o,!0)})}),(0,x.onActivated)(()=>{'WORLD_ORIGIN'===p.value?.id&&Ou.setNavigationPath([])});const B=e=>{Ou.navigateBack(e)};return(e,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',rp,[(0,x.createVNode)(Wu,{path:c.value,onNavigate:B},null,8,['path']),(0,x.createElementVNode)('button',{ref_key:'searchBtnRef',ref:V,class:'search-toggle-btn',onClick:n[0]||(n[0]=e=>i.value=!i.value)},' 🔍 ',512),i.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',ip,[(0,x.withDirectives)((0,x.createElementVNode)('input',{type:'text','onUpdate:modelValue':n[1]||(n[1]=e=>l.value=e),placeholder:'搜索节点...',onKeyup:(0,x.withKeys)(y,['enter'])},null,544),[[x.vModelText,l.value]]),f.value.length&&l.value?((0,x.openBlock)(),(0,x.createElementBlock)('ul',cp,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(f.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e.id,onClick:t=>h(e)},(0,x.toDisplayString)((e=>{const t=[];let n=e;for(;n&&'WORLD_ORIGIN'!==n.id;)t.unshift(n.name),n=v.value.find(e=>e.id===n.parentId);return t.join(' > ')})(e)),9,sp))),128))])):(0,x.createCommentVNode)('v-if',!0)])):(0,x.createCommentVNode)('v-if',!0),((0,x.openBlock)(),(0,x.createElementBlock)('svg',{ref_key:'svgRef',ref:t,class:'map-svg'},null,512)),s.value?((0,x.openBlock)(),(0,x.createBlock)(lp,{key:1,node:d.value,onClose:(0,x.unref)(Ou).hideDetail},null,8,['node','onClose'])):(0,x.createCommentVNode)('v-if',!0)]))}}),mp={class:'world-map-view'},up={key:0,class:'search-panel'},pp={key:0,class:'search-results'},vp=['onClick'],gp={mainWorld:{character:{component:qa,title:'角色本体'},inventory:{component:Jl,title:'本体背包'},skills:{component:Rd,title:'本体技艺'},imprints:{component:El,title:'轮回烙印'},worldDetails:{component:Iu,title:'主世界详情'},sandbox:{component:(0,x.defineComponent)({__name:'WorldMapView',setup(e){const t=(0,x.ref)(null),n=(0,x.ref)(null),o=(0,x.ref)([]),a=(0,x.ref)([]),l=(0,x.ref)(''),r=(0,x.ref)([]),i=(0,x.ref)(!1),c=(0,x.computed)(()=>Au.navigationPath),s=(0,x.computed)(()=>Au.isDetailPanelVisible),d=(0,x.computed)(()=>Au.selectedNode),m=(0,x.computed)(()=>Au.currentRootId),u=(e,t)=>{if(e.id===t)return e;for(const n of e.children){const e=u(n,t);if(e)return e}return null},p=(0,x.computed)(()=>n.value?u(n.value,m.value):null),v=(0,x.computed)(()=>{const e=[];return n.value&&function t(n){e.push(n),n.children.forEach(t)}(n.value),e}),f=(0,x.computed)(()=>l.value?v.value.filter(e=>e.name.toLowerCase().includes(l.value.toLowerCase())).slice(0,10):[]),h=e=>{const t=[];let n=e;for(;n&&n.parentId&&'WORLD_ORIGIN'!==n.id;)t.unshift(n),n=v.value.find(e=>e.id===n.parentId);n&&t.unshift(n);const o=t.map(e=>({id:e.id,name:e.name}));Ou.setNavigationPath(o),e.parentId?Ou.navigateBack(e.parentId):Ou.navigateBack('WORLD_ORIGIN'),l.value=''},y=()=>{f.value.length>0&&h(f.value[0])},V=(0,x.ref)(null);(0,x.computed)(()=>p.value?p.value.children:[]);function S(e,n,o){const a=new Map;if(!t.value)return;const l=k(t.value),i=l.selectAll('g.zoom-container').data([null]),c=i.enter().append('g').attr('class','zoom-container'),s=i.merge(c);c.append('g').selectAll('circle.star').data(r.value).join('circle').attr('class','star').attr('cx',e=>e.x).attr('cy',e=>e.y).attr('r',e=>e.r).attr('fill','white').attr('opacity',e=>e.o);const d=N().scaleExtent([.01,10]).on('zoom',e=>{s.attr('transform',e.transform)});l.call(d).on('dblclick.zoom',null),l.transition().duration(750).call(d.transform,o);const u=E().duration(750),p=e.find(e=>e.id===m.value)||e[0];if(p){const t=e.filter(e=>e.id!==p.id).map(e=>{const t=(e.x??0)-(p.x??0),n=(e.y??0)-(p.y??0);return Math.sqrt(t*t+n*n)}).filter(e=>e>0);s.selectAll('circle.orbit-line').data(t).join(e=>e.append('circle').attr('class','orbit-line').attr('cx',p.x??0).attr('cy',p.y??0).attr('r',0).attr('fill','none').attr('stroke','rgba(255, 255, 255, 0.1)').call(e=>e.transition(u).attr('r',e=>e)),e=>e.call(e=>e.transition(u).attr('cx',p.x??0).attr('cy',p.y??0).attr('r',e=>e)),e=>e.call(e=>e.transition(u).attr('r',0).remove()))}s.selectAll('line.link').data(n,e=>`${e.source.id}-${e.target.id}`).join(e=>e.append('line').attr('class','link').attr('stroke','#999').attr('stroke-opacity',0).attr('x1',e=>e.source.x||0).attr('y1',e=>e.source.y||0).attr('x2',e=>e.target.x||0).attr('y2',e=>e.target.y||0).call(e=>e.transition(u).attr('stroke-opacity',.4)),e=>e.call(e=>e.transition(u).attr('x1',e=>e.source.x||0).attr('y1',e=>e.source.y||0).attr('x2',e=>e.target.x||0).attr('y2',e=>e.target.y||0)),e=>e.call(e=>e.transition(u).attr('stroke-opacity',0).remove()));const v=s.selectAll('g.node-group').data(e,e=>e.id),f=v.enter().append('g').attr('class','node-group').classed('player-location',e=>e.id===Au.userLocationId).classed('avatar-location',e=>e.id===Au.avatarLocationId).attr('transform',e=>`translate(${e.x||0},${e.y||0})`).attr('opacity',0);f.append('circle').attr('r',e=>e.radius).attr('fill',e=>$u.getColor(e.type)).attr('stroke',e=>g($u.getColor(e.type))?.brighter(1.5).toString()??'#fff').attr('stroke-width',2),f.append('text').text(e=>e.name).attr('text-anchor','middle').attr('dy',e=>e.radius+15).attr('fill','white').style('font-size','12px'),v.merge(f).on('click',function(e,t){const n=a.get(t.id);if(n)clearTimeout(n),a.delete(t.id),Ou.selectNode(t);else{const e=window.setTimeout(()=>{t.childCount>0?Ou.navigateToNode(t):Ou.selectNode(t),a.delete(t.id)},250);a.set(t.id,e)}}).transition(u).attr('transform',e=>`translate(${e.x||0},${e.y||0})`).attr('opacity',1),v.exit().transition(u).attr('opacity',0).remove()}(0,x.watch)(p,e=>{if(e&&t.value){const n=JSON.parse(JSON.stringify(e)),{width:l,height:r}=t.value.getBoundingClientRect();let i=[],c=[];if('WORLD_ORIGIN'===n.id){const e=n.children[0];e&&(e.x=l/2,e.y=r/2,_u.calculateRelativePositions(e,n.children.slice(1))),i=n.children,c=n.children.slice(1).map(t=>({source:e,target:t}))}else n.x=l/2,n.y=r/2,_u.calculateRelativePositions(n,n.children),i=[n,...n.children],c=n.children.map(e=>({source:n,target:e}));const s=b;o.value=i.filter(e=>'WORLD_ORIGIN'!==e.id),a.value=c,(0,x.nextTick)(()=>{S(o.value,a.value,s)})}else o.value=[],a.value=[],S([],[],b)},{immediate:!0}),(0,x.onMounted)(async()=>{const e=await Be.loadAndParseWorldData();if(e&&(Ou.setWorldData(e),n.value=zu.getMapHierarchy(e)),ct.worldState){const e=ct.worldState.模拟器?.模拟?.当前化身ID?.[0],t=ct.worldState.角色?.[ct.userId]?.当前位置?.[0]||null,n=e&&ct.worldState.角色?.[e]&&ct.worldState.角色[e].当前位置?.[0]||null;Ou.setPlayerLocations({user:t,avatar:n})}if(t.value){const{width:e,height:n}=t.value.getBoundingClientRect(),o=4*Math.max(e,n);r.value=Array.from({length:1e3},(_,t)=>({id:t,x:(Math.random()-.5)*o+e/2,y:(Math.random()-.5)*o+n/2,r:1.2*Math.random(),o:.8*Math.random()+.2}));const a=k(t.value),l=N().scaleExtent([.01,10]).on('zoom',e=>{k(t.value).select('g.zoom-container').attr('transform',e.transform)});a.call(l).on('dblclick.zoom',null)}(()=>{const e=V.value;if(!e)return;let t=!1,n=0,o=0;const a=a=>{if(!t)return;const l=e.parentElement;if(!l)return;let r=a.clientX-n,i=a.clientY-o;const c=l.getBoundingClientRect();r=Math.max(0,Math.min(r,c.width-e.offsetWidth)),i=Math.max(0,Math.min(i,c.height-e.offsetHeight)),e.style.left=`${r}px`,e.style.top=`${i}px`},l=()=>{if(!t)return;t=!1,document.removeEventListener('mousemove',a),document.removeEventListener('mouseup',l);const n=e.parentElement.getBoundingClientRect(),o=e.getBoundingClientRect();o.left-n.left<50?e.style.left='10px':n.right-o.right<50&&(e.style.left=n.width-o.width-10+'px'),o.top-n.top<50?e.style.top='10px':n.bottom-o.bottom<50&&(e.style.top=n.height-o.height-10+'px')};e.onmousedown=r=>{t=!0,n=r.clientX-e.offsetLeft,o=r.clientY-e.offsetTop,document.addEventListener('mousemove',a),document.addEventListener('mouseup',l)}})();const o=e=>{const t=document.querySelector('.search-panel');!t||t.contains(e.target)||V.value?.contains(e.target)||(i.value=!1)};document.addEventListener('click',o,!0),(0,x.onUnmounted)(()=>{document.removeEventListener('click',o,!0)})}),(0,x.onActivated)(()=>{'WORLD_ORIGIN'===p.value?.id&&Ou.setNavigationPath([])});const B=e=>{Ou.navigateBack(e)};return(e,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',mp,[(0,x.createVNode)(Wu,{path:c.value,onNavigate:B},null,8,['path']),(0,x.createElementVNode)('button',{ref_key:'searchBtnRef',ref:V,class:'search-toggle-btn',onClick:n[0]||(n[0]=e=>i.value=!i.value)},' 🔍 ',512),i.value?((0,x.openBlock)(),(0,x.createElementBlock)('div',up,[(0,x.withDirectives)((0,x.createElementVNode)('input',{type:'text','onUpdate:modelValue':n[1]||(n[1]=e=>l.value=e),placeholder:'搜索节点...',onKeyup:(0,x.withKeys)(y,['enter'])},null,544),[[x.vModelText,l.value]]),f.value.length&&l.value?((0,x.openBlock)(),(0,x.createElementBlock)('ul',pp,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(f.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e.id,onClick:t=>h(e)},(0,x.toDisplayString)((e=>{const t=[];let n=e;for(;n&&'WORLD_ORIGIN'!==n.id;)t.unshift(n.name),n=v.value.find(e=>e.id===n.parentId);return t.join(' > ')})(e)),9,vp))),128))])):(0,x.createCommentVNode)('v-if',!0)])):(0,x.createCommentVNode)('v-if',!0),((0,x.openBlock)(),(0,x.createElementBlock)('svg',{ref_key:'svgRef',ref:t,class:'map-svg'},null,512)),s.value?((0,x.openBlock)(),(0,x.createBlock)(lp,{key:1,node:d.value,onClose:(0,x.unref)(Ou).hideDetail},null,8,['node','onClose'])):(0,x.createCommentVNode)('v-if',!0)]))}}),title:'世界沙盘'}},avatarWorld:{character:{component:qo,title:'化身详情'},inventory:{component:ya,title:'化身背包'},tasks:{component:La,title:'本世任务'},worldDetails:{component:Iu,title:'化身世界详情'},sandbox:{component:dp,title:'化身世界沙盘'}},reincarnation:{main:{component:gd,title:'轮回'}},allWorlds:{npcDirectory:{component:Sc,title:'众生名录'}},ripples:{detail:{component:bd,title:'往世涟漪详情'}},system:{saveLoad:{component:Rm,title:'系统'}}};const fp=new class{events={};on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(e=>e!==t))}emit(e,...t){this.events[e]&&this.events[e].forEach(n=>{try{n(...t)}catch(t){console.error(`Error in event handler for ${e}:`,t)}})}};const hp=new class{goldenLayout=null;hostElement=null;componentMap=new Map;onAction=null;initialize(t){if(!this.goldenLayout&&t){this.hostElement=t,this.goldenLayout=new e(this.hostElement),this.registerComponent('main-view',so);for(const e in gp)for(const t in gp[e]){const n=`${e}-${t}`.toLowerCase(),o=gp[e][t];this.registerComponent(n,o.component)}window.addEventListener('resize',()=>this.updateLayout())}}loadLayout(e){if(this.goldenLayout)try{this.goldenLayout.loadLayout(e)}catch(e){console.error('Failed to load layout:',e);try{this.goldenLayout.loadLayout(this.getDefaultLayout())}catch(e){console.error('Failed to load default layout on fallback:',e)}}}loadSavedLayout(){this.goldenLayout&&this.goldenLayout.loadLayout(this.getDefaultLayout())}registerComponent(e,t){this.componentMap.has(e)||(this.componentMap.set(e,t),this.goldenLayout?.registerComponent(e,(e,n)=>{const o=(0,x.defineComponent)({setup:()=>()=>(0,x.h)(t,n?.props||{})}),a=(0,x.h)(o);(0,x.render)(a,e.getElement()),n?.title&&e.setTitle(n.title),e.on('destroy',()=>{const e=n?.panelId;e&&fp.emit('panelClosed',e)})}))}openPanel(e,t,n,o={}){if(!this.goldenLayout)return void console.error('Golden Layout not initialized.');this.componentMap.get(n)?this.goldenLayout.addComponent(n,{title:t,props:o,panelId:e},e):console.error(`Component "${n}" is not registered.`)}updateLayout(){this.goldenLayout&&this.hostElement&&this.goldenLayout.updateSize(this.hostElement.clientWidth,this.hostElement.clientHeight)}closeAllPanels(){if(!this.goldenLayout?.rootItem)return;this.goldenLayout.rootItem.contentItems.filter(e=>e.isClosable).forEach(e=>{try{e.remove()}catch(t){console.error('Failed to remove panel item:',e,t)}})}destroy(){this.goldenLayout&&(this.goldenLayout.destroy(),this.goldenLayout=null),this.componentMap.clear(),window.removeEventListener('resize',()=>{})}unpinAllPanels(){this.goldenLayout&&this.goldenLayout.loadLayout(this.getDefaultLayout())}getDefaultLayout(){return{root:{type:'row',content:[{type:'component',componentType:'main-view',title:'主视图',isClosable:!1}]}}}getFullscreenLayout(){return{root:{type:'row',content:[{type:'component',componentType:'main-view',title:'主视图',isClosable:!1,width:100}]}}}};function yp(){return{openPanel:(e,t,n={})=>{if('avatarWorld'===e&&!yt.value)return;const o=gp[e]?.[t];if(o){const a=`${e}-${t}-${n.rippleId||''}`.toLowerCase(),l=`${e}-${t}`.toLowerCase();hp.registerComponent(l,o.component);const r={worldType:e,...n};hp.openPanel(a,o.title,l,r),fp.emit('panelOpened',{world:e,panel:t,props:n,panelId:a})}}}}const kp=(0,x.defineComponent)({__name:'DockManager',setup(e){const t=(0,x.ref)(null);return(0,x.onMounted)(()=>{if(t.value){hp.initialize(t.value);for(const e in D.panelRegistry)for(const t in D.panelRegistry[e]){const n=D.panelRegistry[e][t],o=`${e}-${t}`;hp.registerComponent(o,n.component)}hp.registerComponent('main-view',so),hp.loadSavedLayout()}}),(0,x.onBeforeUnmount)(()=>{hp.destroy()}),(e,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{ref_key:'dockHost',ref:t,class:'dock-manager-host'},null,512))}}),Ep={class:'loading-overlay'},Np={class:'loading-content'},bp={key:0,class:'error-container'},Vp={class:'error-message'},Sp={key:1},Bp={class:'tip'},wp={class:'progress-bar-container'},Cp={class:'progress-text'},Dp=(0,x.defineComponent)({__name:'LoadingIndicator',props:{error:{}},setup(e){const t=e,n=['开局不利？尝试在不同的世界寻找机缘，或许能固化改变命运的烙印。','灵魂本源是宝贵的资源，用它来继承天赋或装备，能让你在下一次轮回中走得更远。','高能级的世界往往伴随着高风险，但其产出的轮回烙印也更为强大。','如何重新演化天机？在“轮回”面板中，点击“重演天机”，即可发现新的世界。','与NPC建立良好的关系，可能会在不经意间触发隐藏的命运节点。','诸天万界，每一个选择都可能引发蝴蝶效应，谨慎行事。','有时候，放弃也是一种智慧。当世的终结，或许是下一世更好的开端。','留意世界日志中的摘要，那里面隐藏着后台世界的风起云涌。'],o=(0,x.ref)(''),a=(0,x.ref)(0);let l=null;function r(){l&&(clearInterval(l),l=null)}return(0,x.onMounted)(()=>{t.error||(o.value=n[Math.floor(Math.random()*n.length)],a.value=0,l=window.setInterval(()=>{a.value<99?a.value+=1:r()},9e4/99))}),(0,x.onUnmounted)(()=>{r()}),(0,x.watch)(()=>t.error,e=>{e&&r()}),(t,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Ep,[(0,x.createElementVNode)('div',Np,[e.error?((0,x.openBlock)(),(0,x.createElementBlock)('div',bp,[n[0]||(n[0]=(0,x.createElementVNode)('h3',{class:'error-title'},'天机紊乱',-1)),(0,x.createElementVNode)('p',Vp,(0,x.toDisplayString)(e.error),1),n[1]||(n[1]=(0,x.createElementVNode)('p',{class:'error-tip'},'请检查网络连接或稍后再试。',-1))])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Sp,[(0,x.createElementVNode)('p',Bp,(0,x.toDisplayString)(o.value),1),(0,x.createElementVNode)('div',wp,[(0,x.createElementVNode)('div',{class:'progress-bar',style:(0,x.normalizeStyle)({width:a.value+'%'})},null,4)]),(0,x.createElementVNode)('span',Cp,[n[2]||(n[2]=(0,x.createElementVNode)('span',{class:'highlight'},'轮回',-1)),(0,x.createTextVNode)('回应中... '+(0,x.toDisplayString)(Math.floor(a.value))+'%',1)])]))])]))}}),xp=(0,me.A)(Dp,[['__scopeId','data-v-6ae2bf70']]),Ip={class:'npc-list-modal-content'},$p={key:0,class:'npc-list-container'},_p={class:'npc-list'},zp={class:'npc-header'},Lp={class:'npc-name'},Mp={class:'npc-identity'},Ap={class:'npc-description'},Op={key:1,class:'no-npcs'},jp=(0,x.defineComponent)({__name:'NpcListModal',props:{worldId:{}},setup(e){const t=e,n=(0,x.computed)(()=>Bn.getNpcsByWorld(t.worldId));return(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Ip,[n.value.length>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',$p,[(0,x.createElementVNode)('ul',_p,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(n.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('li',{key:e.姓名[0],class:'npc-item'},[(0,x.createElementVNode)('div',zp,[(0,x.createElementVNode)('span',Lp,(0,x.toDisplayString)(e.姓名[0]),1),(0,x.createElementVNode)('span',Mp,(0,x.toDisplayString)(e.身份.join(', ')),1)]),(0,x.createElementVNode)('p',Ap,(0,x.toDisplayString)(e.外观描述),1)]))),128))])])):((0,x.openBlock)(),(0,x.createElementBlock)('div',Op,[...t[0]||(t[0]=[(0,x.createElementVNode)('p',null,'当前世界没有可供探查的NPC信息。',-1)])]))]))}}),Tp=(0,me.A)(jp,[['__scopeId','data-v-ff267540']]),Fp=$;var Rp=w.n(Fp);let Wp={};const Pp={enterWeb:function(){const e=function(){const e=parent.document.getElementsByTagName('iframe');for(let t=0;t<e.length;t++)if(e[t].contentWindow===window){const n=e[t];if(n.id)return`#${n.id}`;const o=n.getAttribute('src');if(o){const e=o.split('/').pop();if(e)return`iframe[src*="${e}"]`}return null}return null}();if(!e)return void console.warn('无法找到应用 iframe，无法进入网页全屏模式。');const t={[e]:{position:'fixed',top:'0',left:'0',width:'100vw',height:'100vh',zIndex:'99999',border:'none',borderRadius:'0'},'#top-settings-holder':{display:'none'},'#form_sheld > :not(#chat)':{display:'none'},'#top-bar':{display:'none'},'#chat':{height:'100vh',maxHeight:'100vh'},'#chat_fullscreen_button':{display:'none'}};Wp={};for(const e in t){const n=Rp()(e,parent.document);if(n.length>0){Wp[e]={};const o=t[e];for(const t in o)Wp[e][t]=n.css(t);n.css(o)}}Rp()(parent.document.documentElement).addClass('web-fullscreen-active'),Rp()(parent.document.body).addClass('web-fullscreen-active')},exitWeb:function(){for(const e in Wp){const t=Rp()(e,parent.document);t.length>0&&t.css(Wp[e])}Wp={},Rp()(parent.document.documentElement).removeClass('web-fullscreen-active'),Rp()(parent.document.body).removeClass('web-fullscreen-active')},toggleBrowser:function(){V.isEnabled?V.toggle():console.warn('浏览器不支持或不允许全屏功能。')},onBrowserChange:function(e){V.isEnabled&&V.on('change',()=>{e(V.isFullscreen)})},get isBrowserFullscreen(){return V.isEnabled&&V.isFullscreen}},Up=(0,x.reactive)({isVisible:!1,title:'',props:{worldId:''}}),Hp={state:Up,show:e=>{Up.title='NPC 列表',Up.props={worldId:e},Up.isVisible=!0},hide:()=>{Up.isVisible=!1}},Gp=(0,x.reactive)({isWebFullscreen:!1,isBrowserFullscreen:!1});Pp.onBrowserChange(e=>{Gp.isBrowserFullscreen&&!e&&TavernHelper.setChatMessages([],{refresh:'all'}),Gp.isBrowserFullscreen=e});const Jp={toggleBrowserFullscreen(){hp.closeAllPanels(),us.hide(),Cn.hide(),Hp.hide(),Ht.hide(),Pp.toggleBrowser()},toggleWebFullscreen(){const e=!Gp.isWebFullscreen;Gp.isWebFullscreen=e,e?Pp.enterWeb():Pp.exitWeb(),fp.emit('fullscreenChanged',e)},unpinAllPanels(){hp.unpinAllPanels()}},Yp=(0,x.readonly)(Gp),qp=Jp,Kp={class:'world-time-display'},Qp={class:'world-name'},Xp={class:'time-string'},Zp=(0,x.defineComponent)({__name:'WorldTimeDisplay',props:{worldType:{}},setup(e){const t=e,{worldType:n}=(0,x.toRefs)(t),o=(0,x.computed)(()=>'main'===n.value?'主世界':'化身世界'),a=(0,x.computed)(()=>'main'===n.value?St.value:Bt.value);return(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Kp,[(0,x.createElementVNode)('span',Qp,(0,x.toDisplayString)(o.value),1),(0,x.createElementVNode)('span',Xp,(0,x.toDisplayString)(a.value),1)]))}}),ev=(0,me.A)(Zp,[['__scopeId','data-v-668f333f']]),tv={class:'top-status'},nv={class:'status-left'},ov={class:'status-center'},av=['title'],lv={class:'status-right'},rv=(0,x.defineComponent)({__name:'TopStatusBar',setup(e){const t=(0,x.computed)(()=>Yp.isBrowserFullscreen),{openPanel:n}=yp(),o=()=>{qp.toggleBrowserFullscreen(),qp.toggleWebFullscreen()},a=()=>{n('system','saveLoad')},l=()=>{Ut.isVisible?Ht.hide():Ht.show()},r=(0,x.computed)(()=>t.value?'退出全屏':'浏览器全屏'),i=(0,x.computed)(()=>t.value?'fas fa-compress':'fas fa-expand');return(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',tv,[(0,x.createElementVNode)('div',nv,[(0,x.createVNode)(ev,{'world-type':'main'})]),(0,x.createElementVNode)('div',ov,[(0,x.createElementVNode)('button',{onClick:a,class:'view-toggle-btn',title:'系统管理'},[...t[0]||(t[0]=[(0,x.createElementVNode)('i',{class:'fas fa-cog'},null,-1)])]),(0,x.createElementVNode)('button',{onClick:l,class:'view-toggle-btn',title:'输入指令'},[...t[1]||(t[1]=[(0,x.createElementVNode)('i',{class:'fas fa-keyboard'},null,-1)])]),(0,x.createElementVNode)('button',{onClick:o,class:'view-toggle-btn',title:r.value},[(0,x.createElementVNode)('i',{class:(0,x.normalizeClass)(i.value)},null,2)],8,av)]),(0,x.createElementVNode)('div',lv,[(0,x.createVNode)(ev,{'world-type':'avatar'})])]))}}),iv=(0,me.A)(rv,[['__scopeId','data-v-668c5a00']]),cv='reincarnation-simulator-layout-state-v3-normal',sv='reincarnation-simulator-layout-state-v3-fullscreen';const dv=new class{activePanels=new Map;fullscreenPanels=new Map;isFullscreen=!1;constructor(){this.loadAllLayouts(),fp.on('panelOpened',e=>this.addPanel(e)),fp.on('panelClosed',e=>this.removePanel(e)),fp.on('fullscreenChanged',e=>this.handleFullscreenChange(e))}loadAllLayouts(){try{const e=localStorage.getItem(cv);e&&(this.activePanels=new Map(JSON.parse(e)));const t=localStorage.getItem(sv);t&&(this.fullscreenPanels=new Map(JSON.parse(t)))}catch(e){console.error('Failed to load layout states:',e)}}saveLayoutState(){this.isFullscreen?localStorage.setItem(sv,JSON.stringify(Array.from(this.fullscreenPanels.entries()))):localStorage.setItem(cv,JSON.stringify(Array.from(this.activePanels.entries())))}addPanel(e){const t=this.isFullscreen?this.fullscreenPanels:this.activePanels;t.has(e.panelId)||(t.set(e.panelId,e),this.saveLayoutState())}removePanel(e){const t=this.isFullscreen?this.fullscreenPanels:this.activePanels;t.has(e)&&(t.delete(e),this.saveLayoutState())}handleFullscreenChange(e){this.isFullscreen=e,this.restoreLayout()}restoreLayout(){const e=this.isFullscreen?this.fullscreenPanels:this.activePanels;console.log(`[LayoutService] Broadcasting restore ${this.isFullscreen?'fullscreen':'normal'} layout event...`),fp.emit('restoreLayout',Array.from(e.values()))}setCurrentFullscreenState(e){this.isFullscreen=e}},mv=(0,x.defineComponent)({name:'App',components:{DockManager:kp,EnhancedInputBox:Kt,LoadingIndicator:xp,NpcListModal:Tp,TopStatusBar:iv,WorldTimeDisplay:ev,SideMenuButton:bn,NotificationContainer:kn,ActionPanel:ue,InputHistoryPopup:pn},setup(){const{openPanel:e}=yp(),t=(0,x.computed)(()=>us.state),n=(0,x.computed)(()=>Cn.state),o=(0,x.computed)(()=>Hp.state),a=(0,x.computed)(()=>Yp.isWebFullscreen),l=(0,x.computed)(()=>Ut),r=(0,x.ref)(!1),i=(0,x.ref)(!1),c=(0,x.ref)(!1),s=(0,x.ref)([]),d=(0,x.computed)(()=>s.value.length),m={main:[{id:'character',icon:'人',text:'本体',action:()=>e('mainWorld','character')},{id:'inventory',icon:'物',text:'背包',action:()=>e('mainWorld','inventory')},{id:'skills',icon:'技',text:'技艺',action:()=>e('mainWorld','skills')},{id:'worldDetails',icon:'世',text:'详情',action:()=>e('mainWorld','worldDetails')},{id:'sandbox',icon:'盘',text:'沙盘',action:()=>e('mainWorld','sandbox')}],avatar:[{id:'avatar-character',icon:'身',text:'化身',action:()=>e('avatarWorld','character'),disabled:()=>!yt.value},{id:'avatar-inventory',icon:'囊',text:'背包',action:()=>e('avatarWorld','inventory'),disabled:()=>!yt.value},{id:'avatar-tasks',icon:'命',text:'任务',action:()=>e('avatarWorld','tasks'),disabled:()=>!yt.value},{id:'avatar-worldDetails',icon:'界',text:'详情',action:()=>e('avatarWorld','worldDetails'),disabled:()=>!yt.value},{id:'avatar-sandbox',icon:'盘',text:'沙盘',action:()=>e('avatarWorld','sandbox'),disabled:()=>!yt.value}],common:[{id:'imprints',icon:'印',text:'烙印',action:()=>e('mainWorld','imprints')},{id:'reincarnation',icon:'轮',text:'轮回',action:()=>e('reincarnation','main')},{id:'npcDirectory',icon:'众',text:'名录',action:()=>e('allWorlds','npcDirectory')}]},u=async e=>{console.log('Submitting to AI:',e),await jt.handleAction(e),await Lm.performAutoSave()},p=()=>{s.value=pe.getCommands()};return(0,x.onMounted)(()=>{const e=document.getElementById('app');e?hp.initialize(e):console.error('Dock host element not found.'),jt.loadAllData(),jt.initializeEventListeners(),hp.onAction=u,pe.subscribe(p),p(),fp.on('restoreLayout',e=>{const{openPanel:t}=yp();hp.closeAllPanels(),e.forEach(e=>{try{t(e.world,e.panel,e.props||{})}catch(t){console.error(`Failed to restore panel: ${e.world}-${e.panel}`,t)}})}),dv.setCurrentFullscreenState(Yp.isWebFullscreen),dv.restoreLayout()}),{confirmation:t,detailModal:n,npcModal:o,isWebFullscreen:a,inputModal:l,inputModalActions:Ht,menuOptions:m,handleAction:u,handleSubmit:async e=>{const t=l.value.inputValue;Ht.setLastSubmittedValue(t),await u(e),Ht.hide(),Ht.clearValue()},handleOverlayClick:()=>{l.value.isVisible&&Ht.hide()},store:ct,confirmationService:us,detailModalService:Cn,npcModalService:Hp,isActionPanelVisible:r,toggleActionPanel:()=>{r.value=!r.value},isHistoryVisible:i,toggleHistory:()=>{i.value=!i.value,i.value&&(c.value=!1)},selectHistoryEntry:e=>{Ht.setValue(e),i.value=!1},isQueueVisible:c,toggleCommandQueue:()=>{c.value=!c.value,c.value&&(i.value=!1)},commands:s,commandCount:d,clearCommands:()=>{pe.clearCommands()}}}}),uv=(0,me.A)(mv,[['render',function(e,t,n,o,a,l){const r=(0,x.resolveComponent)('TopStatusBar'),i=(0,x.resolveComponent)('DockManager'),c=(0,x.resolveComponent)('LoadingIndicator'),s=(0,x.resolveComponent)('NpcListModal'),d=(0,x.resolveComponent)('ActionPanel'),m=(0,x.resolveComponent)('EnhancedInputBox'),u=(0,x.resolveComponent)('InputHistoryPopup'),p=(0,x.resolveComponent)('NotificationContainer');return(0,x.openBlock)(),(0,x.createElementBlock)('div',{class:(0,x.normalizeClass)(['guixu-root-container',{'web-fullscreen':e.isWebFullscreen}])},[(0,x.createVNode)(r),(0,x.createElementVNode)('div',L,[(0,x.createVNode)(i)]),(0,x.createCommentVNode)(' Global Confirmation Modal '),e.confirmation.isVisible?((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:0,class:'modal-overlay',onClick:t[2]||(t[2]=(0,x.withModifiers)(t=>e.confirmationService.hide(),['self']))},[(0,x.createElementVNode)('div',M,[(0,x.createElementVNode)('h3',A,(0,x.toDisplayString)(e.confirmation.title),1),(0,x.createElementVNode)('p',O,(0,x.toDisplayString)(e.confirmation.message),1),(0,x.createElementVNode)('div',j,[(0,x.createElementVNode)('button',{onClick:t[0]||(t[0]=t=>e.confirmationService.hide())},'取消'),(0,x.createElementVNode)('button',{class:'primary',onClick:t[1]||(t[1]=t=>e.confirmationService.confirm())},'确认')])])])):(0,x.createCommentVNode)('v-if',!0),(0,x.createCommentVNode)(' Global Detail Modal '),e.detailModal.isVisible?((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:1,class:'modal-overlay',onClick:t[4]||(t[4]=(0,x.withModifiers)(t=>e.detailModalService.hide(),['self']))},[(0,x.createElementVNode)('div',T,[(0,x.createElementVNode)('div',F,[(0,x.createElementVNode)('h3',R,(0,x.toDisplayString)(e.detailModal.title),1),(0,x.createElementVNode)('button',{class:'close-button',onClick:t[3]||(t[3]=t=>e.detailModalService.hide())},'×')]),(0,x.createElementVNode)('div',W,[((0,x.openBlock)(),(0,x.createBlock)((0,x.resolveDynamicComponent)(e.detailModal.component),(0,x.normalizeProps)((0,x.guardReactiveProps)(e.detailModal.props)),null,16))])])])):(0,x.createCommentVNode)('v-if',!0),e.store.isGenerating?((0,x.openBlock)(),(0,x.createBlock)(c,{key:2,error:e.store.generationError},null,8,['error'])):(0,x.createCommentVNode)('v-if',!0),(0,x.createCommentVNode)(' Global NPC List Modal '),e.npcModal.isVisible?((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:3,class:'modal-overlay',onClick:t[6]||(t[6]=(0,x.withModifiers)(t=>e.npcModalService.hide(),['self']))},[(0,x.createElementVNode)('div',P,[(0,x.createElementVNode)('div',U,[(0,x.createElementVNode)('h3',H,(0,x.toDisplayString)(e.npcModal.title),1),(0,x.createElementVNode)('button',{class:'close-button',onClick:t[5]||(t[5]=t=>e.npcModalService.hide())},'×')]),(0,x.createElementVNode)('div',G,[(0,x.createVNode)(s,(0,x.normalizeProps)((0,x.guardReactiveProps)(e.npcModal.props)),null,16)])])])):(0,x.createCommentVNode)('v-if',!0),(0,x.createCommentVNode)(' Global Input Modal '),e.inputModal.isVisible?((0,x.openBlock)(),(0,x.createElementBlock)('div',J,[(0,x.createElementVNode)('div',Y,[(0,x.createElementVNode)('div',q,[e.isActionPanelVisible?((0,x.openBlock)(),(0,x.createBlock)(d,{key:0,'command-count':e.commandCount,'main-options':e.menuOptions.main,'avatar-options':e.menuOptions.avatar,'common-options':e.menuOptions.common,onToggleHistory:e.toggleHistory,onToggleCommands:e.toggleCommandQueue},null,8,['command-count','main-options','avatar-options','common-options','onToggleHistory','onToggleCommands'])):(0,x.createCommentVNode)('v-if',!0),(0,x.createElementVNode)('div',K,[(0,x.createVNode)(m,{onSubmitAction:e.handleSubmit,onToggleActionPanel:e.toggleActionPanel},null,8,['onSubmitAction','onToggleActionPanel'])]),e.isHistoryVisible?((0,x.openBlock)(),(0,x.createBlock)(u,{key:1,onClose:e.toggleHistory,onSelectEntry:e.selectHistoryEntry},null,8,['onClose','onSelectEntry'])):(0,x.createCommentVNode)('v-if',!0),e.isQueueVisible?((0,x.openBlock)(),(0,x.createElementBlock)('div',Q,[(0,x.createElementVNode)('div',X,[t[9]||(t[9]=(0,x.createElementVNode)('h3',null,'指令队列',-1)),(0,x.createElementVNode)('button',{class:'close-popup-button',onClick:t[7]||(t[7]=(...t)=>e.toggleCommandQueue&&e.toggleCommandQueue(...t))},'×')]),(0,x.createElementVNode)('div',Z,[e.commandCount>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',ee,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(e.commands,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:t,class:'command-item'},(0,x.toDisplayString)(e),1))),128))])):((0,x.openBlock)(),(0,x.createElementBlock)('div',te,'暂无待执行指令。'))]),e.commandCount>0?((0,x.openBlock)(),(0,x.createElementBlock)('div',ne,[(0,x.createElementVNode)('button',{class:'clear-button',onClick:t[8]||(t[8]=(...t)=>e.clearCommands&&e.clearCommands(...t))},'清空所有指令')])):(0,x.createCommentVNode)('v-if',!0)])):(0,x.createCommentVNode)('v-if',!0)])])])):(0,x.createCommentVNode)('v-if',!0),(0,x.createVNode)(p)],2)}]]),pv={class:'attribute-item'},vv={class:'attribute-name'},gv={class:'attribute-value'},fv=(0,x.defineComponent)({__name:'AttributeDisplay',props:{name:{},value:{}},setup:e=>(t,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',pv,[(0,x.createElementVNode)('span',vv,(0,x.toDisplayString)(e.name),1),(0,x.createElementVNode)('span',gv,(0,x.toDisplayString)(e.value),1)]))}),hv=(0,me.A)(fv,[['__scopeId','data-v-490ee3ff']]),yv={class:'character-panel'},kv={class:'panel-section'},Ev={id:'base-attributes-list',class:'attributes-list'},Nv={class:'panel-section'},bv={id:'secondary-attributes-list',class:'attributes-list'},Vv={class:'panel-section'},Sv={id:'grades-list',class:'attributes-list'},Bv={class:'panel-section'},wv={id:'skills-list',class:'attributes-list'},Cv={class:'panel-section'},Dv={id:'talents-list',class:'attributes-list'},xv={class:'panel-section'},Iv={id:'schedule-list',class:'attributes-list'},$v={class:'panel-section'},_v={id:'relations-list',class:'attributes-list'},zv={class:'attribute-name'},Lv={class:'attribute-value'},Mv=(0,x.defineComponent)({__name:'CharacterView',setup(e){const{character:t,secondaryAttributes:n,todayCourses:o,getBaseAttributes:a,getSubjects:l,getSkills:r,getTalents:i,getRelationships:c}=C.getters,s=a(t),d=l(t),m=r(t),u=C.getters.getTalents(t),p=c(t);return(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',yv,[(0,x.createElementVNode)('div',kv,[t[0]||(t[0]=(0,x.createElementVNode)('div',{class:'section-title'},'基础属性',-1)),(0,x.createElementVNode)('div',Ev,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)((0,x.unref)(s).value,(e,t)=>((0,x.openBlock)(),(0,x.createBlock)(hv,{key:t,name:String(t),value:`${e.值} / ${e.软上限}`},null,8,['name','value']))),128))])]),(0,x.createElementVNode)('div',Nv,[t[1]||(t[1]=(0,x.createElementVNode)('div',{class:'section-title'},'二级属性',-1)),(0,x.createElementVNode)('div',bv,[(0,x.createVNode)(hv,{name:'财力',value:`¥ ${(0,x.unref)(n).财力}`},null,8,['value']),(0,x.createVNode)(hv,{name:'声望',value:(0,x.unref)(n).声望},null,8,['value'])])]),(0,x.createElementVNode)('div',Vv,[t[2]||(t[2]=(0,x.createElementVNode)('div',{class:'section-title'},'各科成绩',-1)),(0,x.createElementVNode)('div',Sv,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)((0,x.unref)(d).value,(e,t)=>((0,x.openBlock)(),(0,x.createBlock)(hv,{key:t,name:String(t),value:`${e.知识水平} (${e.最近一次分数})`},null,8,['name','value']))),128))])]),(0,x.createElementVNode)('div',Bv,[t[3]||(t[3]=(0,x.createElementVNode)('div',{class:'section-title'},'技能与知识',-1)),(0,x.createElementVNode)('div',wv,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)((0,x.unref)(m).value,(e,t)=>((0,x.openBlock)(),(0,x.createBlock)(hv,{key:t,name:String(t),value:`Lv.${e.等级} / ${e.软上限}`},null,8,['name','value']))),128))])]),(0,x.createElementVNode)('div',Cv,[t[4]||(t[4]=(0,x.createElementVNode)('div',{class:'section-title'},'天赋与特长',-1)),(0,x.createElementVNode)('div',Dv,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)((0,x.unref)(u),(e,t)=>((0,x.openBlock)(),(0,x.createBlock)(hv,{key:t,name:e.名称,value:e.描述},null,8,['name','value']))),128))])]),(0,x.createElementVNode)('div',xv,[t[5]||(t[5]=(0,x.createElementVNode)('div',{class:'section-title'},'今日课程',-1)),(0,x.createElementVNode)('div',Iv,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)((0,x.unref)(o),(e,t)=>((0,x.openBlock)(),(0,x.createBlock)(hv,{key:t,name:e.标题,value:e.时间段},null,8,['name','value']))),128))])]),(0,x.createElementVNode)('div',$v,[t[6]||(t[6]=(0,x.createElementVNode)('div',{class:'section-title'},'人际关系',-1)),(0,x.createElementVNode)('div',_v,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)((0,x.unref)(p).value,(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:t,class:'attribute-item'},[(0,x.createElementVNode)('span',zv,(0,x.toDisplayString)(t),1),(0,x.createElementVNode)('span',Lv,' 亲密:'+(0,x.toDisplayString)(e.亲密)+' 信赖:'+(0,x.toDisplayString)(e.信赖),1)]))),128))])])]))}}),Av=(0,me.A)(Mv,[['__scopeId','data-v-3e931026']]),Ov={class:'inventory-panel'},jv={class:'panel-section'},Tv={class:'inventory-grid'},Fv={class:'item-name'},Rv={class:'item-quantity'},Wv=(0,x.defineComponent)({__name:'InventoryView',setup(e){const t=(0,x.ref)([]);return(0,x.onMounted)(()=>{t.value=[{id:'food001',name:'学生A套餐',quantity:1},{id:'snack002',name:'Pocky巧克力棒',quantity:3},{id:'study001',name:'《高等数学辅导》',quantity:1}]}),(e,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Ov,[(0,x.createElementVNode)('div',jv,[n[0]||(n[0]=(0,x.createElementVNode)('div',{class:'section-title'},'我的背包',-1)),(0,x.createElementVNode)('div',Tv,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(t.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:e.id,class:'inventory-item'},[(0,x.createElementVNode)('div',Fv,(0,x.toDisplayString)(e.name),1),(0,x.createElementVNode)('div',Rv,'x'+(0,x.toDisplayString)(e.quantity),1)]))),128))])])]))}}),Pv=(0,me.A)(Wv,[['__scopeId','data-v-fbf176e0']]),Uv={class:'main-content-view'},Hv=['innerHTML'],Gv=['innerHTML'],Jv=(0,x.defineComponent)({__name:'MainContentView',emits:['submit-action'],setup(e,{emit:t}){const n=t,o=(0,x.reactive)({visible:!1,content:'',style:{top:'0px',left:'0px'}}),a=(0,x.computed)(()=>{let e=Ct.value;return e=e.replace(/<item name="([^"]+)">(.+?)<\/item>/g,(e,t,n)=>`<span class="highlighted-item" data-type="item" data-name="${t}">${n}</span>`),e=e.replace(/<npc name="([^"]+)">(.+?)<\/npc>/g,(e,t,n)=>`<span class="highlighted-npc" data-type="npc" data-name="${t}">${n}</span>`),e}),l=e=>{const t=e.target,n=t.dataset.type,a=t.dataset.name;if(!n||!a)return;let l;'item'===n?l=(e=>{const t=ct.worldState?.数据库;if(!t)return null;for(const n in t){const o=t[n];if(o)for(const t in o){const n=o[t];if(n.名称===e)return n}}return null})(a):'npc'===n&&(l=(e=>{const t=ct.worldState?.角色;if(!t)return null;for(const n in t){if('$meta'===n||n===ct.userId)continue;const o=t[n];if(o&&o.姓名&&o.姓名===e)return o}return null})(a)),l&&(o.content=i(l,n),o.style.top=`${e.clientY+15}px`,o.style.left=`${e.clientX+15}px`,o.visible=!0)},r=()=>{o.visible=!1},i=(e,t)=>'item'===t?`\n      <div class="tooltip-title">${e.名称} [${e.类型}]</div>\n      <div class="tooltip-description">${e.描述}</div>\n      <div class="tooltip-level">能级: ${e.能级}</div>\n    `:'npc'===t?`\n      <div class="tooltip-title">${e.姓名}</div>\n      <div class="tooltip-description">${e.外观描述}</div>\n      <div class="tooltip-identity">身份: ${e.身份.join(', ')}</div>\n    `:'',c=e=>{n('submit-action',e)};return(e,t)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',Uv,[(0,x.createElementVNode)('div',{class:'narrative-container',innerHTML:a.value,onMouseover:l,onMouseout:r},null,40,Hv),(0,x.createVNode)(Kt,{placeholder:'请输入行动...',onSubmitAction:c}),(0,x.createCommentVNode)(' Tooltip '),o.visible?((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:0,class:'narrative-tooltip',style:(0,x.normalizeStyle)(o.style),innerHTML:o.content},null,12,Gv)):(0,x.createCommentVNode)('v-if',!0)]))}}),Yv=(0,me.A)(Jv,[['__scopeId','data-v-2caac21f']]),qv={class:'npc-list-panel'},Kv={class:'panel-section'},Qv={class:'npc-list'},Xv={class:'npc-name'},Zv={class:'npc-relationship'},eg=(0,x.defineComponent)({__name:'NpcListView',setup(e){const t=(0,x.ref)([]);return(0,x.onMounted)(()=>{t.value=[{id:'yukinoshita_yukino',name:'雪之下雪乃',favorability:55},{id:'yuigahama_yui',name:'由比滨结衣',favorability:60}]}),(e,n)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',qv,[(0,x.createElementVNode)('div',Kv,[n[0]||(n[0]=(0,x.createElementVNode)('div',{class:'section-title'},'NPC 列表',-1)),(0,x.createElementVNode)('div',Qv,[((0,x.openBlock)(!0),(0,x.createElementBlock)(x.Fragment,null,(0,x.renderList)(t.value,e=>((0,x.openBlock)(),(0,x.createElementBlock)('div',{key:e.id,class:'npc-item'},[(0,x.createElementVNode)('div',Xv,(0,x.toDisplayString)(e.name),1),(0,x.createElementVNode)('div',Zv,'好感度: '+(0,x.toDisplayString)(e.favorability),1)]))),128))])])]))}}),tg=(0,me.A)(eg,[['__scopeId','data-v-cbe78d66']]),ng={class:'world-state-panel'},og={class:'panel-section'},ag={class:'state-list'},lg=(0,x.defineComponent)({__name:'WorldStateView',setup(e){const t=(0,x.ref)(null),n=(0,x.computed)(()=>{if(!t.value)return'';const e=t.value.当前时间;return`${e.年}-${e.月}-${e.日} ${e.时}:${e.分} (${e.星期})`});return(0,x.onMounted)(()=>{t.value={当前时间:{年:2024,月:9,日:1,时:8,分:0,星期:'周一'},季节:'秋',天气:'晴',温度:22,经济指数:100,流行趋势:'复古Y2K穿搭'}}),(e,o)=>((0,x.openBlock)(),(0,x.createElementBlock)('div',ng,[(0,x.createElementVNode)('div',og,[o[0]||(o[0]=(0,x.createElementVNode)('div',{class:'section-title'},'世界状态',-1)),(0,x.createElementVNode)('div',ag,[(0,x.createVNode)(hv,{name:'当前时间',value:n.value},null,8,['value']),(0,x.createVNode)(hv,{name:'季节',value:t.value?.季节||'N/A'},null,8,['value']),(0,x.createVNode)(hv,{name:'天气',value:t.value?.天气||'N/A'},null,8,['value']),(0,x.createVNode)(hv,{name:'温度',value:`${t.value?.温度||'N/A'}°C`},null,8,['value']),(0,x.createVNode)(hv,{name:'经济指数',value:t.value?.经济指数||0},null,8,['value']),(0,x.createVNode)(hv,{name:'流行趋势',value:t.value?.流行趋势||'N/A'},null,8,['value'])])])]))}}),rg=[{path:'/',component:Yv},{path:'/character',component:Av},{path:'/npc-list',component:tg},{path:'/inventory',component:Pv},{path:'/world-state',component:(0,me.A)(lg,[['__scopeId','data-v-1b7ec95a']])}],ig=(0,I.createRouter)({history:(0,I.createMemoryHistory)(),routes:rg});ig.replace('/'),$(()=>{(0,x.createApp)(uv).use(ig).mount('#app')}),async function(){Dm.register('saveLoadService',Lm),Dm.register('inputModalState',Ut),Dm.register('inputModalActions',Ht),Dm.register('store',ct),Dm.register('actions',jt),await Bn.initializeWorldAndLocationData(),ct.worldState||await new Promise(e=>{const t=(0,x.watch)(()=>ct.worldState,n=>{n&&(t(),e(!0))})}),await ze.buildIndex(ct.worldState)}().then(()=>{console.log('All services initialized.')});
//# sourceMappingURL=index.js.map</script><style>.action-panel[data-v-fa88c5d8]{display:flex;flex-direction:column;gap:8px;padding:16px;background-color:rgba(10,15,30,.7);border-radius:5px;border:1px solid rgba(212,175,55,.3);box-shadow:0 -4px 15px rgba(0,0,0,.2)}.button-row[data-v-fa88c5d8]{display:flex;justify-content:center;gap:16px}.action-button[data-v-fa88c5d8]{background:rgba(0,0,0,0);border:1px solid rgba(212,175,55,.5);color:#f0e6d2;padding:8px 24px;border-radius:3px;font-family:"Siyuan Song","Source Han Serif SC",serif;font-size:14px;cursor:pointer;transition:all .2s ease-in-out}.action-button[data-v-fa88c5d8]:hover{background-color:rgba(212,175,55,.2);border-color:#d4af37;color:#e0e0e0;box-shadow:0 0 8px rgba(212,175,55,.5)}.action-button.primary[data-v-fa88c5d8]{background-color:rgba(212,175,55,.8);border-color:#f0e6d2;color:#0a0f1e;font-weight:bold}.action-button.primary[data-v-fa88c5d8]:hover{background-color:#f0e6d2;box-shadow:0 0 12px rgba(240,230,210,.7)}
.input-wrapper[data-v-1eccedfd]{display:flex;align-items:center;padding:8px;gap:8px}textarea[data-v-1eccedfd]{flex-grow:1}.action-button[data-v-1eccedfd]{height:40px;min-width:40px;padding:0 10px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:1px solid rgba(212,175,55,.5);color:#f0e6d2;border-radius:3px;font-family:"Siyuan Song","Source Han Serif SC",serif;font-size:14px;cursor:pointer;transition:all .2s ease-in-out;white-space:nowrap}.action-button.activator[data-v-1eccedfd]{width:40px;height:40px;padding:0;display:flex;align-items:center;justify-content:center;font-family:"Siyuan Song","Source Han Serif SC",serif;font-size:14px;height:40px;background-color:rgba(212,175,55,.8);border-color:#f0e6d2;color:#0a0f1e;font-weight:bold}.action-button.activator[data-v-1eccedfd]:hover{background-color:#f0e6d2;box-shadow:0 0 12px rgba(240,230,210,.7)}.action-button[data-v-1eccedfd]:hover{background-color:rgba(212,175,55,.2);border-color:#d4af37;color:#e0e0e0;box-shadow:0 0 8px rgba(212,175,55,.5)}.action-button.primary[data-v-1eccedfd]{background-color:rgba(212,175,55,.8);border-color:#f0e6d2;color:#0a0f1e;font-weight:bold}.action-button.primary[data-v-1eccedfd]:hover{background-color:#f0e6d2;box-shadow:0 0 12px rgba(240,230,210,.7)}

.notification{position:relative;background-color:rgba(22,33,44,.5);border:1px solid rgba(212,175,55,.4);border-radius:5px;padding:8px 16px;margin-bottom:16px;width:280px;box-shadow:0 6px 25px rgba(10,15,30,.5);transition:all .4s ease-in-out}.notification__content{position:relative;z-index:1}.notification__title{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;font-size:16px;margin:0 0 4px 0}.notification__message{color:#e0e0e0;font-size:14px;margin:0;line-height:1.5}.notification__arrow{position:absolute;top:50%;right:-10px;width:0;height:0;border-top:10px solid rgba(0,0,0,0);border-bottom:10px solid rgba(0,0,0,0);border-left:10px solid rgba(212,175,55,.4);transform:translateY(-50%)}.notification__arrow::before{content:"";position:absolute;top:-9px;left:-11px;width:0;height:0;border-top:9px solid rgba(0,0,0,0);border-bottom:9px solid rgba(0,0,0,0);border-left:9px solid #16212c}.notification--success{border-left-color:#3a8f9d}.notification--info{border-left-color:#8a5db5}.notification--warning{border-left-color:#d4af37}.notification--error{border-left-color:#c74343}.notification-fade-enter-active,.notification-fade-leave-active{transition:all .5s cubic-bezier(0.55,0,0.1,1)}.notification-fade-enter-from,.notification-fade-leave-to{opacity:0;transform:scale(0.5) translateX(100%)}
.notification-container{position:fixed;top:80px;right:20px;z-index:100000;display:flex;flex-direction:column;align-items:flex-end}
.side-menu-button[data-v-5fd70906]{position:absolute;top:50%;transform:translateY(-50%);width:50px;height:50px;background-color:rgba(22,33,44,.85);border:1px solid rgba(212,175,55,.5);border-radius:50%;cursor:pointer;padding:0;z-index:10;display:flex;justify-content:center;align-items:center;transition:all .3s ease}.side-menu-button.left[data-v-5fd70906]{left:0}.side-menu-button.right[data-v-5fd70906]{right:0}.side-menu-button[data-v-5fd70906]:hover{background-color:#16212c;border-color:#d4af37;box-shadow:0 0 12px rgba(212,175,55,.6)}.side-menu-button .icon[data-v-5fd70906]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:1.8rem;color:#f0e6d2;text-shadow:0 0 8px rgba(240,230,210,.5);transition:all .3s ease}.side-menu-button:hover .icon[data-v-5fd70906]{color:#e0e0e0;transform:scale(1.1);text-shadow:0 0 15px #f0e6d2}
.npc-info-card[data-v-40dc9d07]{padding:16px;min-width:350px}.npc-info-card h4[data-v-40dc9d07]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px;text-align:center;margin-top:0;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid rgba(212,175,55,.2)}.npc-info-card .info-grid[data-v-40dc9d07]{display:grid;grid-template-columns:repeat(2,1fr);gap:24px}.npc-info-card .info-item[data-v-40dc9d07]{display:flex;flex-direction:column;gap:4px}.npc-info-card .info-item strong[data-v-40dc9d07]{font-family:"Siyuan Song","Source Han Serif SC",serif;color:#f0e6d2;font-size:12px;text-transform:uppercase;letter-spacing:1px;opacity:.7}.npc-info-card .info-item span[data-v-40dc9d07]{font-size:14px;color:#e0e0e0;line-height:1.6}.npc-info-card .info-item.full-width[data-v-40dc9d07]{grid-column:1/-1}
.location-info-card[data-v-d56cb894]{padding:16px;min-width:300px}.location-info-card h4[data-v-d56cb894]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:18px;margin-top:0;margin-bottom:24px;border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:16px}.location-info-card .info-grid[data-v-d56cb894]{display:grid;grid-template-columns:repeat(2,1fr);gap:24px}.location-info-card .info-item[data-v-d56cb894]{display:flex;flex-direction:column;gap:4px}.location-info-card .info-item strong[data-v-d56cb894]{font-family:"Siyuan Song","Source Han Serif SC",serif;color:#f0e6d2;font-size:12px;text-transform:uppercase;letter-spacing:1px;opacity:.7}.location-info-card .info-item span[data-v-d56cb894]{font-size:14px;color:#e0e0e0;line-height:1.6}.location-info-card .info-item.full-width[data-v-d56cb894]{grid-column:1/-1}.loading-placeholder[data-v-d56cb894]{padding:32px;color:#a0a0a0;text-align:center}
.database-item-card[data-v-7d2511ac]{padding:16px;min-width:350px}.database-item-card .info-grid[data-v-7d2511ac]{display:grid;grid-template-columns:repeat(2,1fr);gap:24px}.database-item-card .info-item[data-v-7d2511ac]{display:flex;flex-direction:column;gap:4px}.database-item-card .info-item strong[data-v-7d2511ac]{font-family:"Siyuan Song","Source Han Serif SC",serif;color:#f0e6d2;font-size:12px;text-transform:uppercase;letter-spacing:1px;opacity:.7}.database-item-card .info-item span[data-v-7d2511ac]{font-size:14px;color:#e0e0e0;line-height:1.6;white-space:pre-wrap}.database-item-card .info-item.full-width[data-v-7d2511ac]{grid-column:1/-1}
.game-text-container[data-v-9156fca4]{font-size:15px;line-height:1.8;color:#000;white-space:pre-wrap}.game-text-container .text-dialogue[data-v-9156fca4]{color:#d4af37}.game-text-container .text-psychology[data-v-9156fca4]{color:#8a5db5;font-style:italic}.game-text-container .text-scenery[data-v-9156fca4]{color:#3a8f9d}.game-text-container .text-system-highlight[data-v-9156fca4]{color:#d4af37;font-weight:bold}.game-text-container[data-v-9156fca4] .npc-name{font-family:"ZCOOL KuaiLe","篆书",cursive;cursor:pointer;text-decoration:underline;text-decoration-color:hsla(0,0%,100%,.5);transition:all .2s ease;text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000}.game-text-container[data-v-9156fca4] .npc-name:hover{background-color:hsla(0,0%,100%,.15);text-decoration-color:#fff}.game-text-container[data-v-9156fca4] .npc-name.npc-hostile-intense{color:#ff4d4d}.game-text-container[data-v-9156fca4] .npc-name.npc-hostile{color:#ff8c66}.game-text-container[data-v-9156fca4] .npc-name.npc-unfriendly{color:gold}.game-text-container[data-v-9156fca4] .npc-name.npc-neutral{color:#fff}.game-text-container[data-v-9156fca4] .npc-name.npc-friendly{color:#90ee90}.game-text-container[data-v-9156fca4] .npc-name.npc-devoted{color:#87cefa}.game-text-container[data-v-9156fca4] .npc-name.npc-fanatical{color:hotpink}.game-text-container[data-v-9156fca4] .npc-name.npc-unknown{color:#9e9e9e}.game-text-container[data-v-9156fca4] .location-name{color:#80b9ea;cursor:pointer;text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;text-decoration:underline;text-decoration-color:rgba(128,222,234,.5)}.game-text-container[data-v-9156fca4] .location-name:hover{background-color:rgba(128,151,234,.15);text-decoration-color:#80b5ea}.game-text-container[data-v-9156fca4] .database-item-name{color:#f8cbad;cursor:pointer;text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;text-decoration:underline;text-decoration-color:rgba(248,203,173,.5)}.game-text-container[data-v-9156fca4] .database-item-name:hover{background-color:rgba(248,203,173,.15);text-decoration-color:#f8cbad}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}html{font-family:"Noto Serif SC",serif;font-size:14px;line-height:1.7;color:#0a0f1e}body{min-height:100vh;overflow:hidden}h1,h2,h3,h4,h5,h6{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#d4af37;font-weight:normal;margin-bottom:16px}h1{font-size:24px}h2{font-size:20px}h3{font-size:18px}a{color:#3a8f9d;text-decoration:none;transition:color .3s ease}a:hover{color:rgb(95.4441860465,181.8279069767,196.0558139535);text-decoration:underline}button,input,textarea,select{font-family:inherit;font-size:inherit;background-color:rgba(10,15,30,.5);border:1px solid rgba(212,175,55,.3);color:#e0e0e0;padding:8px 16px;border-radius:5px;transition:all .3s ease}button:focus,input:focus,textarea:focus,select:focus{outline:none;border-color:#d4af37;box-shadow:0 0 5px rgba(212,175,55,.5)}button:disabled,input:disabled,textarea:disabled,select:disabled{opacity:.5;cursor:not-allowed}button{cursor:pointer;background-color:rgba(58,143,157,.2);border-color:#3a8f9d}button:hover{background-color:rgba(58,143,157,.4);border-color:rgb(76.823255814,173.288372093,189.176744186)}button.primary{background-color:rgba(212,175,55,.8);border-color:#d4af37;color:#0a0f1e;font-weight:bold}button.primary:hover{background-color:#d4af37;box-shadow:0 0 8px rgba(212,175,55,.7)}*::-webkit-scrollbar{width:6px;height:6px}*::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}*::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}*::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}#toast-container>.toast{border:1px solid #d4af37;color:#0a0f1e;text-shadow:none;font-family:"Siyuan Song","Source Han Serif SC",serif;font-weight:bold;border-radius:5px;box-shadow:0 5px 20px rgba(212,175,55,.5);opacity:.9}#toast-container>.toast .toast-title{font-family:"ZCOOL KuaiLe","篆书",cursive;font-weight:bold}#toast-container>.toast .toast-message{font-weight:normal}#toast-container>.toast.toast-info{background-color:rgba(58,143,157,.8);border-color:#3a8f9d;color:#fff}#toast-container>.toast.toast-error{background-color:rgba(199,67,67,.8);border-color:#c74343;color:#fff}#toast-container>.toast.toast-success{background-color:rgba(92,184,92,.8);border-color:#5cb85c;color:#fff}@keyframes border-flow{0%{border-image-source:linear-gradient(to right,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}25%{border-image-source:linear-gradient(to bottom,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}50%{border-image-source:linear-gradient(to left,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}75%{border-image-source:linear-gradient(to top,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}100%{border-image-source:linear-gradient(to right,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}}.panel-base{border-radius:5px;box-shadow:0 8px 35px rgba(10,15,30,.5);color:#000;border-style:solid;border-width:2px;border-image-slice:1;animation:border-flow 8s infinite linear}.panel-titlebar{background-color:rgba(10,15,30,.5);border-bottom:1px solid rgba(212,175,55,.3);height:40px;font-family:"ZCOOL KuaiLe","篆书",cursive;display:flex;align-items:center;padding:0 16px}.panel-titlebar-text{color:#f0e6d2;font-size:18px;font-weight:normal;padding:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.panel-titlebar-button-close{color:#a0a0a0;font-size:16px}.panel-titlebar-button-close::after{content:"×";padding:0}.panel-titlebar-button-close:hover{color:#c74343;transform:scale(1.2)}.panel-titlebar-button-pin{color:#a0a0a0;font-size:14px;cursor:pointer;margin-right:16px;transition:all .3s ease}.panel-titlebar-button-pin.locked{color:#3a8f9d;transform:rotate(45deg)}.panel-titlebar-button-pin:hover{color:#3a8f9d;transform:scale(1.2)}.panel-content{background-color:rgba(0,0,0,0)}.panel-content::-webkit-scrollbar{width:6px;height:6px}.panel-content::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.panel-content::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.panel-content::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.dockspan-tab-host{background-color:rgba(0,0,0,0)}.dockspan-tab-handle-list-container{background-color:rgba(10,15,30,.3);border-bottom:1px solid rgba(212,175,55,.2)}.dockspan-tab-handle{background-color:rgba(0,0,0,0);color:#a0a0a0;border-right:1px solid rgba(212,175,55,.2);padding:16px;transition:all .3s ease}.dockspan-tab-handle:hover{background-color:rgba(58,143,157,.2);color:#3a8f9d}.dockspan-tab-handle-selected{background-color:rgba(212,175,55,.2);color:#f0e6d2;border-bottom:2px solid #d4af37}.dockspan-tab-handle-close-button{color:#a0a0a0}.dockspan-tab-handle-close-button:hover{color:#c74343}.splitbar-horizontal,.splitbar-vertical{background-color:rgba(212,175,55,.3);transition:background-color .3s ease}.splitbar-horizontal:hover,.splitbar-vertical:hover{background-color:#d4af37}.dock-wheel-panel-preview,.panel-grayout{display:none !important}.game-container{display:grid;grid-template-columns:1fr;width:100%;height:100%;overflow:hidden;gap:1px}.character-panel,.interaction-panel{background:#f5f1e9;padding:15px;overflow-y:auto;box-shadow:inset 0 0 10px rgba(58,63,75,.03)}.character-panel{border-right:1px solid #eae6dd}.interaction-panel{border-left:1px solid #eae6dd}.main-content{padding:25px;overflow-y:auto;background:#fdfbf6;position:relative}#tablet-trigger{position:fixed;right:0;top:45%;transform:translateY(-50%);width:32px;height:80px;background-color:#fff;border:1px solid #eae6dd;border-right:none;border-radius:8px 0 0 8px;cursor:pointer;transition:all .3s ease;font-size:24px;display:flex;align-items:center;justify-content:center;color:#6c757d;z-index:1001;box-shadow:-2px 0 8px rgba(58,63,75,.08)}#tablet-trigger:hover{background-color:#f5f1e9;color:#4169e1}#tablet-container{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;background-color:rgba(58,63,75,.4);backdrop-filter:blur(5px);opacity:0;visibility:hidden;transform:scale(1.1);transition:opacity .3s ease,visibility .3s ease,transform .3s ease;z-index:200}#tablet-container.is-visible{opacity:1;visibility:visible;transform:scale(1)}#tablet-container .tablet-case{width:90%;max-width:380px;height:90vh;max-height:800px;background-color:#1a1a1a;border-radius:40px;padding:12px;box-shadow:0 20px 50px rgba(0,0,0,.3),inset 0 0 15px hsla(0,0%,100%,.1);display:flex;flex-direction:column}#tablet-container .phone-screen{width:100%;height:100%;background:linear-gradient(160deg,#f87171 0%,#a855f7 100%);border-radius:28px;overflow:hidden;position:relative;display:flex;flex-direction:column;color:#fff}#tablet-container .phone-content-area{flex-grow:1;position:relative;display:flex;flex-direction:column}#tablet-container .phone-desktop{display:flex;flex-direction:column;height:100%;padding:20px;box-sizing:border-box}#tablet-container .desktop-header{flex-shrink:0;padding:40px 0;text-align:center}#tablet-container .desktop-header .time-display #desktop-time{font-size:72px;font-weight:300;letter-spacing:1px;display:block;line-height:1}#tablet-container .desktop-header .time-display #desktop-date{font-size:16px;font-weight:400;opacity:.9}#tablet-container .app-grid{flex-grow:1;display:grid;grid-template-columns:repeat(4,1fr);gap:20px;align-content:flex-start}#tablet-container .desktop-dock-indicator{flex-shrink:0;display:flex;justify-content:center;padding:15px 0}#tablet-container .desktop-dock-indicator span{width:8px;height:8px;background-color:hsla(0,0%,100%,.5);border-radius:50%}#tablet-container .app-view-container{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background-color:#fdfbf6;z-index:10;flex-direction:column;color:#3a3f4b}#tablet-container .app-view-container.active{display:flex}#tablet-container .phone-nav-bar{height:50px;flex-shrink:0;display:flex;justify-content:space-around;align-items:center;padding:0 20px;background:rgba(0,0,0,.1)}#tablet-container .phone-nav-bar .nav-btn{background:none;border:none;color:#fff;opacity:.8;cursor:pointer;padding:5px}#tablet-container .phone-nav-bar .nav-btn svg{width:20px;height:20px}#tablet-container .app-icon{display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;text-decoration:none}#tablet-container .app-icon .app-icon-visual{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;box-shadow:0 5px 15px rgba(0,0,0,.15);transition:transform .2s ease}#tablet-container .app-icon .app-icon-visual svg{width:28px;height:28px}#tablet-container .app-icon .app-icon-name{font-size:12px;color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.3)}#tablet-container .app-icon:hover .app-icon-visual{transform:scale(1.1)}#tablet-container .app-icon[data-app-id=tianhuachat] .app-icon-visual{background-color:#3b82f6}#tablet-container .app-icon[data-app-id=campus-pass] .app-icon-visual{background-color:#14b8a6}#tablet-container .app-icon[data-app-id=schedule] .app-icon-visual{background-color:#8b5cf6}#tablet-container .app-icon[data-app-id=health] .app-icon-visual{background-color:#ef4444}#tablet-container .app-icon[data-app-id=forum] .app-icon-visual{background-color:#0ea5e9}#tablet-container .app-icon[data-app-id=shopping] .app-icon-visual{background-color:#f97316}#tablet-container .app-icon[data-app-id=inventory] .app-icon-visual{background-color:#ec4899}#tablet-container .app-icon[data-app-id=map] .app-icon-visual{background-color:#22c55e}#tablet-container .app-icon[data-app-id=settings] .app-icon-visual{background-color:#6b7280}#tablet-container .app-icon[data-app-id=saveload] .app-icon-visual{background-color:#f39c12}#tablet-container .app-icon[data-app-id=diary] .app-icon-visual{background-color:#9b59b6}#tablet-container .app-icon[data-app-id=character-annals] .app-icon-visual{background-color:#34495e}#tablet-container .app-icon[data-app-id=calendar] .app-icon-visual{background-color:#1abc9c}#tablet-container .app-icon[data-app-id=mall] .app-icon-visual{background-color:#e67e22}.phone-status-bar{display:flex;justify-content:space-between;align-items:center;padding:4px 12px;background-color:rgba(0,0,0,.1);color:#fff;font-size:12px;position:absolute;top:0;left:0;right:0;z-index:100}.phone-status-bar .status-left,.phone-status-bar .status-right{display:flex;align-items:center;gap:6px}.phone-status-bar .status-center{font-weight:500}.phone-status-bar .battery-icon{width:22px;height:11px;border:1px solid #fff;border-radius:3px;position:relative;padding:1px}.phone-status-bar .battery-icon::after{content:"";position:absolute;right:-3px;top:2px;width:2px;height:5px;background-color:#fff;border-top-right-radius:1px;border-bottom-right-radius:1px}.phone-status-bar .battery-icon .battery-fill{height:100%;background-color:#fff;border-radius:1px;transition:width .3s ease}.phone-content-area{padding-top:24px}.panel-base{pointer-events:none}.panel-base:focus{outline:0}.panel-titlebar{width:100%;overflow:hidden;height:25px;pointer-events:auto}.panel-titlebar-icon{height:16px;margin-right:3px}.panel-titlebar-text{float:left;padding-left:10px;padding-top:5px;text-overflow:ellipsis;overflow:hidden;width:calc(100% - 30px);white-space:nowrap}.panel-titlebar-text>span{vertical-align:top}.panel-titlebar-button-close{display:flex;justify-content:flex-end;align-items:center;width:25px;height:25px;position:absolute;right:0;top:0}.panel-titlebar-button-close::after{float:right;cursor:pointer;padding-right:8px;content:"x";font-weight:normal;font-family:Verdana,Geneva,Tahoma,sans-serif;display:flex;height:100%;align-items:center}.panel-titlebar-button-close:hover{color:#000}.panel-content{width:100%;overflow:hidden}.panel-content-wrapper{width:100%;height:100%;position:relative}.panel-grayout{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:10;pointer-events:all}.panel-has-changes{font-style:italic}.panel-has-changes::before{content:"* "}.dialog-floating{position:absolute}.dialog-floating:focus{outline:0}.resize-handle{position:absolute;width:6px;height:6px;z-index:10}.resize-handle-corner{position:absolute;width:12px;height:12px;z-index:10}.resize-handle-e{cursor:e-resize}.resize-handle-w{cursor:w-resize}.resize-handle-s{cursor:s-resize}.resize-handle-n{cursor:n-resize}.resize-handle-ne{cursor:ne-resize}.resize-handle-nw{cursor:nw-resize}.resize-handle-se{cursor:se-resize}.resize-handle-sw{cursor:sw-resize}.dock-container{position:relative}.dock-wheel-base{position:absolute}.dock-wheel-item{position:absolute;width:32px;height:32px}.dock-wheel-fill{margin-left:-16px;margin-top:-16px}.dock-wheel-left{margin-left:-48px;margin-top:-16px}.dock-wheel-right{margin-left:16px;margin-top:-16px}.dock-wheel-top{margin-left:-16px;margin-top:-48px}.dock-wheel-down{margin-left:-16px;margin-top:16px}.dock-wheel-panel-preview{position:absolute;background-color:rgba(128,128,255,.5)}.dock-wheel-fill-icon{background:url("placeholder.png") 0 0}.dock-wheel-left-icon{background:url("placeholder.png") 0 0}.dock-wheel-right-icon{background:url("placeholder.png") 0 0}.dock-wheel-top-icon{background:url("placeholder.png") 0 0}.dock-wheel-down-icon{background:url("placeholder.png") 0 0}.dock-wheel-fill-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-left-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-right-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-top-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-down-icon-hover{background:url("placeholder.png") 0 0}.splitter-container-horizontal{float:left;position:relative;pointer-events:none}.splitter-container-vertical{position:relative;pointer-events:none}.splitbar-horizontal{width:100%;height:5px;cursor:n-resize;position:relative;pointer-events:auto}.splitbar-vertical{width:5px;height:100%;float:left;cursor:e-resize;position:relative;pointer-events:auto}.splitbar-horizontal-ghoust{width:100%;height:5px;cursor:n-resize;position:absolute}.splitbar-vertical-ghoust{width:5px;height:100%;position:absolute;cursor:e-resize}.dockspan-tab-host{display:inline-block;position:absolute}.dockspan-tab-content{position:relative}.dockspan-tab-content:focus{outline:0}.dockspan-tab-handle{position:relative;height:22px;float:left;overflow:hidden;cursor:pointer;padding-right:16px}.dockspan-tab-handle:hover{cursor:pointer}.dockspan-tab-handle-text{margin-top:3px;margin-left:6px;margin-right:6px;white-space:nowrap;overflow:hidden;float:left;text-overflow:ellipsis;width:calc(100% - 3px);display:block}.dockspan-tab-handle-text>span{vertical-align:top}.dockspan-tab-handle-close-button::after{margin-right:5px;float:right;position:absolute;right:0;content:"x";font-weight:normal;font-family:Verdana,Geneva,Tahoma,sans-serif;cursor:pointer;display:flex;height:100%;align-items:center}.dockspan-tab-handle-close-button:hover{color:#000}.dockspan-tab-handle-list-container{height:22px;overflow:hidden;display:none;pointer-events:auto}.dockspan-tab-handle-list-container-visible{display:flex}.dockspan-tab-handle-content-seperator{height:4px;display:none}.dockspan-tab-handle-content-seperator-visible{display:block}.dockspab-tab-handle-context-menu{position:absolute;z-index:10000000;background-color:#fff;border:#fff;border:#000 solid 2px;padding:5px}.dockspab-tab-handle-context-menu>div{cursor:pointer;padding:2px}.dockspab-tab-handle-context-menu>div:hover{background-color:gray;cursor:pointer;padding:2px}.disable-selection{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:default}.panel-titlebar{background-color:#333;pointer-events:auto}.panel-titlebar-text{font-weight:bold;color:#aaa}.panel-titlebar-button-close{color:#aaa}.panel-titlebar-button-close:hover{color:red}.panel-content{overflow:auto}.panel-element-content-container{background-color:#fff}.dialog-floating{box-shadow:5px 5px 20px #000;pointer-events:none}.draggable-dragging-active{opacity:.95}.resize-handle{pointer-events:auto}.resize-handle-corner{pointer-events:auto}.dock-container{background-color:#888}.document-manager{background-color:#666}.splitbar-horizontal{background-color:#000}.splitbar-horizontal:hover{background-color:#5b636c}.splitbar-horizontal:active{background-color:#5b636c}.splitbar-vertical{background-color:#000}.splitbar-vertical:hover{background-color:#5b636c}.splitbar-vertical:active{background-color:#5b636c}.splitbar-horizontal-ghoust{background-color:#fc0}.splitbar-vertical-ghoust{background-color:#fc0}.dockspan-tab-host{background-color:#fff}.dockspan-tab-content{background-color:#fff}.dockspan-tab-content>*{background-color:#fff}.dockspan-tab-handle{background-color:gray;color:#d5d5d5;box-shadow:0px 5px 20px #000}.dockspan-tab-handle:hover{background-color:#006729;color:#fff}.dockspan-tab-handle-selected{background-color:#333;color:#fff}.dockspan-tab-handle-selected:hover{background-color:#008749;color:#fff}.dockspan-tab-handle-close-button:hover{color:red}.dockspan-tab-handle-list-container{background-color:#fff}.dockspan-tab-handle-content-seperator{background-color:#333}.dockspan-tab-handle-content-seperator-active{background-color:#008749}.dockspan-tab-handle-active{background-color:#008749}.dockspan-panel-active{background-color:#008749}.dockspan-panel-titlebar-text-active{color:#fff}.dockspab-tab-handle-context-menu{position:absolute;z-index:10000000;background-color:#fff;border:#fff;border:#000 solid 2px;padding:5px}.dockspab-tab-handle-context-menu>div{cursor:pointer;padding:2px}.dockspab-tab-handle-context-menu>div:hover{background-color:gray;cursor:pointer;padding:2px}.mall-app{background-color:#f8f9fa}.mall-home-view .search-bar{border-radius:9999px;border:1px solid #e5e7eb;background-color:#fff;box-shadow:0 1px 3px rgba(0,0,0,.05)}.mall-home-view .search-bar:focus{outline:none;border-color:#4f46e5;box-shadow:0 0 0 2px rgba(79,70,229,.2)}.mall-home-view .product-grid{padding-bottom:4rem}.product-card{border:none;border-radius:12px;background-color:#fff;overflow:hidden;display:flex;flex-direction:row;transition:transform .2s ease-in-out,box-shadow .2s ease-in-out;padding:.75rem;gap:.75rem;align-items:flex-start;box-shadow:0 2px 4px rgba(0,0,0,.05)}.product-card .product-image-container{flex-shrink:0;width:90px;height:90px}.product-card .product-image{width:100%;height:100%;border-radius:8px;background-color:#f0f2f5}.product-card .product-details{display:flex;flex-direction:column;flex-grow:1;min-width:0}.product-card .product-name{font-size:1rem;font-weight:600;color:#1f2937}.product-card .product-description{font-size:.8rem;color:#6b7280;margin:.25rem 0;flex-grow:1;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;line-height:1.4}.product-card .product-footer{display:flex;justify-content:space-between;align-items:center;margin-top:auto}.product-card .product-price{font-size:1.1rem;font-weight:bold;color:#ef4444;margin:0}.product-card .product-stock{font-size:.75rem;color:#6b7280}.product-card button{margin:0;background-color:#4f46e5;color:#fff;border:none;width:32px;height:32px;border-radius:50%;cursor:pointer;font-weight:bold;font-size:1.5rem;line-height:1;display:flex;align-items:center;justify-content:center;transition:background-color .2s}.product-card button:hover{background-color:#4338ca}.product-card button:disabled{background-color:#9ca3af;cursor:not-allowed}.mall-page-container{padding:1rem;height:100%;overflow-y:auto}.mall-page-container .page-title{font-size:1.5rem;font-weight:700;margin-bottom:1.5rem}.mall-page-container .empty-state{text-align:center;color:#6b7280;margin-top:4rem;font-size:1rem}.cart-view .cart-item{display:flex;align-items:center;gap:1rem;padding:1rem 0;border-bottom:1px solid #e5e7eb}.cart-view .cart-item .item-name{flex-grow:1;font-weight:500}.cart-view .cart-item .item-quantity{color:#6b7280}.cart-view .cart-item .item-price{font-weight:600;min-width:60px;text-align:right}.cart-view .cart-summary{margin-top:1.5rem;padding:1rem;background-color:#fff;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.05)}.cart-view .cart-summary .summary-row{display:flex;justify-content:space-between;margin-bottom:.5rem}.cart-view .cart-summary .summary-row.total{font-weight:bold;font-size:1.1rem;margin-top:1rem}.cart-view .checkout-btn{width:100%;padding:.875rem;border-radius:8px;border:none;background-color:#10b981;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;margin-top:1.5rem}.cart-view .checkout-btn:disabled{background-color:#9ca3af;cursor:not-allowed}.my-mall-view .user-info-card{background:linear-gradient(to right,#6366f1,#8b5cf6);color:#fff;padding:1.5rem;border-radius:12px;margin-bottom:1.5rem}.my-mall-view .user-info-card h2{margin:0;font-size:1.5rem}.my-mall-view .user-info-card p{margin:.25rem 0 0;font-size:1rem;opacity:.9}.my-mall-view .section-title{font-size:1.2rem;font-weight:600;margin-bottom:1rem}.my-mall-view .order-item{display:flex;justify-content:space-between;align-items:center;padding:1rem;background-color:#fff;border-radius:8px;margin-bottom:.75rem;box-shadow:0 1px 3px rgba(0,0,0,.05)}.my-mall-view .order-item .order-details{font-weight:500}.my-mall-view .order-item .order-delivery-time{font-size:.8rem;color:#6b7280}.character-annals-app{display:flex;height:100%;width:100%;background-color:#f9f9f9;font-family:sans-serif}.character-annals-app .character-list-view{width:280px;flex-shrink:0;background-color:#fff;border-right:1px solid #e0e0e0;display:flex;flex-direction:column}.character-annals-app .character-list-view .search-bar{padding:12px;border-bottom:1px solid #e0e0e0}.character-annals-app .character-list-view .search-bar input{width:100%;padding:8px 12px;border-radius:15px;border:1px solid #ccc;box-sizing:border-box}.character-annals-app .character-list-view .search-bar input:focus{outline:none;border-color:#0d6efd}.character-annals-app .character-list-view .character-list{list-style:none;padding:0;margin:0;overflow-y:auto;flex-grow:1}.character-annals-app .character-list-view .character-list .character-card{padding:15px;border-bottom:1px solid #f0f0f0;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:background-color .2s ease}.character-annals-app .character-list-view .character-list .character-card:hover{background-color:#e7f0fe}.character-annals-app .character-list-view .character-list .character-card .character-name{font-weight:600;color:#333}.character-annals-app .character-list-view .character-list .character-card .character-class{font-size:.85em;color:#777;background-color:#eee;padding:2px 6px;border-radius:8px}.character-annals-app .detail-view-container{flex-grow:1;overflow-y:auto}.character-annals-app .detail-view-container .character-detail-view{padding:24px}.character-annals-app .detail-view-container .placeholder{display:flex;justify-content:center;align-items:center;height:100%;color:#aaa;font-size:1.2em}.detail-header{border-bottom:1px solid #e0e0e0;padding-bottom:20px;margin-bottom:20px}.detail-header h1{margin:0 0 8px 0;font-size:2em;color:#2c3e50}.detail-header .signature{font-style:italic;color:#666;margin:5px 0}.detail-header .tags{margin-top:12px}.detail-header .tags .tag{display:inline-block;background-color:#e0e0e0;padding:4px 10px;border-radius:12px;font-size:.8em;margin-right:8px}.detail-header .tags .tag.identity{background-color:#4169e1;color:#fff}.detail-header .header-main{display:flex;justify-content:space-between;align-items:flex-start}.detail-header .avatar-container{flex-shrink:0;width:60px;height:80px}.detail-header .character-avatar,.detail-header .character-avatar-placeholder{width:100%;height:100%;object-fit:cover;border-radius:8px}.detail-header .character-avatar-placeholder{font-size:2rem}.detail-tabs{display:flex;border-bottom:1px solid #ccc;margin-bottom:20px}.detail-tabs button{padding:12px 24px;border:none;background:none;cursor:pointer;font-size:1em;color:#666;border-bottom:3px solid rgba(0,0,0,0);transition:all .2s ease}.detail-tabs button.active{border-bottom-color:#0d6efd;color:#0d6efd;font-weight:600}.attribute-section{margin-bottom:25px}.attribute-section h3{margin-bottom:15px;font-size:1.2em;color:#333;border-bottom:1px solid #eee;padding-bottom:8px}.attribute-section ul{list-style:none;padding:0}.attribute-section ul li{display:flex;justify-content:space-between;padding:8px 0;font-size:.95em;border-bottom:1px dashed #f0f0f0}.attribute-section ul li:last-child{border-bottom:none}.relationships-panel{width:100%;height:100%}.enhanced-input-box-container{width:100%;position:relative}.input-wrapper{display:flex;width:100%;align-items:center;position:relative;padding:8px;background-color:rgba(10,15,30,.8);border:1px solid rgba(212,175,55,.3);border-radius:30px;box-shadow:0 0 15px rgba(10,15,30,.5),inset 0 0 5px rgba(10,15,30,.5);padding-left:55px;padding-right:55px}textarea{flex-grow:1;resize:none;padding:.5rem 1rem;border:none;background-color:rgba(0,0,0,0);font-size:1rem;line-height:1.5;color:#e0e0e0;min-height:40px;font-family:"Siyuan Song","Source Han Serif SC",serif;outline:none}textarea::placeholder{color:rgba(224,224,224,.4)}.button-group{display:flex;gap:8px;padding-left:8px}.action-button{padding:.5rem 1.2rem;font-size:.9rem;border-radius:20px;font-family:"ZCOOL KuaiLe","篆书",cursive;min-width:90px;text-align:center}.action-button.primary{background-color:#d4af37;color:#0a0f1e;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.action-button.primary:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);box-shadow:0 0 10px rgba(212,175,55,.5)}.action-button.primary{background-color:#d4af37;color:#0a0f1e}.action-button.primary:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);box-shadow:0 0 12px rgba(212,175,55,.7)}.action-button:not(.primary){background-color:rgba(0,0,0,0);color:#f0e6d2;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.action-button:not(.primary):hover{background-color:rgba(212,175,55,.1);border-color:rgb(221.024691358,191.7901234568,96.975308642)}.action-button:not(.primary){background-color:rgba(22,33,44,.7);border-color:rgba(212,175,55,.4);color:#f0e6d2}.action-button:not(.primary):hover{background-color:#16212c;border-color:#d4af37}.command-queue-popup{position:absolute;bottom:100%;right:1rem;width:300px;margin-bottom:.5rem;z-index:10;border:1px solid rgba(212,175,55,.4);border-radius:5px;box-shadow:0 5px 20px rgba(0,0,0,.2);padding:16px}.command-list{max-height:150px;overflow-y:auto;margin-bottom:16px}.command-item{padding:8px;border-bottom:1px solid rgba(212,175,55,.2);font-size:.9rem;color:#e0e0e0}.command-item:last-child{border-bottom:none}.empty-queue{color:rgba(224,224,224,.6);font-style:italic;text-align:center;padding:24px 0}.clear-button{width:100%;padding:8px;background-color:rgba(199,67,67,.6);color:#e0e0e0;border:1px solid rgba(199,67,67,.8);border-radius:3px;cursor:pointer;transition:all .2s ease}.clear-button:hover{background-color:#c74343;box-shadow:0 0 10px rgba(199,67,67,.5)}.input-history-popup{background-color:rgba(10,15,30,.95);backdrop-filter:blur(8px);border:1px solid rgba(212,175,55,.5);border-radius:5px;padding:24px;box-shadow:0 8px 30px rgba(0,0,0,.4);width:450px;max-width:90vw;display:flex;flex-direction:column;gap:24px;position:absolute;bottom:calc(100% + 16px);left:50%;transform:translateX(-50%);z-index:1000}.input-history-popup .history-section h4{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;font-size:16px;margin-bottom:16px;border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:8px}.input-history-popup .history-section ul{list-style:none;padding:0;margin:0;max-height:150px;overflow-y:auto;display:flex;flex-direction:column;gap:8px}.input-history-popup .history-section li{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:3px;background-color:rgba(10,15,30,.2);transition:background-color .2s ease}.input-history-popup .history-section li:hover{background-color:rgba(240,230,210,.1)}.input-history-popup .history-section .entry-text{color:#e0e0e0;cursor:pointer;flex-grow:1;margin-right:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.input-history-popup .history-section .actions{display:flex;gap:8px;flex-shrink:0}.input-history-popup .history-section .actions button{font-size:12px;padding:4px 8px}.input-history-popup .history-section .actions button:disabled{opacity:.5;cursor:not-allowed}.input-history-popup .history-section .empty-text{color:#a0a0a0;font-style:italic}.input-history-popup .close-button-popup{align-self:flex-end;margin-top:16px}@keyframes orbit{from{transform:rotate(0deg) translateX(150px) rotate(0deg)}to{transform:rotate(360deg) translateX(150px) rotate(-360deg)}}.world-detail-modal-content{width:500px;max-width:90vw;color:#e0e0e0;background:radial-gradient(ellipse at top,rgb(30.5,45.75,61),#0a0f1e 80%);padding:24px;border:1px solid rgba(212,175,55,.2)}.world-detail-modal-content .scroll-container{max-height:70vh;overflow-y:auto;padding-right:8px}.world-detail-modal-content .scroll-container::-webkit-scrollbar{width:6px;height:6px}.world-detail-modal-content .scroll-container::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.world-detail-modal-content .scroll-container::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.world-detail-modal-content .scroll-container::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.world-detail-modal-content .world-section{margin-bottom:32px;position:relative}.world-detail-modal-content .section-title{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px;color:#f0e6d2;padding-bottom:16px;margin-bottom:24px;text-align:center;letter-spacing:2px;border-bottom:1px solid rgba(212,175,55,.3)}.world-detail-modal-content .rules-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:24px;text-align:center;padding:16px;border-radius:5px;background:rgba(10,15,30,.3)}.world-detail-modal-content .rule-item .rule-name{font-size:12px;color:#a0a0a0;margin-bottom:8px}.world-detail-modal-content .rule-item .rule-value{font-size:18px;font-weight:bold;color:#e0e0e0}.world-detail-modal-content .system-overview{font-style:italic;color:#a0a0a0;text-align:center;margin-bottom:32px;padding:0 24px}.world-detail-modal-content .ladder-container{position:relative;height:350px;margin:32px 0}.world-detail-modal-content .ladder-container::before{content:"";position:absolute;top:0;bottom:0;left:50%;transform:translateX(-50%);width:2px;background:linear-gradient(to bottom,transparent,#d4af37 50%,transparent 100%);opacity:.7}.world-detail-modal-content .境界-ladder{list-style:none;padding:0;margin:0;position:absolute;top:50%;left:50%;width:1px;height:1px}.world-detail-modal-content .ladder-step{position:absolute;display:flex;flex-direction:column;align-items:center;gap:4px}.world-detail-modal-content .ladder-step:nth-child(1){transform:rotate(0deg) translateX(95px) rotate(-0deg);animation:orbit 25s linear infinite;animation-direction:normal}.world-detail-modal-content .ladder-step:nth-child(2){transform:rotate(72deg) translateX(110px) rotate(-72deg);animation:orbit 30s linear infinite;animation-direction:reverse}.world-detail-modal-content .ladder-step:nth-child(3){transform:rotate(144deg) translateX(125px) rotate(-144deg);animation:orbit 35s linear infinite;animation-direction:normal}.world-detail-modal-content .ladder-step:nth-child(4){transform:rotate(216deg) translateX(140px) rotate(-216deg);animation:orbit 40s linear infinite;animation-direction:reverse}.world-detail-modal-content .ladder-step:nth-child(5){transform:rotate(288deg) translateX(155px) rotate(-288deg);animation:orbit 45s linear infinite;animation-direction:normal}.world-detail-modal-content .ladder-step::before{content:"";width:10px;height:10px;border-radius:50%;background:#f0e6d2;box-shadow:0 0 8px #f0e6d2,0 0 15px #d4af37}.world-detail-modal-content .ladder-step .level-name,.world-detail-modal-content .ladder-step .level-energy{position:absolute;top:-30px;white-space:nowrap;background:rgba(22,33,44,.8);padding:2px 6px;border-radius:3px}.world-detail-modal-content .ladder-step .level-name{font-weight:bold;color:#f0e6d2;font-size:14px}.world-detail-modal-content .ladder-step .level-energy{display:none}.settlement-choice-card{background-color:rgba(22,33,44,.6);border:1px solid rgba(212,175,55,.3);border-radius:5px;padding:16px;cursor:pointer;transition:all .3s ease;backdrop-filter:blur(8px);display:flex;flex-direction:column;justify-content:space-between;min-height:240px}.settlement-choice-card:hover{border-color:rgba(240,230,210,.7);background-color:rgba(22,33,44,.8);box-shadow:0 5px 25px rgba(10,15,30,.6);transform:translateY(-5px)}.settlement-choice-card.is-selected{border-color:#f0e6d2;box-shadow:0 0 20px rgba(240,230,210,.4);background:rgba(22,33,44,.9)}.settlement-choice-card .card-header{text-align:center;padding-bottom:8px;border-bottom:1px solid rgba(212,175,55,.2);margin-bottom:16px}.settlement-choice-card .card-header .choice-type{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;font-size:20px;text-shadow:0 0 8px rgba(240,230,210,.7)}.settlement-choice-card .card-body{flex-grow:1}.settlement-choice-card .card-body .description{color:#e0e0e0;font-size:14px;line-height:1.7;margin-bottom:16px}.settlement-choice-card .card-body .data-details{background-color:rgba(10,15,30,.4);padding:16px;border-radius:3px;border-left:3px solid #3a8f9d}.settlement-choice-card .card-body .data-details .data-name{color:#3a8f9d;font-weight:bold;font-size:16px;margin-bottom:8px;display:block}.settlement-choice-card .card-body .data-details .data-description{color:hsl(0,0%,77.7450980392%);font-size:14px;line-height:1.6}.settlement-choice-card .card-footer{text-align:right;padding-top:16px;margin-top:16px;border-top:1px solid rgba(212,175,55,.1)}.settlement-choice-card .card-footer .cost{color:#c74343;font-size:14px;font-weight:bold;text-shadow:0 0 5px rgba(199,67,67,.5)}.settlement-view{display:flex;flex-direction:column;height:100%;padding:24px}.settlement-view .choices-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:24px;overflow-y:auto;padding-bottom:24px}.settlement-view .choices-grid::-webkit-scrollbar{width:6px;height:6px}.settlement-view .choices-grid::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.settlement-view .choices-grid::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.settlement-view .choices-grid::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.settlement-view .no-choices{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;height:100%;color:#a0a0a0;font-size:16px}.settlement-view .no-choices p{margin:8px 0}.settlement-view .actions-footer{padding-top:24px;margin-top:auto;display:flex;justify-content:flex-end;border-top:1px solid rgba(58,143,157,.2)}.settlement-view .actions-footer .confirm-button{background-color:#d4af37;color:#0a0f1e;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.settlement-view .actions-footer .confirm-button:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);box-shadow:0 0 10px rgba(212,175,55,.5)}.settlement-view .actions-footer .confirm-button{padding:16px 32px;font-size:16px}.settlement-view .actions-footer .confirm-button:disabled{background-color:#a0a0a0;color:rgba(10,15,30,.7);border-color:#a0a0a0;cursor:not-allowed}.guixu-root-container.mobile-view .main-layout{display:grid !important;grid-template-columns:1fr !important}.guixu-root-container.mobile-view .top-overlays{padding:4px 8px}.guixu-root-container.mobile-view .side-panel.is-mobile-overlay,.guixu-root-container.mobile-view .right-side-panel.is-mobile-overlay{position:fixed;top:0;bottom:0;width:280px;max-width:75%;z-index:800;overflow:hidden}.guixu-root-container.mobile-view .side-panel.is-mobile-overlay{left:0}.guixu-root-container.mobile-view .right-side-panel.is-mobile-overlay{right:0}.guixu-root-container.mobile-view .is-mobile-overlay .side-panel-container{background-color:rgba(22,33,44,.95) !important;backdrop-filter:blur(12px) !important;-webkit-backdrop-filter:blur(12px) !important;border:1px solid rgba(212,175,55,.3) !important;box-shadow:0 5px 50px rgba(0,0,0,.7) !important;height:100% !important;padding-top:24px !important}.guixu-root-container.mobile-view .mobile-time-display{padding:8px 16px;margin-bottom:16px;border-bottom:1px solid rgba(212,175,55,.2)}.guixu-root-container.mobile-view .slide-left-enter-active,.guixu-root-container.mobile-view .slide-left-leave-active,.guixu-root-container.mobile-view .slide-right-enter-active,.guixu-root-container.mobile-view .slide-right-leave-active{transition:transform .35s cubic-bezier(0.23,1,0.32,1)}.guixu-root-container.mobile-view .slide-left-enter-from,.guixu-root-container.mobile-view .slide-left-leave-to{transform:translateX(-100%)}.guixu-root-container.mobile-view .slide-right-enter-from,.guixu-root-container.mobile-view .slide-right-leave-to{transform:translateX(100%)}.text-dialogue{color:#f0e6d2}.enhanced-input-box-container .input-wrapper{display:flex;align-items:stretch;gap:8px}.enhanced-input-box-container .button-group{display:flex;gap:8px}.enhanced-input-box-container .side-buttons{display:flex;flex-direction:column;gap:4px}.enhanced-input-box-container .side-buttons .action-button{flex-grow:1}.enhanced-input-box-container .lm_header .lm_tab .lm_close_tab,.enhanced-input-box-container .lm_controls .lm_popout,.enhanced-input-box-container .lm_controls .lm_maximise,.enhanced-input-box-container .lm_controls .lm_close{background-image:none !important}.text-psychology{color:#8a5db5;font-style:italic}.text-scenery{color:#3a8f9d}.text-system-highlight{color:#d4af37;font-weight:bold}.lm_header{height:32px !important}.lm_tab{height:30px !important;line-height:30px !important;padding-bottom:0 !important}.lm_tab .lm_close_tab{width:20px !important;height:20px !important;right:6px !important;top:5px !important;background-size:16px 16px;background-repeat:no-repeat;background-position:center;background-image:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23a0a0a0"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>') !important}.lm_tab .lm_close_tab:hover{background-image:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffffff"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>') !important}.main-content-wrapper{position:absolute;top:0;left:0;right:0;bottom:0;box-sizing:border-box;overflow-y:auto;padding:25px;background:#fdfbf6}
.destiny-plate-container[data-v-0f9cb796]{width:100%;height:100%;display:grid;place-items:center;container-type:size}.destiny-plate[data-v-0f9cb796]{position:relative;width:min(98cqw,98cqh);height:min(98cqw,98cqh);font-size:clamp(5px,2cqw,14px);border-radius:50%;background:radial-gradient(ellipse at center,rgba(25,28,40,0.9) 0%,rgba(10,12,23,0.95) 70%)}.static-orbit[data-v-0f9cb796]{position:absolute;top:50%;left:50%;border-radius:50%;border:1px solid rgba(224,224,224,.05);transform:translate(-50%,-50%)}.static-orbit.orbit-1[data-v-0f9cb796]{width:20em;height:20em}.static-orbit.orbit-2[data-v-0f9cb796]{width:32em;height:32em}.static-orbit.orbit-3[data-v-0f9cb796]{width:44em;height:44em}.static-orbit.orbit-4[data-v-0f9cb796]{width:56em;height:56em}.plate-center[data-v-0f9cb796]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:12em;height:12em;border-radius:50%;background:radial-gradient(circle,rgba(100,110,130,0.1) 0%,rgba(50,55,70,0.05) 100%);display:flex;justify-content:center;align-items:center;text-align:center;z-index:20;transition:all .3s ease;border:1px solid rgba(212,175,55,.2);box-shadow:0 0 1em rgba(240,230,210,.1)}.plate-center .core-title[data-v-0f9cb796]{font-size:1.8em;font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2}.plate-center .core-description[data-v-0f9cb796]{font-size:1.1em;color:#a0a0a0;line-height:1.3;margin-top:.5em}.node[data-v-0f9cb796]{position:absolute;top:50%;left:50%;display:flex;flex-direction:column;justify-content:center;align-items:center;border-radius:50%;cursor:pointer;transition:transform .3s ease,box-shadow .3s ease,border-color .3s ease;transform:rotate(var(--angle)) translateX(var(--radius)) rotate(calc(-1 * var(--angle)))}.node[data-v-0f9cb796]:hover{transform:rotate(var(--angle)) translateX(var(--radius)) rotate(calc(-1 * var(--angle))) scale(1.15);z-index:30}.node .node-name[data-v-0f9cb796]{color:#e0e0e0}.node .node-value[data-v-0f9cb796]{color:#3a8f9d}.inner-node[data-v-0f9cb796]{--radius:10em;width:6em;height:6em;margin:-3em;background-color:rgba(22,33,44,.6);border:1px solid rgba(58,143,157,.3)}.inner-node .node-name[data-v-0f9cb796]{font-size:1.6em}.inner-node .node-value[data-v-0f9cb796]{font-size:1.4em}.param-node[data-v-0f9cb796]{--radius:16em;width:5.6em;height:5.6em;margin:-2.8em;background-color:rgba(10,15,30,.7);border:1px solid rgba(212,175,55,.4)}.param-node .node-name[data-v-0f9cb796]{font-size:1.4em;color:#f0e6d2}.param-node .node-value[data-v-0f9cb796]{font-size:1.2em}.world-node[data-v-0f9cb796]{--radius:22em;width:5em;height:5em;margin:-2.5em;background-color:rgba(43,44,66,.7);border:1px solid rgba(58,143,157,.3)}.world-node .node-name[data-v-0f9cb796]{font-size:1.2em;color:#f0e6d2}.world-node .node-value[data-v-0f9cb796]{font-size:1.1em}.world-node.is-special[data-v-0f9cb796]{background-color:rgba(80,30,30,.8);border:1px solid rgba(199,67,67,.5);box-shadow:0 0 .8em rgba(199,67,67,.3)}.orbit-track[data-v-0f9cb796]{position:absolute;top:50%;left:50%;width:8em;height:8em;margin:-4em;transform:rotate(var(--angle)) translateX(22em) rotate(calc(-1 * var(--angle)));z-index:5}.orbit-track .orbit-svg[data-v-0f9cb796]{width:100%;height:100%;transform:rotate(-90deg)}.orbit-track .orbit-svg .track[data-v-0f9cb796]{fill:none;stroke:rgba(224,224,224,.1);stroke-width:4}.orbit-track .orbit-svg .progress[data-v-0f9cb796]{fill:none;stroke:#3a8f9d;stroke-width:4;stroke-dasharray:283;transition:stroke-dashoffset .5s ease}.orbit-track .orbit-label[data-v-0f9cb796]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#e0e0e0;font-size:1em;cursor:pointer;width:100%;text-align:center}
.character-panel-container[data-v-8e022938]{container-type:inline-size}.character-panel-container .destiny-wheel[data-v-8e022938]{position:relative;width:100%;max-width:300px;aspect-ratio:1/1;margin:24px auto;display:grid;place-items:center}.character-panel-container .galaxy-background[data-v-8e022938],.character-panel-container .nodes-container[data-v-8e022938]{grid-area:1/1;width:100%;height:100%}.character-panel-container .galaxy-background[data-v-8e022938]{background:radial-gradient(ellipse at center,rgba(255,255,255,0.1) 0%,rgba(255,255,255,0) 40%),radial-gradient(ellipse at center,rgba(58,143,157,0.15) 0%,rgba(58,143,157,0) 70%),url("https://www.transparenttextures.com/patterns/stardust.png");background-color:#0a0f1e;border-radius:50%}.character-panel-container .galaxy-background[data-v-8e022938]::before{content:"";position:absolute;inset:-10%;background:conic-gradient(from 0deg,transparent 50%,#3a8f9d 100%);border-radius:50%;animation:rotate-galaxy-8e022938 15s linear infinite}.character-panel-container .nodes-container[data-v-8e022938]{position:relative}.character-panel-container .center-node[data-v-8e022938]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10;width:40%;height:40%;background:radial-gradient(circle,rgb(35.6,53.4,71.2),#16212c);border-radius:50%;border:2px solid #d4af37;box-shadow:0 0 25px rgba(212,175,55,.7),inset 0 0 15px rgba(10,15,30,.9);display:flex;justify-content:center;align-items:center;flex-direction:column;color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive}.character-panel-container .center-node .label[data-v-8e022938]{font-size:1.1rem}.character-panel-container .center-node .value[data-v-8e022938]{font-size:2.2rem;font-weight:bold;text-shadow:0 0 5px #d4af37}.character-panel-container .attribute-node[data-v-8e022938]{position:absolute;top:50%;left:50%;z-index:5;width:25%;height:25%;transition:all .3s ease}.character-panel-container .attribute-node .star-core[data-v-8e022938]{width:100%;height:100%;background:radial-gradient(circle,rgba(39,58.5,78,0.85),rgba(22,33,44,0.85));border-radius:50%;border:1px solid #3a8f9d;box-shadow:0 0 8px rgba(58,143,157,.4),inset 0 0 5px rgba(10,15,30,.7);display:flex;justify-content:center;align-items:center;flex-direction:column;color:#e0e0e0}.character-panel-container .attribute-node .star-core .label[data-v-8e022938]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:.9rem;opacity:.8}.character-panel-container .attribute-node .star-core .value[data-v-8e022938]{font-size:1.3rem}.character-panel-container .attribute-node[data-v-8e022938]::before{content:"";position:absolute;top:50%;left:50%;width:1px;height:var(--radius);background:linear-gradient(to top,rgba(58,143,157,0.6) 0%,transparent 100%);transform-origin:bottom;transform:translate(-50%,-100%) rotate(var(--connector-rotation));z-index:-1}.character-panel-container .attribute-node:hover .star-core[data-v-8e022938]{transform:scale(1.1);box-shadow:0 0 20px #3a8f9d,0 0 30px rgba(224,224,224,.7);border-color:rgb(114.0651162791,190.3674418605,202.9348837209)}@keyframes rotate-galaxy-8e022938{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}@keyframes twinkle-8e022938{0%,100%{opacity:.8;transform:scale(0.98)}50%{opacity:1;transform:scale(1)}}@keyframes grow-line-8e022938{from{height:0}to{height:80px}}@container (max-width:250px){.center-node .label[data-v-8e022938]{font-size:.9rem}.center-node .value[data-v-8e022938]{font-size:1.8rem}.attribute-node .star-core .label[data-v-8e022938]{font-size:.7rem}.attribute-node .star-core .value[data-v-8e022938]{font-size:1.1rem}}@container (max-width:200px){.center-node .label[data-v-8e022938]{font-size:.7rem}.center-node .value[data-v-8e022938]{font-size:1.5rem}.attribute-node .star-core .label[data-v-8e022938]{font-size:.6rem}.attribute-node .star-core .value[data-v-8e022938]{font-size:.9rem}}.combat-attributes-section[data-v-8e022938]{margin-top:24px;padding-top:24px;border-top:1px solid rgba(212,175,55,.2)}.combat-attributes-section .section-title[data-v-8e022938]{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;text-align:center;margin-bottom:16px}.combat-attributes-section .attributes-list[data-v-8e022938]{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}.combat-attributes-section .attribute-item[data-v-8e022938]{display:flex;justify-content:space-between;font-size:.9em}.combat-attributes-section .attribute-item .label[data-v-8e022938]{color:#a0a0a0}.combat-attributes-section .attribute-item .value[data-v-8e022938]{color:#e0e0e0;font-weight:bold}.combat-attributes-section .empty-state[data-v-8e022938]{text-align:center;color:#a0a0a0;font-style:italic}
.inventory-panel[data-v-ca49a7a8]{padding:24px;height:100%;overflow:hidden;container-type:inline-size}.inventory-layout[data-v-ca49a7a8]{display:grid;grid-template-columns:1fr;height:100%;width:100%;position:relative}@container (min-width:600px){.inventory-layout[data-v-ca49a7a8]{grid-template-columns:1fr 0;gap:24px;transition:grid-template-columns .5s ease-in-out}.inventory-layout.detail-open[data-v-ca49a7a8]{grid-template-columns:2fr 1fr}}.main-content[data-v-ca49a7a8]{display:flex;flex-direction:column;min-width:0}.talisman-tabs[data-v-ca49a7a8]{display:none}.item-grid-container[data-v-ca49a7a8]{flex-grow:1;overflow-x:auto;overflow-y:hidden}.item-grid-container[data-v-ca49a7a8]::-webkit-scrollbar{width:6px;height:6px}.item-grid-container[data-v-ca49a7a8]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.item-grid-container[data-v-ca49a7a8]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.item-grid-container[data-v-ca49a7a8]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.item-grid-container[data-v-ca49a7a8]{padding:24px;background:url("https://www.transparenttextures.com/patterns/old-paper.png");background-color:#e8e0d0;border-radius:5px;border:1px solid #c9bba8}.item-grid[data-v-ca49a7a8]{display:flex;align-items:center;flex-wrap:nowrap;gap:4cqi;padding-bottom:24px;min-width:min-content}.chapter-separator[data-v-ca49a7a8]{display:flex;justify-content:center;align-items:center;flex-shrink:0;width:12cqi;height:12cqi;min-width:50px;min-height:50px;background:linear-gradient(145deg,#a03030,#d85050);border:max(2px,.3cqi) solid #5a2020;border-radius:.8cqi;box-shadow:inset 0 0 1.5cqi rgba(0,0,0,.5),0 .3cqi .6cqi rgba(0,0,0,.3);position:relative}.chapter-separator[data-v-ca49a7a8]::after{content:"";position:absolute;inset:0;background-image:url("https://www.transparenttextures.com/patterns/subtle-grunge.png");opacity:.3;mix-blend-mode:overlay;border-radius:.4cqi}.chapter-separator .text[data-v-ca49a7a8]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-weight:700;font-size:clamp(1.8rem,4.5cqi,3rem);color:#e0d0b8;text-shadow:1px 1px 1px hsla(0,0%,100%,.15),-1px -1px 1px rgba(0,0,0,.5)}.item-cell[data-v-ca49a7a8]{flex-shrink:0;width:15cqi;height:15cqi;min-width:60px;min-height:60px;border-radius:50%;display:flex;justify-content:center;align-items:center;text-align:center;cursor:pointer;transition:all .3s ease;position:relative;background-color:#b8d8c8;background-image:radial-gradient(ellipse 60% 40% at 75% 80%,rgba(100,140,120,0.3) 0%,transparent 100%),radial-gradient(ellipse 30% 20% at 20% 25%,rgba(230,255,240,0.2) 0%,transparent 100%),radial-gradient(ellipse 25% 15% at 40% 55%,rgba(210,230,220,0.15) 0%,transparent 100%),radial-gradient(ellipse 80% 70% at 50% 40%,rgba(240,255,245,0.25) 0%,transparent 70%),linear-gradient(155deg,#d0e8e0,#a8c8b8);box-shadow:inset .2cqi .3cqi .8cqi hsla(0,0%,100%,.4),inset -0.3cqi -0.6cqi 1.5cqi rgba(40,80,60,.3),inset 0 0 3cqi rgba(184,216,200,.5),0 .8cqi 2cqi rgba(0,0,0,.2);border:max(1px,.15cqi) solid hsla(0,0%,100%,.5);mask-image:radial-gradient(circle,transparent 8%,black 8.5%);-webkit-mask-image:radial-gradient(circle,transparent 8%,black 8.5%)}.item-cell[data-v-ca49a7a8]::before,.item-cell[data-v-ca49a7a8]::after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:16%;height:16%;border-radius:50%;z-index:-1}.item-cell[data-v-ca49a7a8]::before{box-shadow:0 .1cqi .3cqi rgba(20,40,30,.4)}.item-cell[data-v-ca49a7a8]::after{box-shadow:0 -0.1cqi .3cqi hsla(0,0%,100%,.5)}.item-cell .item-name-arc[data-v-ca49a7a8]{position:absolute;inset:0;width:100%;height:100%;overflow:visible}.item-cell .item-name-arc .arc-text[data-v-ca49a7a8]{font-family:"Noto Serif SC",serif;font-size:clamp(10px,1.4cqi,13px);font-weight:500;fill:#184830;letter-spacing:.2cqi}.item-cell .item-name[data-v-ca49a7a8]{display:none}.item-cell .item-footer[data-v-ca49a7a8]{position:absolute;bottom:1.5cqi;right:1.5cqi;background:none;font-size:clamp(.9rem,1.8cqi,1.2rem);font-weight:bold;color:rgba(8,36,22,.6);text-shadow:1px 1px 1px hsla(0,0%,100%,.5);z-index:2}.item-cell[data-v-ca49a7a8]:hover{transform:scale(1.1) translateY(-0.5cqi);box-shadow:inset .2cqi .3cqi 1.5cqi hsla(0,0%,100%,.7),inset -0.4cqi -0.8cqi 2cqi rgba(80,120,100,.5),inset 0 0 4cqi rgba(184,216,200,.7),0 2cqi 4cqi rgba(var(--tier-color-rgb),0.4)}.scroll-detail-view[data-v-ca49a7a8]{opacity:0;transform:translateX(20px);transition:opacity .5s ease-in-out,transform .5s ease-in-out;overflow:hidden;position:relative;background:rgba(0,0,0,0)}.inventory-layout.detail-open .scroll-detail-view[data-v-ca49a7a8]{opacity:1;transform:translateX(0)}.scroll-detail-view .scroll-content[data-v-ca49a7a8]{background-color:#0a0f1e;border:1px solid rgba(212,175,55,.5);border-radius:5px;height:100%;padding:24px;overflow-y:auto}.scroll-detail-view .scroll-content[data-v-ca49a7a8]::-webkit-scrollbar{width:6px;height:6px}.scroll-detail-view .scroll-content[data-v-ca49a7a8]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.scroll-detail-view .scroll-content[data-v-ca49a7a8]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.scroll-detail-view .scroll-content[data-v-ca49a7a8]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.scroll-detail-view .close-button[data-v-ca49a7a8]{position:absolute;top:16px;right:16px;background:none;border:none;font-size:clamp(1.5rem,4vw,2rem);line-height:1;color:#a0a0a0;cursor:pointer;transition:color .3s ease,transform .3s ease;z-index:2}.scroll-detail-view .close-button[data-v-ca49a7a8]:hover{color:#e0e0e0;transform:scale(1.2)}.scroll-detail-view .detail-name[data-v-ca49a7a8]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:clamp(1.5rem,5vw,2.2rem);color:#f0e6d2;text-align:center;margin-bottom:8px;text-shadow:0 0 10px rgba(var(--tier-color-rgb),0.9),0 0 20px rgba(var(--tier-color-rgb),0.6)}.scroll-detail-view .detail-meta[data-v-ca49a7a8]{display:flex;justify-content:center;gap:16px;margin-bottom:24px;font-size:clamp(.8rem,2.5vw,1rem);color:#a0a0a0}.scroll-detail-view .detail-meta .meta-tier[data-v-ca49a7a8]{color:#3a8f9d;font-weight:bold;text-shadow:0 0 5px #3a8f9d}.scroll-detail-view .detail-meta .meta-type[data-v-ca49a7a8]{font-style:italic}.scroll-detail-view .detail-desc[data-v-ca49a7a8]{font-family:"Siyuan Song","Source Han Serif SC",serif;line-height:1.8;color:#f0f0f0;text-shadow:1px 1px 3px rgba(0,0,0,.7);margin-bottom:24px;font-size:clamp(.8rem,2.5vw,1rem)}.scroll-detail-view .detail-effects[data-v-ca49a7a8]{margin-top:24px;border-top:1px solid rgba(212,175,55,.3);padding-top:24px}.scroll-detail-view .detail-effects h5[data-v-ca49a7a8]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-weight:normal;font-size:clamp(1.1rem,4vw,1.5rem);color:#f0e6d2;margin-bottom:16px;text-shadow:1px 1px 2px rgba(0,0,0,.5)}.scroll-detail-view .detail-effects ul[data-v-ca49a7a8]{padding-left:24px;list-style:"✧ ";color:#e8e8e8;text-shadow:1px 1px 3px rgba(0,0,0,.6);font-size:clamp(.8rem,2.5vw,.95rem)}.scroll-detail-view .detail-effects ul li[data-v-ca49a7a8]{margin-bottom:8px}.scroll-detail-view .detail-effects ul li .effect-tag[data-v-ca49a7a8]{color:#3a8f9d;font-weight:bold;margin-right:8px}.scroll-detail-view .detail-effects ul li .effect-type[data-v-ca49a7a8]{color:#a0a0a0;font-style:italic;margin-right:4px}.scroll-detail-view .detail-effects ul li .effect-value[data-v-ca49a7a8]{color:#f0e6d2;font-weight:bold}
.tasks-panel-starmap[data-v-1f7a99f8]{height:100%;position:relative;overflow:hidden;background-color:#0a0f1e;background-image:radial-gradient(1px 1px at 25px 5px,white,transparent),radial-gradient(1px 1px at 50px 25px,white,transparent),radial-gradient(1.5px 1.5px at 100px 60px,white,transparent),radial-gradient(2px 2px at 150px 120px,white,transparent),radial-gradient(2.5px 2.5px at 200px 80px,white,transparent);background-size:200px 200px;background-position:0 0}.starmap-container[data-v-1f7a99f8]{width:100%;height:100%;position:relative}.starmap-svg[data-v-1f7a99f8]{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}.starmap-svg .star-path[data-v-1f7a99f8]{fill:none;stroke:rgba(160,160,160,.1);stroke-width:1.5;stroke-dasharray:3 6;transition:stroke .5s ease}.starmap-svg .star-path.triggered[data-v-1f7a99f8]{stroke:url(#grad-triggered);stroke-dasharray:none;filter:drop-shadow(0 0 5px #3a8f9d);animation:dash-1f7a99f8 2s linear infinite}@keyframes dash-1f7a99f8{to{stroke-dashoffset:-100}}.star-node[data-v-1f7a99f8]{position:absolute;transform:translate(-50%,-50%);cursor:pointer;display:flex;flex-direction:column;align-items:center}.star-node .star-core[data-v-1f7a99f8]{width:20px;height:20px;border-radius:50%;transition:all .3s ease;position:relative;background:radial-gradient(circle,rgba(255,255,255,0.2) 0%,transparent 60%);box-shadow:0 0 5px hsla(0,0%,100%,.1) inset}.star-node .star-label[data-v-1f7a99f8]{margin-top:8px;font-size:12px;color:rgba(160,160,160,.7);text-shadow:0 0 5px #0a0f1e;transition:color .3s ease}.star-node:hover .star-core[data-v-1f7a99f8]{transform:scale(1.1)}.star-node:hover .star-label[data-v-1f7a99f8]{color:#e0e0e0;text-shadow:0 0 5px #e0e0e0}.ultimate-star .star-core[data-v-1f7a99f8]{width:60px;height:60px;background:radial-gradient(ellipse,rgba(255,77,77,0.8) 20%,rgba(255,77,77,0.4) 50%,transparent 70%),radial-gradient(circle,rgba(255,77,77,0.5) 0%,rgba(139,0,0,0.8) 100%);border:1px solid rgba(255,77,77,.8);--glow-color:rgba(#ff4d4d,0.4);animation:pulse-1f7a99f8 4s infinite ease-in-out}.ultimate-star .star-label[data-v-1f7a99f8]{font-size:16px;font-weight:bold;color:#ff4d4d}.destiny-star .star-core[data-v-1f7a99f8]{width:30px;height:30px;background:radial-gradient(ellipse,rgba(160,160,160,0.5) 30%,transparent 70%),radial-gradient(circle,rgba(160,160,160,0.3) 0%,rgba(10,15,30,0.5) 100%);border:1px solid rgba(160,160,160,.5)}.destiny-star.triggered .star-core[data-v-1f7a99f8]{background:radial-gradient(ellipse,rgba(58,143,157,0.8) 20%,transparent 70%),radial-gradient(circle,rgba(58,143,157,0.6) 0%,rgba(22,33,44,0.8) 100%);border-color:rgba(58,143,157,.8);--glow-color:rgba($color-cyan-tian,0.4);animation:pulse-1f7a99f8 3s infinite ease-in-out}.destiny-star.triggered .star-label[data-v-1f7a99f8]{color:#3a8f9d}.derived-star .star-core[data-v-1f7a99f8]{width:10px;height:10px;background:rgba(212,175,55,.5);border:1px solid rgba(212,175,55,.7);box-shadow:0 0 5px rgba(212,175,55,.5)}.starmap-svg .derived-path[data-v-1f7a99f8]{stroke:rgba(212,175,55,.3);stroke-dasharray:2 4}.node-detail-modal[data-v-1f7a99f8]{position:absolute;width:300px;padding:24px;background:rgba(10,15,30,.8);border:1px solid #d4af37;border-radius:5px;z-index:10;color:#e0e0e0;box-shadow:0 10px 30px rgba(0,0,0,.5)}.node-detail-modal .detail-title[data-v-1f7a99f8]{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;margin:0 0 16px 0;cursor:move}.node-detail-modal .detail-desc[data-v-1f7a99f8]{font-size:12px;margin-bottom:16px}.node-detail-modal .detail-meta[data-v-1f7a99f8]{font-size:11px;color:#a0a0a0;font-style:italic}.node-detail-modal .detail-meta p[data-v-1f7a99f8]{margin:.5em 0}.node-detail-modal .detail-meta strong[data-v-1f7a99f8]{color:#f0e6d2}.node-detail-modal .close-button[data-v-1f7a99f8]{position:absolute;top:8px;right:8px;background:none;border:none;color:#a0a0a0;font-size:20px;cursor:pointer}.node-detail-modal .close-button[data-v-1f7a99f8]:hover{color:#e0e0e0}.no-data[data-v-1f7a99f8]{display:flex;justify-content:center;align-items:center;height:100%;color:#a0a0a0;font-style:italic}@keyframes pulse-1f7a99f8{0%,100%{transform:scale(1);box-shadow:0 0 20px 5px var(--glow-color)}50%{transform:scale(1.1);box-shadow:0 0 35px 10px var(--glow-color)}}
.character-panel-container[data-v-75993348]{height:100%;width:100%;overflow:hidden;position:relative;background-color:rgba(0,0,0,0)}.character-sheet[data-v-75993348]{height:100%;width:100%;display:flex;justify-content:center;align-items:center}.loading-state[data-v-75993348]{display:flex;justify-content:center;align-items:center;height:100%;font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2}.additional-info-drawer[data-v-75993348]{position:absolute;bottom:0;left:0;right:0;background:rgba(10,15,30,.8);backdrop-filter:blur(5px);border-top:1px solid rgba(212,175,55,.3);transform:translateY(100%);transition:transform .4s ease-in-out;z-index:100}.additional-info-drawer.is-open[data-v-75993348]{transform:translateY(0)}.additional-info-drawer .drawer-toggle[data-v-75993348]{position:absolute;top:-30px;left:50%;transform:translateX(-50%);background:rgba(212,175,55,.8);color:#0a0f1e;border:none;border-radius:10px 10px 0 0;padding:4px 16px;cursor:pointer;font-family:"ZCOOL KuaiLe","篆书",cursive}.additional-info-drawer .drawer-content[data-v-75993348]{padding:24px;padding-top:32px;display:flex;flex-direction:column;gap:16px}.additional-info-drawer .info-item[data-v-75993348]{display:flex;justify-content:space-between;font-size:14px}.additional-info-drawer .info-item .label[data-v-75993348]{color:#a0a0a0}.additional-info-drawer .info-item .value[data-v-75993348]{color:#e0e0e0;font-weight:bold}.additional-info-drawer .world-attributes-section[data-v-75993348]{margin-top:24px;padding-top:24px;border-top:1px solid rgba(212,175,55,.2)}.additional-info-drawer .world-attributes-section .section-title[data-v-75993348]{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;text-align:center;margin-bottom:16px}.additional-info-drawer .world-attributes-section .attributes-list[data-v-75993348]{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}.additional-info-drawer .world-attributes-section .attribute-item[data-v-75993348]{display:flex;justify-content:space-between;font-size:.9em;cursor:help}.additional-info-drawer .world-attributes-section .attribute-item .label[data-v-75993348]{color:#a0a0a0}.additional-info-drawer .world-attributes-section .attribute-item .value[data-v-75993348]{color:#e0e0e0;font-weight:bold}.additional-info-drawer .world-attributes-section .empty-state[data-v-75993348]{text-align:center;color:#a0a0a0;font-style:italic}
@keyframes rotate-starmap-slow-dcca238c{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}@keyframes rotate-starmap-fast-dcca238c{from{transform:rotate(0deg)}to{transform:rotate(-360deg)}}@keyframes breathe-deep-dcca238c{0%,100%{opacity:.6;transform:scale(1)}50%{opacity:.8;transform:scale(1.03)}}.imprints-panel-container[data-v-dcca238c]{padding:24px;display:flex;justify-content:center;align-items:center;flex-direction:column}.imprints-grid[data-v-dcca238c]{position:relative;display:grid;grid-template-columns:repeat(3,1fr);gap:16px;width:400px;height:400px;margin:0 auto;padding:32px;border-radius:50%;background:radial-gradient(ellipse at center,rgb(30.5,45.75,61) 0%,#0a0f1e 70%);box-shadow:0 0 30px rgba(58,143,157,.3),inset 0 0 20px rgba(10,15,30,.9);border:2px solid rgba(212,175,55,.3)}.imprints-grid[data-v-dcca238c]::before,.imprints-grid[data-v-dcca238c]::after{content:"";position:absolute;top:50%;left:50%;border-radius:50%;border-style:solid;border-color:rgba(212,175,55,.3) rgba(0,0,0,0)}.imprints-grid[data-v-dcca238c]::before{width:110%;height:110%;margin-left:-55%;margin-top:-55%;border-width:1px;animation:rotate-starmap-slow-dcca238c 120s linear infinite}.imprints-grid[data-v-dcca238c]::after{width:95%;height:95%;margin-left:-47.5%;margin-top:-47.5%;border-width:2px;animation:rotate-starmap-fast-dcca238c 80s linear infinite}.imprint-slot[data-v-dcca238c]{position:relative;border:none;background:rgba(0,0,0,0);display:flex;justify-content:center;align-items:center;z-index:1;cursor:pointer;transition:transform .3s ease}.imprint-slot[data-v-dcca238c]::before{content:"";position:absolute;width:80%;height:80%;background:rgba(10,15,30,.7);border:1px solid rgba(58,143,157,.4);border-radius:5px;box-shadow:inset 0 0 15px rgba(10,15,30,.8);transition:all .3s ease}.imprint-slot.empty .empty-text[data-v-dcca238c]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px;color:rgba(160,160,160,.4);animation:breathe-deep-dcca238c 5s infinite ease-in-out}.imprint-slot:not(.empty) .imprint-name[data-v-dcca238c]{opacity:0;transform:translateY(10px);transition:all .3s ease}.imprint-slot[data-v-dcca238c]:not(.empty):hover{transform:scale(1.1)}.imprint-slot:not(.empty):hover .imprint-name[data-v-dcca238c]{opacity:1;transform:translateY(0)}.imprint-slot[data-v-dcca238c]:not(.empty):hover::before{border-color:#f0e6d2}.imprint-slot[data-level="1"][data-v-dcca238c]::before{box-shadow:inset 0 0 15px rgba(10,15,30,.8),0 0 6.5px hsla(48,100%,62%,.4444444444),0 0 13px hsla(48,100%,62%,.2444444444);border-color:hsla(48,100%,62%,.8)}.imprint-slot[data-level="2"][data-v-dcca238c]::before{box-shadow:inset 0 0 15px rgba(10,15,30,.8),0 0 8px hsla(48,100%,64%,.4888888889),0 0 16px hsla(48,100%,64%,.2888888889);border-color:hsla(48,100%,64%,.8)}.imprint-slot[data-level="3"][data-v-dcca238c]::before{box-shadow:inset 0 0 15px rgba(10,15,30,.8),0 0 9.5px hsla(48,100%,66%,.5333333333),0 0 19px hsla(48,100%,66%,.3333333333);border-color:hsla(48,100%,66%,.8)}.imprint-slot[data-level="4"][data-v-dcca238c]::before{box-shadow:inset 0 0 15px rgba(10,15,30,.8),0 0 11px hsla(48,100%,68%,.5777777778),0 0 22px hsla(48,100%,68%,.3777777778);border-color:hsla(48,100%,68%,.8)}.imprint-slot[data-level="5"][data-v-dcca238c]::before{box-shadow:inset 0 0 15px rgba(10,15,30,.8),0 0 12.5px hsla(48,100%,70%,.6222222222),0 0 25px hsla(48,100%,70%,.4222222222);border-color:hsla(48,100%,70%,.8)}.imprint-slot[data-level="6"][data-v-dcca238c]::before{box-shadow:inset 0 0 15px rgba(10,15,30,.8),0 0 14px hsla(48,100%,72%,.6666666667),0 0 28px hsla(48,100%,72%,.4666666667);border-color:hsla(48,100%,72%,.8)}.imprint-slot[data-level="7"][data-v-dcca238c]::before{box-shadow:inset 0 0 15px rgba(10,15,30,.8),0 0 15.5px hsla(48,100%,74%,.7111111111),0 0 31px hsla(48,100%,74%,.5111111111);border-color:hsla(48,100%,74%,.8)}.imprint-slot[data-level="8"][data-v-dcca238c]::before{box-shadow:inset 0 0 15px rgba(10,15,30,.8),0 0 17px hsla(48,100%,76%,.7555555556),0 0 34px hsla(48,100%,76%,.5555555556);border-color:hsla(48,100%,76%,.8)}.imprint-slot[data-level="9"][data-v-dcca238c]::before{box-shadow:inset 0 0 15px rgba(10,15,30,.8),0 0 18.5px hsla(48,100%,78%,.8),0 0 37px hsla(48,100%,78%,.6);border-color:hsla(48,100%,78%,.8)}.imprint-name[data-v-dcca238c]{position:absolute;bottom:-25px;width:120%;text-align:center;font-size:12px;color:#f0e6d2;background:rgba(10,15,30,.7);padding:2px 0;border-radius:3px;pointer-events:none}.detail-placeholder[data-v-dcca238c]{margin-top:24px;color:#a0a0a0;font-style:italic;text-align:center}.imprint-slot.clickable[data-v-dcca238c]{cursor:pointer}.imprint-slot.clickable[data-v-dcca238c]:hover{background-color:rgba(212,175,55,.1);transform:translateY(-2px)}.empty-text[data-v-dcca238c]{color:#a0a0a0;font-size:16px}
.item-detail-panel[data-v-11d93009]{padding:24px;background-color:rgba(10,15,30,.3);border-radius:5px;height:100%;overflow-y:auto}.item-detail-panel[data-v-11d93009]::-webkit-scrollbar{width:6px;height:6px}.item-detail-panel[data-v-11d93009]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.item-detail-panel[data-v-11d93009]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.item-detail-panel[data-v-11d93009]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.empty-detail[data-v-11d93009]{display:flex;justify-content:center;align-items:center;height:100%;color:#a0a0a0;font-style:italic;background-color:rgba(10,15,30,.3);border-radius:5px}.detail-name[data-v-11d93009]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px;color:#f0e6d2;margin-bottom:8px}.detail-meta[data-v-11d93009]{display:flex;gap:16px;margin-bottom:16px;font-size:12px}.meta-tier[data-v-11d93009]{font-weight:bold}.meta-type[data-v-11d93009]{color:rgb(236.5,236.5,236.5)}.detail-desc[data-v-11d93009]{color:#f0e6d2;line-height:1.7;margin-bottom:24px;font-size:14px}.detail-effects h5[data-v-11d93009]{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#3a8f9d;margin-bottom:8px}.detail-effects ul[data-v-11d93009]{list-style:none;padding-left:0;margin-bottom:16px}.detail-effects li[data-v-11d93009]{color:#a0a0a0;margin-bottom:4px}
.inventory-panel[data-v-484e88e6]{padding:24px;height:100%;overflow:hidden}.inventory-layout[data-v-484e88e6]{display:grid;grid-template-rows:auto 1fr;gap:24px;height:100%;width:100%}.category-header[data-v-484e88e6]{flex-shrink:0;background-color:rgba(10,15,30,.3);border-radius:5px;padding:8px}.category-header ul[data-v-484e88e6]{list-style:none;padding:0;margin:0;display:flex;gap:8px}.category-header li[data-v-484e88e6]{padding:8px 16px;cursor:pointer;border-radius:3px;transition:background-color .3s ease;color:#a0a0a0}.category-header li[data-v-484e88e6]:hover{background-color:rgba(58,143,157,.1)}.category-header li.active[data-v-484e88e6]{background-color:rgba(58,143,157,.2);color:#3a8f9d;font-weight:bold}.main-content[data-v-484e88e6]{display:grid;grid-template-columns:2fr 1fr;gap:24px;min-width:0;min-height:0}.item-grid-container[data-v-484e88e6]{overflow-y:auto}.item-grid-container[data-v-484e88e6]::-webkit-scrollbar{width:6px;height:6px}.item-grid-container[data-v-484e88e6]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.item-grid-container[data-v-484e88e6]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.item-grid-container[data-v-484e88e6]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.item-grid[data-v-484e88e6]{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:16px}.item-cell[data-v-484e88e6]{aspect-ratio:1;border:1px solid var(--tier-border-color,#a0a0a0);background-color:rgba(10,15,30,.5);border-radius:3px;cursor:pointer;transition:all .3s ease;display:flex;flex-direction:column;justify-content:space-between;padding:8px}.item-cell[data-v-484e88e6]:hover{transform:translateY(-2px);box-shadow:0 4px 10px rgba(0,0,0,.4)}.item-cell.selected[data-v-484e88e6]{transform:translateY(-2px);box-shadow:0 0 15px var(--tier-border-color);border-width:2px}.item-cell .item-name[data-v-484e88e6]{font-size:14px;color:#e0e0e0;text-align:center}.item-cell .item-quantity[data-v-484e88e6]{font-size:12px;color:#a0a0a0;text-align:right}.empty-grid[data-v-484e88e6]{display:flex;justify-content:center;align-items:center;height:100%;color:#a0a0a0;font-style:italic}
.follow-btn[data-v-9ca898fa]{background:none;border:none;color:#a0a0a0;cursor:pointer;font-size:1.2rem;transition:color .2s ease,transform .2s ease}.follow-btn[data-v-9ca898fa]:hover{color:#d4af37;transform:scale(1.2)}.follow-btn.followed[data-v-9ca898fa]{color:#d4af37;text-shadow:0 0 5px #d4af37}
.grid-layout[data-v-221487f4]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:24px}.detail-item .detail-key[data-v-221487f4]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:16px;display:block;margin-bottom:16px}.detail-item .detail-value[data-v-221487f4]{color:#e0e0e0;font-size:14px;line-height:1.7}.detail-item .detail-value p[data-v-221487f4]{margin:0;white-space:pre-wrap}.detail-item .detail-value .tag[data-v-221487f4]{display:inline-block;background-color:rgba(58,143,157,.15);color:#3a8f9d;padding:4px 8px;border-radius:3px;margin-right:8px;margin-bottom:8px}.history-list[data-v-221487f4]{list-style:none;padding:0}.history-list li[data-v-221487f4]{margin-bottom:16px}.history-list li strong[data-v-221487f4]{color:#f0e6d2}.history-list li p[data-v-221487f4]{color:#a0a0a0;font-size:12px}.influence-text[data-v-221487f4]{color:#3a8f9d;font-style:italic;font-size:12px;margin-top:8px}.influence-text[data-v-221487f4]::before{content:"影响：";font-weight:bold}
.art-detail[data-v-4b328335]{padding:16px;color:#e0e0e0}.art-name[data-v-4b328335]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:18px;margin-top:0;margin-bottom:16px;text-align:center}.art-meta[data-v-4b328335]{display:flex;justify-content:center;gap:32px;margin-bottom:24px;color:#a0a0a0;font-size:12px}.art-meta span strong[data-v-4b328335]{color:#d4af37}.art-description[data-v-4b328335]{font-style:italic;text-align:center;margin-bottom:24px;color:#a0a0a0}.effects[data-v-4b328335]{background:rgba(10,15,30,.3);padding:16px;border-radius:3px;margin-bottom:24px}.effects p[data-v-4b328335]{margin:0 0 8px 0}.effects strong[data-v-4b328335]{color:#3a8f9d}.skills-section[data-v-4b328335]{margin-top:32px}.skills-section h5[data-v-4b328335]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;border-bottom:1px solid rgba(212,175,55,.3);padding-bottom:8px;margin-bottom:16px}.skills-section ul[data-v-4b328335]{list-style:none;padding:0;margin:0}.skills-section li[data-v-4b328335]{margin-bottom:16px}.skills-section li strong[data-v-4b328335]{color:#e0e0e0}.skills-section li p[data-v-4b328335]{margin:4px 0 0 0;color:#a0a0a0;font-size:12px}
.talent-detail[data-v-7ee5fcf5]{padding:16px;color:#e0e0e0}.talent-name[data-v-7ee5fcf5]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:18px;margin-top:0;margin-bottom:16px;text-align:center}.talent-meta[data-v-7ee5fcf5]{display:flex;justify-content:center;gap:32px;margin-bottom:24px;color:#a0a0a0;font-size:12px}.talent-meta .meta-item strong[data-v-7ee5fcf5]{color:#d4af37}.talent-description[data-v-7ee5fcf5]{font-size:14px;line-height:1.7;text-align:justify}
.attribute-grid[data-v-3cb45dc2]{display:flex;flex-wrap:wrap;gap:24px}.attribute-item[data-v-3cb45dc2]{display:flex;flex-direction:column;align-items:flex-start;gap:8px;background-color:rgba(10,15,30,.3);padding:16px;border-radius:5px;border:1px solid rgba(212,175,55,.1);flex-basis:45%;min-width:150px}.attribute-key[data-v-3cb45dc2]{color:#a0a0a0;font-size:12px}.attribute-value[data-v-3cb45dc2]{color:#e0e0e0;font-weight:bold;font-size:14px;white-space:pre-wrap}
li[data-v-bf3c2c3e]{display:contents}.object-key[data-v-bf3c2c3e]{color:#f0e6d2;font-weight:bold;cursor:help;text-align:right;white-space:nowrap;padding-bottom:24px}.value-cell[data-v-bf3c2c3e]{padding-bottom:24px;min-width:0}.value-cell>ul[data-v-bf3c2c3e]{list-style-type:none;padding-left:16px;margin-top:8px;border-left:1px solid rgba(212,175,55,.2);display:grid;grid-template-columns:auto 1fr;gap:8px 16px}.value-cell>ul.multi-column[data-v-bf3c2c3e]{grid-template-columns:repeat(2,auto 1fr);gap:8px 24px}.object-value[data-v-bf3c2c3e]{color:#e0e0e0}.progress-bar-container[data-v-bf3c2c3e]{width:100%;background-color:rgba(10,15,30,.5);border-radius:3px;position:relative;height:24px;border:1px solid rgba(212,175,55,.3)}.progress-bar[data-v-bf3c2c3e]{background:linear-gradient(90deg,rgba(58,143,157,0.5) 0%,rgba(58,143,157,0.8) 100%);height:100%;border-radius:3px;transition:width .3s ease}.progress-text[data-v-bf3c2c3e]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#e0e0e0;font-size:12px;text-shadow:1px 1px 2px #0a0f1e}.data-item[data-v-bf3c2c3e]{display:flex;flex-direction:column;gap:4px}.data-item-row[data-v-bf3c2c3e]{display:grid;grid-template-columns:80px 1fr}.data-item-key[data-v-bf3c2c3e]{color:#d4af37;font-weight:normal;text-align:right;padding-right:8px}.data-item-value[data-v-bf3c2c3e]{color:#e0e0e0}
.object-renderer:not(.is-nested)>ul.multi-column[data-v-63d33886]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px 32px}ul[data-v-63d33886]{list-style-type:none;padding:0;margin:0;display:grid;grid-template-columns:auto 1fr;gap:8px 16px}ul.multi-column[data-v-63d33886]{grid-template-columns:repeat(2,auto 1fr);gap:8px 24px}li[data-v-63d33886]{display:contents}.object-key[data-v-63d33886]{color:#f0e6d2;font-weight:bold;cursor:help;text-align:right;white-space:nowrap;padding-bottom:24px}.value-cell[data-v-63d33886]{padding-bottom:24px}.value-cell[data-v-63d33886]{min-width:0}.object-value[data-v-63d33886]{color:#e0e0e0}.is-nested ul[data-v-63d33886]{padding-left:16px;margin-top:8px;border-left:1px solid rgba(212,175,55,.2)}.progress-bar-container[data-v-63d33886]{width:100%;background-color:rgba(10,15,30,.5);border-radius:3px;position:relative;height:24px;border:1px solid rgba(212,175,55,.3)}.progress-bar[data-v-63d33886]{background:linear-gradient(90deg,rgba(58,143,157,0.5) 0%,rgba(58,143,157,0.8) 100%);height:100%;border-radius:3px;transition:width .3s ease}.progress-text[data-v-63d33886]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#e0e0e0;font-size:12px;text-shadow:1px 1px 2px #0a0f1e}
.grid-layout[data-v-4bffb608]{display:grid;grid-template-columns:1fr;gap:24px}.detail-item.full-width[data-v-4bffb608]{grid-column:1/-1}.detail-item .detail-key[data-v-4bffb608]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:16px;display:block;margin-bottom:16px}.placeholder[data-v-4bffb608]{color:#a0a0a0;font-style:italic}.tags-container[data-v-4bffb608]{display:flex;flex-wrap:wrap;gap:8px}.tag[data-v-4bffb608]{display:inline-block;background-color:rgba(58,143,157,.15);color:#3a8f9d;padding:4px 8px;border-radius:3px}.talent-tag[data-v-4bffb608]{background-color:rgba(212,175,55,.2);color:#f0e6d2;cursor:help}.skills-list[data-v-4bffb608]{display:flex;flex-direction:column;gap:8px}.skill-item[data-v-4bffb608]{background:rgba(10,15,30,.4);border-radius:3px;padding:8px 16px;cursor:pointer;transition:background-color .2s ease}.skill-item[data-v-4bffb608]:hover{background:rgba(58,143,157,.1)}.skill-header[data-v-4bffb608]{display:flex;justify-content:space-between;align-items:center}.skill-header h3[data-v-4bffb608]{margin:0;font-size:14px;color:#e0e0e0}.skill-level[data-v-4bffb608]{font-size:12px;color:#a0a0a0}
.progress-bar-container[data-v-780a870c]{display:flex;align-items:center;gap:16px;width:100%}.label[data-v-780a870c]{color:#a0a0a0;font-size:12px;flex-basis:60px;flex-shrink:0;white-space:nowrap}.progress-track[data-v-780a870c]{position:relative;flex-grow:1;height:8px;background-color:rgba(10,15,30,.5);border-radius:4px;overflow:hidden}.center-tick[data-v-780a870c]{position:absolute;left:50%;top:0;bottom:0;width:1px;background-color:rgba(160,160,160,.5)}.progress-fill[data-v-780a870c]{position:absolute;top:0;bottom:0;height:100%;border-radius:4px;transition:width .5s ease,left .5s ease,right .5s ease}.value[data-v-780a870c]{color:#e0e0e0;font-size:12px;font-weight:bold;flex-basis:40px;flex-shrink:0;text-align:right}
.relation-list[data-v-763d7aea]{list-style:none;padding:0;margin:0}.relation-item[data-v-763d7aea]{border-bottom:1px solid rgba(212,175,55,.1);padding:16px 0}.relation-header[data-v-763d7aea]{display:flex;justify-content:space-between;align-items:center;cursor:pointer}.relation-name[data-v-763d7aea]{font-weight:bold;color:#e0e0e0}.relation-tags .tag[data-v-763d7aea]{font-size:12px;background-color:rgba(224,224,224,.1);color:#a0a0a0;padding:2px 6px;border-radius:3px;margin-left:8px}.relation-details[data-v-763d7aea]{margin-top:16px;padding:16px;background-color:rgba(10,15,30,.3);border-radius:5px;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:24px}.vector-group[data-v-763d7aea]{display:flex;flex-direction:column;gap:16px}.group-title[data-v-763d7aea]{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;margin-bottom:8px;border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:8px}
.inventory-grid[data-v-289f38ac]{width:100%}.grid-container[data-v-289f38ac]{display:grid;grid-template-columns:repeat(5,1fr);gap:16px}.item-cell[data-v-289f38ac]{position:relative;background-color:rgba(10,15,30,.4);border:1px solid rgba(212,175,55,.2);border-radius:5px;padding:8px;aspect-ratio:1/1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;font-size:12px}.item-name[data-v-289f38ac]{color:#e0e0e0;font-weight:bold}.item-quantity[data-v-289f38ac]{position:absolute;bottom:4px;right:6px;font-size:10px;color:#a0a0a0}.empty-inventory[data-v-289f38ac]{color:#a0a0a0;text-align:center;padding:24px 0}
.grid-layout[data-v-06bf308e]{display:grid;grid-template-columns:1fr;gap:24px}.detail-item.full-width[data-v-06bf308e]{grid-column:1/-1}.detail-item .detail-key[data-v-06bf308e]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:16px;display:block;margin-bottom:16px}
.memory-list[data-v-06bf308e]{display:flex;flex-direction:column;gap:16px}.memory-item[data-v-06bf308e]{background-color:rgba(10,15,30,.4);padding:8px;border-radius:3px;border-left:3px solid #8a5db5}.memory-event[data-v-06bf308e],.memory-influence[data-v-06bf308e]{margin:0;padding:2px 0;color:#a0a0a0;line-height:1.6}.memory-event strong[data-v-06bf308e],.memory-influence strong[data-v-06bf308e]{color:#8a5db5;font-weight:bold}.placeholder[data-v-06bf308e]{color:#a0a0a0;font-style:italic}
.npc-detail-display[data-v-7a2f4260]{display:flex;flex-direction:column;height:100%}.tabs[data-v-7a2f4260]{display:flex;flex-shrink:0;border-bottom:1px solid rgba(212,175,55,.3)}.tabs button[data-v-7a2f4260]{background:none;border:none;color:#a0a0a0;padding:16px 24px;cursor:pointer;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:16px;transition:all .2s ease;border-bottom:2px solid rgba(0,0,0,0)}.tabs button.active[data-v-7a2f4260]{color:#f0e6d2;border-bottom-color:#d4af37}.tabs button[data-v-7a2f4260]:hover{color:#e0e0e0}.tab-content[data-v-7a2f4260]{flex-grow:1;overflow-y:auto;padding:24px}.tab-content[data-v-7a2f4260]::-webkit-scrollbar{width:6px;height:6px}.tab-content[data-v-7a2f4260]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.tab-content[data-v-7a2f4260]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.tab-content[data-v-7a2f4260]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.placeholder[data-v-7a2f4260]{display:flex;justify-content:center;align-items:center;height:100%;color:#a0a0a0;font-size:16px}
.npc-directory-panel[data-v-73769044]{display:grid;grid-template-columns:1fr 1.5fr;height:100%;position:relative;background:#0a0f1e;color:#e0e0e0}.search-input[data-v-73769044]{width:100%;padding:8px;margin-bottom:16px;background-color:rgba(10,15,30,.5);border:1px solid #a0a0a0;color:#e0e0e0;border-radius:3px}.world-list-overlay[data-v-73769044]{position:absolute;top:0;left:0;bottom:0;width:250px;background-color:rgba(10,15,30,.85);backdrop-filter:blur(8px);z-index:10;border-right:1px solid rgba(212,175,55,.3);padding:16px}.world-list-column ul[data-v-73769044],.npc-list[data-v-73769044]{list-style:none;padding:0;margin:0}.world-list-column ul li[data-v-73769044],.npc-list li[data-v-73769044]{padding:8px 16px;cursor:pointer;border-radius:3px;transition:background-color .2s ease;display:flex;justify-content:space-between;align-items:center}.world-list-column ul li[data-v-73769044]:hover,.npc-list li[data-v-73769044]:hover{background-color:rgba(58,143,157,.1)}.world-list-column ul li.active[data-v-73769044],.npc-list li.active[data-v-73769044]{background-color:#3a8f9d;color:#0a0f1e;font-weight:bold}.toggle-world-list[data-v-73769044]{position:absolute;top:12px;left:12px;z-index:20;background:rgba(10,15,30,.7);border:1px solid #d4af37;color:#d4af37;padding:5px 10px;border-radius:5px;cursor:pointer;font-family:"ZCOOL KuaiLe","篆书",cursive}[class*=-column][data-v-73769044]{padding:16px;overflow-y:auto;border-right:1px solid rgba(212,175,55,.15)}[class*=-column][data-v-73769044]:last-child{border-right:none}[class*=-column] h4[data-v-73769044]{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;text-align:center;margin-top:0;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid rgba(212,175,55,.3)}.npc-info[data-v-73769044]{display:flex;flex-direction:column}.npc-location[data-v-73769044]{font-size:12px;color:#a0a0a0;margin-top:4px}
.log-panel-container[data-v-03bc3d58]{height:100%;overflow-y:auto;padding:24px}.log-panel-container[data-v-03bc3d58]::-webkit-scrollbar{width:6px;height:6px}.log-panel-container[data-v-03bc3d58]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.log-panel-container[data-v-03bc3d58]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.log-panel-container[data-v-03bc3d58]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.log-panel-container[data-v-03bc3d58]{background-color:rgba(0,0,0,0)}.timeline[data-v-03bc3d58]{position:relative;margin:0 auto;padding:24px 0;width:100%;list-style:none}.timeline[data-v-03bc3d58]::before{content:"";position:absolute;top:0;left:20px;height:100%;width:2px;background:rgba(212,175,55,.2)}.timeline-item[data-v-03bc3d58]{margin-bottom:32px;position:relative;padding-left:55px}.timeline-item[data-v-03bc3d58]:last-child{margin-bottom:0}.timeline-marker[data-v-03bc3d58]{position:absolute;top:4px;left:12px;width:18px;height:18px;border-radius:50%;background:#16212c;border:3px solid #3a8f9d;z-index:1;box-shadow:0 0 10px rgba(58,143,157,.7)}.timeline-content[data-v-03bc3d58]{position:relative;background-color:rgba(22,33,44,.6);border:1px solid rgba(212,175,55,.3);border-radius:5px;padding:16px;transition:all .3s ease;cursor:pointer;backdrop-filter:blur(8px)}.timeline-content[data-v-03bc3d58]:hover{border-color:rgba(240,230,210,.7);background-color:rgba(22,33,44,.8);box-shadow:0 5px 25px rgba(10,15,30,.6)}.log-header[data-v-03bc3d58]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}.log-title[data-v-03bc3d58]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:16px;color:#f0e6d2;font-weight:700}.log-date[data-v-03bc3d58]{font-size:12px;color:#a0a0a0;white-space:nowrap;margin-left:16px}.log-meta[data-v-03bc3d58]{font-size:12px;color:#a0a0a0;margin-bottom:16px;display:flex;flex-wrap:wrap;gap:16px}.log-meta span[data-v-03bc3d58]{display:flex;align-items:center}.log-meta span .icon[data-v-03bc3d58]{margin-right:4px;color:#3a8f9d}.log-description[data-v-03bc3d58]{font-size:14px;line-height:1.7;color:#d3d3d3;margin:0}.log-details[data-v-03bc3d58]{margin-top:16px;padding-top:16px;border-top:1px dashed rgba(212,175,55,.2);animation:fadeIn-03bc3d58 .5s ease}.log-details .detail-section[data-v-03bc3d58]{margin-bottom:8px}.log-details .detail-section strong[data-v-03bc3d58]{display:block;color:#f0e6d2;margin-bottom:4px;font-family:"Siyuan Song","Source Han Serif SC",serif}.log-details .detail-section p[data-v-03bc3d58],.log-details .detail-section pre[data-v-03bc3d58]{background-color:rgba(10,15,30,.4);padding:8px;border-radius:3px;color:hsl(0,0%,77.7450980392%);font-size:12px;white-space:pre-wrap;word-break:break-word;line-height:1.6}.log-tags[data-v-03bc3d58]{margin-top:16px;display:flex;flex-wrap:wrap;gap:8px}.log-tags .tag[data-v-03bc3d58]{display:inline-block;padding:.25em .6em;font-size:75%;font-weight:700;line-height:1;text-align:center;white-space:nowrap;vertical-align:baseline;border-radius:5px;background-color:rgba(58,143,157,.1);color:#3a8f9d}.empty-state[data-v-03bc3d58]{text-align:center;padding:32px;color:#a0a0a0}@keyframes fadeIn-03bc3d58{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
.ripples-panel[data-v-c8ad07aa]{height:100%;display:flex;flex-direction:column}.ripples-list[data-v-c8ad07aa]{height:100%;overflow-y:auto}.ripples-list[data-v-c8ad07aa]::-webkit-scrollbar{width:6px;height:6px}.ripples-list[data-v-c8ad07aa]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.ripples-list[data-v-c8ad07aa]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.ripples-list[data-v-c8ad07aa]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.ripples-list ul[data-v-c8ad07aa]{list-style:none;padding:0;margin:0}.ripples-list li[data-v-c8ad07aa]{padding:16px;border-bottom:1px solid rgba(212,175,55,.2);cursor:pointer;transition:background-color .2s ease}.ripples-list li[data-v-c8ad07aa]:hover{background-color:rgba(240,230,210,.1)}.ripples-list .ripple-title[data-v-c8ad07aa]{display:block;font-size:16px;color:#f0e6d2;margin-bottom:4px}.ripples-list .ripple-summary[data-v-c8ad07aa]{font-size:12px;color:#a0a0a0}.ripple-detail[data-v-c8ad07aa]{height:100%;display:flex;flex-direction:column}.ripple-detail .back-button[data-v-c8ad07aa]{margin-bottom:16px;align-self:flex-start}.ripple-detail .detail-content[data-v-c8ad07aa]{flex-grow:1;overflow-y:auto}.ripple-detail .detail-content[data-v-c8ad07aa]::-webkit-scrollbar{width:6px;height:6px}.ripple-detail .detail-content[data-v-c8ad07aa]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.ripple-detail .detail-content[data-v-c8ad07aa]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.ripple-detail .detail-content[data-v-c8ad07aa]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.ripple-detail .detail-content[data-v-c8ad07aa]{padding-right:8px}.ripple-detail .detail-item[data-v-c8ad07aa]{margin-bottom:24px}.ripple-detail .detail-key[data-v-c8ad07aa]{font-weight:bold;color:#f0e6d2;margin-bottom:4px;display:block}.ripple-detail .detail-value[data-v-c8ad07aa]{white-space:pre-wrap;word-wrap:break-word;color:#e0e0e0;font-family:inherit;font-size:14px}.empty-state[data-v-c8ad07aa]{text-align:center;padding:32px;color:#a0a0a0}
.avatar-selection[data-v-375c1c96]{display:grid;grid-template-columns:1fr;gap:1rem}.avatar-card[data-v-375c1c96]{border:1px solid #ccc;padding:1rem;border-radius:8px;cursor:pointer;transition:all .2s ease}.avatar-card[data-v-375c1c96]:hover{border-color:#007bff;box-shadow:0 0 10px rgba(0,123,255,.5)}.avatar-card h4[data-v-375c1c96]{margin-top:0}
@keyframes pulse-star{0%,100%{transform:scale(1);opacity:.8;box-shadow:0 0 8px currentColor}50%{transform:scale(1.3);opacity:1;box-shadow:0 0 16px currentColor,0 0 24px currentColor}}@keyframes rotate-orbit{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}@keyframes swirl-background{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}.world-selection-container{height:100%;position:relative;display:flex;flex-direction:column;overflow:hidden;background-color:#05050a}.loading-state{display:flex;justify-content:center;align-items:center;flex-direction:column;gap:16px;height:100%;font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;font-size:1.2rem;text-shadow:0 0 8px #f0e6d2}.progress-bar-container{width:80%;height:10px;background-color:rgba(10,15,30,.5);border-radius:5px;border:1px solid rgba(212,175,55,.3);overflow:hidden}.progress-bar{height:100%;background:linear-gradient(90deg,#3a8f9d,#d4af37);transition:width .1s linear;border-radius:5px}.star-map{flex-grow:1;position:relative;background:rgba(0,0,0,0) !important;background-size:250% 250%,auto;animation:swirl-background 120s ease-in-out infinite;border-radius:5px;overflow:hidden;display:flex;justify-content:center;align-items:center}.star-orbits{position:absolute;width:100%;height:100%}.star-orbits .orbit{position:absolute;top:50%;left:50%;border:1px dashed rgba(212,175,55,.2);border-radius:50%;transform-origin:center;animation-name:rotate-orbit;animation-timing-function:linear;animation-iteration-count:infinite}.star-orbits .orbit.orbit-1{width:30%;height:30%;margin:-15% 0 0 -15%;animation-direction:normal}.star-orbits .orbit.orbit-2{width:55%;height:55%;margin:-27.5% 0 0 -27.5%;animation-direction:reverse}.star-orbits .orbit.orbit-3{width:80%;height:80%;margin:-40% 0 0 -40%;animation-direction:normal}.star{position:absolute;border-radius:50%;cursor:pointer;animation:pulse-star 15s infinite ease-in-out;transition:transform .5s ease,box-shadow .5s ease}.star.size-small{width:8px;height:8px}.star.size-medium{width:12px;height:12px}.star.size-large{width:16px;height:16px}.star.color-blue{background-color:#3a8f9d}.star.color-yellow{background-color:#d4af37}.star.color-red{background-color:#c74343}.star.selected{transform:scale(1.8);box-shadow:0 0 20px #fff,0 0 30px currentColor;z-index:10}.world-detail-panel{position:absolute;top:0;right:-400px;width:350px;height:100%;border-left:1px solid rgba(212,175,55,.4);box-shadow:-10px 0 30px rgba(0,0,0,.5);transition:right .5s cubic-bezier(0.25,0.8,0.25,1);z-index:20;padding:24px;display:flex;flex-direction:column}.world-detail-panel.visible{right:0}.world-detail-panel h4{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;font-size:24px;text-align:center;margin-bottom:24px;text-shadow:0 0 8px #f0e6d2}.world-detail-panel .detail-item{margin-bottom:16px}.world-detail-panel .detail-item p{margin:0;color:#a0a0a0}.world-detail-panel .detail-item p strong{color:#e0e0e0;font-weight:normal}.world-detail-panel .world-description{flex-grow:1;overflow-y:auto}.world-detail-panel .world-description::-webkit-scrollbar{width:6px;height:6px}.world-detail-panel .world-description::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.world-detail-panel .world-description::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.world-detail-panel .world-description::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.world-detail-panel .world-description{font-size:14px;line-height:1.7;color:#e0e0e0;background:rgba(10,15,30,.3);padding:16px;border-radius:3px}.world-detail-panel .panel-footer{margin-top:24px;text-align:center}.map-controls{display:flex;align-items:center;gap:16px;position:absolute;bottom:16px;left:50%;transform:translateX(-50%);z-index:30;padding:8px 16px}.map-controls .constellation-info{color:#e0d8c0;font-family:"Noto Serif SC",serif}.map-controls .rescan-btn{margin-left:24px;background-color:rgba(4,30,66,.5);border:1px solid rgba(137,221,255,.3);opacity:.7;transition:all .3s ease}.map-controls .rescan-btn:hover{background-color:rgba(4,30,66,.8);opacity:1;border-color:rgba(137,221,255,.7)}.evolving-overlay{display:flex;justify-content:center;align-items:center;flex-direction:column;gap:24px;position:absolute;top:0;left:0;width:100%;height:100%;color:#f0e6d2;font-size:1.2rem;z-index:10}.evolving-overlay .spinner{width:40px;height:40px;border:3px solid rgba(212,175,55,.3);border-top-color:#d4af37;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
.world-selection-container[data-v-189e8ce4]{overflow:hidden}.star-map-canvas[data-v-189e8ce4]{width:100%;height:100%;position:absolute;top:0;left:0;cursor:grab}.star-map-canvas[data-v-189e8ce4]:active{cursor:grabbing}.unselectable-notice[data-v-189e8ce4]{text-align:center;color:#a0a0a0;font-style:italic}.map-controls[data-v-189e8ce4]{position:absolute;bottom:20px;right:20px}.speed-controls-overlay[data-v-189e8ce4]{position:absolute;top:50%;left:30px;transform:translateY(-50%);display:flex;flex-direction:column;align-items:center;gap:8px;z-index:10}.speed-controls-overlay .control-btn[data-v-189e8ce4]{position:relative;width:32px;height:32px;border-radius:50%;background:rgba(0,0,0,0);border:1px solid rgba(212,175,55,.4);color:#f0e6d2;font-size:24px;line-height:1;cursor:pointer;transition:all .3s ease;display:flex;justify-content:center;align-items:center}.speed-controls-overlay .control-btn[data-v-189e8ce4]::before{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;height:80%;border-radius:50%;border:1px solid rgba(58,143,157,.5);transition:all .3s ease}.speed-controls-overlay .control-btn[data-v-189e8ce4]:hover{border-color:#d4af37;color:#e0e0e0;box-shadow:0 0 10px rgba(212,175,55,.5)}.speed-controls-overlay .control-btn[data-v-189e8ce4]:hover::before{transform:translate(-50%,-50%) scale(1.2);opacity:0}.speed-controls-overlay .speed-bar-container[data-v-189e8ce4]{width:8px;height:100px;background:rgba(10,15,30,.5);border-radius:4px;position:relative;border:1px solid rgba(212,175,55,.2);overflow:hidden;display:flex;flex-direction:column-reverse}.speed-controls-overlay .speed-bar-fill[data-v-189e8ce4]{width:100%;background:linear-gradient(to top,#3a8f9d,#f0e6d2);transition:height .3s ease}
.settlement-overlay[data-v-fd6b92fa]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.75);display:flex;justify-content:center;align-items:center;z-index:2000}.settlement-panel[data-v-fd6b92fa]{width:90%;max-width:800px;height:90vh;background:#1a1a1a;color:#e0e0e0;border-radius:12px;border:1px solid #444;box-shadow:0 10px 30px rgba(0,0,0,.5);display:flex;flex-direction:column}.settlement-header[data-v-fd6b92fa]{padding:1.5rem;border-bottom:1px solid #444;text-align:center}.settlement-header h2[data-v-fd6b92fa]{margin:0;font-size:2rem;font-weight:300;color:#0af}.settlement-content[data-v-fd6b92fa]{flex-grow:1;overflow-y:auto;padding:2rem}.content-grid[data-v-fd6b92fa]{display:grid;grid-template-columns:1fr 1fr;gap:2rem}.grid-item[data-v-fd6b92fa]{background:#2b2b2b;padding:1.5rem;border-radius:8px}.grid-item h3[data-v-fd6b92fa]{margin-top:0;margin-bottom:1rem;font-size:1.2rem;color:#0af;border-bottom:1px solid #444;padding-bottom:.5rem}.grid-item p[data-v-fd6b92fa]{margin:0;font-size:.95rem;line-height:1.7;color:#c5c5c5}.full-width[data-v-fd6b92fa]{grid-column:1/-1}.cause-of-death[data-v-fd6b92fa]{color:#ff4d4d;font-weight:bold}.evaluation[data-v-fd6b92fa]{font-style:italic;color:#0fc}.settlement-footer[data-v-fd6b92fa]{padding:1.5rem;border-top:1px solid #444;text-align:center}.settlement-footer button[data-v-fd6b92fa]{padding:.75rem 2.5rem;border:1px solid #0af;border-radius:25px;background:rgba(0,0,0,0);color:#0af;font-size:1.1rem;cursor:pointer;transition:all .3s ease}.settlement-footer button[data-v-fd6b92fa]:hover{background:#0af;color:#1a1a1a;box-shadow:0 0 15px #0af}
.reincarnation-panel[data-v-e142f334]{display:flex;flex-direction:column;height:100%;padding:16px}.tabs-container[data-v-e142f334]{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(58,143,157,.2);margin-bottom:16px}.tabs[data-v-e142f334]{display:flex;gap:16px}.tabs button[data-v-e142f334]{padding:8px 16px;border:none;background:none;cursor:pointer;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:16px;color:#a0a0a0;position:relative;transition:color .3s ease}.tabs button[data-v-e142f334]::after{content:"";position:absolute;bottom:-1px;left:0;width:100%;height:2px;background-color:#d4af37;transform:scaleX(0);transition:transform .3s ease}.tabs button[data-v-e142f334]:hover{color:#e0e0e0}.tabs button.active[data-v-e142f334]{color:#f0e6d2}.tabs button.active[data-v-e142f334]::after{transform:scaleX(1)}.tabs button[data-v-e142f334]:disabled{color:rgba(160,160,160,.4);cursor:not-allowed}.tab-content[data-v-e142f334]{flex-grow:1;overflow-y:auto}.tab-content[data-v-e142f334]::-webkit-scrollbar{width:6px;height:6px}.tab-content[data-v-e142f334]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.tab-content[data-v-e142f334]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.tab-content[data-v-e142f334]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}
.ripple-detail-panel[data-v-4e32e506]{padding:24px;height:100%;overflow-y:auto}.ripple-detail-panel[data-v-4e32e506]::-webkit-scrollbar{width:6px;height:6px}.ripple-detail-panel[data-v-4e32e506]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.ripple-detail-panel[data-v-4e32e506]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.ripple-detail-panel[data-v-4e32e506]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.ripple-content[data-v-4e32e506]{display:flex;flex-direction:column;gap:16px}.detail-item[data-v-4e32e506]{display:flex;flex-direction:column;padding-bottom:16px;border-bottom:1px solid rgba(212,175,55,.1)}.detail-key[data-v-4e32e506]{font-weight:bold;color:#f0e6d2;margin-bottom:4px}.detail-value[data-v-4e32e506]{white-space:pre-wrap;color:#e0e0e0;line-height:1.6}.loading-message[data-v-4e32e506]{color:#a0a0a0;text-align:center;padding:32px}
.skills-panel[data-v-385af6cc]{height:100%;padding:24px;box-sizing:border-box;overflow-y:auto}.skills-panel[data-v-385af6cc]::-webkit-scrollbar{width:6px;height:6px}.skills-panel[data-v-385af6cc]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.skills-panel[data-v-385af6cc]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.skills-panel[data-v-385af6cc]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.skills-panel h2[data-v-385af6cc]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:24px;color:rgb(252.75,251.25,248.25);text-align:center;margin-bottom:32px;text-shadow:0 0 15px rgba(212,175,55,.7),0 0 5px rgba(212,175,55,.5)}.skills-panel .empty-state[data-v-385af6cc]{display:flex;justify-content:center;align-items:center;height:100%;color:#a0a0a0;font-size:16px}.skills-panel .skills-list[data-v-385af6cc]{display:flex;flex-direction:column;gap:24px}.skills-panel .skill-item[data-v-385af6cc]{background:linear-gradient(145deg,rgba(22,33,44,0.5),rgba(10,15,30,0.5));border:1px solid rgba(212,175,55,.2);border-radius:5px;padding:16px;box-shadow:0 4px 15px rgba(0,0,0,.4);transition:all .3s ease}.skills-panel .skill-item[data-v-385af6cc]:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(212,175,55,.2);border-color:rgba(212,175,55,.4)}.skills-panel .skill-header[data-v-385af6cc]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.skills-panel .skill-header h3[data-v-385af6cc]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px;color:#f0e6d2;margin:0}.skills-panel .skill-header .skill-level[data-v-385af6cc]{font-size:14px;font-weight:bold;color:rgb(95.4441860465,181.8279069767,196.0558139535);background-color:rgba(58,143,157,.15);padding:4px 8px;border-radius:3px;border:1px solid rgba(58,143,157,.4);text-shadow:0 0 5px rgba(58,143,157,.5)}.skills-panel .skill-description[data-v-385af6cc]{font-size:14px;color:#e0e0e0;line-height:1.7;margin-bottom:16px}.skills-panel .skill-progress .progress-bar-wrapper[data-v-385af6cc]{display:flex;align-items:center;gap:16px}.skills-panel .skill-progress .progress-bar-wrapper progress[data-v-385af6cc]{flex-grow:1;height:10px;-webkit-appearance:none;appearance:none}.skills-panel .skill-progress .progress-bar-wrapper progress[data-v-385af6cc]::-webkit-progress-bar{background-color:rgba(10,15,30,.7);border-radius:5px;box-shadow:inset 0 1px 3px rgba(0,0,0,.5)}.skills-panel .skill-progress .progress-bar-wrapper progress[data-v-385af6cc]::-webkit-progress-value{background-image:linear-gradient(to right,#3a8f9d,rgb(95.4441860465,181.8279069767,196.0558139535));border-radius:5px;box-shadow:0 0 5px rgba(58,143,157,.7);-webkit-transition:width .3s ease;transition:width .3s ease}.skills-panel .skill-progress .progress-bar-wrapper .progress-text[data-v-385af6cc]{font-size:12px;color:rgb(185.5,185.5,185.5);font-weight:bold;white-space:nowrap;min-width:80px;text-align:right}.skills-panel .associated-skills[data-v-385af6cc]{margin-top:24px;padding-top:16px;border-top:1px solid rgba(212,175,55,.15)}.skills-panel .associated-skills-title[data-v-385af6cc]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:18px;color:rgb(95.4441860465,181.8279069767,196.0558139535);margin-bottom:16px;padding-bottom:8px;background:none;border:none;border-bottom:1px solid rgba(58,143,157,.2);cursor:pointer;width:100%;text-align:left;display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:3px;transition:background-color .3s ease}.skills-panel .associated-skills-title[data-v-385af6cc]:hover{background-color:rgba(58,143,157,.1)}.skills-panel .associated-skills-title .arrow[data-v-385af6cc]{border:solid rgb(76.823255814,173.288372093,189.176744186);border-width:0 2px 2px 0;display:inline-block;padding:3px;transform:rotate(45deg);transition:transform .3s ease}.skills-panel .associated-skills-title .arrow.expanded[data-v-385af6cc]{transform:rotate(-135deg)}.skills-panel .associated-skills-list[data-v-385af6cc]{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}.skills-panel .associated-skill-item[data-v-385af6cc]{display:flex;flex-direction:column;padding:16px;background-color:rgba(10,15,30,.5);border-radius:5px;border:1px solid rgba(10,15,30,.7);box-shadow:inset 0 2px 5px rgba(0,0,0,.5)}.skills-panel .associated-skill-item .skill-name[data-v-385af6cc]{font-size:14px;color:#e0e0e0;margin-bottom:8px}.skills-panel .associated-skill-item .skill-name strong[data-v-385af6cc]{font-weight:bold;color:#f0e6d2}.skills-panel .associated-skill-item .skill-detail[data-v-385af6cc]{font-size:12px;color:#a0a0a0;line-height:1.6;margin-top:4px}.skills-panel .associated-skill-item .skill-detail strong[data-v-385af6cc]{color:#3a8f9d;font-weight:normal}.skills-panel .associated-skill-item .skill-description-detail[data-v-385af6cc]{font-style:italic;color:rgb(134.5,134.5,134.5);margin-bottom:8px}
.memory-panel-container[data-v-5351f233]{padding:0;background-color:rgba(0,0,0,0);color:#e0e0e0;overflow-y:auto;height:100%;display:flex;flex-direction:column}.panel-content[data-v-5351f233]{display:flex;flex-direction:column;gap:24px;height:100%}.panel-title[data-v-5351f233]{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;text-align:center;margin-bottom:24px;flex-shrink:0}.section[data-v-5351f233]{margin-bottom:24px;padding-bottom:24px;border-bottom:1px solid rgba(212,175,55,.2)}.section[data-v-5351f233]:last-child{border-bottom:none;margin-bottom:0;flex-grow:1;display:flex;flex-direction:column}.section h4[data-v-5351f233]{color:#d4af37;margin-bottom:16px}.section .description[data-v-5351f233]{font-size:12px;color:#a0a0a0;line-height:1.6;margin-top:8px}.setting-item[data-v-5351f233]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.setting-item label[data-v-5351f233]{color:#a0a0a0}.setting-item input[type=number][data-v-5351f233]{width:80px;text-align:right}button[data-v-5351f233]{margin-right:16px}.tabs[data-v-5351f233]{display:flex;margin-bottom:16px;border-bottom:1px solid rgba(212,175,55,.3);flex-shrink:0}.tabs button[data-v-5351f233]{background:none;border:none;color:#a0a0a0;padding:8px 16px;cursor:pointer;transition:all .2s ease;border-bottom:2px solid rgba(0,0,0,0)}.tabs button.active[data-v-5351f233]{color:#f0e6d2;border-bottom-color:#f0e6d2}.memory-content[data-v-5351f233]{flex-grow:1}.memory-content textarea[data-v-5351f233]{width:100%;height:100%;min-height:200px;resize:none;background-color:rgba(10,15,30,.5);color:#e0e0e0;border:1px solid rgba(212,175,55,.2);border-radius:3px}
.save-load-panel[data-v-1dbb5532]{background-color:rgba(0,0,0,0);padding:0;display:flex;flex-direction:column;gap:24px;height:100%;border:none;border-radius:0}.panel-header[data-v-1dbb5532]{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(212,175,55,.3);padding-bottom:16px}.panel-title[data-v-1dbb5532]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px}.header-actions[data-v-1dbb5532]{display:flex;gap:16px}.header-btn[data-v-1dbb5532]{background-color:#d4af37;color:#0a0f1e;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.header-btn[data-v-1dbb5532]:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);box-shadow:0 0 10px rgba(212,175,55,.5)}.header-btn[data-v-1dbb5532]{padding:8px 24px}.save-slots-container[data-v-1dbb5532]{overflow-y:auto;display:flex;flex-direction:column;gap:32px}.slot-group[data-v-1dbb5532]{display:flex;flex-direction:column;gap:16px}.group-title[data-v-1dbb5532]{color:#e0e0e0;font-family:"Siyuan Song","Source Han Serif SC",serif;font-size:16px;font-weight:bold;border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:8px;margin-bottom:8px}.save-slot[data-v-1dbb5532]{border:1px solid rgba(212,175,55,.2);border-radius:3px;padding:16px;display:flex;justify-content:space-between;align-items:center;transition:all .2s ease-in-out}.save-slot[data-v-1dbb5532]:hover{background-color:rgba(212,175,55,.05);border-color:rgba(212,175,55,.4)}.slot-info[data-v-1dbb5532]{display:flex;flex-direction:column;gap:4px}.slot-name[data-v-1dbb5532]{color:#e0e0e0;font-weight:bold}.slot-timestamp[data-v-1dbb5532]{color:#a0a0a0;font-size:12px}.slot-world-log[data-v-1dbb5532]{margin-top:4px;padding-top:4px;border-top:1px solid rgba(212,175,55,.1);font-size:12px;color:#a0a0a0}.slot-world-log .log-date[data-v-1dbb5532]{font-style:italic}.slot-world-log .log-title[data-v-1dbb5532]{display:block;margin-top:2px;color:#e0e0e0;font-weight:500}.slot-actions[data-v-1dbb5532]{display:flex;gap:8px}.action-btn[data-v-1dbb5532]{background-color:rgba(0,0,0,0);color:#f0e6d2;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.action-btn[data-v-1dbb5532]:hover{background-color:rgba(212,175,55,.1);border-color:rgb(221.024691358,191.7901234568,96.975308642)}.action-btn[data-v-1dbb5532]{padding:4px 16px;font-size:12px}.action-btn.delete-btn[data-v-1dbb5532]{border-color:rgba(199,67,67,.6);color:rgba(199,67,67,.8)}.action-btn.delete-btn[data-v-1dbb5532]:hover:not(:disabled){background-color:rgba(199,67,67,.15);border-color:#c74343;color:#c74343}.action-btn[data-v-1dbb5532]:disabled{opacity:.4;cursor:not-allowed;border-color:#a0a0a0;color:#a0a0a0}.auto-save-toggle[data-v-1dbb5532]{margin-top:16px;color:#e0e0e0}.auto-save-toggle label[data-v-1dbb5532]{display:flex;align-items:center;gap:8px;cursor:pointer}
.system-panel[data-v-238307c0]{display:flex;flex-direction:column;height:100%;background-color:rgba(0,0,0,0)}.panel-tabs[data-v-238307c0]{display:flex;border-bottom:1px solid rgba(212,175,55,.3);padding:0 24px}.panel-tabs button[data-v-238307c0]{background-color:rgba(0,0,0,0);color:#f0e6d2;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.panel-tabs button[data-v-238307c0]:hover{background-color:rgba(212,175,55,.1);border-color:rgb(221.024691358,191.7901234568,96.975308642)}.panel-tabs button[data-v-238307c0]{border-radius:0;border-bottom:2px solid rgba(0,0,0,0);margin-bottom:-1px}.panel-tabs button.active[data-v-238307c0]{color:#f0e6d2;border-bottom-color:#f0e6d2;background-color:rgba(212,175,55,.05)}.panel-content[data-v-238307c0]{flex-grow:1;overflow:hidden;padding:24px}
.realm-detail-card[data-v-3873800d]{padding:16px;min-width:400px;display:grid;grid-template-columns:repeat(2,1fr);gap:24px}.realm-detail-card .info-item[data-v-3873800d]{display:flex;flex-direction:column;gap:4px}.realm-detail-card .info-item strong[data-v-3873800d]{font-family:"Siyuan Song","Source Han Serif SC",serif;color:#f0e6d2;font-size:12px;text-transform:uppercase;letter-spacing:1px;opacity:.7}.realm-detail-card .info-item span[data-v-3873800d],.realm-detail-card .info-item ul[data-v-3873800d]{font-size:14px;color:#e0e0e0;line-height:1.6}.realm-detail-card .info-item ul[data-v-3873800d]{padding-left:20px}.realm-detail-card .info-item.full-width[data-v-3873800d]{grid-column:1/-1}
.world-detail-panel-content[data-v-19c6fefe]{color:#e0e0e0;padding:16px;height:100%;overflow:hidden;background:rgba(0,0,0,0);font-family:"Noto Sans SC",sans-serif}.scroll-container[data-v-19c6fefe]{height:100%;overflow-y:auto;padding-right:12px}.world-section[data-v-19c6fefe]{margin-bottom:24px}.world-section[data-v-19c6fefe]:last-child{margin-bottom:0}.epoch-header[data-v-19c6fefe]{text-align:center;margin-bottom:16px}.epoch-header .section-title[data-v-19c6fefe]{margin-bottom:8px}.epoch-header .epoch-overview[data-v-19c6fefe]{font-size:.9em;color:#a0a0a0;max-width:600px;margin:0 auto;line-height:1.5}.section-title[data-v-19c6fefe]{font-family:"Noto Serif SC",serif;font-size:1.5em;color:#f0e6d2;text-align:center;margin-bottom:16px;text-shadow:0 0 10px rgba(184,134,11,.5)}.rules-grid[data-v-19c6fefe]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px}.rule-item[data-v-19c6fefe]{background-color:rgba(40,42,58,.7);backdrop-filter:blur(8px);padding:12px;border-radius:8px;text-align:center;border:1px solid rgba(17,233,225,.2)}.rule-item .rule-name[data-v-19c6fefe]{font-size:.8em;color:#a0a0a0;margin-bottom:8px}.rule-item .rule-value[data-v-19c6fefe]{font-size:1.25em;font-weight:bold;color:#82d8d8}.system-overview[data-v-19c6fefe]{font-size:1em;line-height:1.6;text-align:justify;margin-bottom:16px;padding:12px;background-color:rgba(10,10,15,.3);border-radius:4px}.subsection-title[data-v-19c6fefe]{font-family:"Noto Serif SC",serif;font-size:1.25em;color:#b8860b;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid rgba(184,134,11,.3)}.tags-container[data-v-19c6fefe]{display:flex;flex-wrap:wrap;gap:8px}.tag[data-v-19c6fefe]{background-color:rgba(17,233,225,.2);color:#82d8d8;padding:4px 8px;border-radius:4px;font-size:.8em}.ladder-container[data-v-19c6fefe]{background:linear-gradient(to top,rgba(10,10,15,0.5) 0%,transparent 100%);padding:12px;border-radius:8px}.境界-ladder[data-v-19c6fefe]{list-style:none;padding:0;margin:0;display:flex;flex-direction:column-reverse;gap:8px}.ladder-step[data-v-19c6fefe]{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:4px;background-color:rgba(28,32,53,.5);border-left:3px solid #b8860b;cursor:help;transition:all .2s ease}.ladder-step[data-v-19c6fefe]:hover{background-color:rgba(62,71,112,.5);transform:translateX(5px)}.ladder-step .level-name[data-v-19c6fefe]{font-size:1.1em;font-weight:bold}.ladder-step .level-energy[data-v-19c6fefe]{font-size:.8em;color:#a0a0a0;background-color:rgba(10,10,15,.5);padding:4px 8px;border-radius:4px}.epoch-selection .tabs-container[data-v-19c6fefe]{display:flex;justify-content:center;gap:12px;margin-bottom:16px}.epoch-selection .epoch-tab[data-v-19c6fefe]{background-color:rgba(40,42,58,.7);backdrop-filter:blur(8px);border:1px solid rgba(17,233,225,.2);color:#a0a0a0;padding:8px 12px;border-radius:8px;cursor:pointer;transition:all .3s ease}.epoch-selection .epoch-tab.active[data-v-19c6fefe]{color:#82d8d8;border-color:#11e9e1;background-color:rgba(17,233,225,.2)}.epoch-selection .epoch-tab[data-v-19c6fefe]:hover:not(.active){background-color:rgba(62,71,112,.3)}.loading-state[data-v-19c6fefe]{display:flex;justify-content:center;align-items:center;height:100%;font-family:"Noto Serif SC",serif;color:#f0e6d2}.summary-content[data-v-19c6fefe]{padding:16px;line-height:1.7;white-space:normal}[data-v-19c6fefe] .summary-content p{margin-bottom:1.5em}[data-v-19c6fefe] .summary-content p:last-child{margin-bottom:0}
.map-navigator[data-v-41303afe]{position:absolute;top:10px;left:10px;background-color:hsla(0,0%,100%,.8);padding:5px 10px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.15);z-index:10;display:flex;align-items:center;font-size:14px}.map-navigator .crumb[data-v-41303afe]{cursor:pointer;color:#333;transition:color .3s}.map-navigator .crumb[data-v-41303afe]:hover{color:#007bff}.map-navigator .separator[data-v-41303afe]{margin:0 8px;color:#aaa}
.node-detail-panel[data-v-22e5bfcd]{position:absolute;top:50px;right:10px;width:320px;max-height:85vh;background-color:#fff;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:10;display:flex;flex-direction:column;color:#333;resize:both;overflow:hidden}.resize-handle[data-v-22e5bfcd]{position:absolute;background:rgba(0,0,0,0);z-index:10}.resize-handle.top[data-v-22e5bfcd]{top:-5px;left:0;right:0;height:10px;cursor:ns-resize}.resize-handle.right[data-v-22e5bfcd]{top:0;right:-5px;bottom:0;width:10px;cursor:ew-resize}.resize-handle.bottom[data-v-22e5bfcd]{bottom:-5px;left:0;right:0;height:10px;cursor:ns-resize}.resize-handle.left[data-v-22e5bfcd]{top:0;left:-5px;bottom:0;width:10px;cursor:ew-resize}.resize-handle.top-left[data-v-22e5bfcd]{top:-5px;left:-5px;width:10px;height:10px;cursor:nwse-resize}.resize-handle.top-right[data-v-22e5bfcd]{top:-5px;right:-5px;width:10px;height:10px;cursor:nesw-resize}.resize-handle.bottom-left[data-v-22e5bfcd]{bottom:-5px;left:-5px;width:10px;height:10px;cursor:nesw-resize}.resize-handle.bottom-right[data-v-22e5bfcd]{bottom:-5px;right:-5px;width:10px;height:10px;cursor:nwse-resize}.panel-header[data-v-22e5bfcd]{display:flex;justify-content:space-between;align-items:center;padding:10px 15px;border-bottom:1px solid #eee;cursor:move}.panel-header.dragging[data-v-22e5bfcd]{background-color:#f5f5f5}.panel-header h3[data-v-22e5bfcd]{margin:0;font-size:16px;font-weight:700}.panel-header .close-btn[data-v-22e5bfcd]{background:none;border:none;font-size:24px;cursor:pointer;color:#999}.panel-header .close-btn[data-v-22e5bfcd]:hover{color:#333}.panel-content[data-v-22e5bfcd]{padding:5px 15px 15px 15px;overflow-y:auto;font-size:14px}.panel-content p[data-v-22e5bfcd]{margin:0 0 10px}.panel-content pre[data-v-22e5bfcd]{white-space:pre-wrap;word-wrap:break-word;background-color:#f5f5f5;padding:10px;border-radius:4px;font-family:monospace;font-size:13px;color:#555}.section[data-v-22e5bfcd]{margin-top:15px;border-top:1px solid #f0f0f0;padding-top:15px}.section[data-v-22e5bfcd]:first-child{margin-top:0;border-top:none;padding-top:5px}.section-title[data-v-22e5bfcd]{font-size:14px;font-weight:600;margin:0 0 10px 0;color:#000}.item-list[data-v-22e5bfcd]{list-style:none;padding:0;margin:0;max-height:150px;overflow-y:auto}.item-list .list-item[data-v-22e5bfcd]{padding:6px 8px;border-radius:4px;margin-bottom:4px;background-color:#fafafa;display:flex;justify-content:space-between;align-items:center}.item-list .list-item.interactive[data-v-22e5bfcd]{cursor:pointer}.item-list .list-item.interactive[data-v-22e5bfcd]:hover{background-color:#e9e9e9}.rarity[data-v-22e5bfcd]{font-size:12px;font-weight:bold;padding:2px 5px;border-radius:3px;color:#fff}.rarity-常见[data-v-22e5bfcd]{background-color:#a0a0a0}.rarity-稀有[data-v-22e5bfcd]{background-color:#4caf50}.rarity-传说[data-v-22e5bfcd]{background-color:#ff9800}.rarity-史诗[data-v-22e5bfcd]{background-color:#9c27b0}.rarity-神话[data-v-22e5bfcd]{background-color:#f44336}
@keyframes move-twink-back{from{background-position:0 0}to{background-position:-10000px 5000px}}.stars,.twinkling{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;display:block}.stars{background:#000 url(https://www.script-tutorials.com/demos/360/images/stars.png) repeat top center;z-index:0}.twinkling{background:rgba(0,0,0,0) url(https://www.script-tutorials.com/demos/360/images/twinkling.png) repeat top center;z-index:1;animation:move-twink-back 200s linear infinite}.world-map-view .player-location circle{stroke:#ffeb3b !important;stroke-width:4px !important;filter:drop-shadow(0 0 8px #ffeb3b)}.world-map-view .avatar-location circle{stroke:#03a9f4 !important;stroke-width:4px !important;filter:drop-shadow(0 0 8px #03a9f4)}.world-map-view{position:relative;width:100%;height:100%;overflow:hidden;background-color:#000}.world-map-view .search-toggle-btn{position:absolute;top:60px;left:10px;z-index:20;background:rgba(10,15,30,.7);border:1px solid #4a4a4a;color:#e0e0e0;width:36px;height:36px;border-radius:50%;cursor:pointer}.world-map-view .search-panel{position:absolute;top:50px;left:10px;z-index:20;background:rgba(10,15,30,.8);border:1px solid #4a4a4a;border-radius:8px;padding:15px;width:280px}.world-map-view .search-panel input{width:100%;box-sizing:border-box;background-color:rgba(0,0,0,.5);border:1px solid #4a4a4a;color:#e0e0e0;padding:8px 12px;border-radius:4px;margin-bottom:10px}.world-map-view .search-panel .search-results{list-style:none;padding:0;margin:0;max-height:300px;overflow-y:auto}.world-map-view .search-panel .search-results li{padding:8px 12px;cursor:pointer;color:#ccc;font-size:13px;border-radius:4px}.world-map-view .search-panel .search-results li:hover{background-color:#333;color:#fff}.world-map-view .map-svg{width:100%;height:100%;background-color:rgba(0,0,0,0)}
@keyframes move-twink-back{from{background-position:0 0}to{background-position:-10000px 5000px}}.stars,.twinkling{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;display:block}.stars{background:#000 url(https://www.script-tutorials.com/demos/360/images/stars.png) repeat top center;z-index:0}.twinkling{background:rgba(0,0,0,0) url(https://www.script-tutorials.com/demos/360/images/twinkling.png) repeat top center;z-index:1;animation:move-twink-back 200s linear infinite}.world-map-view .player-location circle{stroke:#ffeb3b !important;stroke-width:4px !important;filter:drop-shadow(0 0 8px #ffeb3b)}.world-map-view .avatar-location circle{stroke:#03a9f4 !important;stroke-width:4px !important;filter:drop-shadow(0 0 8px #03a9f4)}.world-map-view{position:relative;width:100%;height:100%;overflow:hidden;background-color:#000}.world-map-view .search-toggle-btn{position:absolute;top:60px;left:10px;z-index:20;background:rgba(10,15,30,.7);border:1px solid #4a4a4a;color:#e0e0e0;width:36px;height:36px;border-radius:50%;cursor:pointer}.world-map-view .search-panel{position:absolute;top:50px;left:10px;z-index:20;background:rgba(10,15,30,.8);border:1px solid #4a4a4a;border-radius:8px;padding:15px;width:280px}.world-map-view .search-panel input{width:100%;box-sizing:border-box;background-color:rgba(0,0,0,.5);border:1px solid #4a4a4a;color:#e0e0e0;padding:8px 12px;border-radius:4px;margin-bottom:10px}.world-map-view .search-panel .search-results{list-style:none;padding:0;margin:0;max-height:300px;overflow-y:auto}.world-map-view .search-panel .search-results li{padding:8px 12px;cursor:pointer;color:#ccc;font-size:13px;border-radius:4px}.world-map-view .search-panel .search-results li:hover{background-color:#333;color:#fff}.world-map-view .map-svg{width:100%;height:100%;background-color:rgba(0,0,0,0)}
.dock-manager-host{width:100%;height:100%;position:absolute;top:0;left:0}.dock-manager-host .lm_goldenlayout{background:rgba(0,0,0,0)}.dock-manager-host .lm_root{position:absolute !important}.dock-manager-host .lm_header{background-color:rgba(25,30,45,.8)}.dock-manager-host .lm_header .lm_tab{background-color:rgba(0,0,0,0);color:#ccc;border-right:1px solid #111}.dock-manager-host .lm_header .lm_tab.lm_active{background-color:rgba(45,55,80,.8);color:#fff}.dock-manager-host .lm_content{background:rgba(15,20,35,.85);border:1px solid rgba(180,160,120,.2)}.dock-manager-host .lm_close_tab{font-size:1.2rem;font-weight:bold;color:#ff6b6b}.dock-manager-host .lm_close_tab:hover{background:#ff6b6b;color:#111}
.loading-overlay[data-v-6ae2bf70]{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:9999}.loading-content[data-v-6ae2bf70]{background-color:#16212c;border:1px solid rgba(212,175,55,.5);border-radius:5px;padding:32px;box-shadow:0 12px 40px rgba(0,0,0,.4);display:flex;flex-direction:column;align-items:center;gap:24px;width:80%;max-width:500px;text-align:center}.loading-content .tip[data-v-6ae2bf70]{font-family:"Siyuan Song","Source Han Serif SC",serif;font-size:16px;color:#f0e6d2;line-height:1.6;text-shadow:0 0 5px #f0e6d2}.loading-content .progress-bar-container[data-v-6ae2bf70]{width:100%;height:12px;background-color:rgba(10,15,30,.5);border-radius:6px;border:1px solid rgba(212,175,55,.4);overflow:hidden}.loading-content .progress-bar[data-v-6ae2bf70]{height:100%;background:linear-gradient(90deg,#3a8f9d,#d4af37);transition:width .2s linear;border-radius:6px}.loading-content .progress-text[data-v-6ae2bf70]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:14px;color:#a0a0a0}.loading-content .progress-text .highlight[data-v-6ae2bf70]{color:#f0e6d2;font-weight:bold;text-shadow:0 0 5px rgba(212,175,55,.7)}.loading-content .error-container .error-title[data-v-6ae2bf70]{color:#c74343;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:24px;margin-bottom:16px;text-shadow:0 0 8px rgba(199,67,67,.6)}.loading-content .error-container .error-message[data-v-6ae2bf70]{color:#e0e0e0;font-size:14px;margin-bottom:24px}.loading-content .error-container .error-tip[data-v-6ae2bf70]{color:#a0a0a0;font-size:12px}
.npc-list-modal-content[data-v-ff267540]{width:100%;max-height:60vh;overflow-y:auto}.npc-list-modal-content[data-v-ff267540]::-webkit-scrollbar{width:6px;height:6px}.npc-list-modal-content[data-v-ff267540]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.npc-list-modal-content[data-v-ff267540]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.npc-list-modal-content[data-v-ff267540]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.npc-list[data-v-ff267540]{list-style:none;padding:0;margin:0}.npc-item[data-v-ff267540]{padding:16px;border-bottom:1px solid rgba(212,175,55,.2)}.npc-item[data-v-ff267540]:last-child{border-bottom:none}.npc-header[data-v-ff267540]{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:8px}.npc-name[data-v-ff267540]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:16px;color:#f0e6d2}.npc-identity[data-v-ff267540]{font-size:12px;color:#a0a0a0;font-style:italic}.npc-description[data-v-ff267540]{font-size:14px;color:#e0e0e0;line-height:1.7;margin:0}.no-npcs[data-v-ff267540]{text-align:center;padding:32px;color:#a0a0a0}
.world-time-display[data-v-668f333f]{padding:4px 16px;background:rgba(10,15,30,.5);border:1px solid rgba(212,175,55,.2);border-radius:3px;color:#a0a0a0;font-size:12px;display:flex;gap:16px;align-items:center}.world-time-display .world-name[data-v-668f333f]{font-weight:bold;color:#f0e6d2}.world-time-display .time-string[data-v-668f333f]{font-family:monospace}
.top-status[data-v-668c5a00]{border-bottom:1px solid rgba(212,175,55,.2);box-shadow:0 4px 15px rgba(0,0,0,.3);display:flex;align-items:center;justify-content:space-between;padding:8px 16px;position:relative;z-index:100}.top-status[data-v-668c5a00]::before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;border-radius:inherit;box-shadow:inset 0 1px 1px rgba(230.049382716,208.5802469136,138.950617284,.1)}.status-left[data-v-668c5a00],.status-right[data-v-668c5a00]{flex:1;display:flex;align-items:center;gap:16px}.status-left[data-v-668c5a00]{justify-content:flex-start}.status-right[data-v-668c5a00]{justify-content:flex-end}.status-center[data-v-668c5a00]{position:absolute;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:32px}.view-toggle-btn[data-v-668c5a00]{background:none;border:1px solid rgba(0,0,0,0);color:#a0a0a0;font-size:18px;padding:4px 8px;border-radius:3px;cursor:pointer;transition:all .2s ease-in-out}.view-toggle-btn[data-v-668c5a00]:hover{color:#e0e0e0;background-color:rgba(212,175,55,.1);border-color:rgba(212,175,55,.3)}
.guixu-root-container{display:grid;grid-template-rows:auto 1fr;width:100%;max-height:100%;aspect-ratio:16/13;margin:auto;overflow:hidden;border:1px solid rgba(212,175,55,.2);border-radius:12px;box-shadow:0 8px 35px rgba(10,15,30,.5);background:#0a0f1e;position:relative}.web-fullscreen{position:fixed !important;top:0 !important;left:0 !important;width:100vw !important;height:100vh !important;aspect-ratio:auto !important;overflow:visible !important;border-radius:0 !important;border:none !important;z-index:1}.main-layout{position:relative;display:grid;grid-template-columns:1fr;grid-template-rows:1fr;overflow:hidden}.main-layout>*{grid-column:1/-1;grid-row:1/-1}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(10,15,30,.7);backdrop-filter:blur(5px);display:flex;justify-content:center;align-items:center;z-index:90000}.modal-content{border:1px solid rgba(212,175,55,.4);border-radius:5px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.3);min-width:320px;max-width:500px}.modal-content .confirmation-title{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px;text-align:center;margin-bottom:16px}.modal-content .confirmation-message{color:#e0e0e0;font-size:14px;line-height:1.7;margin-bottom:32px;text-align:center}.modal-content .confirmation-buttons{display:flex;justify-content:flex-end;gap:16px}.detail-modal{min-width:400px;max-width:80vw;max-height:90vh;display:flex;flex-direction:column}.detail-modal .modal-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:16px;margin-bottom:24px;border-bottom:1px solid rgba(212,175,55,.3)}.detail-modal .modal-header .modal-title{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px}.detail-modal .modal-header .close-button{background:none;border:none;color:#a0a0a0;font-size:24px;cursor:pointer}.detail-modal .modal-header .close-button:hover{color:#e0e0e0}.detail-modal .modal-body{overflow-y:auto;padding-right:8px;color:#e0e0e0}.input-modal-overlay{align-items:flex-end;padding-bottom:5vh;background-color:rgba(0,0,0,0);backdrop-filter:none;pointer-events:none}.input-modal-content{pointer-events:auto;border:1px solid rgba(212,175,55,.4);border-radius:5px;box-shadow:0 10px 30px rgba(0,0,0,.3);padding:0;width:70%;max-width:900px}.input-area-container{position:relative}.input-area-with-buttons{position:relative;display:flex;align-items:center;width:100%}.action-panel{position:absolute;bottom:calc(100% + 16px);left:50%;transform:translateX(-50%);z-index:10}.command-queue-popup,:deep(.input-history-popup){position:absolute;bottom:calc(100% + 16px);left:50%;transform:translateX(-50%);width:80%;max-width:600px;z-index:20;border-radius:5px;box-shadow:0 10px 30px rgba(0,0,0,.3);padding:16px;display:flex;flex-direction:column;gap:16px}.command-queue-popup .popup-header,:deep(.input-history-popup) .popup-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:8px;border-bottom:1px solid rgba(212,175,55,.2)}.command-queue-popup .popup-header h3,:deep(.input-history-popup) .popup-header h3{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:18px;margin:0}.command-queue-popup .popup-header .close-popup-button,:deep(.input-history-popup) .popup-header .close-popup-button{background:none;border:none;color:#a0a0a0;font-size:22px;cursor:pointer;line-height:1}.command-queue-popup .popup-header .close-popup-button:hover,:deep(.input-history-popup) .popup-header .close-popup-button:hover{color:#e0e0e0}.command-queue-popup .popup-body .command-list,:deep(.input-history-popup) .popup-body .command-list{max-height:200px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;padding-right:8px}.command-queue-popup .popup-body .command-item,:deep(.input-history-popup) .popup-body .command-item{background-color:rgba(10,15,30,.3);padding:8px 16px;border-radius:3px;font-family:"Siyuan Song","Source Han Serif SC",serif;color:#e0e0e0;word-break:break-all}.command-queue-popup .popup-body .empty-queue,:deep(.input-history-popup) .popup-body .empty-queue{text-align:center;color:#a0a0a0;padding:24px 0}.command-queue-popup .popup-footer,:deep(.input-history-popup) .popup-footer{display:flex;justify-content:flex-end;padding-top:8px;border-top:1px solid rgba(212,175,55,.2)}:global(html.web-fullscreen-active),:global(body.web-fullscreen-active){overflow:hidden !important}:global(body.web-fullscreen-active #chat){padding:0 !important;margin:0 !important;height:100vh !important;max-height:100vh !important}:global(body.web-fullscreen-active #chat>div){padding:0 !important;margin:0 !important}:global(body.web-fullscreen-active .mes_block){padding:0 !important;margin:0 !important}:global(body.web-fullscreen-active .mes_text){padding:0 !important;margin:0 !important}
.attribute-item[data-v-490ee3ff]{display:flex;justify-content:space-between;font-size:13px}.attribute-name[data-v-490ee3ff]{color:#6c757d}.attribute-value[data-v-490ee3ff]{color:#3a3f4b;font-weight:500}
.character-panel[data-v-3e931026]{background:#f5f1e9;padding:15px;overflow-y:auto;box-shadow:inset 0 0 10px rgba(58,63,75,.03);border-right:1px solid #eae6dd}.panel-section[data-v-3e931026]{margin-bottom:20px;padding:15px;background:#fff;border-radius:8px;border:1px solid #eae6dd;box-shadow:0 2px 8px rgba(58,63,75,.05);transition:box-shadow .3s ease}.panel-section[data-v-3e931026]:hover{box-shadow:0 4px 12px rgba(58,63,75,.08)}.section-title[data-v-3e931026]{font-size:14px;font-weight:600;color:#3a3f4b;margin-bottom:12px;text-align:left;border-bottom:2px solid #4169e1;padding-bottom:8px;display:inline-block}.attributes-list[data-v-3e931026]{display:flex;flex-direction:column;gap:8px}.attribute-item[data-v-3e931026]{display:flex;justify-content:space-between;font-size:13px}.attribute-name[data-v-3e931026]{color:#6c757d}.attribute-value[data-v-3e931026]{color:#3a3f4b;font-weight:500}
.inventory-panel[data-v-fbf176e0]{padding:15px}.panel-section[data-v-fbf176e0]{margin-bottom:20px;padding:15px;background:#fff;border-radius:8px;border:1px solid #eae6dd}.section-title[data-v-fbf176e0]{font-size:14px;font-weight:600;color:#3a3f4b;margin-bottom:12px}.inventory-grid[data-v-fbf176e0]{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px}.inventory-item[data-v-fbf176e0]{padding:10px;background-color:#f8f9fa;border-radius:6px;text-align:center}.item-name[data-v-fbf176e0]{font-weight:500}.item-quantity[data-v-fbf176e0]{color:#6c757d;font-size:12px}
.main-content-view[data-v-2caac21f]{display:flex;flex-direction:column;height:100%;width:100%;box-sizing:border-box;overflow:hidden;position:relative}.narrative-container[data-v-2caac21f]{flex-grow:1;overflow-y:auto;padding:1.5rem;white-space:pre-wrap;line-height:1.8;font-size:1rem}.narrative-container[data-v-2caac21f] .highlighted-item{color:#007bff;cursor:pointer;text-decoration:underline;text-decoration-style:dotted}.narrative-container[data-v-2caac21f] .highlighted-npc{color:#28a745;cursor:pointer;font-weight:600}.narrative-tooltip[data-v-2caac21f]{position:fixed;background-color:#333;color:#fff;border:1px solid #555;border-radius:6px;padding:.75rem;z-index:1100;pointer-events:none;font-size:.9rem;max-width:350px;box-shadow:0 4px 12px rgba(0,0,0,.4)}.narrative-tooltip[data-v-2caac21f] .tooltip-title{font-weight:bold;margin-bottom:.5rem;color:#ffc107;border-bottom:1px solid #555;padding-bottom:.5rem}.narrative-tooltip[data-v-2caac21f] .tooltip-description{margin-bottom:.5rem;color:#eee}.narrative-tooltip[data-v-2caac21f] .tooltip-level,.narrative-tooltip[data-v-2caac21f] .tooltip-identity{font-style:italic;color:#aaa;font-size:.8rem}
.npc-list-panel[data-v-cbe78d66]{padding:15px}.panel-section[data-v-cbe78d66]{margin-bottom:20px;padding:15px;background:#fff;border-radius:8px;border:1px solid #eae6dd}.section-title[data-v-cbe78d66]{font-size:14px;font-weight:600;color:#3a3f4b;margin-bottom:12px}.npc-list[data-v-cbe78d66]{display:flex;flex-direction:column;gap:10px}.npc-item[data-v-cbe78d66]{display:flex;justify-content:space-between;padding:10px;background-color:#f8f9fa;border-radius:6px}.npc-name[data-v-cbe78d66]{font-weight:500}.npc-relationship[data-v-cbe78d66]{color:#6c757d}
.world-state-panel[data-v-1b7ec95a]{padding:15px}.panel-section[data-v-1b7ec95a]{margin-bottom:20px;padding:15px;background:#fff;border-radius:8px;border:1px solid #eae6dd}.section-title[data-v-1b7ec95a]{font-size:14px;font-weight:600;color:#3a3f4b;margin-bottom:12px}.state-list[data-v-1b7ec95a]{display:flex;flex-direction:column;gap:8px}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}html{font-family:"Noto Serif SC",serif;font-size:14px;line-height:1.7;color:#0a0f1e}body{min-height:100vh;overflow:hidden}h1,h2,h3,h4,h5,h6{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#d4af37;font-weight:normal;margin-bottom:16px}h1{font-size:24px}h2{font-size:20px}h3{font-size:18px}a{color:#3a8f9d;text-decoration:none;transition:color .3s ease}a:hover{color:rgb(95.4441860465,181.8279069767,196.0558139535);text-decoration:underline}button,input,textarea,select{font-family:inherit;font-size:inherit;background-color:rgba(10,15,30,.5);border:1px solid rgba(212,175,55,.3);color:#e0e0e0;padding:8px 16px;border-radius:5px;transition:all .3s ease}button:focus,input:focus,textarea:focus,select:focus{outline:none;border-color:#d4af37;box-shadow:0 0 5px rgba(212,175,55,.5)}button:disabled,input:disabled,textarea:disabled,select:disabled{opacity:.5;cursor:not-allowed}button{cursor:pointer;background-color:rgba(58,143,157,.2);border-color:#3a8f9d}button:hover{background-color:rgba(58,143,157,.4);border-color:rgb(76.823255814,173.288372093,189.176744186)}button.primary{background-color:rgba(212,175,55,.8);border-color:#d4af37;color:#0a0f1e;font-weight:bold}button.primary:hover{background-color:#d4af37;box-shadow:0 0 8px rgba(212,175,55,.7)}*::-webkit-scrollbar{width:6px;height:6px}*::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}*::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}*::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}#toast-container>.toast{border:1px solid #d4af37;color:#0a0f1e;text-shadow:none;font-family:"Siyuan Song","Source Han Serif SC",serif;font-weight:bold;border-radius:5px;box-shadow:0 5px 20px rgba(212,175,55,.5);opacity:.9}#toast-container>.toast .toast-title{font-family:"ZCOOL KuaiLe","篆书",cursive;font-weight:bold}#toast-container>.toast .toast-message{font-weight:normal}#toast-container>.toast.toast-info{background-color:rgba(58,143,157,.8);border-color:#3a8f9d;color:#fff}#toast-container>.toast.toast-error{background-color:rgba(199,67,67,.8);border-color:#c74343;color:#fff}#toast-container>.toast.toast-success{background-color:rgba(92,184,92,.8);border-color:#5cb85c;color:#fff}@keyframes border-flow{0%{border-image-source:linear-gradient(to right,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}25%{border-image-source:linear-gradient(to bottom,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}50%{border-image-source:linear-gradient(to left,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}75%{border-image-source:linear-gradient(to top,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}100%{border-image-source:linear-gradient(to right,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}}.panel-base{border-radius:5px;box-shadow:0 8px 35px rgba(10,15,30,.5);color:#000;border-style:solid;border-width:2px;border-image-slice:1;animation:border-flow 8s infinite linear}.panel-titlebar{background-color:rgba(10,15,30,.5);border-bottom:1px solid rgba(212,175,55,.3);height:40px;font-family:"ZCOOL KuaiLe","篆书",cursive;display:flex;align-items:center;padding:0 16px}.panel-titlebar-text{color:#f0e6d2;font-size:18px;font-weight:normal;padding:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.panel-titlebar-button-close{color:#a0a0a0;font-size:16px}.panel-titlebar-button-close::after{content:"×";padding:0}.panel-titlebar-button-close:hover{color:#c74343;transform:scale(1.2)}.panel-titlebar-button-pin{color:#a0a0a0;font-size:14px;cursor:pointer;margin-right:16px;transition:all .3s ease}.panel-titlebar-button-pin.locked{color:#3a8f9d;transform:rotate(45deg)}.panel-titlebar-button-pin:hover{color:#3a8f9d;transform:scale(1.2)}.panel-content{background-color:rgba(0,0,0,0)}.panel-content::-webkit-scrollbar{width:6px;height:6px}.panel-content::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.panel-content::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.panel-content::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.dockspan-tab-host{background-color:rgba(0,0,0,0)}.dockspan-tab-handle-list-container{background-color:rgba(10,15,30,.3);border-bottom:1px solid rgba(212,175,55,.2)}.dockspan-tab-handle{background-color:rgba(0,0,0,0);color:#a0a0a0;border-right:1px solid rgba(212,175,55,.2);padding:16px;transition:all .3s ease}.dockspan-tab-handle:hover{background-color:rgba(58,143,157,.2);color:#3a8f9d}.dockspan-tab-handle-selected{background-color:rgba(212,175,55,.2);color:#f0e6d2;border-bottom:2px solid #d4af37}.dockspan-tab-handle-close-button{color:#a0a0a0}.dockspan-tab-handle-close-button:hover{color:#c74343}.splitbar-horizontal,.splitbar-vertical{background-color:rgba(212,175,55,.3);transition:background-color .3s ease}.splitbar-horizontal:hover,.splitbar-vertical:hover{background-color:#d4af37}.dock-wheel-panel-preview,.panel-grayout{display:none !important}.game-container{display:grid;grid-template-columns:1fr;width:100%;height:100%;overflow:hidden;gap:1px}.character-panel,.interaction-panel{background:#f5f1e9;padding:15px;overflow-y:auto;box-shadow:inset 0 0 10px rgba(58,63,75,.03)}.character-panel{border-right:1px solid #eae6dd}.interaction-panel{border-left:1px solid #eae6dd}.main-content{padding:25px;overflow-y:auto;background:#fdfbf6;position:relative}#tablet-trigger{position:fixed;right:0;top:45%;transform:translateY(-50%);width:32px;height:80px;background-color:#fff;border:1px solid #eae6dd;border-right:none;border-radius:8px 0 0 8px;cursor:pointer;transition:all .3s ease;font-size:24px;display:flex;align-items:center;justify-content:center;color:#6c757d;z-index:1001;box-shadow:-2px 0 8px rgba(58,63,75,.08)}#tablet-trigger:hover{background-color:#f5f1e9;color:#4169e1}#tablet-container{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;background-color:rgba(58,63,75,.4);backdrop-filter:blur(5px);opacity:0;visibility:hidden;transform:scale(1.1);transition:opacity .3s ease,visibility .3s ease,transform .3s ease;z-index:200}#tablet-container.is-visible{opacity:1;visibility:visible;transform:scale(1)}#tablet-container .tablet-case{width:90%;max-width:380px;height:90vh;max-height:800px;background-color:#1a1a1a;border-radius:40px;padding:12px;box-shadow:0 20px 50px rgba(0,0,0,.3),inset 0 0 15px hsla(0,0%,100%,.1);display:flex;flex-direction:column}#tablet-container .phone-screen{width:100%;height:100%;background:linear-gradient(160deg,#f87171 0%,#a855f7 100%);border-radius:28px;overflow:hidden;position:relative;display:flex;flex-direction:column;color:#fff}#tablet-container .phone-content-area{flex-grow:1;position:relative;display:flex;flex-direction:column}#tablet-container .phone-desktop{display:flex;flex-direction:column;height:100%;padding:20px;box-sizing:border-box}#tablet-container .desktop-header{flex-shrink:0;padding:40px 0;text-align:center}#tablet-container .desktop-header .time-display #desktop-time{font-size:72px;font-weight:300;letter-spacing:1px;display:block;line-height:1}#tablet-container .desktop-header .time-display #desktop-date{font-size:16px;font-weight:400;opacity:.9}#tablet-container .app-grid{flex-grow:1;display:grid;grid-template-columns:repeat(4,1fr);gap:20px;align-content:flex-start}#tablet-container .desktop-dock-indicator{flex-shrink:0;display:flex;justify-content:center;padding:15px 0}#tablet-container .desktop-dock-indicator span{width:8px;height:8px;background-color:hsla(0,0%,100%,.5);border-radius:50%}#tablet-container .app-view-container{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background-color:#fdfbf6;z-index:10;flex-direction:column;color:#3a3f4b}#tablet-container .app-view-container.active{display:flex}#tablet-container .phone-nav-bar{height:50px;flex-shrink:0;display:flex;justify-content:space-around;align-items:center;padding:0 20px;background:rgba(0,0,0,.1)}#tablet-container .phone-nav-bar .nav-btn{background:none;border:none;color:#fff;opacity:.8;cursor:pointer;padding:5px}#tablet-container .phone-nav-bar .nav-btn svg{width:20px;height:20px}#tablet-container .app-icon{display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;text-decoration:none}#tablet-container .app-icon .app-icon-visual{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;box-shadow:0 5px 15px rgba(0,0,0,.15);transition:transform .2s ease}#tablet-container .app-icon .app-icon-visual svg{width:28px;height:28px}#tablet-container .app-icon .app-icon-name{font-size:12px;color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.3)}#tablet-container .app-icon:hover .app-icon-visual{transform:scale(1.1)}#tablet-container .app-icon[data-app-id=tianhuachat] .app-icon-visual{background-color:#3b82f6}#tablet-container .app-icon[data-app-id=campus-pass] .app-icon-visual{background-color:#14b8a6}#tablet-container .app-icon[data-app-id=schedule] .app-icon-visual{background-color:#8b5cf6}#tablet-container .app-icon[data-app-id=health] .app-icon-visual{background-color:#ef4444}#tablet-container .app-icon[data-app-id=forum] .app-icon-visual{background-color:#0ea5e9}#tablet-container .app-icon[data-app-id=shopping] .app-icon-visual{background-color:#f97316}#tablet-container .app-icon[data-app-id=inventory] .app-icon-visual{background-color:#ec4899}#tablet-container .app-icon[data-app-id=map] .app-icon-visual{background-color:#22c55e}#tablet-container .app-icon[data-app-id=settings] .app-icon-visual{background-color:#6b7280}#tablet-container .app-icon[data-app-id=saveload] .app-icon-visual{background-color:#f39c12}#tablet-container .app-icon[data-app-id=diary] .app-icon-visual{background-color:#9b59b6}#tablet-container .app-icon[data-app-id=character-annals] .app-icon-visual{background-color:#34495e}#tablet-container .app-icon[data-app-id=calendar] .app-icon-visual{background-color:#1abc9c}#tablet-container .app-icon[data-app-id=mall] .app-icon-visual{background-color:#e67e22}.phone-status-bar{display:flex;justify-content:space-between;align-items:center;padding:4px 12px;background-color:rgba(0,0,0,.1);color:#fff;font-size:12px;position:absolute;top:0;left:0;right:0;z-index:100}.phone-status-bar .status-left,.phone-status-bar .status-right{display:flex;align-items:center;gap:6px}.phone-status-bar .status-center{font-weight:500}.phone-status-bar .battery-icon{width:22px;height:11px;border:1px solid #fff;border-radius:3px;position:relative;padding:1px}.phone-status-bar .battery-icon::after{content:"";position:absolute;right:-3px;top:2px;width:2px;height:5px;background-color:#fff;border-top-right-radius:1px;border-bottom-right-radius:1px}.phone-status-bar .battery-icon .battery-fill{height:100%;background-color:#fff;border-radius:1px;transition:width .3s ease}.phone-content-area{padding-top:24px}.panel-base{pointer-events:none}.panel-base:focus{outline:0}.panel-titlebar{width:100%;overflow:hidden;height:25px;pointer-events:auto}.panel-titlebar-icon{height:16px;margin-right:3px}.panel-titlebar-text{float:left;padding-left:10px;padding-top:5px;text-overflow:ellipsis;overflow:hidden;width:calc(100% - 30px);white-space:nowrap}.panel-titlebar-text>span{vertical-align:top}.panel-titlebar-button-close{display:flex;justify-content:flex-end;align-items:center;width:25px;height:25px;position:absolute;right:0;top:0}.panel-titlebar-button-close::after{float:right;cursor:pointer;padding-right:8px;content:"x";font-weight:normal;font-family:Verdana,Geneva,Tahoma,sans-serif;display:flex;height:100%;align-items:center}.panel-titlebar-button-close:hover{color:#000}.panel-content{width:100%;overflow:hidden}.panel-content-wrapper{width:100%;height:100%;position:relative}.panel-grayout{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:10;pointer-events:all}.panel-has-changes{font-style:italic}.panel-has-changes::before{content:"* "}.dialog-floating{position:absolute}.dialog-floating:focus{outline:0}.resize-handle{position:absolute;width:6px;height:6px;z-index:10}.resize-handle-corner{position:absolute;width:12px;height:12px;z-index:10}.resize-handle-e{cursor:e-resize}.resize-handle-w{cursor:w-resize}.resize-handle-s{cursor:s-resize}.resize-handle-n{cursor:n-resize}.resize-handle-ne{cursor:ne-resize}.resize-handle-nw{cursor:nw-resize}.resize-handle-se{cursor:se-resize}.resize-handle-sw{cursor:sw-resize}.dock-container{position:relative}.dock-wheel-base{position:absolute}.dock-wheel-item{position:absolute;width:32px;height:32px}.dock-wheel-fill{margin-left:-16px;margin-top:-16px}.dock-wheel-left{margin-left:-48px;margin-top:-16px}.dock-wheel-right{margin-left:16px;margin-top:-16px}.dock-wheel-top{margin-left:-16px;margin-top:-48px}.dock-wheel-down{margin-left:-16px;margin-top:16px}.dock-wheel-panel-preview{position:absolute;background-color:rgba(128,128,255,.5)}.dock-wheel-fill-icon{background:url("placeholder.png") 0 0}.dock-wheel-left-icon{background:url("placeholder.png") 0 0}.dock-wheel-right-icon{background:url("placeholder.png") 0 0}.dock-wheel-top-icon{background:url("placeholder.png") 0 0}.dock-wheel-down-icon{background:url("placeholder.png") 0 0}.dock-wheel-fill-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-left-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-right-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-top-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-down-icon-hover{background:url("placeholder.png") 0 0}.splitter-container-horizontal{float:left;position:relative;pointer-events:none}.splitter-container-vertical{position:relative;pointer-events:none}.splitbar-horizontal{width:100%;height:5px;cursor:n-resize;position:relative;pointer-events:auto}.splitbar-vertical{width:5px;height:100%;float:left;cursor:e-resize;position:relative;pointer-events:auto}.splitbar-horizontal-ghoust{width:100%;height:5px;cursor:n-resize;position:absolute}.splitbar-vertical-ghoust{width:5px;height:100%;position:absolute;cursor:e-resize}.dockspan-tab-host{display:inline-block;position:absolute}.dockspan-tab-content{position:relative}.dockspan-tab-content:focus{outline:0}.dockspan-tab-handle{position:relative;height:22px;float:left;overflow:hidden;cursor:pointer;padding-right:16px}.dockspan-tab-handle:hover{cursor:pointer}.dockspan-tab-handle-text{margin-top:3px;margin-left:6px;margin-right:6px;white-space:nowrap;overflow:hidden;float:left;text-overflow:ellipsis;width:calc(100% - 3px);display:block}.dockspan-tab-handle-text>span{vertical-align:top}.dockspan-tab-handle-close-button::after{margin-right:5px;float:right;position:absolute;right:0;content:"x";font-weight:normal;font-family:Verdana,Geneva,Tahoma,sans-serif;cursor:pointer;display:flex;height:100%;align-items:center}.dockspan-tab-handle-close-button:hover{color:#000}.dockspan-tab-handle-list-container{height:22px;overflow:hidden;display:none;pointer-events:auto}.dockspan-tab-handle-list-container-visible{display:flex}.dockspan-tab-handle-content-seperator{height:4px;display:none}.dockspan-tab-handle-content-seperator-visible{display:block}.dockspab-tab-handle-context-menu{position:absolute;z-index:10000000;background-color:#fff;border:#fff;border:#000 solid 2px;padding:5px}.dockspab-tab-handle-context-menu>div{cursor:pointer;padding:2px}.dockspab-tab-handle-context-menu>div:hover{background-color:gray;cursor:pointer;padding:2px}.disable-selection{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:default}.panel-titlebar{background-color:#333;pointer-events:auto}.panel-titlebar-text{font-weight:bold;color:#aaa}.panel-titlebar-button-close{color:#aaa}.panel-titlebar-button-close:hover{color:red}.panel-content{overflow:auto}.panel-element-content-container{background-color:#fff}.dialog-floating{box-shadow:5px 5px 20px #000;pointer-events:none}.draggable-dragging-active{opacity:.95}.resize-handle{pointer-events:auto}.resize-handle-corner{pointer-events:auto}.dock-container{background-color:#888}.document-manager{background-color:#666}.splitbar-horizontal{background-color:#000}.splitbar-horizontal:hover{background-color:#5b636c}.splitbar-horizontal:active{background-color:#5b636c}.splitbar-vertical{background-color:#000}.splitbar-vertical:hover{background-color:#5b636c}.splitbar-vertical:active{background-color:#5b636c}.splitbar-horizontal-ghoust{background-color:#fc0}.splitbar-vertical-ghoust{background-color:#fc0}.dockspan-tab-host{background-color:#fff}.dockspan-tab-content{background-color:#fff}.dockspan-tab-content>*{background-color:#fff}.dockspan-tab-handle{background-color:gray;color:#d5d5d5;box-shadow:0px 5px 20px #000}.dockspan-tab-handle:hover{background-color:#006729;color:#fff}.dockspan-tab-handle-selected{background-color:#333;color:#fff}.dockspan-tab-handle-selected:hover{background-color:#008749;color:#fff}.dockspan-tab-handle-close-button:hover{color:red}.dockspan-tab-handle-list-container{background-color:#fff}.dockspan-tab-handle-content-seperator{background-color:#333}.dockspan-tab-handle-content-seperator-active{background-color:#008749}.dockspan-tab-handle-active{background-color:#008749}.dockspan-panel-active{background-color:#008749}.dockspan-panel-titlebar-text-active{color:#fff}.dockspab-tab-handle-context-menu{position:absolute;z-index:10000000;background-color:#fff;border:#fff;border:#000 solid 2px;padding:5px}.dockspab-tab-handle-context-menu>div{cursor:pointer;padding:2px}.dockspab-tab-handle-context-menu>div:hover{background-color:gray;cursor:pointer;padding:2px}.mall-app{background-color:#f8f9fa}.mall-home-view .search-bar{border-radius:9999px;border:1px solid #e5e7eb;background-color:#fff;box-shadow:0 1px 3px rgba(0,0,0,.05)}.mall-home-view .search-bar:focus{outline:none;border-color:#4f46e5;box-shadow:0 0 0 2px rgba(79,70,229,.2)}.mall-home-view .product-grid{padding-bottom:4rem}.product-card{border:none;border-radius:12px;background-color:#fff;overflow:hidden;display:flex;flex-direction:row;transition:transform .2s ease-in-out,box-shadow .2s ease-in-out;padding:.75rem;gap:.75rem;align-items:flex-start;box-shadow:0 2px 4px rgba(0,0,0,.05)}.product-card .product-image-container{flex-shrink:0;width:90px;height:90px}.product-card .product-image{width:100%;height:100%;border-radius:8px;background-color:#f0f2f5}.product-card .product-details{display:flex;flex-direction:column;flex-grow:1;min-width:0}.product-card .product-name{font-size:1rem;font-weight:600;color:#1f2937}.product-card .product-description{font-size:.8rem;color:#6b7280;margin:.25rem 0;flex-grow:1;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;line-height:1.4}.product-card .product-footer{display:flex;justify-content:space-between;align-items:center;margin-top:auto}.product-card .product-price{font-size:1.1rem;font-weight:bold;color:#ef4444;margin:0}.product-card .product-stock{font-size:.75rem;color:#6b7280}.product-card button{margin:0;background-color:#4f46e5;color:#fff;border:none;width:32px;height:32px;border-radius:50%;cursor:pointer;font-weight:bold;font-size:1.5rem;line-height:1;display:flex;align-items:center;justify-content:center;transition:background-color .2s}.product-card button:hover{background-color:#4338ca}.product-card button:disabled{background-color:#9ca3af;cursor:not-allowed}.mall-page-container{padding:1rem;height:100%;overflow-y:auto}.mall-page-container .page-title{font-size:1.5rem;font-weight:700;margin-bottom:1.5rem}.mall-page-container .empty-state{text-align:center;color:#6b7280;margin-top:4rem;font-size:1rem}.cart-view .cart-item{display:flex;align-items:center;gap:1rem;padding:1rem 0;border-bottom:1px solid #e5e7eb}.cart-view .cart-item .item-name{flex-grow:1;font-weight:500}.cart-view .cart-item .item-quantity{color:#6b7280}.cart-view .cart-item .item-price{font-weight:600;min-width:60px;text-align:right}.cart-view .cart-summary{margin-top:1.5rem;padding:1rem;background-color:#fff;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.05)}.cart-view .cart-summary .summary-row{display:flex;justify-content:space-between;margin-bottom:.5rem}.cart-view .cart-summary .summary-row.total{font-weight:bold;font-size:1.1rem;margin-top:1rem}.cart-view .checkout-btn{width:100%;padding:.875rem;border-radius:8px;border:none;background-color:#10b981;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;margin-top:1.5rem}.cart-view .checkout-btn:disabled{background-color:#9ca3af;cursor:not-allowed}.my-mall-view .user-info-card{background:linear-gradient(to right,#6366f1,#8b5cf6);color:#fff;padding:1.5rem;border-radius:12px;margin-bottom:1.5rem}.my-mall-view .user-info-card h2{margin:0;font-size:1.5rem}.my-mall-view .user-info-card p{margin:.25rem 0 0;font-size:1rem;opacity:.9}.my-mall-view .section-title{font-size:1.2rem;font-weight:600;margin-bottom:1rem}.my-mall-view .order-item{display:flex;justify-content:space-between;align-items:center;padding:1rem;background-color:#fff;border-radius:8px;margin-bottom:.75rem;box-shadow:0 1px 3px rgba(0,0,0,.05)}.my-mall-view .order-item .order-details{font-weight:500}.my-mall-view .order-item .order-delivery-time{font-size:.8rem;color:#6b7280}.character-annals-app{display:flex;height:100%;width:100%;background-color:#f9f9f9;font-family:sans-serif}.character-annals-app .character-list-view{width:280px;flex-shrink:0;background-color:#fff;border-right:1px solid #e0e0e0;display:flex;flex-direction:column}.character-annals-app .character-list-view .search-bar{padding:12px;border-bottom:1px solid #e0e0e0}.character-annals-app .character-list-view .search-bar input{width:100%;padding:8px 12px;border-radius:15px;border:1px solid #ccc;box-sizing:border-box}.character-annals-app .character-list-view .search-bar input:focus{outline:none;border-color:#0d6efd}.character-annals-app .character-list-view .character-list{list-style:none;padding:0;margin:0;overflow-y:auto;flex-grow:1}.character-annals-app .character-list-view .character-list .character-card{padding:15px;border-bottom:1px solid #f0f0f0;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:background-color .2s ease}.character-annals-app .character-list-view .character-list .character-card:hover{background-color:#e7f0fe}.character-annals-app .character-list-view .character-list .character-card .character-name{font-weight:600;color:#333}.character-annals-app .character-list-view .character-list .character-card .character-class{font-size:.85em;color:#777;background-color:#eee;padding:2px 6px;border-radius:8px}.character-annals-app .detail-view-container{flex-grow:1;overflow-y:auto}.character-annals-app .detail-view-container .character-detail-view{padding:24px}.character-annals-app .detail-view-container .placeholder{display:flex;justify-content:center;align-items:center;height:100%;color:#aaa;font-size:1.2em}.detail-header{border-bottom:1px solid #e0e0e0;padding-bottom:20px;margin-bottom:20px}.detail-header h1{margin:0 0 8px 0;font-size:2em;color:#2c3e50}.detail-header .signature{font-style:italic;color:#666;margin:5px 0}.detail-header .tags{margin-top:12px}.detail-header .tags .tag{display:inline-block;background-color:#e0e0e0;padding:4px 10px;border-radius:12px;font-size:.8em;margin-right:8px}.detail-header .tags .tag.identity{background-color:#4169e1;color:#fff}.detail-header .header-main{display:flex;justify-content:space-between;align-items:flex-start}.detail-header .avatar-container{flex-shrink:0;width:60px;height:80px}.detail-header .character-avatar,.detail-header .character-avatar-placeholder{width:100%;height:100%;object-fit:cover;border-radius:8px}.detail-header .character-avatar-placeholder{font-size:2rem}.detail-tabs{display:flex;border-bottom:1px solid #ccc;margin-bottom:20px}.detail-tabs button{padding:12px 24px;border:none;background:none;cursor:pointer;font-size:1em;color:#666;border-bottom:3px solid rgba(0,0,0,0);transition:all .2s ease}.detail-tabs button.active{border-bottom-color:#0d6efd;color:#0d6efd;font-weight:600}.attribute-section{margin-bottom:25px}.attribute-section h3{margin-bottom:15px;font-size:1.2em;color:#333;border-bottom:1px solid #eee;padding-bottom:8px}.attribute-section ul{list-style:none;padding:0}.attribute-section ul li{display:flex;justify-content:space-between;padding:8px 0;font-size:.95em;border-bottom:1px dashed #f0f0f0}.attribute-section ul li:last-child{border-bottom:none}.relationships-panel{width:100%;height:100%}.enhanced-input-box-container{width:100%;position:relative}.input-wrapper{display:flex;width:100%;align-items:center;position:relative;padding:8px;background-color:rgba(10,15,30,.8);border:1px solid rgba(212,175,55,.3);border-radius:30px;box-shadow:0 0 15px rgba(10,15,30,.5),inset 0 0 5px rgba(10,15,30,.5);padding-left:55px;padding-right:55px}textarea{flex-grow:1;resize:none;padding:.5rem 1rem;border:none;background-color:rgba(0,0,0,0);font-size:1rem;line-height:1.5;color:#e0e0e0;min-height:40px;font-family:"Siyuan Song","Source Han Serif SC",serif;outline:none}textarea::placeholder{color:rgba(224,224,224,.4)}.button-group{display:flex;gap:8px;padding-left:8px}.action-button{padding:.5rem 1.2rem;font-size:.9rem;border-radius:20px;font-family:"ZCOOL KuaiLe","篆书",cursive;min-width:90px;text-align:center}.action-button.primary{background-color:#d4af37;color:#0a0f1e;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.action-button.primary:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);box-shadow:0 0 10px rgba(212,175,55,.5)}.action-button.primary{background-color:#d4af37;color:#0a0f1e}.action-button.primary:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);box-shadow:0 0 12px rgba(212,175,55,.7)}.action-button:not(.primary){background-color:rgba(0,0,0,0);color:#f0e6d2;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.action-button:not(.primary):hover{background-color:rgba(212,175,55,.1);border-color:rgb(221.024691358,191.7901234568,96.975308642)}.action-button:not(.primary){background-color:rgba(22,33,44,.7);border-color:rgba(212,175,55,.4);color:#f0e6d2}.action-button:not(.primary):hover{background-color:#16212c;border-color:#d4af37}.command-queue-popup{position:absolute;bottom:100%;right:1rem;width:300px;margin-bottom:.5rem;z-index:10;border:1px solid rgba(212,175,55,.4);border-radius:5px;box-shadow:0 5px 20px rgba(0,0,0,.2);padding:16px}.command-list{max-height:150px;overflow-y:auto;margin-bottom:16px}.command-item{padding:8px;border-bottom:1px solid rgba(212,175,55,.2);font-size:.9rem;color:#e0e0e0}.command-item:last-child{border-bottom:none}.empty-queue{color:rgba(224,224,224,.6);font-style:italic;text-align:center;padding:24px 0}.clear-button{width:100%;padding:8px;background-color:rgba(199,67,67,.6);color:#e0e0e0;border:1px solid rgba(199,67,67,.8);border-radius:3px;cursor:pointer;transition:all .2s ease}.clear-button:hover{background-color:#c74343;box-shadow:0 0 10px rgba(199,67,67,.5)}.input-history-popup{background-color:rgba(10,15,30,.95);backdrop-filter:blur(8px);border:1px solid rgba(212,175,55,.5);border-radius:5px;padding:24px;box-shadow:0 8px 30px rgba(0,0,0,.4);width:450px;max-width:90vw;display:flex;flex-direction:column;gap:24px;position:absolute;bottom:calc(100% + 16px);left:50%;transform:translateX(-50%);z-index:1000}.input-history-popup .history-section h4{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;font-size:16px;margin-bottom:16px;border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:8px}.input-history-popup .history-section ul{list-style:none;padding:0;margin:0;max-height:150px;overflow-y:auto;display:flex;flex-direction:column;gap:8px}.input-history-popup .history-section li{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:3px;background-color:rgba(10,15,30,.2);transition:background-color .2s ease}.input-history-popup .history-section li:hover{background-color:rgba(240,230,210,.1)}.input-history-popup .history-section .entry-text{color:#e0e0e0;cursor:pointer;flex-grow:1;margin-right:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.input-history-popup .history-section .actions{display:flex;gap:8px;flex-shrink:0}.input-history-popup .history-section .actions button{font-size:12px;padding:4px 8px}.input-history-popup .history-section .actions button:disabled{opacity:.5;cursor:not-allowed}.input-history-popup .history-section .empty-text{color:#a0a0a0;font-style:italic}.input-history-popup .close-button-popup{align-self:flex-end;margin-top:16px}@keyframes orbit{from{transform:rotate(0deg) translateX(150px) rotate(0deg)}to{transform:rotate(360deg) translateX(150px) rotate(-360deg)}}.world-detail-modal-content{width:500px;max-width:90vw;color:#e0e0e0;background:radial-gradient(ellipse at top,rgb(30.5,45.75,61),#0a0f1e 80%);padding:24px;border:1px solid rgba(212,175,55,.2)}.world-detail-modal-content .scroll-container{max-height:70vh;overflow-y:auto;padding-right:8px}.world-detail-modal-content .scroll-container::-webkit-scrollbar{width:6px;height:6px}.world-detail-modal-content .scroll-container::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.world-detail-modal-content .scroll-container::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.world-detail-modal-content .scroll-container::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.world-detail-modal-content .world-section{margin-bottom:32px;position:relative}.world-detail-modal-content .section-title{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px;color:#f0e6d2;padding-bottom:16px;margin-bottom:24px;text-align:center;letter-spacing:2px;border-bottom:1px solid rgba(212,175,55,.3)}.world-detail-modal-content .rules-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:24px;text-align:center;padding:16px;border-radius:5px;background:rgba(10,15,30,.3)}.world-detail-modal-content .rule-item .rule-name{font-size:12px;color:#a0a0a0;margin-bottom:8px}.world-detail-modal-content .rule-item .rule-value{font-size:18px;font-weight:bold;color:#e0e0e0}.world-detail-modal-content .system-overview{font-style:italic;color:#a0a0a0;text-align:center;margin-bottom:32px;padding:0 24px}.world-detail-modal-content .ladder-container{position:relative;height:350px;margin:32px 0}.world-detail-modal-content .ladder-container::before{content:"";position:absolute;top:0;bottom:0;left:50%;transform:translateX(-50%);width:2px;background:linear-gradient(to bottom,transparent,#d4af37 50%,transparent 100%);opacity:.7}.world-detail-modal-content .境界-ladder{list-style:none;padding:0;margin:0;position:absolute;top:50%;left:50%;width:1px;height:1px}.world-detail-modal-content .ladder-step{position:absolute;display:flex;flex-direction:column;align-items:center;gap:4px}.world-detail-modal-content .ladder-step:nth-child(1){transform:rotate(0deg) translateX(95px) rotate(-0deg);animation:orbit 25s linear infinite;animation-direction:normal}.world-detail-modal-content .ladder-step:nth-child(2){transform:rotate(72deg) translateX(110px) rotate(-72deg);animation:orbit 30s linear infinite;animation-direction:reverse}.world-detail-modal-content .ladder-step:nth-child(3){transform:rotate(144deg) translateX(125px) rotate(-144deg);animation:orbit 35s linear infinite;animation-direction:normal}.world-detail-modal-content .ladder-step:nth-child(4){transform:rotate(216deg) translateX(140px) rotate(-216deg);animation:orbit 40s linear infinite;animation-direction:reverse}.world-detail-modal-content .ladder-step:nth-child(5){transform:rotate(288deg) translateX(155px) rotate(-288deg);animation:orbit 45s linear infinite;animation-direction:normal}.world-detail-modal-content .ladder-step::before{content:"";width:10px;height:10px;border-radius:50%;background:#f0e6d2;box-shadow:0 0 8px #f0e6d2,0 0 15px #d4af37}.world-detail-modal-content .ladder-step .level-name,.world-detail-modal-content .ladder-step .level-energy{position:absolute;top:-30px;white-space:nowrap;background:rgba(22,33,44,.8);padding:2px 6px;border-radius:3px}.world-detail-modal-content .ladder-step .level-name{font-weight:bold;color:#f0e6d2;font-size:14px}.world-detail-modal-content .ladder-step .level-energy{display:none}.settlement-choice-card{background-color:rgba(22,33,44,.6);border:1px solid rgba(212,175,55,.3);border-radius:5px;padding:16px;cursor:pointer;transition:all .3s ease;backdrop-filter:blur(8px);display:flex;flex-direction:column;justify-content:space-between;min-height:240px}.settlement-choice-card:hover{border-color:rgba(240,230,210,.7);background-color:rgba(22,33,44,.8);box-shadow:0 5px 25px rgba(10,15,30,.6);transform:translateY(-5px)}.settlement-choice-card.is-selected{border-color:#f0e6d2;box-shadow:0 0 20px rgba(240,230,210,.4);background:rgba(22,33,44,.9)}.settlement-choice-card .card-header{text-align:center;padding-bottom:8px;border-bottom:1px solid rgba(212,175,55,.2);margin-bottom:16px}.settlement-choice-card .card-header .choice-type{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;font-size:20px;text-shadow:0 0 8px rgba(240,230,210,.7)}.settlement-choice-card .card-body{flex-grow:1}.settlement-choice-card .card-body .description{color:#e0e0e0;font-size:14px;line-height:1.7;margin-bottom:16px}.settlement-choice-card .card-body .data-details{background-color:rgba(10,15,30,.4);padding:16px;border-radius:3px;border-left:3px solid #3a8f9d}.settlement-choice-card .card-body .data-details .data-name{color:#3a8f9d;font-weight:bold;font-size:16px;margin-bottom:8px;display:block}.settlement-choice-card .card-body .data-details .data-description{color:hsl(0,0%,77.7450980392%);font-size:14px;line-height:1.6}.settlement-choice-card .card-footer{text-align:right;padding-top:16px;margin-top:16px;border-top:1px solid rgba(212,175,55,.1)}.settlement-choice-card .card-footer .cost{color:#c74343;font-size:14px;font-weight:bold;text-shadow:0 0 5px rgba(199,67,67,.5)}.settlement-view{display:flex;flex-direction:column;height:100%;padding:24px}.settlement-view .choices-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:24px;overflow-y:auto;padding-bottom:24px}.settlement-view .choices-grid::-webkit-scrollbar{width:6px;height:6px}.settlement-view .choices-grid::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.settlement-view .choices-grid::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.settlement-view .choices-grid::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.settlement-view .no-choices{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;height:100%;color:#a0a0a0;font-size:16px}.settlement-view .no-choices p{margin:8px 0}.settlement-view .actions-footer{padding-top:24px;margin-top:auto;display:flex;justify-content:flex-end;border-top:1px solid rgba(58,143,157,.2)}.settlement-view .actions-footer .confirm-button{background-color:#d4af37;color:#0a0f1e;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.settlement-view .actions-footer .confirm-button:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);box-shadow:0 0 10px rgba(212,175,55,.5)}.settlement-view .actions-footer .confirm-button{padding:16px 32px;font-size:16px}.settlement-view .actions-footer .confirm-button:disabled{background-color:#a0a0a0;color:rgba(10,15,30,.7);border-color:#a0a0a0;cursor:not-allowed}.guixu-root-container.mobile-view .main-layout{display:grid !important;grid-template-columns:1fr !important}.guixu-root-container.mobile-view .top-overlays{padding:4px 8px}.guixu-root-container.mobile-view .side-panel.is-mobile-overlay,.guixu-root-container.mobile-view .right-side-panel.is-mobile-overlay{position:fixed;top:0;bottom:0;width:280px;max-width:75%;z-index:800;overflow:hidden}.guixu-root-container.mobile-view .side-panel.is-mobile-overlay{left:0}.guixu-root-container.mobile-view .right-side-panel.is-mobile-overlay{right:0}.guixu-root-container.mobile-view .is-mobile-overlay .side-panel-container{background-color:rgba(22,33,44,.95) !important;backdrop-filter:blur(12px) !important;-webkit-backdrop-filter:blur(12px) !important;border:1px solid rgba(212,175,55,.3) !important;box-shadow:0 5px 50px rgba(0,0,0,.7) !important;height:100% !important;padding-top:24px !important}.guixu-root-container.mobile-view .mobile-time-display{padding:8px 16px;margin-bottom:16px;border-bottom:1px solid rgba(212,175,55,.2)}.guixu-root-container.mobile-view .slide-left-enter-active,.guixu-root-container.mobile-view .slide-left-leave-active,.guixu-root-container.mobile-view .slide-right-enter-active,.guixu-root-container.mobile-view .slide-right-leave-active{transition:transform .35s cubic-bezier(0.23,1,0.32,1)}.guixu-root-container.mobile-view .slide-left-enter-from,.guixu-root-container.mobile-view .slide-left-leave-to{transform:translateX(-100%)}.guixu-root-container.mobile-view .slide-right-enter-from,.guixu-root-container.mobile-view .slide-right-leave-to{transform:translateX(100%)}.text-dialogue{color:#f0e6d2}.enhanced-input-box-container .input-wrapper{display:flex;align-items:stretch;gap:8px}.enhanced-input-box-container .button-group{display:flex;gap:8px}.enhanced-input-box-container .side-buttons{display:flex;flex-direction:column;gap:4px}.enhanced-input-box-container .side-buttons .action-button{flex-grow:1}.enhanced-input-box-container .lm_header .lm_tab .lm_close_tab,.enhanced-input-box-container .lm_controls .lm_popout,.enhanced-input-box-container .lm_controls .lm_maximise,.enhanced-input-box-container .lm_controls .lm_close{background-image:none !important}.text-psychology{color:#8a5db5;font-style:italic}.text-scenery{color:#3a8f9d}.text-system-highlight{color:#d4af37;font-weight:bold}.lm_header{height:32px !important}.lm_tab{height:30px !important;line-height:30px !important;padding-bottom:0 !important}.lm_tab .lm_close_tab{width:20px !important;height:20px !important;right:6px !important;top:5px !important;background-size:16px 16px;background-repeat:no-repeat;background-position:center;background-image:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23a0a0a0"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>') !important}.lm_tab .lm_close_tab:hover{background-image:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffffff"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>') !important}

/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"></div><script type="module" src="846c27d4abed59c2d773.ts"></script></body></html>