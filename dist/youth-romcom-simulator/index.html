<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>轮回-诸天万界</title><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet"/><script type="module">import*as e from'https://testingcf.jsdelivr.net/npm/dayjs/+esm';import'https://testingcf.jsdelivr.net/npm/golden-layout/dist/css/goldenlayout-base.css/+esm';import'https://testingcf.jsdelivr.net/npm/golden-layout/dist/css/themes/goldenlayout-dark-theme.css/+esm';import{GoldenLayout as t}from'https://testingcf.jsdelivr.net/npm/golden-layout/+esm';import{default as n}from'https://testingcf.jsdelivr.net/npm/screenfull/+esm';var a={223(e,t,n){n.d(t,{l:()=>l});var a=n(61),o=n(445);const l=new class{state=(0,a.reactive)({mainStoryStatus:'未读取',mainStoryContent:null,mainStoryStats:{filesLoaded:0,totalEvents:0,actionableEvents:0,foreshadowedEvents:0},calendarFixedStatus:'未读取',calendarFixedContent:null,calendarRandomStatus:'未读取',calendarRandomContent:null,calendarCrossoverStatus:'未读取',calendarCrossoverContent:null,styleGuideStatus:'未读取',styleGuideContent:null,lastContext:null});async refreshData(){try{const e=['[数据]主线剧情_第一卷','[数据]主线剧情_第二卷','[数据]主线剧情_第三卷','[数据]主线剧情_第四卷','[数据]主线剧情_第五卷','[数据]主线剧情_第六卷','[数据]主线剧情_第六点五卷','[数据]主线剧情_第七卷','[数据]主线剧情_第七点五卷','[数据]主线剧情_第八卷','[数据]主线剧情_第九卷','[数据]主线剧情_第十卷','[数据]主线剧情_第十点五卷','[数据]主线剧情_第十一卷','[数据]主线剧情_第十二卷','[数据]主线剧情_第十三卷','[数据]主线剧情_第十四卷','[数据]主线剧情_第十四点五卷'],t=(await Promise.all(e.map(e=>o.T.readFromLorebook(e)))).filter(e=>e).map(e=>{try{return JSON.parse(this._cleanJsonString(e))}catch{return null}}).filter(Boolean);if(t.length>0){this.state.mainStoryContent=t,this.state.mainStoryStatus=`读取成功 (${t.length}/${e.length})`;const n=t.reduce((e,t)=>e+(t.timeline?.length||0),0);this.state.mainStoryStats.filesLoaded=t.length,this.state.mainStoryStats.totalEvents=n}else this.state.mainStoryStatus='读取失败：所有主线条目均为空或无效'}catch(e){this.state.mainStoryStatus=`读取失败：${e.message}`}await this.loadDebugEntry('[数据]日历-固定事件','calendarFixedStatus','calendarFixedContent'),await this.loadDebugEntry('[数据]日历-随机事件','calendarRandomStatus','calendarRandomContent'),await this.loadDebugEntry('[数据]日历-跨界事件','calendarCrossoverStatus','calendarCrossoverContent'),await this.loadDebugEntry('[数据]服装风格指南','styleGuideStatus','styleGuideContent')}setLastContext(e){this.state.lastContext=e}setMainStoryStats(e){this.state.mainStoryStats=e}async loadDebugEntry(e,t,n){try{const a=await o.T.readFromLorebook(e);a?(this.state[n]=JSON.parse(this._cleanJsonString(a)),this.state[t]='读取成功'):this.state[t]='读取失败：条目为空'}catch(e){this.state[t]=`读取失败：${e.message}`}}_cleanJsonString(e){try{return JSON.parse(e),e}catch(t){const n=e.indexOf('{'),a=e.lastIndexOf('}');if(-1!==n&&-1!==a&&a>n)return e.substring(n,a+1)}return e}}},994(e,t,n){n.d(t,{q:()=>l});var a=n(61),o=n(354);const l=new class{get activeCards(){return(0,a.computed)(()=>{const e=o.M_.worldState?.叙事记录.当前激活卡牌;if(!e)return[];const t=this.playerBackpackCards.value.find(t=>t.ID===e);return t?[t]:[]})}get playerBackpackCards(){return(0,a.computed)(()=>{const e=o.M_.worldState?.主角;return'object'==typeof e&&e&&'卡牌背包'in e&&Array.isArray(e.卡牌背包)?e.卡牌背包:[]})}}},380(e,t,n){n.d(t,{U:()=>l});var a=n(61);const o=(0,a.reactive)({isVisible:!1,component:null,props:{},title:''}),l={state:(0,a.readonly)(o),show(e,t,n={}){o.title=e,o.component=(0,a.markRaw)(t),o.props=n,o.isVisible=!0},hide(){o.isVisible=!1,setTimeout(()=>{o.component=null,o.props={},o.title=''},300)}}},783(e,t,n){n.d(t,{R:()=>o});var a=n(725);const o=new class{processedDatesForDiary=new Set;lastWeeklyReviewCount=0;getSynthesisRequest(){const e=a.S.get('store');if(!e.diaryFragments||0===e.diaryFragments.length)return'';const t=[...new Set(e.diaryFragments.map(e=>e.日期))].sort();if(t.length>1){const n=t[0];if(!this.processedDatesForDiary.has(n)){const t=e.diaryFragments.filter(e=>e.日期===n);if(t.length>0){console.log(`[DiarySynthesisService] New day detected. Triggering synthesis for previous day: ${n}`),this.processedDatesForDiary.add(n);return`<请求合成日记>${JSON.stringify(t)}</请求合成日记>`}this.processedDatesForDiary.add(n)}}const n=e.diary.slice(this.lastWeeklyReviewCount);if(n.length>=7){console.log(`[DiarySynthesisService] Diary count (${e.diary.length}) reached threshold. Triggering Weekly Review Synthesis.`);const t=JSON.stringify(n);return this.lastWeeklyReviewCount+=7,`<请求合成周刊>${t}</请求合成周刊>`}return''}initialize(){const e=a.S.get('store');this.processedDatesForDiary.clear(),e.diary.forEach(e=>this.processedDatesForDiary.add(e.日期)),this.lastWeeklyReviewCount=7*e.weeklyReviews.length,console.log('[DiarySynthesisService] Initialized. Processed dates restored:',this.processedDatesForDiary)}}},861(e,t,n){n.d(t,{$:()=>a});const a=new class{indexByName=new Map;indexById=new Map;isInitialized=!1;async buildIndex(e){!this.isInitialized&&e&&(console.log('[EntityIndexService] Starting to build global entity index...'),this.indexByName.clear(),this.indexById.clear(),e.角色列表&&this.indexCharacters(e.角色列表),e.空间实体&&this.indexLocations(e.空间实体),this.isInitialized=!0,console.log(`[EntityIndexService] Global entity index built successfully with ${this.indexById.size} entries.`))}findByName(e){return this.indexByName.get(e)}findById(e){return this.indexById.get(e)}addEntity(e){const t=this.indexByName.get(e.name)||[];this.indexByName.set(e.name,[...t,e]),this.indexById.has(e.id)||this.indexById.set(e.id,e)}indexCharacters(e){for(const t in e){const n=e[t];if('object'==typeof n){if(this.addEntity({id:t,name:n.名称,type:'character',path:`角色列表.${t}`}),n.技能)for(const e in n.技能){n.技能[e];this.addEntity({id:`${t}-${e}`,name:e,type:'skill',path:`角色列表.${t}.技能.${e}`,ownerId:t})}if(n.物品栏)for(const e in n.物品栏)this.addEntity({id:e,name:e,type:'item',path:`角色列表.${t}.物品栏.${e}`,ownerId:t})}}}indexLocations(e){for(const t in e){const n=e[t];n&&n.名称&&this.addEntity({id:t,name:n.名称,type:'location',path:`空间实体.${t}`})}}}},691(e,t,n){n.d(t,{B:()=>a});const a=new class{events={};on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(e=>e!==t))}emit(e,...t){this.events[e]&&this.events[e].forEach(n=>{try{n(...t)}catch(t){console.error(`Error in event handler for ${e}:`,t)}})}}},445(e,t,n){n.d(t,{T:()=>i});const a='综漫-春物';let o=null;async function l(e=!1){if(o&&!e)return o;try{const e=await TavernHelper.getLorebookEntries(a);return e?(o=e,e):(console.error(`[LorebookService] 无法获取名为 "${a}" 的世界书的条目，或该世界书不存在。`),o=null,null)}catch(e){return console.error('[LorebookService] 调用 getLorebookEntries 时出错:',e),null}}async function r(e,t=!1){const n=await l(t);if(!n)return null;const a=n.find(t=>t.comment===e||t.name===e);return a?a.content:null}async function s(e,t,n={isEnabled:!0,keys:[]}){console.log(`[Roo Debug] Lorebook: Preparing to write/create entry: "${e}".`);const r=await l();if(!r)return;const s=r.find(t=>t.comment===e||t.name===e);try{if(s)console.log(`[Roo Debug] Lorebook: Entry "${e}" exists. Updating with setLorebookEntries.`),await TavernHelper.setLorebookEntries(a,[{uid:s.uid,content:t,enabled:n.isEnabled}]);else{console.log(`[Roo Debug] Lorebook: Entry "${e}" does not exist. Creating with createLorebookEntries.`);const o=e.replace(/\(\d+\)$/,''),l=r.find(e=>e.comment===o||e.name===o),s={comment:e,content:t,keys:[e],enabled:n.isEnabled,position:'before_character_definition',order:100};l&&Object.assign(s,{keys:[...l.keys||[],e],selective:l.selective,constant:l.constant,position:l.position,order:l.order,case_sensitive:l.case_sensitive}),console.log(`[Roo Debug] Lorebook: Calling createLorebookEntries for "${e}" with payload:`,JSON.stringify(s)),await TavernHelper.createLorebookEntries(a,[s])}console.log(`[LorebookService] API call for "${e}" completed successfully.`),o=null}catch(t){console.error(`[LorebookService] 操作条目 "${e}" 时出错:`,t)}}const i={getEntries:l,readFromLorebook:r,writeToLorebook:s,appendToEntry:async function(e,t,n='\n\n---\n\n'){console.log(`[Roo Debug] Lorebook: Appending to entry "${e}".`);try{const a=await r(e),o=a?`${a}${n}${t}`:t;await s(e,o)}catch(t){console.error(`[LorebookService] 追加内容到条目 "${e}" 时出错:`,t)}},findEntryByComment:function(e){return o?o.find(t=>t.comment===e)||null:(console.warn('[LorebookService] findEntryByComment called before cache was populated.'),null)},setEntryEnabled:async function(e,t){console.log(`[LorebookService] Setting entry "${e}" enabled status to: ${t}`);try{const n=await l();if(!n)return;const o=n.find(t=>t.comment===e||t.name===e);if(o){const n={...o,enabled:t};await TavernHelper.setLorebookEntries(a,[n]),console.log(`[LorebookService] Successfully set "${e}" enabled=${t}.`)}else console.warn(`[LorebookService] setEntryEnabled: Entry "${e}" not found. Skipping.`)}catch(t){console.error(`[LorebookService] 操作条目 "${e}" 启用状态时出错:`,t)}}}},131(e,t,n){n.d(t,{H:()=>l});var a=n(691),o=n(445);const l=new class{INSTANT_MEMORY_KEY='[系统]瞬时记忆';SHORT_TERM_MEMORY_KEY='[系统]短期记忆';LONG_TERM_MEMORY_KEY='[系统]长期记忆';DIRECTOR_LOG_KEY='导演场记';config={instantMemoryCount:10,shortTermMemoryCount:20,longTermMemoryCount:40};async processDirectorLog(){console.log('[MemoryService V3] Processing Director Log...');try{const e=await o.T.readFromLorebook(this.DIRECTOR_LOG_KEY,!0);if(!e)return void console.warn('[MemoryService V3] Director Log is empty. No new memory entries to add.');const t=e.split(/(?=剧本ID\|)/).filter(e=>''!==e.trim()),n=t.length>0?t[t.length-1]:'';if(!n)return void console.warn('[MemoryService V3] Processed Director Log content is empty after filtering. No new memory entries to add.');const l=this._formatInstantContent(n),r=this._formatShortTermContent(n),s=this._formatLongTermContent(n);await this._updateMemoryTier(this.INSTANT_MEMORY_KEY,l,this.config.instantMemoryCount),await this._updateMemoryTier(this.SHORT_TERM_MEMORY_KEY,r,this.config.shortTermMemoryCount),await this._updateMemoryTier(this.LONG_TERM_MEMORY_KEY,s,this.config.longTermMemoryCount),console.log('[MemoryService V3] Director Log processed and memory tiers updated.'),a.B.emit('memoryUpdated')}catch(e){console.error('[MemoryService V3] Failed to process Director Log:',e)}}_extractSection(e,t){const n=new RegExp(`【${t}】([\\s\\S]*?)(?=\\n【|$)`),a=e.match(n);return a&&a[1]?a[1].trim():'无'}_formatInstantContent(e){const t=e.match(/^剧本ID\|(.+)/m);return[`剧本ID|${t?t[1].trim():'未知'}`,`【下回合锚点预告】\n${this._extractSection(e,'下回合锚点预告')}`,`【关键情节完成度】\n${this._extractSection(e,'世界线变动记录')}`].join('\n\n---\n\n').trim()}_formatShortTermContent(e){const t=e.match(/^剧本ID\|(.+)/m),n=`剧本ID|${t?t[1].trim():'未知'}`;let a='无';const o=this._extractSection(e,'镜头与表演分析');if('无'!==o){const e=/NPC表演分析\|([\s\S]*)/,t=o.match(e);t&&t[1]&&(a=t[1].trim())}return[n,`【NPC表演分析】\n${a}`,`【校园BBS】\n${this._extractSection(e,'校园BBS')}`].join('\n\n---\n\n').trim()}_formatLongTermContent(e){const t=e.match(/^剧本ID\|(.+)/m),n=`剧本ID|${t?t[1].trim():'未知'}`,a=e.match(/导演意图\|([\s\S]*?)(?=\n---|$)/),o=`【导演意图】\n${a&&a[1]?a[1].trim():'无'}`;let l=this._extractSection(e,'镜头与表演分析');if('无'!==l){const e=l.indexOf('NPC表演分析|');-1!==e&&(l=l.substring(0,e).trim())}return[n,o,`【镜头与表演分析】\n${l}`,`【叙事节奏掌控】\n${this._extractSection(e,'叙事节奏掌控')}`].join('\n\n---\n\n').trim()}async _updateMemoryTier(e,t,n){const a='\n\n<--MEMORY_ENTRY_SEPARATOR--\x3e\n\n';let l='';try{l=await o.T.readFromLorebook(e,!0)}catch(t){console.log(`[MemoryService V3] Could not read memory tier "${e}", assuming it's new.`)}let r=[];if(l&&!l.startsWith('暂无')&&(r=l.split(a)),r.length>0&&r[0]===t)return void console.log(`[MemoryService V3] Skipping update for "${e}" as the new entry is identical to the latest one.`);r.unshift(t);const s=r.slice(0,n).join(a);await this.writeMemory(e,s)}async writeMemory(e,t){await o.T.writeToLorebook(e,t,{isEnabled:!0,keys:[e]})}getConfig(){return this.config}setConfig(e){this.config={...this.config,...e},console.log('[MemoryService V2] Config updated:',this.config),this.processDirectorLog()}}},711(e,t,n){n.d(t,{f:()=>s,l:()=>i});var a=n(61);const o=(0,a.reactive)({notifications:[]});let l=0;const r={show(e,t,n='info',a=4e3){const r=l++;o.notifications.push({id:r,title:e,message:t,type:n}),a>0&&setTimeout(()=>{this.hide(r)},a)},hide(e){const t=o.notifications.findIndex(t=>t.id===e);-1!==t&&o.notifications.splice(t,1)},success(e,t,n=4e3){this.show(e,t,'success',n)},info(e,t,n=4e3){this.show(e,t,'info',n)},warn(e,t,n=5e3){this.show(e,t,'warning',n)},error(e,t,n=7e3){this.show(e,t,'error',n)}},s=o,i=r},407(e,t,n){n.d(t,{n:()=>c});var a=n(224),o=n(61),l=n(354);const r='{{user}}',s=(0,o.reactive)(new Map),i=(0,o.computed)(()=>{const e=l.M_.worldState;if(!e?.角色列表)return[];const t=[];for(const n in e.角色列表){const a=e.角色列表[n];'object'==typeof a&&null!==a&&t.push({...a,id:n})}return t});const c={getNpcsByWorld:function(e){return i.value},allNpcs:i,initializeWorldAndLocationData:async function(){const e=l.M_.worldState?.角色列表;if(!e)return console.warn('[NpcService] worldState.角色列表 is not available for initialization.'),[];const t=new Set;Object.values(e).forEach(e=>{'object'==typeof e&&e?.身份&&e.身份.forEach(e=>{e.组织&&t.add(e.组织)})});const n=Array.from(t).map(e=>({id:e,name:e}));return console.log('[NpcService] Initialized worlds from character data.',n),n},getLocationName:function(e){if(!e)return'未知地点';const t=(0,a.get)(l.M_.worldState,`地点.${e}`);return t?.名称||e},getLocationDetails:function(e){return e?(0,a.get)(l.M_.worldState,`地点.${e}`):null},getNpcNameById:function(e){if(e===r){const t=l.M_.worldState?.主角;return'object'==typeof t&&t.名称||e}const t=(0,a.get)(l.M_.worldState,`角色列表.${e}`);return'object'==typeof t&&null!==t&&t.名称||e},getNpcId:function(e){const t=l.M_.worldState?.角色列表;if(!t)return null;for(const n in t)if(t[n]===e)return n;const n=l.M_.worldState?.主角;return'object'==typeof n&&n===e?r:null},locationCache:s,getParentLocationName:function(e){const t=s.get(e)?.parentId;return t?'WORLD_ORIGIN'===t?'世界本身':s.get(t)?.name||'未知':'未知'},cacheLocationData:function(e){if(Array.isArray(e))for(const t of e)t.ID&&t.名称&&s.set(t.ID,{name:t.名称,parentId:t.所属?.ID||null})}}},479(e,t,n){n.d(t,{z:()=>l});var a=n(423),o=n(445);const l=new class{masterTimeline=null;flattenedStages=null;fixedEvents=null;async loadMasterTimeline(){if(!this.masterTimeline)try{const e=await Promise.all([o.T.readFromLorebook('[数据]主线剧情_第一卷'),o.T.readFromLorebook('[数据]主线剧情_第二卷'),o.T.readFromLorebook('[数据]主线剧情_第三卷'),o.T.readFromLorebook('[数据]主线剧情_第四卷'),o.T.readFromLorebook('[数据]主线剧情_第五卷'),o.T.readFromLorebook('[数据]主线剧情_第六卷'),o.T.readFromLorebook('[数据]主线剧情_第六点五卷'),o.T.readFromLorebook('[数据]主线剧情_第七卷'),o.T.readFromLorebook('[数据]主线剧情_第七点五卷'),o.T.readFromLorebook('[数据]主线剧情_第八卷'),o.T.readFromLorebook('[数据]主线剧情_第九卷'),o.T.readFromLorebook('[数据]主线剧情_第十卷'),o.T.readFromLorebook('[数据]主线剧情_第十点五卷'),o.T.readFromLorebook('[数据]主线剧情_第十一卷'),o.T.readFromLorebook('[数据]主线剧情_第十二卷'),o.T.readFromLorebook('[数据]主线剧情_第十三卷'),o.T.readFromLorebook('[数据]主线剧情_第十四卷'),o.T.readFromLorebook('[数据]主线剧情_第十四点五卷')]);let t=[];e.forEach(e=>{if(e)try{const n=JSON.parse(e);n&&Array.isArray(n.timeline)&&(t=t.concat(n.timeline))}catch(e){console.error('Failed to parse story content:',e)}}),this.masterTimeline=t,this.flattenStages()}catch(e){console.error('[StorylineService] Failed to load main story data:',e),this.masterTimeline=[]}}flattenStages(){this.masterTimeline?this.flattenedStages=this.masterTimeline.flatMap(e=>(e.stages||e.阶段||[]).map(t=>{const n=t.trigger_time||t.触发条件||t.trigger_conditions;let a='N/A',o='N/A';if(n){const e=n.必须全部满足||n.must_all;if(e&&Array.isArray(e)){for(const t of e)if('string'==typeof t){const e=t.match(/日期为 (\d{4}-\d{2}-\d{2})/);e&&(a=e[1]);const n=t.match(/时间片段为 ([\u4e00-\u9fa5]+)/);n&&(o=n[1])}}else n.date&&(a=n.date,o=n.segment||'N/A')}return{...t,id:t.id||t.stage_id||'',arcId:e.id,arcTitle:e.title,trigger_time:{date:a,segment:o}}}).filter(e=>e.id)):this.flattenedStages=[]}async getFlattenedStages(){return await this.loadMasterTimeline(),this.flattenedStages}async getMasterTimeline(){return await this.loadMasterTimeline(),this.masterTimeline}async getActionableStoryline(e){if(!e)return null;if(await this.loadMasterTimeline(),!this.flattenedStages)return null;const t=e.叙事记录?.历史事件||[],n=(0,a.default)(e.世界状态.时间.日期),o=e.世界状态.时间.当前片段;for(const a of this.flattenedStages){if(!a.id||t.includes(a.id))continue;if(!this.isTimeReached(n,o,a))continue;if(this.checkTriggerConditions(a,t,e))return a}return null}isTimeReached(e,t,n){let o,l;if(n.trigger_time&&n.trigger_time.date)o=n.trigger_time.date,l=n.trigger_time.segment;else if(n.触发条件&&Array.isArray(n.触发条件.必须全部满足)){const e=n.触发条件.必须全部满足,t=e.find(e=>'string'==typeof e&&e.startsWith('日期为')),a=e.find(e=>'string'==typeof e&&e.startsWith('时间片段为'));t&&(o=t.replace('日期为 ','').trim()),a&&(l=a.replace('时间片段为 ','').trim())}if(!o)return!0;const r=(0,a.default)(o);if(!r.isValid())return console.warn(`[StorylineService] Invalid date format in trigger: ${o}`),!1;if(e.isBefore(r,'day'))return!1;if(e.isSame(r,'day')&&l){const e=['早晨','上学路','午前','午休','午后','放学后','傍晚','夜'],n=e.indexOf(t),a=e.indexOf(l);if(-1===a)return console.warn(`[StorylineService] Invalid time segment in trigger: ${l}`),!1;if(n<a)return!1}return!0}checkTriggerConditions(e,t,n){const a=e.触发条件?.必须全部满足||e.trigger_conditions?.must_all;if(!a||!Array.isArray(a))return!0;for(const e of a)if('object'==typeof e&&e.type){if('event_completed'===e.type){if(!t.includes(e.event_id))return!1}else if('character_not_has_status'===e.type){if(!n)return!1;const t=e.character_id,a='{{user}}'===t?n.主角:n.角色列表[t];if(a&&'待初始化'!==a&&a.当前状态.includes(e.status))return!1}}else if('string'==typeof e){if(e.startsWith('日期为')||e.startsWith('时间片段为'))continue;if(!this._parseNaturalLanguageCondition(e,t,n))return!1}else if('object'==typeof e&&e['完成事件']&&!t.includes(e['完成事件']))return!1;return!0}_parseNaturalLanguageCondition(e,t,n){if(!n)return!1;const a=e.match(/完成事件\s+([A-Z0-9._-]+)/);if(a)return t.includes(a[1]);const o=e.match(/(\S+)\s*当前状态不包含\s*“([^”]+)”/);if(o){const e=o[1],t=o[2];if(!n.角色列表)return!1;const a=Object.values(n.角色列表).find(t=>'object'==typeof t&&t.名称===e);if(a&&'object'==typeof a){return!(a.当前状态||[]).some(e=>e.includes(t))}return!1}return!0}async getDisplayTimeline(e){const t=await this.getAllTimelineStages(e);if(!t||!e)return[];const n=new Set(e.叙事记录.历史事件);let a=-1;for(let e=t.length-1;e>=0;e--)if(t[e].id&&n.has(t[e].id)){a=e;break}const o=a+1,l=o+4,r=t.slice(o,l);return r.length>0&&(r[0].status='current'),r}async getAllTimelineStages(e){if(await this.loadMasterTimeline(),!this.flattenedStages)return[];const t=new Set(e?.叙事记录?.历史事件||[]);return this.flattenedStages.map(e=>({...e,status:t.has(e.id)?'completed':'future'}))}async getFixedEvents(){if(this.fixedEvents)return this.fixedEvents;try{const e=await o.T.readFromLorebook('[数据]日历-固定事件',!0);if(!e)return this.fixedEvents={},{};const t=JSON.parse(e),n={};if(t&&t.events)for(const e in t.events)for(const a in t.events[e]){n[`${String(e).padStart(2,'0')}-${String(a).padStart(2,'0')}`]=t.events[e][a]}return this.fixedEvents=n,this.fixedEvents}catch(e){return console.error('[StorylineService] Failed to load or parse fixed events:',e),this.fixedEvents={},{}}}}},393(e,t,n){n.d(t,{N:()=>l});var a=n(445);const o={NORMAL:['【cot】必要关键cot'],CREATION:['【cot】创世必要关键cot'],IDENTITY:['【cot】身份必要关键cot']};const l=new class{currentState='NORMAL';narrativeCache=null;updateScriptCache=null;preserveMode='none';constructor(){this.switchTo('NORMAL')}getCurrentState(){return this.currentState}async switchTo(e,t=!1){if(this.currentState===e&&!t)return;console.log(`[WorkflowService] Switching from ${this.currentState} to ${e} (Forced: ${t})`);const n=Object.values(o).flat(),l=o[e];for(const e of n){const t=l.includes(e);await a.T.setEntryEnabled(e,t)}this.currentState=e,console.log(`[WorkflowService] Switched to ${e}. Enabled CoTs: ${l.join(', ')}`)}cacheNarrative(e){this.narrativeCache=e,console.log('[WorkflowService] Narrative cached.')}popNarrative(){const e=this.narrativeCache;return this.narrativeCache=null,e&&console.log('[WorkflowService] Popped cached narrative.'),e}cacheUpdateScript(e){this.updateScriptCache=e,console.log('[WorkflowService] Update script cached.')}popUpdateScript(){const e=this.updateScriptCache;return this.updateScriptCache=null,e&&console.log('[WorkflowService] Popped cached update script.'),e}setPreserveMode(e){this.preserveMode=e,console.log(`[WorkflowService] Preserve mode set to: ${e}`)}popPreservedContent(){let e='';return'gametxt'!==this.preserveMode&&'full'!==this.preserveMode||this.narrativeCache&&(e+=`\n<gametxt>${this.narrativeCache}</gametxt>`,console.log('[WorkflowService] Popped cached narrative for appending.')),'full'===this.preserveMode&&this.updateScriptCache&&(e+=`\n<UpdateVariable>${this.updateScriptCache}</UpdateVariable>`,console.log('[WorkflowService] Popped cached update script for appending.')),this.narrativeCache=null,this.updateScriptCache=null,this.preserveMode='none',e&&console.log('[WorkflowService] Final content to append length:',e.length),e}}},581(e,t,n){n.d(t,{h:()=>m});var a=n(632),o=n(445),l=n(725);const r='综漫-春物',s='存档-',i=['自动-A','自动-B'],c='自动-重来',d=['[系统]长期记忆','[系统]短期记忆','[系统]瞬时记忆','日记','日记片段-禁开','周刊','日记片段','导演场记'];const m=new class{manualSlots=[];autoSlots=[];rerollSlot=null;turnCounter=0;isAutoSaveEnabled=!0;autoSaveInterval;areSlotsLoaded=!1;constructor(){this.initializeSlots(),this.loadAutoSaveState(),this.loadTurnCounter()}async ensureSlotsLoaded(){this.areSlotsLoaded||(await this.loadAllSaveSlots(),this.areSlotsLoaded=!0)}initializeSlots(){for(let e=1;e<=5;e++)this.manualSlots.push({id:`手动-${e}`,name:`手动存档 ${e}`,timestamp:null,data:null});for(const e of i)this.autoSlots.push({id:e,name:`自动存档 ${e.split('-')[1]}`,timestamp:null,data:null});this.rerollSlot={id:c,name:'重来存档',timestamp:null,data:null}}async loadAllSaveSlots(){try{const e=await TavernHelper.getLorebookEntries(r);if(!e)return;const t=t=>{const n=e.find(e=>e.comment===`${s}${t.id}`);if(n&&n.content)try{t.data=JSON.parse(n.content),t.timestamp=t.data.timestamp,t.diaryDate=t.data.diaryDate,t.diaryTimeSegment=t.data.diaryTimeSegment,t.diaryTitle=t.data.diaryTitle,t.entryUid=n.uid}catch(e){console.error(`解析存档 ${t.id} 失败:`,e),t.timestamp='数据损坏',t.data=null}else t.timestamp=null,t.data=null,t.entryUid=void 0};this.manualSlots.forEach(t),this.autoSlots.forEach(t),this.rerollSlot&&t(this.rerollSlot)}catch(e){console.error('加载存档槽位时出错:',e),a.error('加载存档列表失败。')}}async saveGame(e,t=!1){await this.ensureSlotsLoaded(),t||a.info(`正在保存到槽位 [${e}]...`);try{const n=await TavernHelper.getChatMessages('0');if(!n||0===n.length)throw new Error('无法获取当前聊天状态，无法保存。');const i=n[0],c=(new Date).toISOString(),m={};for(const e of d){const t=await o.T.readFromLorebook(e);m[e]=t??''}const u=l.S.get('store'),p=await this._getLatestFragment(),v=u.worldState?.世界状态?.时间,g=i.message.replace(/(<\s*UpdateVariable\b[^>]*>)[\s\S]*?(<\s*\/\s*UpdateVariable\s*>)/g,'$1$2'),y={timestamp:c,mvu_data:i.data,message_content:g,lorebook_backup:m,diaryDate:v?.日期,diaryTimeSegment:v?.当前片段,diaryTitle:p?.标题},f=`${s}${e}`,h=(await TavernHelper.getLorebookEntries(r)).find(e=>e.comment===f);h?await TavernHelper.setLorebookEntries(r,[{uid:h.uid,content:JSON.stringify(y,null,2)}]):await TavernHelper.createLorebookEntries(r,[{comment:f,content:JSON.stringify(y,null,2),keys:[f],position:'after_character_definition',order:200}]),await this.loadAllSaveSlots(),t?console.log(`[AutoSave] 成功自动存档至 ${e}`):a.success(`游戏已成功保存至 [${e}]！`)}catch(n){const o=`保存失败: ${n instanceof Error?n.message:String(n)}`;console.error(`保存游戏到槽位 ${e} 时出错:`,n),t||a.error(o)}}async _internalLoadGame(e){if(!e.data||!e.data.mvu_data)throw new Error('无法读取空存档或损坏的存档。');if(e.data.lorebook_backup)for(const t in e.data.lorebook_backup)await o.T.writeToLorebook(t,e.data.lorebook_backup[t]);const t=(await TavernHelper.getChatMessages('0'))[0]||{};t.data=e.data.mvu_data,t.message=e.data.message_content,await TavernHelper.setChatMessages([t],{refresh:'all'})}async loadGame(e){if(confirm(`确定要读取存档 [${e.name}] 吗？当前所有未保存的进度将会被覆盖。`)){a.info(`正在从 [${e.name}] 读取存档...`);try{await this._internalLoadGame(e),a.success(`已成功从 [${e.name}] 读取存档！游戏即将刷新...`)}catch(t){const n=`读档失败: ${t instanceof Error?t.message:String(t)}`;console.error(`读取游戏存档 ${e.name} 时出错:`,t),a.error(n)}}}async _getLatestFragment(){try{const e=await TavernHelper.getChatMessages('0');if(!e||0===e.length)return null;const t=[...e].reverse().find(e=>'You'!==e.name&&'{{user}}'!==e.name&&e.message&&e.message.includes('<日记片段>'));if(!t)return null;const n=t.message.match(/<日记片段>([\s\S]+?)<\/日记片段>/);if(!n||!n[1])return null;const a=n[1].match(/标题\|(.+)/);return a&&a[1]?{标题:a[1].trim()}:null}catch(e){return console.error('Failed to get latest fragment:',e),null}}async deleteSave(e){if(e.entryUid){if(confirm(`你确定要永久删除存档 [${e.name}] 吗？\n此操作不可撤销。`)){a.info(`正在删除存档 [${e.name}]...`);try{await TavernHelper.deleteLorebookEntries(r,[e.entryUid]),await this.loadAllSaveSlots(),a.success(`存档 [${e.name}] 已被删除。`)}catch(t){console.error(`删除存档 ${e.name} 时出错:`,t),a.error(`删除失败: ${t instanceof Error?t.message:String(t)}`)}}}else a.warning('这是一个空槽位，无需删除。')}async performAutoSave(){if(!this.isAutoSaveEnabled)return;this.turnCounter++,localStorage.setItem('tianhua_turn_counter',this.turnCounter.toString());const e=this.turnCounter%2==1?i[0]:i[1];await this.saveGame(e,!0)}async saveStateForReroll(){console.log('[Reroll] Saving state for potential reroll...'),await this.saveGame(c,!0)}async loadRerollState(){if(await this.ensureSlotsLoaded(),!this.rerollSlot||!this.rerollSlot.data)throw a.error('没有可用于“重来”的存档点。'),new Error('No reroll save state found.');console.log('[Reroll] Loading state for reroll and setting restore flag...'),localStorage.setItem('reincarnation-simulator-restore-input','true'),await this._internalLoadGame(this.rerollSlot),setTimeout(()=>window.location.reload(),500)}exportSave(e){if(!e.data)return void a.warning('无法导出空存档。');const t=JSON.stringify(e.data,null,2),n=new Blob([t],{type:'application/json'}),o=URL.createObjectURL(n),l=document.createElement('a');l.href=o,l.download=`[轮回模拟器]存档-${e.name}-${(new Date).toISOString()}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o),a.success(`存档 [${e.name}] 已导出。`)}async importSave(e){try{const t=JSON.parse(e);if(!t.timestamp||!t.mvu_data)throw new Error('存档文件格式不正确。');const n=this.manualSlots.find(e=>!e.data);if(!n)return void a.error('没有空的手动存档槽位可用于导入。');a.info(`正在导入存档到槽位 [${n.name}]...`);const o=`${s}${n.id}`,l=(await TavernHelper.getLorebookEntries(r)).find(e=>e.comment===o);l?await TavernHelper.setLorebookEntries(r,[{uid:l.uid,content:JSON.stringify(t,null,2)}]):await TavernHelper.createLorebookEntries(r,[{comment:o,content:JSON.stringify(t,null,2),keys:[o],position:'after_character_definition',order:200,enabled:!1}]),await this.loadAllSaveSlots(),a.success(`存档已成功导入至 [${n.name}]！`)}catch(e){const t=`导入失败: ${e instanceof Error?e.message:String(e)}`;console.error('导入存档时出错:',e),a.error(t)}}toggleAutoSave(e){this.isAutoSaveEnabled=e,localStorage.setItem('tianhua_auto_save_enabled',JSON.stringify(e)),a.info('自动存档已'+(e?'开启':'关闭'))}loadAutoSaveState(){const e=localStorage.getItem('tianhua_auto_save_enabled');null!==e&&(this.isAutoSaveEnabled=JSON.parse(e))}loadTurnCounter(){const e=localStorage.getItem('tianhua_turn_counter');null!==e&&(this.turnCounter=parseInt(e,10)||0)}}},725(e,t,n){n.d(t,{S:()=>o});const a={},o={register(e,t){a[e]=t},get(e){const t=a[e];if(!t)throw new Error(`Service with key "${e}" has not been registered.`);return t}}},487(e,t,n){n.d(t,{_:()=>a});const a=new class{async fetchTavernData(){console.debug('Fetching data from Tavern...');const e=await getChatMessages(getCurrentMessageId());return console.debug('Messages received:',e),e}async generateAiResponse(e){const t={injects:[{role:'user',content:e,position:'in_chat',should_scan:!0}],should_stream:!1},n=await TavernHelper.generate(t);if('string'!=typeof n)throw new Error('AI未能返回有效文本。');return n}async invokeMvuScript(e,t){const n={old_variables:t};return await eventEmit('mag_invoke_mvu',e,n),n.new_variables}}},562(e,t,n){n.d(t,{AE:()=>i,IL:()=>c,dn:()=>s,qE:()=>d});var a=n(224),o=n(61),l=n(255);const r=(0,o.computed)(()=>{if(!l.M.worldState)return null;const e=(0,a.get)(l.M.worldState,`角色列表.${l.i}`);return'string'!=typeof e&&e?e:null}),s=((0,o.computed)(()=>l.M.mainWorldNarrative),(e,t=null)=>(0,o.computed)(()=>(0,a.get)(l.M.worldState,e,t))),i=((0,o.computed)(()=>r.value?(0,a.get)(r.value,'属性',{}):[]),(0,o.computed)(()=>r.value?(0,a.get)(r.value,'技能',{}):[])),c=((0,o.computed)(()=>r.value?(0,a.get)(r.value,'物品栏',{}):[]),(0,o.computed)(()=>l.M.worldState?.世界状态?.时间?new Date(l.M.worldState.世界状态.时间).toLocaleString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',hour12:!1}):'未知时间'),(0,o.computed)(()=>`<div class="narrative-block main-world-narrative">${l.M.mainWorldNarrative||'等待故事的展开...'}</div>`)),d=e=>{const t=l.M.worldState?.角色列表;if(!t)return null;for(const n in t){const a=t[n];if('string'!=typeof a&&a&&a.名称===e)return a}return null}},354(e,t,n){n.d(t,{o1:()=>x,M_:()=>h.M});var a=n(224),o=n(707),l=n(423),r=n(223),s=n(783),i=n(445);const c=new class{cachedLogs=[];entityIdToNameMap=new Map;lastLogCount=-1;config={topN:5,recencyWeight:1.5,entityMatchWeight:5,locationMatchWeight:3,socialGraphWeight:4,coreTraitWeight:2.5,causalLinkWeight:10};getRelevantMemories(e,t,n,a,o){this.ensureCacheIsReady(n,t,a);let l=this.cachedLogs;o&&(l=this.cachedLogs.filter(e=>e.日期&&o(e.日期)));const r=this.extractQueryEntities(e,t,a),s=l.map(e=>{const n=this.calculateRelevanceScore(e,r,t,a);return{...e,relevanceScore:n}}),i=s.filter(e=>e.relevanceScore>0);return i.length>0?i.sort((e,t)=>t.relevanceScore-e.relevanceScore).slice(0,this.config.topN):o&&l.length>0?l:o?[]:s.sort((e,t)=>t.relevanceScore-e.relevanceScore).slice(0,this.config.topN)}calculateRelevanceScore(e,t,n,a){let o=0;const l=this.cachedLogs.length>0?Math.max(...this.cachedLogs.map(e=>e.序号)):1,r=`${e.标题} ${e.事件概要||''} ${e.我的抉择||''} ${e.关系变动||''}`,s=new Set;for(const[e,t]of this.entityIdToNameMap.entries())t&&r.includes(t)&&s.add(e);return o+=new Set([...t].filter(e=>s.has(e))).size*this.config.entityMatchWeight,o+=e.序号/l*this.config.recencyWeight,o+=this.getSocialGraphScore(s,t,n),o+=this.getCoreTraitScore(r,s,n,a),o+=this.getCausalLinkScore(e,t),o}ensureCacheIsReady(e,t,n){e.length!==this.lastLogCount&&(this.cachedLogs=[...e],this.lastLogCount=e.length,this.buildEntityIdToNameMap(t,n),console.log(`[MemoryRetrievalService] Cache updated. Entity index rebuilt with ${this.entityIdToNameMap.size} entries.`))}buildEntityIdToNameMap(e,t){this.entityIdToNameMap.clear();const{角色列表:n,地点:a,主角:o}=e;if(n)for(const e in n){const t=n[e];'object'==typeof t&&t.名称&&this.entityIdToNameMap.set(e,t.名称)}if(a)for(const e in a){const t=a[e];t.名称&&this.entityIdToNameMap.set(e,t.名称)}o&&'object'==typeof o&&o.名称&&this.entityIdToNameMap.set(t,o.名称)}extractQueryEntities(e,t,n){const a=new Set;a.add(n);for(const[t,n]of this.entityIdToNameMap.entries())n&&e.includes(n)&&a.add(t);const o=t.主角;if(o&&'object'==typeof o){const e=o.位置;if(e&&t.角色列表)for(const n in t.角色列表){const o=t.角色列表[n];'object'==typeof o&&o.位置===e&&a.add(n)}e&&a.add(e)}return a}getSocialGraphScore(e,t,n){let a=0;if(!n.关系)return 0;for(const o of e)if(this.entityIdToNameMap.has(o))for(const e of t){if(o===e||!this.entityIdToNameMap.has(e))continue;const t=n.关系[o];if(t&&'object'==typeof t){const n=t[e];if(n&&'object'==typeof n&&n.数值){const e=Math.abs(n.数值.亲密度),t=Math.abs(n.数值.支配度);e>80&&(a+=this.config.socialGraphWeight),t>100&&(a+=this.config.socialGraphWeight)}}}return a}getCoreTraitScore(e,t,n,a){let o=0;for(const l of t){let t;if(t=l===a?n.主角:n.角色列表[l],t&&'object'==typeof t&&'人格内核'in t){const n=t;n.人格内核?.标识符&&e.includes(n.人格内核.标识符)&&(o+=this.config.coreTraitWeight)}}return o}getCausalLinkScore(e,t){return 0}};var d=n(479);const m=new class{lastProcessedCardDrawTime=null;hasIssuedDrawCommandForTime=!1;analyzeUserIntent(e,t,n){const a={actionType:'default',explicitEntities:{characters:[],locations:[],dbItems:[]},triggeredRipples:[]};if(!t)return a;const o=[{type:'social',regex:/(对话|交谈|说服|询问|关系|告诉|回答|问)/},{type:'exploration',regex:/(探索|前往|调查|寻找|去|观察|看)/},{type:'inventory',regex:/(背包|物品|整理|装备|使用|查看)/}];for(const{type:t,regex:n}of o)if(n.test(e)){a.actionType=t;break}if(t.角色列表)for(const n in t.角色列表){const o=t.角色列表[n];'object'==typeof o&&o.名称&&e.includes(o.名称)&&a.explicitEntities.characters.push(n)}return console.log('[ContextService] User Intent Analyzed:',a),a}async buildLeanContext(e,t,n,a,o,l){if(!a||'object'!=typeof a.主角)return console.error('[ContextService] World state or protagonist not found or invalid.'),{sceneContext:{},worldContext:{}};const s=`${t} ${n}`,i=this.parseRelativeDate(s,a),c=await d.z.getFlattenedStages(),m=a.主角,u=o,{anchorCharacterNames:p,anchorLocationNames:v}=await this.parseDirectorLogForAnchors(),g=this.buildLocationContext(a,m,v),y=this.buildSceneContext(a,m,g),{presentCharacters:f,absentCharacterSummaries:h,presentCharacterIds:k}=await this.buildCharacterContext(e,s,a,m,u,p),E=this.buildRelationshipContext(a,k,u),N=await this.buildDirectiveContext(a,k,c),S=await this.buildMemoryContext(a,s,l,c,o,i),b={主角:m,在场人物:f,非在场人物摘要:h,关系网络:E,地点:g,导演指令:N,卡牌系统:this.buildCardContext(a),...S};return r.l.setLastContext({...y,...b}),{sceneContext:y,worldContext:b}}buildSceneContext(e,t,n){if(!e)return{地点:'未知',时间:'',天气:'晴天',氛围:'未知'};const a=t?.位置,o=a?n[a]:void 0;return{地点:o?.名称||'未知',时间:`${e.世界状态.时间.日期} ${e.世界状态.时间.当前片段}`,天气:e.世界状态.天气,氛围:o?.场景特质?.map(e=>e.特质名称).join(', ')||'无特殊氛围'}}buildLocationContext(e,t,n=[]){const a={};if(!e?.地点)return a;const o=e.地点,l=Object.entries(o).filter(([,e])=>n.includes(e.名称)).map(([e])=>e),r=new Set(l);if(t?.位置){r.add(t.位置);this.getAllParentLocationIds(t.位置,o).forEach(e=>r.add(e))}for(const e in o){const t=o[e];r.has(e)?a[e]=t:a[e]={名称:t.名称,层级类型:t.层级类型}}return a}async buildCharacterContext(e,t,n,a,o,l=[]){const r={},s={},i=new Set,c=await this.loadClothingStyles();if(n&&n.角色列表){const t=n.角色列表,d=Object.entries(t).filter(([,e])=>'object'==typeof e&&l.includes(e.名称)).map(([e])=>e),m=a?.位置,u=new Set(e.explicitEntities.characters),p=new Set(d);o&&p.add(o),u.forEach(e=>p.add(e));for(const e in t){const n=t[e];'object'==typeof n&&n&&n.位置===m&&(p.add(e),i.add(e))}for(const e in t){const a=t[e];if('object'!=typeof a||!a)continue;const o={...a},l=c?.[e]||c?.DEFAULT;if(l){const e={通用偏好:l.通用偏好,特殊情境:l.特殊情境},t=this.getCurrentSeason(new Date(n.世界状态.时间.日期)),a=n.世界状态.天气;l.季节偏好?.[t]&&(e.季节偏好={[t]:l.季节偏好[t]}),l.天气应对?.[a]&&(e.天气应对={[a]:l.天气应对[a]}),o.服装风格=e}p.has(e)?(r[e]=o,a.位置===m&&i.add(e)):s[e]={名称:a.名称,身份:a.身份,位置:a.位置,核心标识:a.人格内核?.标识符}}}return{presentCharacters:r,absentCharacterSummaries:s,presentCharacterIds:i}}buildRelationshipContext(e,t,n){const a={};if(!e?.关系)return a;const o=e.关系,l=new Set(t);n&&l.add(n);for(const e of l){const t=o[e];if(t){a[e]={};for(const n of l)t[n]&&(a[e][n]=t[n])}}return a}async buildDirectiveContext(e,t,n){if(!e)return{};const a={};try{if(n){const t=await d.z.getActionableStoryline(e);let o=[];if(t){a.待触发主线={...t,导演指导:'【剧情触发指令】这是一个必须发生的核心事件。请在本回合或接下来的几个回合内，严格按照以上剧本（包含NPC剧本、关键情节等）进行演绎，确保剧情向此事件发展。你可以根据`默认演化`中的描述来理解在无干预情况下的标准剧情走向。'};const e=n.findIndex(e=>e.id===t.id);-1!==e&&(o=n.slice(e+1,e+4))}else{const t=e.叙事记录?.历史事件||[],a=n.findIndex(e=>e.id&&!t.includes(e.id));-1!==a&&(o=n.slice(a,a+3))}o.length>0&&(a.未来主线预告=o.map(e=>({...e,导演指导:'【叙事铺垫指引】这是一个未来可能发生的事件，请将其作为背景信息。你不能直接表演其中的`关键情节`，但可以利用剧本中的所有信息（如人物关系、心态、关键道具等）在当前的叙事中进行合理的铺垫。例如，可以在对话中提及未来的关键人物，或让角色对未来的关键地点产生兴趣。'})))}}catch(e){console.error('[ContextService] Failed to process main story data:',e)}try{const t=await i.T.readFromLorebook('[数据]日历-固定事件');if(t){const n=JSON.parse(t),o=new Date(e.世界状态.时间.日期).getMonth()+1,l=new Date(e.世界状态.时间.日期).getDate(),r=String(o).padStart(2,'0'),s=n.events?.[r]||{},i=[];for(let t=0;t<7;t++){const n=new Date(e.世界状态.时间.日期);n.setDate(l+t);const a=String(n.getDate()).padStart(2,'0');s[a]&&i.push({日期:`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,'0')}-${a}`,事件:s[a].join(' | ')})}i.length>0&&(a.日历事件={指导:'【背景氛围素材】以下是近期将发生的日历事件，请在叙事中适当融入相关的节日氛围或活动暗示，以增强世界的真实感。',事件列表:i})}const n=await i.T.readFromLorebook('[数据]日历-随机事件');if(n){const e=JSON.parse(n),t=(e.pool||[]).slice(0,2).map(e=>({类型:e.type,标题:e.content,内容:e.detail}));t.length>0&&(a.可用随机事件={指导:'【叙事填充素材】当没有明确的主线任务时，你可以从以下随机事件中选择一个进行演绎，以丰富日常剧情。请选择与当前场景和人物心情最匹配的事件。',事件列表:t})}}catch(e){console.error('[ContextService] Failed to process calendar data:',e)}if(e.命运卡牌系统&&e.命运卡牌系统.下次抽卡时间){const t=e.命运卡牌系统.下次抽卡时间;if(t&&t.日期&&t.片段){this.lastProcessedCardDrawTime&&this.lastProcessedCardDrawTime.日期===t.日期&&this.lastProcessedCardDrawTime.片段===t.片段||(this.hasIssuedDrawCommandForTime=!1,this.lastProcessedCardDrawTime={...t});d.z.isTimeReached((0,l.default)(e.世界状态.时间.日期),e.世界状态.时间.当前片段,{trigger_time:t})&&!this.hasIssuedDrawCommandForTime&&(a.系统指令=a.系统指令||[],a.系统指令.push({指令类型:'触发抽卡',描述:'命运的齿-轮再次转动，你感到似乎有什么新的可能性即将到来。是时候进行一次命运抽卡了。'}),this.hasIssuedDrawCommandForTime=!0)}}const o=s.R.getSynthesisRequest();return o&&(a.系统指令=a.系统指令||[],a.系统指令.push({指令类型:o.includes('日记')?'请求合成日记':'请求合成周刊',描述:o})),a}async buildMemoryContext(e,t,n,a,o,l){if(!e)return{};const r={},s=c.getRelevantMemories(t,e,n,o,l);if(s.length>0&&(l?r.指定日期记忆={指导:'【精确记忆检索】根据用户的日期提示，检索到以下记忆片段。',事件列表:s}:r.相关记忆={指导:'【相关性记忆检索】根据你的输入，系统从记忆库中检索到了以下最相关的历史事件日志。',事件列表:s}),!l&&e.叙事记录?.历史事件&&e.叙事记录.历史事件.length>0&&a){const t=e.叙事记录.历史事件.slice(-3).map(e=>a.find(t=>(t.id||t.stage_id)===e)).filter(Boolean);t.length>0&&(r.短期记忆={指导:'【短期记忆模块】以下是最近发生的3件关键主线事件的完整日志。这是确保叙事连贯性的核心参考。',事件列表:t})}return r}async parseDirectorLogForAnchors(){const e=[],t=[];try{const n=await i.T.readFromLorebook('[导演场记]');if(n){const a=/【下回合锚点预告】\s*([\s\S]*)/,o=n.match(a);if(o&&o[1]){const n=o[1],a=/触发人物：(.*?)\n/,l=/触发地点：(.*?)\n/,r=n.match(a);r&&r[1]&&e.push(...r[1].split('、').map(e=>e.trim()));const s=n.match(l);s&&s[1]&&t.push(...s[1].split('、').map(e=>e.trim()))}}}catch(e){console.error('[ContextService] Failed to parse director log for anchors:',e)}return{anchorCharacterNames:e,anchorLocationNames:t}}getAllParentLocationIds(e,t){const n=[];let a=e;for(let e=0;e<10&&a;e++){const e=t[a];if(!(e&&e.所属&&e.所属.ID))break;{const t=e.所属.ID;n.push(t),a=t}}return n}simplifyIdMap(e){if(!e)return{};const t={};for(const n in e)'$meta'!==n&&(t[n]='number'!=typeof e[n]||e[n]);return t}parseRelativeDate(e,t){const n=(0,l.default)(t.世界状态.时间.日期),a={一:1,二:2,三:3,四:4,五:5,六:6,七:7,八:8,九:9,十:10},o=e.match(/((\d+)|[一二三四五六七八九十])天前/),r=e.match(/((\d+)|[一二三四五六七八九十])周前/),s=e.match(/^(上+)周/),i=e.match(/((\d+)|[一二三四五六七八九十])个月前/),c=e.match(/((\d+)|[一二三四五六七八九十])月(的时候)?/);if(o){const e=o[1],t=parseInt(e,10)||a[e];if(t){const e=n.subtract(t,'day').format('YYYY-MM-DD');return t=>t===e}}else{if(s){const e=s[1].length,t=n.subtract(e,'week').startOf('week'),a=n.subtract(e,'week').endOf('week');return e=>(0,l.default)(e).isAfter(t)&&(0,l.default)(e).isBefore(a)}if(r){const e=r[1],t=parseInt(e,10)||a[e];if(t){const e=n.subtract(t,'week').startOf('week'),a=n.subtract(t,'week').endOf('week');return t=>(0,l.default)(t).isAfter(e)&&(0,l.default)(t).isBefore(a)}}else if(i){const e=i[1],t=parseInt(e,10)||a[e];if(t){const e=n.subtract(t,'month').format('YYYY-MM');return t=>t.startsWith(e)}}else{if(e.includes('去年')){const e=n.subtract(1,'year').format('YYYY');return t=>t.startsWith(e)}if(c){const e=c[1],t=parseInt(e,10)||a[e];if(t&&t>0&&t<=12){let e=n.month(t-1);e.isAfter(n)&&(e=e.subtract(1,'year'));const a=e.format('YYYY-MM');return e=>e.startsWith(a)}}else{if(e.includes('上旬')||e.includes('月初')){const e=n.format('YYYY-MM');return t=>t.startsWith(e)&&parseInt(t.slice(-2),10)<=10}if(e.includes('中旬')||e.includes('月中')){const e=n.format('YYYY-MM');return t=>t.startsWith(e)&&parseInt(t.slice(-2),10)>10&&parseInt(t.slice(-2),10)<=20}if(e.includes('下旬')||e.includes('月末')){const e=n.format('YYYY-MM');return t=>t.startsWith(e)&&parseInt(t.slice(-2),10)>20}if(e.includes('昨天')){const e=n.subtract(1,'day').format('YYYY-MM-DD');return t=>t===e}if(e.includes('前天')){const e=n.subtract(2,'day').format('YYYY-MM-DD');return t=>t===e}}}}}buildCardContext(e){const t={背包详情:[],已激活详情:[]};return e?.主角&&'string'!=typeof e.主角?(t.背包详情=e.主角.卡牌背包||[],t.已激活详情=e.叙事记录.当前激活卡牌||[],t):t}async loadClothingStyles(){try{const e=await i.T.readFromLorebook('[数据]服装风格指南');if(e){return JSON.parse(e).character_styles||null}}catch(e){console.error('Failed to load or parse [数据]服装风格指南',e)}return null}getCurrentSeason(e){const t=e.getMonth()+1;return t>=3&&t<=5?'春':t>=6&&t<=8?'夏':t>=9&&t<=11?'秋':'冬'}};var u=n(711),p=n(725),v=n(487),g=n(393),y=n(861);const f=new class{informationDelayQueue=[];applyPressure(e){const t=[];if(!e?.世界)return t;for(const n of Object.values(e.世界)){const e=(0,a.get)(n,'角色',{});for(const n in e){if(n.startsWith('sample_'))continue;const o=e[n];if(!o||!('姓名'in o))continue;const l=(0,a.get)(o,'心流.驱动力.长期目标'),r=(0,a.get)(o,'战斗参数.权能',0),s=(0,a.get)(o,'基础潜力.神',0),i=l&&Object.values(l).some(e=>'进行中'===e.状态),c=r>100||s>8;if(i||c){const e=i?Object.values(l)[0]:{名称:'维持自身存在',动机:'其强大的力量无时无刻不在影响周围。'};let d=5*s+(0,a.get)(o,'心流.情绪状态.怒意',0);c&&!i&&(d=r/10),t.push({type:i?'desire':'authority',source:{type:'npc',id:n},intensity:d,description:`[${o.姓名}] 的存在或意志正在形成压力。`,intent:e.动机||'未知'})}}}return console.log(`[EvoSys-Pressure] Identified ${t.length} evolutionary pressures.`,t),t}simulateReactions(e,t){const n=[];if(!t)return n;console.log(`[EvoSys-Reaction] Simulating reactions for ${e.length} pressures...`);for(const o of e)if(o.intensity>50){const e=(0,a.get)(t,`世界.${y.$.findById(o.source.id)?.worldId}.角色.${o.source.id}`);if(e){const t={id:`event_${o.source.id}_${Date.now()}`,timestamp:Date.now(),locationId:e.当前位置,type:'personal',description:`${e.姓名} 在其执念的驱使下，开始采取行动：${o.intent}`,participants:[o.source.id],sourcePressure:o};n.push(t),console.log('[EvoSys-Reaction] Generated event:',t)}}return n}propagateRipples(e,t){if(!t?.世界)return;const n=e.locationId?y.$.findById(e.locationId)?.worldId:null;if(!n)return;const o=t.世界[n];if(!o)return;const l={id:`ripple_${e.id}_${Math.random().toString(36).substring(2,6)}`,sourceEventId:e.id,type:'rumor',content:`听说在${y.$.findById(e.locationId)?.name||'远方'}发生了大事！`,sphereOfInfluence:{locationIds:[],factionIds:[]},decayRate:.1,distortion:0},r=1e3/((0,a.get)(o,'定义.规则.信息传播法则',[]).find(e=>e.medium===l.type)||{baseSpeed:100}).baseSpeed,s=24*r*60*60*1e3,i=e.timestamp+s,c={...l,arrivalTimestamp:i};this.informationDelayQueue.push(c),console.log(`[EvoSys-Ripple] New ripple queued. Distance: 1000km. Arrival in ${r.toFixed(1)} days.`,c),console.log('[EvoSys-Queue] Current Information Delay Queue:',this.informationDelayQueue)}getAvailableRipples(e){const t=[],n=[];for(const a of this.informationDelayQueue)a.arrivalTimestamp<=e?t.push(a):n.push(a);return this.informationDelayQueue=n,t.length>0&&console.log(`[EvoSys-Gravity] ${t.length} ripples have arrived and are now available as 'narrative material'.`,t),t}calculateDistance(e,t,n){const o=y.$.findById(e),l=y.$.findById(t);if(!o||!l||!n)return null;if(o.parentId===l.parentId&&'WORLD_ORIGIN'!==o.parentId){const l=o.epochId||(0,a.get)(n,'定义.元规则.当前纪元ID');if(!l)return null;(0,a.get)(n,`定义.历史纪元.${l}.内容.空间实体.${o.parentId}`);const r=(0,a.get)(n,`定义.历史纪元.${l}.内容.空间实体.${e}`),s=(0,a.get)(n,`定义.历史纪元.${l}.内容.空间实体.${t}`);if(r?.相对坐标&&s?.相对坐标)return(r.相对坐标.距离?.[0]||0)+(s.相对坐标.距离?.[0]||0)}return 1e3}};var h=n(255);function k(e){return e?e.stat_data||e:null}let E=null,N=!1;const S='zodErrorNotified';let b='true'===sessionStorage.getItem(S);function V(e,t){if(!e||!t)return;const n=(0,a.get)(e,'角色列表',{}),o=(0,a.get)(t,'角色列表',{});for(const e in o)if((!n[e]||'待初始化'===n[e])&&'object'==typeof o[e]){const t=o[e];u.l.info('新角色登场',`你遇到了 ${t.名称}。`)}const l=(0,a.get)(e,'主角.物品栏',{}),r=(0,a.get)(t,'主角.物品栏',{});if(l&&r){const e=new Set([...Object.keys(l),...Object.keys(r)]);for(const t of e){const e=l[t]?.数量||0,n=(r[t]?.数量||0)-e;if(0!==n){const e=t,a=n>0?'获得':'失去';u.l.success('物品变更',`${a} ${e} x${Math.abs(n)}`)}}}const s=(0,a.get)(e,'主角',{}),i=(0,a.get)(t,'主角',{});if(s&&i){const e=(e,t)=>{const n=(0,a.get)(s,e),o=(0,a.get)(i,e);JSON.stringify(n)!==JSON.stringify(o)&&u.l.info('属性变化',`${t} 发生了变化。`)};if(s.属性&&i.属性){const t=new Set([...Object.keys(s.属性),...Object.keys(i.属性)]);for(const n of t)e(`属性.${n}`,`属性[${n}]`)}}}function B(e){const t={},n=e.trim().split('\n');let a=null,o=!1,l=null;for(const e of n)if('---'!==e.trim())if(o){if(a){const n=e.trim();if(n.startsWith('- ')){const e=n.substring(2).trim();if(Array.isArray(t[a]))t[a].push(e);else if('object'==typeof t[a]){const n=e.indexOf(':');if(-1!==n){const o=e.substring(0,n).trim(),l=e.substring(n+1).trim();t[a][a]||(t[a][a]=[]),t[a][a].push({[o]:l})}}}else if(n&&'object'==typeof t[a]&&!Array.isArray(t[a])){const e=n.indexOf(':');if(-1!==e){const o=n.substring(0,e).trim(),l=n.substring(e+1).trim();t[a][o]=l}}}}else{const n=e.indexOf('|');if(-1!==n){const r=e.substring(0,n).trim(),s=e.substring(n+1).trim();t[r]=s,a=r,['【表·世界日志】','【里·导演剪辑室】','【校园BBS】','【下回合展望】','【一周热点追击】','【本周人物风云榜】','【关系蛛网变动】','【世界线收束与发散】'].includes(r)?(o=!0,l={},t[r]=l):['人物弧光','NPC表演分析','镜头语言分析','世界演化'].includes(r)&&(o=!0,l=[],t[r]=l)}}else o=!1,a=null;return t}async function w(){try{const e=await i.T.readFromLorebook('周刊');if(!e||!e.trim())return void(h.M.weeklyReviews=[]);const t=e.split('\n\n===\n\n').map(e=>B(e));h.M.weeklyReviews=t.sort((e,t)=>e.刊号-t.刊号),console.log(`[Store] Loaded ${h.M.weeklyReviews.length} weekly reviews.`)}catch(e){console.error('Error loading weekly reviews from lorebook:',e),h.M.weeklyReviews=[]}}async function C(){try{const e=await i.T.readFromLorebook('日记')||'',t=e+'\n\n---\n\n'+(await i.T.readFromLorebook('日记-禁开')||'');if(!t.trim())return void(h.M.diary=[]);const n=t.split(/\n\n---\n\n|\n\n===\[存档分割线\]===\n\n/g).map(e=>{if(!e.trim())return null;try{return B(e)}catch(t){return console.error('Failed to parse diary block:',e,t),null}}).filter(e=>null!==e&&!!e.日期),a=new Map;for(const e of n)e.日期&&a.set(e.日期,e);const o=Array.from(a.values());h.M.diary=o.sort((e,t)=>new Date(e.日期).getTime()-new Date(t.日期).getTime()),console.log(`[Store] Loaded and deduplicated ${h.M.diary.length} entries from "日记" and "日记-禁开".`)}catch(e){console.error('Error loading diary from lorebook:',e),h.M.diary=[]}}async function D(){try{const e=await i.T.readFromLorebook('日记片段')||'',t=e+'\n\n---\n\n'+(await i.T.readFromLorebook('日记片段-禁开')||'');if(!t.trim())return void(h.M.diaryFragments=[]);const n=t.split('\n\n---\n\n').map(e=>{if(!e.trim())return null;try{return function(e){const t={},n=e.split('\n---\n'),a=n[0]?.trim().split('\n')||[];for(const e of a){const n=e.indexOf('|');if(-1!==n){const a=e.substring(0,n).trim(),o=e.substring(n+1).trim();switch(a){case'序号':t.序号=parseInt(o,10);break;case'日期':t.日期=o;break;case'时间片段':t.时间片段=o;break;case'标题':t.标题=o}}}for(let e=1;e<n.length;e++){const a=n[e].trim(),o=a.match(/^【(.+?)】\n?/);if(!o)continue;const l=o[1],r=a.substring(o[0].length).trim();switch(l){case'事件概要':{const e=r.match(/^概要\|(.+)/s);e&&(t.事件概要=e[1].trim());break}case'我的抉择':t.我的抉择=r;break;case'关系变动':t.关系变动=r;break;case'属性成长':t.属性成长=r}}return t}(e)}catch(t){return console.error('Failed to parse diary fragment block:',e,t),null}}).filter(e=>null!==e&&void 0!==e.序号),a=new Map;for(const e of n)a.set(e.序号,e);h.M.diaryFragments=Array.from(a.values()).sort((e,t)=>e.序号-t.序号),console.log(`[Store] Loaded and deduplicated ${h.M.diaryFragments.length} fragments.`)}catch(e){console.error('Error loading diary fragments:',e),h.M.diaryFragments=[]}}async function L(){try{const e=await i.T.readFromLorebook('导演场记');if(!e||!e.trim())return void(h.M.directorLogs=[]);const t=e.split('\n\n---\n\n').map(e=>B(e));h.M.directorLogs=t.sort((e,t)=>parseInt(e.剧本ID,10)-parseInt(t.剧本ID,10)),console.log(`[Store] Loaded ${h.M.directorLogs.length} director logs.`)}catch(e){console.error('Error loading director logs from lorebook:',e),h.M.directorLogs=[]}}async function M(){N||(await Promise.all([C(),w(),D(),L()]),N=!0),await async function(){try{const e=await v._.fetchTavernData();if(e&&e.length>0&&e[0].data){const t=k(e[0].data),n=e[0].message,l=e[0].id,r=JSON.parse(JSON.stringify(h.M.worldState));try{h.M.worldState=t,b&&(sessionStorage.removeItem(S),b=!1)}catch(e){console.warn('[Zod-AutoFix] Initial parsing failed. Attempting to auto-fix...',e);const n=(0,a.cloneDeep)(t);if(e instanceof o.z.ZodError){for(const t of e.issues)if('invalid_type'===t.code&&'received'in t&&'undefined'===t.received){let e='';'number'===t.expected?e=0:'boolean'===t.expected?e=!1:'object'===t.expected?e={}:'array'===t.expected&&(e=[]),(0,a.set)(n,t.path,e)}try{h.M.worldState=n,u.l.success('数据自动修复','部分数据格式已自动修正。'),b&&(sessionStorage.removeItem(S),b=!1)}catch(e){if(!b){const t=e.issues[0],n=`路径 [${t.path.join(' -> ')}] 发生错误: ${t.message}。`;console.error('Zod validation failed even after auto-fixing:',e),u.l.error('数据校验失败',`自动修复失败: ${n}`),sessionStorage.setItem(S,'true'),b=!0}h.M.worldState=n}}else h.M.worldState=t,b||(console.error('Validation failed with non-Zod error:',e),u.l.error('数据错误','发生了一个未知的数据格式错误。'),sessionStorage.setItem(S,'true'),b=!0)}V(r,h.M.worldState);const s=n?.match(/<gametxt>([\s\S]*?)<\/gametxt>/i)?.[1].trim();s&&(h.M.mainWorldNarrative=s),n&&l!==E&&(E=l)}}catch(e){console.error('获取核心数据时出错:',e)}}(),await i.T.getEntries(!0),h.M.isReady=!0,console.log('[Store] Core data loaded and lorebook cache refreshed.')}const x={loadAllData:M,handleAction:async function(e,t=!1){const n=p.S.get('saveLoadService');if(e.trim()){h.M.isReady||await M(),t||await n.saveStateForReroll(),h.M.isGenerating=!0;try{await async function(){try{const e=await v._.fetchTavernData();if(e&&e.length>0){const t=[...e].reverse().find(e=>!e.is_user);if(!t)return;const n=t,a=n.message?.match(/<UpdateVariable>([\s\S]+?)<\/UpdateVariable>/i),o=a?a[1].trim():null,l=o?.match(/<JSONPatch>([\s\S]*?)<\/JSONPatch>/i);if(l&&l[1]){const e=l[1].trim();h.M.lastGeneratedPatch=e}else h.M.lastGeneratedPatch=null}}catch(e){console.error('Failed to silently update patch from history:',e)}}(),console.log('[EvoSys] Executing Pre-Action Deduction...');const t=f.applyPressure(h.M.worldState),a=f.simulateReactions(t,h.M.worldState);for(const e of a)f.propagateRipples(e,h.M.worldState);const o=f.getAvailableRipples(Date.now()),l=(g.N.getCurrentState(),m.analyzeUserIntent(e,h.M.worldState,o)),{sceneContext:r,worldContext:i}=await m.buildLeanContext(l,e,h.M.mainWorldNarrative,h.M.worldState,h.M.userId,h.M.diaryFragments);console.log('[Actions] Generating AI response with modular context.');const c=(e,t)=>!t||Array.isArray(t)&&0===t.length||'object'==typeof t&&0===Object.keys(t).length?'':`<${e}>\n${JSON.stringify(t,null,2)}\n</${e}>\n\n`,d=i,p=s.R.getSynthesisRequest(),y=`<previous_patch>\n${h.M.lastGeneratedPatch||'无'}\n</previous_patch>\n\n${c('当前场景',r)}\n${c('主角',d.主角)}\n${c('在场人物',d.在场人物)}\n${c('非在场人物摘要',d.非在场人物摘要)}\n${c('关系网络',d.关系网络)}\n${c('导演指令',d.导演指令)}\n${c('补充情景',{短期记忆:d.短期记忆,相关记忆:d.相关记忆})}\n${p?`\n${p}\n`:''}\n<user_input>\n${e}\n</user_input>`;console.log('[SUBMIT_DEBUG] Submitting to AI with combined input:',y);const E=function(e){let t=e;t=t.replace(/<\/?think(ing)?>/g,e=>e.startsWith('</')?'</thinking>':'<thinking>'),t=t.replace(/<\/?(game-?txt|gamet-?xt|gametxtt)>/g,e=>e.startsWith('</')?'</gametxt>':'<gametxt>'),t.includes('<thinking>')||(t='<thinking>\n</thinking>\n'+t);const n=t.indexOf('<thinking>'),a=t.indexOf('</thinking>'),o=t.indexOf('<gametxt>');-1!==n&&-1===a&&(-1!==o&&o>n?t=t.slice(0,o)+'</thinking>\n'+t.slice(o):t+='\n</thinking>'),t=t.replace(/<thinking>([\s\S]*?)<\/thinking>/g,(e,t)=>`<thinking>${t.replace(/<|>/g,'')}</thinking>`);const l=t.indexOf('</thinking>');-1===l||t.includes('<gametxt>')||(t=t.slice(0,l+11)+'\n<gametxt></gametxt>'+t.slice(l+11));const r=t.indexOf('<gametxt>'),s=t.indexOf('</gametxt>');if(-1!==r&&-1===s){const e=t.indexOf('<',r+9);-1!==e?t=t.slice(0,e)+'</gametxt>\n'+t.slice(e):t+='\n</gametxt>'}return t}(await v._.generateAiResponse(y)),N=E+g.N.popPreservedContent();await async function(e){if(!e)return;const t=e.match(/<gametxt>([\s\S]+?)<\/gametxt>/i),n=t?t[1].trim():null;n&&(h.M.mainWorldNarrative=n);const a=e.match(/<UpdateVariable>([\s\S]+?)<\/UpdateVariable>/i);let o=a?a[1].trim():null;if(o){const e=o.match(/<JSONPatch>([\s\S]*?)<\/JSONPatch>/i);e&&e[1]&&(h.M.lastGeneratedPatch=e[1].trim(),console.log('[Actions] Cached last generated patch.'))}if(n&&g.N.cacheNarrative(n),o&&g.N.cacheUpdateScript(o),o){const e=(await v._.fetchTavernData())?.[0]?.data??h.M.worldState,t=JSON.parse(JSON.stringify(h.M.worldState)),n=await v._.invokeMvuScript(o,e);if(n){const e=k(n);try{h.M.worldState=e,b=!1}catch(t){if(!b){const e=t.issues[0],n=`路径 [${e.path.join(' -> ')}] 发生错误: ${e.message}。`;console.error('Zod validation failed for newVariables from MVU script:',t),u.l.error('数据校验失败',n),b=!0}h.M.worldState=e}V(t,h.M.worldState)}}}(N);const S=await v._.fetchTavernData();if(S&&S.length>0){const e=S[0];e.message=N;const t=e.data||{};t.stat_data=JSON.parse(JSON.stringify(h.M.worldState)),e.data=t,await TavernHelper.setChatMessages([e],{refresh:'none'})}await n.performAutoSave(),console.log('[EvoSys] Executing Post-Action Deduction...');const B={type:'custom',source:{type:'npc',id:h.M.userId},intensity:75,description:`天命之人执行了行动: "${e}"`,intent:e},w=f.simulateReactions([B],h.M.worldState);for(const e of w)f.propagateRipples(e,h.M.worldState)}catch(e){console.error('处理动作时出错:',e);const t=e instanceof Error?e.message:String(e);h.M.generationError=`AI响应失败: ${t}`,u.l.error('操作失败','与AI交互失败，请检查控制台。')}finally{h.M.generationError?setTimeout(()=>{h.M.isGenerating=!1,h.M.generationError=null},5e3):h.M.isGenerating=!1}}},loadFutureStorylines:async()=>{if(h.M.worldState)try{const e=await d.z.getDisplayTimeline(h.M.worldState);h.M.futureStorylines=e}catch(e){console.error('Failed to load future storylines:',e),u.l.error('加载主线失败','无法获取未来的主线剧情。')}},rerollLastAction:async()=>{const e=p.S.get('saveLoadService');console.log('[Actions] Reroll requested.');try{u.l.info('正在返回上一轮...','页面即将刷新。'),await e.loadRerollState()}catch(e){console.error('Reroll failed:',e),u.l.error('重来失败',e instanceof Error?e.message:'未知错误')}}}},255(e,t,n){n.d(t,{M:()=>r,i:()=>o});var a=n(61);const o='{{user}}',l={isReady:!1,worldState:null,userId:o,narrative:'正在连接春物世界...',mainWorldNarrative:'正在连接春物世界...',avatarWorldNarrative:'',activeView:'mainWorld',isGenerating:!1,generationError:null,lastSubmittedAction:null,lastGeneratedPatch:null,diary:[],diaryFragments:[],directorLogs:[],weeklyReviews:[],futureStorylines:[]},r=(0,a.reactive)({...l})},798(e,t,n){n.d(t,{A:()=>g});var a=n(61);const o={class:'card-header'},l={class:'card-type'},r={class:'card-level'},s={class:'card-content'},i={class:'card-name'},c={class:'card-face'},d={key:1,class:'card-text-face'},m={class:'card-info'},u={class:'card-description'},p={class:'card-effect'},v=(0,a.defineComponent)({__name:'DestinyCard',props:{card:{}},setup(e){const t=e,n={任务卡:'#4a90e2',角色卡:'#50e3c2',物品卡:'#b8e986',事件卡:'#f5a623',命运卡:'#9013fe',属性卡:'#f8e71c',技能卡:'#e58c00',灾难卡:'#d0021b',纪念卡:'#bd10e0'},v=(0,a.computed)(()=>{try{return new URL(t.card.卡面),!0}catch{return!1}}),g=(0,a.computed)(()=>n[t.card.类型]||'#7f8c8d'),y={F:'#6c757d',E:'#6c757d',D:'#33aaff',C:'#33aaff',B:'#9013fe',A:'#d633ff',S:'#ffd700',SS:'#ff8c00',SSS:'#ff4500'},f=(0,a.computed)(()=>{const e=t.card.等级;return['S','SS','SSS'].includes(e)?'rarity-legendary':['A','B'].includes(e)?'rarity-epic':['C','D'].includes(e)?'rarity-rare':'rarity-common'}),h=(0,a.computed)(()=>({'--card-type-color':g.value,'--card-level-color':y[t.card.等级]||'#6c757d'}));return(t,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{class:(0,a.normalizeClass)(['destiny-card',f.value]),style:(0,a.normalizeStyle)(h.value)},[n[1]||(n[1]=(0,a.createElementVNode)('div',{class:'card-border-glow'},null,-1)),(0,a.createElementVNode)('div',o,[(0,a.createElementVNode)('span',l,(0,a.toDisplayString)(e.card.类型),1),(0,a.createElementVNode)('span',r,'['+(0,a.toDisplayString)(e.card.等级)+']',1)]),(0,a.createElementVNode)('div',s,[(0,a.createElementVNode)('h3',i,(0,a.toDisplayString)(e.card.名称),1),(0,a.createElementVNode)('div',c,[v.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:0,class:'card-image',style:(0,a.normalizeStyle)({backgroundImage:`url(${e.card.卡面})`})},null,4)):((0,a.openBlock)(),(0,a.createElementBlock)('div',d,(0,a.toDisplayString)(e.card.卡面),1))]),(0,a.createElementVNode)('div',m,[(0,a.createElementVNode)('p',u,(0,a.toDisplayString)(e.card.介绍),1)]),(0,a.createElementVNode)('p',p,[n[0]||(n[0]=(0,a.createElementVNode)('strong',null,'效果:',-1)),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.card.效果),1)])])],6))}});const g=(0,n(667).A)(v,[['__scopeId','data-v-2bc79802']])},931(e,t,n){n.d(t,{A:()=>u});var a=n(61);const o={class:'database-item-card'},l={class:'info-grid'},r={class:'info-item'},s={class:'info-item'},i={class:'info-item'},c={class:'info-item full-width'},d={key:0,class:'info-item full-width'},m=(0,a.defineComponent)({__name:'DatabaseItemCard',props:{item:{type:Object,required:!0}},setup(e){const t=e,n=(0,a.computed)(()=>{if(!t.item.effects)return null;const{attributes_bonus:e,percentage_bonus:n}=t.item.effects,a=[];if(e)for(const t in e)'$meta'!==t&&a.push(`${t} +${e[t]}`);if(n)for(const e in n)'$meta'!==e&&a.push(`${e} +${n[e]}`);return a.join('；')});return(t,m)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',o,[(0,a.createElementVNode)('div',l,[(0,a.createElementVNode)('div',r,[m[0]||(m[0]=(0,a.createElementVNode)('strong',null,'类型',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(e.item.类型||'未知'),1)]),(0,a.createElementVNode)('div',s,[m[1]||(m[1]=(0,a.createElementVNode)('strong',null,'子类型',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(e.item.子类型||'无'),1)]),(0,a.createElementVNode)('div',i,[m[2]||(m[2]=(0,a.createElementVNode)('strong',null,'能级',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(e.item.能级??'未知'),1)]),(0,a.createElementVNode)('div',c,[m[3]||(m[3]=(0,a.createElementVNode)('strong',null,'描述',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(e.item.描述||'无详细描述。'),1)]),n.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',d,[m[4]||(m[4]=(0,a.createElementVNode)('strong',null,'效果',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(n.value),1)])):(0,a.createCommentVNode)('v-if',!0)])]))}});const u=(0,n(667).A)(m,[['__scopeId','data-v-58039cc0']])},978(e,t,n){n.d(t,{A:()=>y});var a=n(61),o=n(407),l=n(354),r=n(224);const s={key:0,class:'location-info-card'},i={class:'info-grid'},c={class:'info-item'},d={class:'info-item'},m={class:'info-item'},u={class:'info-item'},p={class:'info-item full-width'},v={key:1,class:'loading-placeholder'},g=(0,a.defineComponent)({__name:'LocationInfoCard',props:{locationId:{type:String,required:!0}},setup(e){const t=e,n=(0,a.computed)(()=>t.locationId&&l.M_.worldState?(0,r.get)(l.M_.worldState,`地点.${t.locationId}`):null),g=(0,a.computed)(()=>n.value?o.n.getParentLocationName(t.locationId):'未知'),y=e=>'string'!=typeof e?e:e.replace(/["'\[\]]/g,''),f=e=>{if(!e)return'未知';if(Array.isArray(e))return e.join(' ');return y(String(e)).split(',').join(' ')},h=e=>{if(!e)return'未知';try{const t=y(e.参考ID),n=o.n.getLocationName(t),a=y(e.方位).split(','),l=a[0]||'',r=a[1]||'',s=y(String(e.距离)).split(','),i=s[0]||'';return`距 ${n} ${i}${s[1]||''} ${l}${r}°`}catch(e){return console.error('Error formatting coordinates:',e),'解析错误'}};return(e,t)=>n.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',s,[(0,a.createElementVNode)('div',i,[(0,a.createElementVNode)('div',c,[t[0]||(t[0]=(0,a.createElementVNode)('strong',null,'类型',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(y(n.value.层级类型)),1)]),(0,a.createElementVNode)('div',d,[t[1]||(t[1]=(0,a.createElementVNode)('strong',null,'所属',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(g.value),1)]),(0,a.createElementVNode)('div',m,[t[2]||(t[2]=(0,a.createElementVNode)('strong',null,'面积',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(f(n.value.面积)),1)]),(0,a.createElementVNode)('div',u,[t[3]||(t[3]=(0,a.createElementVNode)('strong',null,'相对坐标',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(h(n.value.相对坐标)),1)]),(0,a.createElementVNode)('div',p,[t[4]||(t[4]=(0,a.createElementVNode)('strong',null,'描述',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(y(n.value.描述)),1)])])])):((0,a.openBlock)(),(0,a.createElementBlock)('div',v,'正在获取地点信息...'))}});const y=(0,n(667).A)(g,[['__scopeId','data-v-4aea10f8']])},10(e,t,n){n.d(t,{A:()=>jt});var a=n(61),o=n(354);const l={class:'attribute-grid'},r={class:'attribute-key'},s={class:'attribute-value'},i={key:0,class:'progress-bar-container'},c={class:'progress-text'},d=(0,a.defineComponent)({__name:'AttributeGrid',props:{attributes:{}},setup(e){const t=e,n=[{等级:'F',修正值:-5,升级经验:100},{等级:'E',修正值:-3,升级经验:200},{等级:'D',修正值:-1,升级经验:300},{等级:'C',修正值:0,升级经验:400},{等级:'B',修正值:2,升级经验:500},{等级:'A',修正值:5,升级经验:600},{等级:'S',修正值:10,升级经验:800},{等级:'SS',修正值:15,升级经验:1e3},{等级:'SSS',修正值:20,升级经验:1/0}],o=(0,a.computed)(()=>{if(!t.attributes)return{};const{$meta:e,...n}=t.attributes;return n});function d(e){return'object'==typeof e&&null!==e&&'等级'in e&&'经验值'in e}function m(e){return n.find(t=>t.等级===e)}function u(e){const t=m(e.等级);if(!t||t.升级经验===1/0)return'0%';const n=e.经验值/t.升级经验*100;return`${Math.min(n,100)}%`}function p(e){if(d(e))return`${e.等级} (${e.修正值>=0?'+':''}${e.修正值})`;if('object'==typeof e&&null!==e){if('当前'in e&&'上限'in e){let t=`${e['当前']}/${e['上限']}`;return'恢复速度'in e&&(t+=` (+${e['恢复速度']})`),t}return JSON.stringify(e)}return String(e)}return(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',l,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(o.value,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:t,class:'attribute-item'},[(0,a.createElementVNode)('span',r,(0,a.toDisplayString)(t),1),(0,a.createElementVNode)('span',s,(0,a.toDisplayString)(p(e)),1),d(e)?((0,a.openBlock)(),(0,a.createElementBlock)('div',i,[(0,a.createElementVNode)('div',{class:'progress-bar',style:(0,a.normalizeStyle)({width:u(e)})},null,4),(0,a.createElementVNode)('span',c,(0,a.toDisplayString)(e.经验值)+' / '+(0,a.toDisplayString)(m(e.等级)?.升级经验),1)])):(0,a.createCommentVNode)('v-if',!0)]))),128))]))}});var m=n(667);const u=(0,m.A)(d,[['__scopeId','data-v-321a611a']]),p={class:'detail-tab-content grid-layout'},v={class:'detail-item'},g={class:'detail-value'},y={class:'detail-item'},f={class:'detail-value'},h={class:'detail-item'},k={class:'detail-value'},E={class:'tag'},N={class:'detail-item'},S={class:'detail-value'},b={class:'detail-item'},V={class:'detail-value'},B={class:'detail-item'},w={class:'detail-value'},C={class:'detail-item evolution-level'},D={class:'evolution-tracks'},L={class:'track'},M={class:'track-level'},x={class:'track-status'},I={class:'track'},T={class:'track-level'},A={class:'track-status'},F={class:'detail-item full-width'},j={class:'detail-value'},O={class:'detail-item full-width'},R={class:'detail-value'},P={class:'history-list'},W={class:'influence-text'},Y=(0,a.defineComponent)({__name:'NpcArchiveTab',props:{npc:{}},setup(e){const t=e,n=[{lv:0,status:'纯洁/紧致'},{lv:1,status:'适应/记忆'},{lv:2,status:'开发/柔软'},{lv:3,status:'敏感/淫乱'},{lv:4,status:'吸吮/名器'},{lv:5,status:'肉便器/松弛'},{lv:6,status:'自律/随心'}],l=[{lv:0,status:'抵抗/纯洁'},{lv:1,status:'好奇/动摇'},{lv:2,status:'屈服/认知'},{lv:3,status:'沉沦/享乐'},{lv:4,status:'M属性觉醒'},{lv:5,status:'堕落(雌堕)'}],r=(0,a.computed)(()=>{const e=t.npc.内在世界.NSFW?.phys??0;return n.find(t=>t.lv===e)?.status||'未知'}),s=(0,a.computed)(()=>{const e=t.npc.内在世界.NSFW?.mind??0;return l.find(t=>t.lv===e)?.status||'未知'}),i=(0,a.computed)(()=>{if(!t.npc.个人信息?.出生日期)return'未知';const e=new Date(t.npc.个人信息.出生日期),n=new Date(o.M_.worldState?.世界状态.时间.日期||Date.now());let a=n.getFullYear()-e.getFullYear();const l=n.getMonth()-e.getMonth();return(l<0||0===l&&n.getDate()<e.getDate())&&a--,a}),c=(0,a.computed)(()=>{const e=t.npc.个人信息.出生日期;if(!e)return'未知';const n=new Date(e);return`${n.getFullYear()}年${n.getMonth()+1}月${n.getDate()}日`});return(t,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',p,[(0,a.createElementVNode)('div',v,[n[0]||(n[0]=(0,a.createElementVNode)('strong',{class:'detail-key'},'姓名:',-1)),(0,a.createElementVNode)('div',g,[(0,a.createElementVNode)('p',null,(0,a.toDisplayString)(e.npc.名称),1)])]),(0,a.createElementVNode)('div',y,[n[1]||(n[1]=(0,a.createElementVNode)('strong',{class:'detail-key'},'生日:',-1)),(0,a.createElementVNode)('div',f,[(0,a.createElementVNode)('p',null,(0,a.toDisplayString)(c.value)+' ('+(0,a.toDisplayString)(i.value)+')',1)])]),(0,a.createElementVNode)('div',h,[n[2]||(n[2]=(0,a.createElementVNode)('strong',{class:'detail-key'},'身份:',-1)),(0,a.createElementVNode)('div',k,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.npc.身份,e=>((0,a.openBlock)(),(0,a.createElementBlock)('span',E,(0,a.toDisplayString)(e.组织)+' - '+(0,a.toDisplayString)(e.职位),1))),256))])]),(0,a.createElementVNode)('div',N,[n[3]||(n[3]=(0,a.createElementVNode)('strong',{class:'detail-key'},'相貌:',-1)),(0,a.createElementVNode)('div',S,[(0,a.createElementVNode)('p',null,(0,a.toDisplayString)(e.npc.个人信息.容貌),1)])]),(0,a.createElementVNode)('div',b,[n[4]||(n[4]=(0,a.createElementVNode)('strong',{class:'detail-key'},'着装:',-1)),(0,a.createElementVNode)('div',V,[(0,a.createElementVNode)('p',null,(0,a.toDisplayString)(e.npc.个人信息.衣着),1)])]),(0,a.createElementVNode)('div',B,[n[5]||(n[5]=(0,a.createElementVNode)('strong',{class:'detail-key'},'心理状态:',-1)),(0,a.createElementVNode)('div',w,[(0,a.createElementVNode)('p',null,(0,a.toDisplayString)(e.npc.内在世界.心理状态)+' ('+(0,a.toDisplayString)(e.npc.内在世界.心理健康)+')',1)])]),(0,a.createElementVNode)('div',C,[n[8]||(n[8]=(0,a.createElementVNode)('strong',{class:'detail-key'},'演化等级:',-1)),(0,a.createElementVNode)('div',D,[(0,a.createElementVNode)('div',L,[n[6]||(n[6]=(0,a.createElementVNode)('span',{class:'track-label'},'身体',-1)),(0,a.createElementVNode)('span',M,(0,a.toDisplayString)(e.npc.内在世界.NSFW?.phys??0),1),(0,a.createElementVNode)('span',x,(0,a.toDisplayString)(r.value),1)]),(0,a.createElementVNode)('div',I,[n[7]||(n[7]=(0,a.createElementVNode)('span',{class:'track-label'},'精神',-1)),(0,a.createElementVNode)('span',T,(0,a.toDisplayString)(e.npc.内在世界.NSFW?.mind??0),1),(0,a.createElementVNode)('span',A,(0,a.toDisplayString)(s.value),1)])])]),(0,a.createElementVNode)('div',F,[n[9]||(n[9]=(0,a.createElementVNode)('strong',{class:'detail-key'},'核心动机:',-1)),(0,a.createElementVNode)('div',j,[(0,a.createVNode)(u,{attributes:e.npc.内在世界.核心动机},null,8,['attributes'])])]),(0,a.createElementVNode)('div',O,[n[10]||(n[10]=(0,a.createElementVNode)('strong',{class:'detail-key'},'恐惧创伤:',-1)),(0,a.createElementVNode)('div',R,[(0,a.createElementVNode)('ul',P,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.npc.内在世界.恐惧创伤,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('li',{key:t},[(0,a.createElementVNode)('strong',null,'触发源: '+(0,a.toDisplayString)(e.触发源),1),(0,a.createElementVNode)('p',W,'应激反应: '+(0,a.toDisplayString)(e.应激反应),1)]))),128))])])])]))}}),H=(0,m.A)(Y,[['__scopeId','data-v-502908ed']]);var U=n(380);const G={class:'complex-attribute'},J={class:'header'},q={class:'name'},K={class:'description'},Q={class:'body'},Z={class:'child-key'},X={class:'child-value'},ee=(0,a.defineComponent)({__name:'ComplexAttribute',props:{data:{}},setup(e){const t=e,n=(0,a.computed)(()=>{const{名称:e,描述:n,$meta:a,...o}=t.data;return o}),o=e=>'object'==typeof e&&null!==e&&!Array.isArray(e);return(t,l)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',G,[(0,a.createElementVNode)('div',J,[(0,a.createElementVNode)('h5',q,(0,a.toDisplayString)(e.data.名称),1),(0,a.createElementVNode)('p',K,(0,a.toDisplayString)(e.data.描述),1)]),(0,a.createElementVNode)('div',Q,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(n.value,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:t,class:'child-attribute'},[(0,a.createElementVNode)('span',Z,(0,a.toDisplayString)(t)+':',1),(0,a.createElementVNode)('div',X,[o(e)?((0,a.openBlock)(),(0,a.createBlock)(u,{key:0,attributes:e,style:{display:'grid','grid-template-columns':'repeat(auto-fit, minmax(100px, 1fr))'}},null,8,['attributes'])):((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createTextVNode)((0,a.toDisplayString)(e),1)],64))])]))),128))])]))}}),te=(0,m.A)(ee,[['__scopeId','data-v-5bb115c3']]),ne={key:1},ae=['title'],oe={class:'value-cell'},le={key:0,class:'progress-bar-container'},re={class:'progress-text'},se={class:'object-value'},ie={class:'data-item'},ce={class:'data-item-key'},de={class:'data-item-value'},me={class:'object-value'},ue=(0,a.defineComponent)({__name:'ObjectRendererItem',props:{itemKey:{},value:{}},setup(e){const t=e=>'object'==typeof e&&null!==e&&!Array.isArray(e),n=e=>{if(!t(e))return!1;if('名称'in e||'描述'in e)return!1;const n=Object.values(e);return n.length>1&&n.every(e=>'string'==typeof e||'number'==typeof e)},o=e=>{if(!t(e)||!('名称'in e)||!('描述'in e))return!1;return Object.keys(e).filter(e=>'名称'!==e&&'描述'!==e&&'$meta'!==e).some(t=>'object'==typeof e[t])},l=e=>t(e)&&'value'in e&&Object.keys(e).length<=2,r=e=>t(e)&&('ID'in e||'名称'in e)&&!('value'in e)&&!('current'in e)&&Object.values(e).every(e=>'object'!=typeof e),s=e=>{if(!e)return{};const{$meta:t,...n}=e;return n};return(i,c)=>{return(0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,[(0,a.createCommentVNode)(' ComplexAttribute is a self-contained block, so it\'s rendered at the top level '),o(e.value)?((0,a.openBlock)(),(0,a.createBlock)(te,{key:0,data:e.value},null,8,['data'])):((0,a.openBlock)(),(0,a.createElementBlock)('li',ne,[(0,a.createElementVNode)('span',{class:'object-key',title:e.value?.description},(0,a.toDisplayString)(e.itemKey)+':',9,ae),(0,a.createElementVNode)('div',oe,[(0,a.createCommentVNode)(' Case 1: Progress Bar (current/max) '),(d=e.value,t(d)&&'current'in d&&'max'in d?((0,a.openBlock)(),(0,a.createElementBlock)('div',le,[(0,a.createElementVNode)('div',{class:'progress-bar',style:(0,a.normalizeStyle)({width:e.value.current/e.value.max*100+'%'})},null,4),(0,a.createElementVNode)('span',re,(0,a.toDisplayString)(e.value.current)+' / '+(0,a.toDisplayString)(e.value.max),1)])):n(e.value)?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createCommentVNode)(' Case 2: Attribute Grid '),(0,a.createVNode)(u,{attributes:e.value},null,8,['attributes'])],64)):l(e.value)?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:2},[(0,a.createCommentVNode)(' Case 3: Simple Value (value key) '),(0,a.createElementVNode)('span',se,(0,a.toDisplayString)(e.value.value),1)],64)):r(e.value)?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:3},[(0,a.createCommentVNode)(' Case 4: Data Item (ID, 名称, 描述) '),(0,a.createElementVNode)('div',ie,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.value,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:t,class:'data-item-row'},[(0,a.createElementVNode)('span',ce,(0,a.toDisplayString)(t)+':',1),(0,a.createElementVNode)('span',de,(0,a.toDisplayString)(e),1)]))),128))])],64)):t(e.value)?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:4},[(0,a.createCommentVNode)(' Case 5: Recursive Object '),(0,a.createElementVNode)('ul',{class:(0,a.normalizeClass)({'multi-column':Object.keys(e.value).length>4})},[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(s(e.value),(e,t)=>((0,a.openBlock)(),(0,a.createBlock)(pe,{key:t,'item-key':String(t),value:e},null,8,['item-key','value']))),128))],2)],64)):((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:5},[(0,a.createCommentVNode)(' Case 6: Primitive Value '),(0,a.createElementVNode)('span',me,(0,a.toDisplayString)(e.value),1)],64)))])]))],2112);var d}}}),pe=(0,m.A)(ue,[['__scopeId','data-v-02469c81']]),ve=(0,a.defineComponent)({__name:'ObjectRenderer',props:{data:{},isNested:{type:Boolean},context:{}},setup(e){const t=e,n=(0,a.computed)(()=>{if(!t.data)return{};const{$meta:e,...n}=t.data;return n});return(o,l)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{class:(0,a.normalizeClass)(['object-renderer',{'is-nested':e.isNested}])},[(0,a.createElementVNode)('ul',{class:(0,a.normalizeClass)({'multi-column':Object.keys(n.value).length>4})},[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(n.value,(e,n)=>((0,a.openBlock)(),(0,a.createBlock)(pe,{key:n,'item-key':String(n),value:e,context:t.context},null,8,['item-key','value','context']))),128))],2)],2))}}),ge=(0,m.A)(ve,[['__scopeId','data-v-6f2991f8']]),ye={class:'detail-tab-content grid-layout'},fe={key:0,class:'detail-item full-width'},he={class:'detail-item full-width'},ke={key:0,class:'kernel-content'},Ee={class:'kernel-section'},Ne={class:'kernel-text identifier'},Se={class:'kernel-section'},be={class:'kernel-text'},Ve={class:'kernel-section'},Be={class:'profile-list'},we=['onClick'],Ce={key:0,class:'profile-details'},De={class:'profile-behavior'},_e={class:'profile-motivation'},Le={key:0,class:'kernel-section'},Me={class:'dialogue-style'},xe={key:0},Ie={key:1},Te={class:'tags-container'},$e={key:1,class:'placeholder'},ze={class:'detail-item full-width'},Ae={key:0,class:'skills-list'},Fe=['onClick'],je={class:'skill-header'},Oe={class:'skill-level'},Re={key:1,class:'placeholder'},Pe=(0,a.defineComponent)({__name:'NpcPowerTab',props:{npc:{}},setup(e){const t=e,n=(0,a.ref)({});(0,a.watch)(()=>t.npc,()=>{n.value={}},{immediate:!0});return(t,o)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',ye,[e.npc.属性?((0,a.openBlock)(),(0,a.createElementBlock)('div',fe,[o[0]||(o[0]=(0,a.createElementVNode)('strong',{class:'detail-key'},'属性',-1)),(0,a.createVNode)(u,{attributes:e.npc.属性},null,8,['attributes'])])):(0,a.createCommentVNode)('v-if',!0),(0,a.createElementVNode)('div',he,[o[9]||(o[9]=(0,a.createElementVNode)('strong',{class:'detail-key'},'人格内核',-1)),e.npc.人格内核?((0,a.openBlock)(),(0,a.createElementBlock)('div',ke,[(0,a.createElementVNode)('div',Ee,[o[1]||(o[1]=(0,a.createElementVNode)('h5',{class:'kernel-title'},'标识符',-1)),(0,a.createElementVNode)('p',Ne,(0,a.toDisplayString)(e.npc.人格内核.标识符),1)]),(0,a.createElementVNode)('div',Se,[o[2]||(o[2]=(0,a.createElementVNode)('h5',{class:'kernel-title'},'公开行为逻辑',-1)),(0,a.createElementVNode)('p',be,(0,a.toDisplayString)(e.npc.人格内核.行为逻辑.公开模式),1)]),(0,a.createElementVNode)('div',Ve,[o[5]||(o[5]=(0,a.createElementVNode)('h5',{class:'kernel-title'},'行为剖面',-1)),(0,a.createElementVNode)('ul',Be,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.npc.人格内核.行为剖面,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('li',{key:t,class:'profile-item'},[(0,a.createElementVNode)('strong',{class:'profile-context',onClick:e=>(e=>{n.value[e]=!n.value[e]})(t)},[(0,a.createTextVNode)(' 情境: '+(0,a.toDisplayString)(e.情境)+' ',1),(0,a.createElementVNode)('span',{class:(0,a.normalizeClass)(['toggle-icon',{'is-open':n.value[t]}])},'▶',2)],8,we),n.value[t]?((0,a.openBlock)(),(0,a.createElementBlock)('div',Ce,[(0,a.createElementVNode)('p',De,[o[3]||(o[3]=(0,a.createElementVNode)('span',null,'行为:',-1)),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.行为模式),1)]),(0,a.createElementVNode)('p',_e,[o[4]||(o[4]=(0,a.createElementVNode)('span',null,'动机:',-1)),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.动机解释),1)])])):(0,a.createCommentVNode)('v-if',!0)]))),128))])]),e.npc.人格内核.对话风格?((0,a.openBlock)(),(0,a.createElementBlock)('div',Le,[o[8]||(o[8]=(0,a.createElementVNode)('h5',{class:'kernel-title'},'对话风格',-1)),(0,a.createElementVNode)('div',Me,[e.npc.人格内核.对话风格.口头禅?((0,a.openBlock)(),(0,a.createElementBlock)('p',xe,[o[6]||(o[6]=(0,a.createElementVNode)('strong',null,'口头禅:',-1)),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.npc.人格内核.对话风格.口头禅),1)])):(0,a.createCommentVNode)('v-if',!0),e.npc.人格内核.对话风格.常用语?.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',Ie,[o[7]||(o[7]=(0,a.createElementVNode)('strong',null,'常用语:',-1)),(0,a.createElementVNode)('div',Te,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.npc.人格内核.对话风格.常用语,e=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:e,class:'tag phrase-tag'},(0,a.toDisplayString)(e),1))),128))])])):(0,a.createCommentVNode)('v-if',!0)])])):(0,a.createCommentVNode)('v-if',!0)])):((0,a.openBlock)(),(0,a.createElementBlock)('div',$e,'无'))]),(0,a.createElementVNode)('div',ze,[o[10]||(o[10]=(0,a.createElementVNode)('strong',{class:'detail-key'},'技能',-1)),e.npc.技能&&Object.keys(e.npc.技能).length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',Ae,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.npc.技能,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:t,class:'skill-item',onClick:n=>((e,t)=>{U.U.show(t,ge,{data:e})})(e,t)},[(0,a.createElementVNode)('div',je,[(0,a.createElementVNode)('h3',null,(0,a.toDisplayString)(t),1),(0,a.createElementVNode)('div',Oe,'等级 '+(0,a.toDisplayString)(e.等级),1)])],8,Fe))),128))])):((0,a.openBlock)(),(0,a.createElementBlock)('div',Re,'无'))])]))}}),We=(0,m.A)(Pe,[['__scopeId','data-v-0cc0afb0']]);var Ye=n(224),He=n(407);const Ue={class:'progress-bar-container'},Ge={class:'label'},Je={class:'progress-track'},qe={key:0,class:'center-tick'},Ke={class:'value'},Qe=(0,a.defineComponent)({__name:'ProgressBar',props:{label:{},value:{},max:{},min:{},color:{}},setup(e){const t=e,n=(0,a.computed)(()=>t.value),o=(0,a.computed)(()=>void 0!==t.min&&t.min<0),l=(0,a.computed)(()=>{const e=t.min||0,n=t.max||100,a=Math.max(e,Math.min(n,t.value));if(o.value){return a>0?{left:'50%',right:'auto',width:a/n*50+'%',backgroundColor:t.color}:{left:'auto',right:'50%',width:Math.abs(a)/Math.abs(e)*50+'%',backgroundColor:'#e53935'}}return{left:'0',right:'auto',width:`${n===e?0:(a-e)/(n-e)*100}%`,backgroundColor:t.color}});return(t,r)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',Ue,[(0,a.createElementVNode)('span',Ge,(0,a.toDisplayString)(e.label),1),(0,a.createElementVNode)('div',Je,[o.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',qe)):(0,a.createCommentVNode)('v-if',!0),(0,a.createElementVNode)('div',{class:'progress-fill',style:(0,a.normalizeStyle)(l.value)},null,4)]),(0,a.createElementVNode)('span',Ke,(0,a.toDisplayString)(n.value),1)]))}}),Ze=(0,m.A)(Qe,[['__scopeId','data-v-a2763620']]),Xe={class:'relations-display'},et={key:0,class:'relation-list'},tt=['onClick'],nt={class:'relation-name'},at={class:'relation-tags'},ot={class:'tag'},lt={key:0,class:'relation-details'},rt={class:'group-title'},st={key:1,class:'placeholder'},it=(0,a.defineComponent)({__name:'RelationsDisplay',props:{subjectId:{}},setup(e){const t=[{title:'关系数值',vectors:[{label:'亲密度',path:'数值.亲密度',min:-100,max:200,color:'#c74343'},{label:'支配度',path:'数值.支配度',min:-100,max:200,color:'#3a8f9d'},{label:'信赖度',path:'数值.信赖度',min:-100,max:200,color:'#d4af37'}]}],n=e,l=(0,a.computed)(()=>{const e=o.M_.worldState?.关系||{},t={};if(!n.subjectId)return{};const a=e[n.subjectId];if(a)for(const e in a)'object'==typeof a[e]&&(t[e]=a[e]);return t}),{getNpcNameById:r}=He.n,s=(0,a.ref)(null);return(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',Xe,[Object.keys(l.value).length>0?((0,a.openBlock)(),(0,a.createElementBlock)('ul',et,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(l.value,(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('li',{key:n,class:'relation-item'},[(0,a.createElementVNode)('div',{class:'relation-header',onClick:e=>function(e){const t=String(e);s.value===t?s.value=null:s.value=t}(n)},[(0,a.createElementVNode)('span',nt,(0,a.toDisplayString)((0,a.unref)(r)(String(n))),1),(0,a.createElementVNode)('div',at,[(0,a.createElementVNode)('span',ot,(0,a.toDisplayString)(e.阶段.亲密度),1)])],8,tt),s.value===n?((0,a.openBlock)(),(0,a.createElementBlock)('div',lt,[((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t,t=>(0,a.createElementVNode)('div',{key:t.title,class:'vector-group'},[(0,a.createElementVNode)('strong',rt,(0,a.toDisplayString)(t.title),1),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.vectors,t=>((0,a.openBlock)(),(0,a.createBlock)(Ze,{key:t.label,label:t.label,value:(0,a.unref)(Ye.get)(e,t.path,0),min:t.min,max:t.max,color:t.color},null,8,['label','value','min','max','color']))),128))])),64))])):(0,a.createCommentVNode)('v-if',!0)]))),128))])):((0,a.openBlock)(),(0,a.createElementBlock)('div',st,'暂无人际关系信息'))]))}}),ct=(0,m.A)(it,[['__scopeId','data-v-37746a86']]);var dt=n(931);const mt={class:'inventory-grid'},ut={key:0,class:'grid-container'},pt=['onClick'],vt={class:'item-name'},gt={key:0,class:'item-quantity'},yt={key:1,class:'empty-inventory'},ft=(0,a.defineComponent)({__name:'InventoryGrid',props:{items:{}},setup:e=>(t,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',mt,[e.items.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',ut,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.items,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:t,class:'item-cell',onClick:t=>(e=>{e&&U.U.show(e.名称,dt.A,{item:e})})(e)},[(0,a.createElementVNode)('span',vt,(0,a.toDisplayString)(e.名称),1),e.数量?((0,a.openBlock)(),(0,a.createElementBlock)('span',gt,'x'+(0,a.toDisplayString)(e.数量),1)):(0,a.createCommentVNode)('v-if',!0)],8,pt))),128))])):((0,a.openBlock)(),(0,a.createElementBlock)('div',yt,[...n[0]||(n[0]=[(0,a.createElementVNode)('p',null,'空无一物',-1)])]))]))}),ht=(0,m.A)(ft,[['__scopeId','data-v-f5d19dc2']]),kt={class:'detail-tab-content grid-layout'},Et={class:'detail-item full-width'},Nt={class:'detail-item full-width'},St={class:'detail-item full-width'},bt={key:0,class:'memory-timeline'},Vt=['onClick'],Bt={key:0,class:'memory-list'},wt={class:'memory-header'},Ct={class:'memory-date'},Dt={class:'memory-event'},_t={class:'memory-influence'},Lt={key:1,class:'placeholder'},Mt=(0,a.defineComponent)({__name:'NpcCauseTab',props:{npc:{},npcId:{}},setup(e){const t=e,n=(0,a.reactive)({}),l=(0,a.computed)(()=>{const e=o.M_.worldState?.数据库||{};if(!t.npc||!t.npc.物品栏)return[];const n=t.npc.物品栏,a=[];for(const t in n){const o=n[t]?.数量||0;if(o<=0)continue;let l=null;for(const n in e){const a=e[n];if(a&&a[t]){l=a[t];break}}l&&a.push({...l,ID:t,数量:o})}return a}),r=(0,a.computed)(()=>{if(!t.npc.记忆)return{};return[...t.npc.记忆].sort((e,t)=>new Date(t.时间).getTime()-new Date(e.时间).getTime()).reduce((e,t)=>{const n=new Date(t.时间).getFullYear();return e[n]||(e[n]=[]),e[n].push(t),e},{})});function s(e){switch(e){case'愤怒':return'emotion-tag-anger';case'悲伤':return'emotion-tag-sadness';case'恐惧':return'emotion-tag-fear';case'屈辱':return'emotion-tag-humiliation';case'满足':return'emotion-tag-satisfaction';case'喜悦':return'emotion-tag-joy';default:return''}}return Object.keys(r.value).forEach((e,t)=>{n[e]=0===t}),(t,o)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',kt,[(0,a.createElementVNode)('div',Et,[o[0]||(o[0]=(0,a.createElementVNode)('strong',{class:'detail-key'},'持有物品',-1)),(0,a.createVNode)(ht,{items:l.value},null,8,['items'])]),(0,a.createElementVNode)('div',Nt,[o[1]||(o[1]=(0,a.createElementVNode)('strong',{class:'detail-key'},'人际关系',-1)),e.npcId?((0,a.openBlock)(),(0,a.createBlock)(ct,{key:0,'subject-id':e.npcId},null,8,['subject-id'])):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createElementVNode)('div',St,[o[3]||(o[3]=(0,a.createElementVNode)('strong',{class:'detail-key'},'因果足迹',-1)),Object.keys(r.value).length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',bt,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.value,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:t,class:'year-group'},[(0,a.createElementVNode)('h5',{onClick:e=>(e=>{n[e]=!n[e]})(t),class:(0,a.normalizeClass)({collapsed:!n[t]})},(0,a.toDisplayString)(t)+'年',11,Vt),n[t]?((0,a.openBlock)(),(0,a.createElementBlock)('div',Bt,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:t,class:'memory-item'},[(0,a.createElementVNode)('div',wt,[(0,a.createElementVNode)('span',Ct,(0,a.toDisplayString)(new Date(e.时间).toLocaleDateString()),1)]),(0,a.createElementVNode)('p',Dt,[(0,a.createElementVNode)('span',{class:(0,a.normalizeClass)(['tag',s(e.情感标签)])},(0,a.toDisplayString)(e.情感标签),3),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.事件摘要),1)]),(0,a.createElementVNode)('p',_t,[o[2]||(o[2]=(0,a.createElementVNode)('strong',null,'影响:',-1)),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.影响),1)])]))),128))])):(0,a.createCommentVNode)('v-if',!0)]))),128))])):((0,a.openBlock)(),(0,a.createElementBlock)('div',Lt,'无'))])]))}}),xt=(0,m.A)(Mt,[['__scopeId','data-v-1c024944']]),It={class:'npc-detail-display'},Tt={class:'tabs'},$t=['onClick'],zt={class:'tab-content'},At={key:1,class:'placeholder'},Ft=(0,a.defineComponent)({__name:'NpcDetailDisplay',props:{npc:{},npcId:{}},setup(e){const t=(0,a.ref)('archive'),n=[{id:'archive',name:'【档案】'},{id:'power',name:'【权能】'},{id:'cause',name:'【因果】'}];return(o,l)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',It,[(0,a.createElementVNode)('div',Tt,[((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(n,e=>(0,a.createElementVNode)('button',{key:e.id,class:(0,a.normalizeClass)({active:t.value===e.id}),onClick:n=>t.value=e.id},(0,a.toDisplayString)(e.name),11,$t)),64))]),(0,a.createElementVNode)('div',zt,[e.npc?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:0},['archive'===t.value?((0,a.openBlock)(),(0,a.createBlock)(H,{key:0,npc:e.npc},null,8,['npc'])):(0,a.createCommentVNode)('v-if',!0),'power'===t.value?((0,a.openBlock)(),(0,a.createBlock)(We,{key:1,npc:e.npc},null,8,['npc'])):(0,a.createCommentVNode)('v-if',!0),'cause'===t.value?((0,a.openBlock)(),(0,a.createBlock)(xt,{key:2,npc:e.npc,'npc-id':e.npcId},null,8,['npc','npc-id'])):(0,a.createCommentVNode)('v-if',!0)],64)):((0,a.openBlock)(),(0,a.createElementBlock)('div',At,[...l[0]||(l[0]=[(0,a.createElementVNode)('p',null,'暂无数据',-1)])]))])]))}}),jt=(0,m.A)(Ft,[['__scopeId','data-v-3d67675a']])},269(e,t,n){n.d(t,{default:()=>N}),n.r(t);var a=n(61),o=n(224),l=n(632),r=n(223),s=n(445);const i={class:'debug-panel'},c={class:'section'},d={class:'story-stats'},m={class:'section'},u={class:'section'},p={class:'section'},v={class:'section'},g={class:'section'},y={class:'section'},f={class:'section'},h={class:'section'},k={class:'section'},E=(0,a.defineComponent)({__name:'DebugPanel',setup(e){const t=r.l.state;(0,a.onMounted)(()=>{r.l.refreshData()});const n=e=>{if(null===e)return'N/A';try{return JSON.stringify(e,null,2)}catch{return'无法格式化数据'}},E=(0,a.computed)(()=>n(t.lastContext)),N=(0,a.computed)(()=>n(t.mainStoryContent)),S=(0,a.computed)(()=>n(t.calendarFixedContent)),b=(0,a.computed)(()=>n(t.calendarRandomContent)),V=(0,a.computed)(()=>n(t.calendarCrossoverContent)),B=(0,a.computed)(()=>n(t.styleGuideContent)),w=(0,a.computed)(()=>(0,o.get)(t.lastContext,'导演指令.待触发主线',{})),C=(0,a.computed)(()=>(0,o.get)(t.lastContext,'导演指令.日历事件.事件列表',[])),D=(0,a.computed)(()=>(0,o.get)(t.lastContext,'短期记忆.事件列表',[])),L=(0,a.computed)(()=>w.value&&Object.keys(w.value).length>0?1:0),M=(0,a.computed)(()=>C.value.length),x=(0,a.computed)(()=>D.value.length),I=(0,a.computed)(()=>n(w.value)),T=(0,a.computed)(()=>n(C.value)),A=(0,a.computed)(()=>n(D.value)),F=e=>e.includes('成功')?'status-success':e.includes('失败')?'status-error':'',j=async()=>{if(confirm('确定要清除所有分段记忆、日记和周刊吗？这将清空相关的世界书条目。'))try{await s.T.writeToLorebook('[系统]瞬时记忆',''),await s.T.writeToLorebook('[系统]短期记忆',''),await s.T.writeToLorebook('[系统]长期记忆',''),await s.T.writeToLorebook('日记',''),await s.T.writeToLorebook('周刊',''),await s.T.writeToLorebook('日记-禁开',''),await s.T.writeToLorebook('日记片段-禁开',''),await s.T.writeToLorebook('日记片段',''),await s.T.writeToLorebook('导演场记',''),l.success('所有记忆与日志记录已成功清除！')}catch(e){console.error('清除记忆记录时出错:',e),l.error('清除记忆记录失败。')}};return(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',i,[n[13]||(n[13]=(0,a.createElementVNode)('h2',null,'调试信息面板',-1)),(0,a.createElementVNode)('div',{class:'section danger-zone'},[(0,a.createElementVNode)('button',{onClick:j,class:'button is-warning'},'清除所有记忆记录')]),(0,a.createElementVNode)('button',{onClick:n[0]||(n[0]=e=>(0,a.unref)(r.l).refreshData())},'刷新数据'),(0,a.createElementVNode)('div',c,[n[6]||(n[6]=(0,a.createElementVNode)('h3',null,'世界书读取状态',-1)),(0,a.createElementVNode)('p',null,[n[1]||(n[1]=(0,a.createElementVNode)('strong',null,'主线剧情:',-1)),(0,a.createElementVNode)('span',{class:(0,a.normalizeClass)(F((0,a.unref)(t).mainStoryStatus))},(0,a.toDisplayString)((0,a.unref)(t).mainStoryStatus),3)]),(0,a.createElementVNode)('div',d,[(0,a.createElementVNode)('p',null,' 文件: '+(0,a.toDisplayString)((0,a.unref)(t).mainStoryStats.filesLoaded)+' | 总事件: '+(0,a.toDisplayString)((0,a.unref)(t).mainStoryStats.totalEvents)+' | 待触发: '+(0,a.toDisplayString)((0,a.unref)(t).mainStoryStats.actionableEvents)+' | 预告: '+(0,a.toDisplayString)((0,a.unref)(t).mainStoryStats.foreshadowedEvents),1)]),(0,a.createElementVNode)('p',null,[n[2]||(n[2]=(0,a.createElementVNode)('strong',null,'日历-固定事件:',-1)),(0,a.createElementVNode)('span',{class:(0,a.normalizeClass)(F((0,a.unref)(t).calendarFixedStatus))},(0,a.toDisplayString)((0,a.unref)(t).calendarFixedStatus),3)]),(0,a.createElementVNode)('p',null,[n[3]||(n[3]=(0,a.createElementVNode)('strong',null,'日历-随机事件:',-1)),(0,a.createElementVNode)('span',{class:(0,a.normalizeClass)(F((0,a.unref)(t).calendarRandomStatus))},(0,a.toDisplayString)((0,a.unref)(t).calendarRandomStatus),3)]),(0,a.createElementVNode)('p',null,[n[4]||(n[4]=(0,a.createElementVNode)('strong',null,'日历-跨界事件:',-1)),(0,a.createElementVNode)('span',{class:(0,a.normalizeClass)(F((0,a.unref)(t).calendarCrossoverStatus))},(0,a.toDisplayString)((0,a.unref)(t).calendarCrossoverStatus),3)]),(0,a.createElementVNode)('p',null,[n[5]||(n[5]=(0,a.createElementVNode)('strong',null,'服装风格指南:',-1)),(0,a.createElementVNode)('span',{class:(0,a.normalizeClass)(F((0,a.unref)(t).styleGuideStatus))},(0,a.toDisplayString)((0,a.unref)(t).styleGuideStatus),3)])]),(0,a.createElementVNode)('div',m,[n[7]||(n[7]=(0,a.createElementVNode)('h3',null,'上一轮发送的精简上下文',-1)),(0,a.createElementVNode)('pre',null,(0,a.toDisplayString)(E.value),1)]),(0,a.createElementVNode)('div',u,[(0,a.createElementVNode)('h3',null,'注入的潜在主线 ('+(0,a.toDisplayString)(L.value)+')',1),(0,a.createElementVNode)('pre',null,(0,a.toDisplayString)(I.value),1)]),(0,a.createElementVNode)('div',p,[(0,a.createElementVNode)('h3',null,'注入的近期事件 ('+(0,a.toDisplayString)(M.value)+')',1),(0,a.createElementVNode)('pre',null,(0,a.toDisplayString)(T.value),1)]),(0,a.createElementVNode)('div',v,[(0,a.createElementVNode)('h3',null,'短期记忆 ('+(0,a.toDisplayString)(x.value)+')',1),(0,a.createElementVNode)('pre',null,(0,a.toDisplayString)(A.value),1)]),(0,a.createElementVNode)('div',g,[n[8]||(n[8]=(0,a.createElementVNode)('h3',null,'主线剧情数据',-1)),(0,a.createElementVNode)('pre',null,(0,a.toDisplayString)(N.value),1)]),(0,a.createElementVNode)('div',y,[n[9]||(n[9]=(0,a.createElementVNode)('h3',null,'日历-固定事件',-1)),(0,a.createElementVNode)('pre',null,(0,a.toDisplayString)(S.value),1)]),(0,a.createElementVNode)('div',f,[n[10]||(n[10]=(0,a.createElementVNode)('h3',null,'日历-随机事件',-1)),(0,a.createElementVNode)('pre',null,(0,a.toDisplayString)(b.value),1)]),(0,a.createElementVNode)('div',h,[n[11]||(n[11]=(0,a.createElementVNode)('h3',null,'日历-跨界事件',-1)),(0,a.createElementVNode)('pre',null,(0,a.toDisplayString)(V.value),1)]),(0,a.createElementVNode)('div',k,[n[12]||(n[12]=(0,a.createElementVNode)('h3',null,'服装风格指南数据',-1)),(0,a.createElementVNode)('pre',null,(0,a.toDisplayString)(B.value),1)])]))}});const N=(0,n(667).A)(E,[['__scopeId','data-v-1f4f8a7d']])},248(e,t,n){n.d(t,{default:()=>b}),n.r(t);var a=n(61),o=n(798),l=n(994);const r={class:'destiny-card-panel-layout'},s={key:0,class:'card-display-section-mobile'},i={class:'list-view-container'},c={class:'card-list-section'},d={class:'card-list'},m=['onClick'],u={class:'card-list-name'},p={class:'card-list-level'},v={key:0,class:'empty-list'},g={class:'card-display-section-desktop'},y={key:1,class:'placeholder'},f=(0,a.defineComponent)({__name:'CardBackpackTab',setup(e){const t=(0,a.ref)(null),n=(0,a.ref)(!1),f=l.q.playerBackpackCards;return(0,a.watch)(f,e=>{t.value&&e.find(e=>e.ID===t.value?.ID)||(t.value=e[0]||null)},{immediate:!0}),(e,l)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',r,[(0,a.createCommentVNode)(' Mobile Detail View '),n.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',s,[(0,a.createElementVNode)('button',{class:'back-to-list-btn',onClick:l[0]||(l[0]=e=>n.value=!1)},'< 返回列表'),t.value?((0,a.openBlock)(),(0,a.createBlock)(o.A,{key:0,card:t.value},null,8,['card'])):(0,a.createCommentVNode)('v-if',!0)])):((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createCommentVNode)(' List View (Default on mobile, always visible on desktop) '),(0,a.createElementVNode)('div',i,[(0,a.createElementVNode)('div',c,[(0,a.createElementVNode)('ul',d,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)((0,a.unref)(f),e=>((0,a.openBlock)(),(0,a.createElementBlock)('li',{key:e.ID,onClick:a=>(e=>{t.value=e,n.value=!0})(e),class:(0,a.normalizeClass)({active:t.value?.ID===e.ID})},[(0,a.createElementVNode)('span',u,(0,a.toDisplayString)(e.名称),1),(0,a.createElementVNode)('span',p,'['+(0,a.toDisplayString)(e.等级)+']',1)],10,m))),128)),0===(0,a.unref)(f).length?((0,a.openBlock)(),(0,a.createElementBlock)('li',v,'背包是空的')):(0,a.createCommentVNode)('v-if',!0)])]),(0,a.createElementVNode)('div',g,[t.value?((0,a.openBlock)(),(0,a.createBlock)(o.A,{key:0,card:t.value},null,8,['card'])):((0,a.openBlock)(),(0,a.createElementBlock)('div',y,'从左侧选择一张卡牌查看'))])])],2112))]))}});var h=n(667);const k=(0,h.A)(f,[['__scopeId','data-v-ed5d0826']]),E={class:'destiny-card-panel'},N={class:'tab-content'},S=(0,a.defineComponent)({__name:'DestinyCardPanel',setup:e=>(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',E,[(0,a.createElementVNode)('div',N,[(0,a.createVNode)(k)])]))}),b=(0,h.A)(S,[['__scopeId','data-v-5dc88b4c']])},941(e,t,n){n.d(t,{A:()=>V});var a=n(61),o=n(445);const l=new class{parseSingleDiaryEntry(e){try{const t=e.trim().split('\n').map(e=>e.trim());if(t.length<2)return null;const n={日期:'',标题:'',天气:'',心情随笔:'',本日事件簿:[],关系温度计:[],明日备忘:[]};let a=0;for(let e=0;e<t.length;e++){const o=t[e];if(o.includes('日期|')&&(n.日期=o.split('|')[1]?.trim()||''),o.includes('标题|')&&(n.标题=o.split('|')[1]?.trim()||''),o.includes('天气|')&&(n.天气=o.split('|')[1]?.trim()||''),'---'===o){a=e+1;break}}if(!n.日期){const t=e.match(/日期\|(.+)/);t&&(n.日期=t[1].trim())}if(!n.标题){const t=e.match(/标题\|(.+)/);t&&(n.标题=t[1].trim())}if(!n.天气){const t=e.match(/天气\|(.+)/);t&&(n.天气=t[1].trim())}if(!n.日期||!n.标题)return null;let o=null;for(let e=a;e<t.length;e++){const a=t[e].trim();if(a)if(a.startsWith('【'))o=a.includes('心情随笔')?'随笔':a.includes('本日事件簿')?'事件':a.includes('关系温度计')?'关系':a.includes('明日备忘')?'备忘':null;else switch(o){case'随笔':n.心情随笔+=(n.心情随笔?'\n':'')+a;break;case'事件':if(a.startsWith('- 时刻:'))n.本日事件簿.push({时刻:a.replace('- 时刻:','').trim(),地点:'',事件:'',我的吐槽:''});else if(n.本日事件簿.length>0){const e=n.本日事件簿[n.本日事件簿.length-1];a.startsWith('地点:')?e.地点=a.replace('地点:','').trim():a.startsWith('事件:')?e.事件=a.replace('事件:','').trim():a.startsWith('我的吐槽:')&&(e.我的吐槽=a.replace('我的吐槽:','').trim())}break;case'关系':if(a.startsWith('- 对象:'))n.关系温度计.push({对象:a.replace('- 对象:','').trim(),事件:'',我的看法:''});else if(n.关系温度计.length>0){const e=n.关系温度计[n.关系温度计.length-1];a.startsWith('事件:')?e.事件=a.replace('事件:','').trim():a.startsWith('我的看法:')&&(e.我的看法=a.replace('我的看法:','').trim())}break;case'备忘':a.startsWith('- ')&&n.明日备忘.push(a.replace('- ','').trim())}}return n}catch(t){return console.error('Error parsing single diary entry:',t,e),null}}parseDiaryText(e){const t=[],n=e.split('---');let a='';for(const e of n)if(e.trim().startsWith('日期|')){if(a){const e=this.parseSingleDiaryEntry(a);e&&t.push(e)}a=e}else a+='---'+e;if(a){const e=this.parseSingleDiaryEntry(a);e&&t.push(e)}return t}async getDiaryEntries(){const e=await o.T.readFromLorebook('日记',!0);return e?this.parseDiaryText(e):(console.warn('Lorebook entry \'日记\' is empty or not found.'),[])}},r={class:'diary-app-container'},s={key:0,class:'side-nav'},i=['onClick'],c={class:'app-content'},d={key:0},m={class:'diary-header'},u={class:'date-weather'},p={class:'title'},v={class:'diary-section'},g={class:'diary-section collapsible'},y={key:0,class:'collapsible-content'},f={class:'t吐槽'},h={class:'diary-section collapsible'},k={key:0,class:'collapsible-content'},E={class:'diary-section collapsible'},N={key:0,class:'collapsible-content'},S={key:1,class:'empty-state'},b=(0,a.defineComponent)({__name:'DiaryPanel',props:{isDiaryNavOpen:Boolean},emits:['close-diary-nav'],setup(e,{emit:t}){const n=e,o=t,b=(0,a.ref)(n.isDiaryNavOpen);(0,a.watch)(()=>n.isDiaryNavOpen,e=>{b.value=e});const V=(0,a.ref)([]),B=(0,a.ref)(null),w=(0,a.reactive)({events:!1,relations:!1,memos:!1}),C=e=>{w[e]=!w[e]};return(0,a.onMounted)(async()=>{try{const e=await l.getDiaryEntries();V.value=e,e.length>0&&(B.value=e[0])}catch(e){console.error('Failed to load diary entries:',e)}}),(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',r,[(0,a.createVNode)(a.Transition,{name:'slide-fade'},{default:(0,a.withCtx)(()=>[b.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:0,class:'side-nav-overlay',onClick:t[0]||(t[0]=e=>o('close-diary-nav'))})):(0,a.createCommentVNode)('v-if',!0)]),_:1}),(0,a.createVNode)(a.Transition,{name:'slide'},{default:(0,a.withCtx)(()=>[b.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',s,[t[4]||(t[4]=(0,a.createElementVNode)('h3',null,'日记列表',-1)),(0,a.createElementVNode)('ul',null,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(V.value,e=>((0,a.openBlock)(),(0,a.createElementBlock)('li',{key:e.日期,class:(0,a.normalizeClass)({active:B.value&&B.value.日期===e.日期}),onClick:t=>{return n=e,B.value=n,void o('close-diary-nav');var n}},(0,a.toDisplayString)(e.日期)+' - '+(0,a.toDisplayString)(e.标题),11,i))),128))])])):(0,a.createCommentVNode)('v-if',!0)]),_:1}),(0,a.createElementVNode)('div',c,[B.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',d,[(0,a.createElementVNode)('div',m,[(0,a.createElementVNode)('div',u,[(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(B.value.日期),1),(0,a.createElementVNode)('span',null,'天气: '+(0,a.toDisplayString)(B.value.天气),1)]),(0,a.createElementVNode)('h1',p,(0,a.toDisplayString)(B.value.标题),1)]),(0,a.createElementVNode)('div',v,[t[5]||(t[5]=(0,a.createElementVNode)('h2',null,'心情随笔',-1)),(0,a.createElementVNode)('p',null,(0,a.toDisplayString)(B.value.心情随笔),1)]),(0,a.createElementVNode)('div',g,[(0,a.createElementVNode)('h2',{onClick:t[1]||(t[1]=e=>C('events'))},[t[6]||(t[6]=(0,a.createTextVNode)(' 本日事件簿 ',-1)),(0,a.createElementVNode)('span',{class:(0,a.normalizeClass)(['arrow',{open:w.events}])},'▸',2)]),w.events?((0,a.openBlock)(),(0,a.createElementBlock)('div',y,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(B.value.本日事件簿,(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:n,class:'event-item'},[(0,a.createElementVNode)('p',null,[t[7]||(t[7]=(0,a.createElementVNode)('strong',null,'时刻:',-1)),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.时刻),1)]),(0,a.createElementVNode)('p',null,[t[8]||(t[8]=(0,a.createElementVNode)('strong',null,'地点:',-1)),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.地点),1)]),(0,a.createElementVNode)('p',null,[t[9]||(t[9]=(0,a.createElementVNode)('strong',null,'事件:',-1)),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.事件),1)]),(0,a.createElementVNode)('p',f,[t[10]||(t[10]=(0,a.createElementVNode)('strong',null,'我的吐槽:',-1)),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.我的吐槽),1)])]))),128))])):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createElementVNode)('div',h,[(0,a.createElementVNode)('h2',{onClick:t[2]||(t[2]=e=>C('relations'))},[t[11]||(t[11]=(0,a.createTextVNode)(' 关系温度计 ',-1)),(0,a.createElementVNode)('span',{class:(0,a.normalizeClass)(['arrow',{open:w.relations}])},'▸',2)]),w.relations?((0,a.openBlock)(),(0,a.createElementBlock)('div',k,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(B.value.关系温度计,(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:n,class:'relation-item'},[(0,a.createElementVNode)('p',null,[t[12]||(t[12]=(0,a.createElementVNode)('strong',null,'对象:',-1)),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.对象),1)]),(0,a.createElementVNode)('p',null,[t[13]||(t[13]=(0,a.createElementVNode)('strong',null,'事件:',-1)),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.事件),1)]),(0,a.createElementVNode)('p',null,[t[14]||(t[14]=(0,a.createElementVNode)('strong',null,'我的看法:',-1)),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.我的看法),1)])]))),128))])):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createElementVNode)('div',E,[(0,a.createElementVNode)('h2',{onClick:t[3]||(t[3]=e=>C('memos'))},[t[15]||(t[15]=(0,a.createTextVNode)(' 明日备忘 ',-1)),(0,a.createElementVNode)('span',{class:(0,a.normalizeClass)(['arrow',{open:w.memos}])},'▸',2)]),w.memos?((0,a.openBlock)(),(0,a.createElementBlock)('div',N,[(0,a.createElementVNode)('ul',null,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(B.value.明日备忘,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('li',{key:t},(0,a.toDisplayString)(e),1))),128))])])):(0,a.createCommentVNode)('v-if',!0)])])):((0,a.openBlock)(),(0,a.createElementBlock)('div',S,[...t[16]||(t[16]=[(0,a.createElementVNode)('p',null,'日记加载中，或没有找到日记条目。',-1)])]))])]))}});const V=(0,n(667).A)(b,[['__scopeId','data-v-2abe18ac']])},587(e,t,n){n.d(t,{default:()=>L}),n.r(t);var a=n(61),o=n(224),l=n(354);const r={class:'item-detail-panel'},s={key:0,class:'item-details'},i={class:'item-tags'},c={class:'item-description'},d={key:0,class:'item-effects'},m={key:1,class:'placeholder'},u=(0,a.defineComponent)({__name:'ItemDetailPanel',props:{item:{}},setup(e){const t={日常用品:{bg:'rgba(108, 117, 125, 0.2)',text:'#6c757d'},书籍资料:{bg:'rgba(58, 143, 157, 0.2)',text:'#3a8f9d'},个人物品:{bg:'rgba(212, 175, 55, 0.2)',text:'#d4af37'},剧情道具:{bg:'rgba(138, 93, 181, 0.2)',text:'#8a5db5'},赠礼:{bg:'rgba(220, 53, 69, 0.2)',text:'#dc3545'},服装饰品:{bg:'rgba(255, 193, 7, 0.2)',text:'#ffc107'}},n={bg:'rgba(108, 117, 125, 0.2)',text:'#6c757d'},o=e=>{const a=t[e.类型]||n;return{backgroundColor:a.bg,color:a.text}};return(l,u)=>{return(0,a.openBlock)(),(0,a.createElementBlock)('div',r,[e.item?((0,a.openBlock)(),(0,a.createElementBlock)('div',s,[(0,a.createElementVNode)('h3',{class:'item-name',style:(0,a.normalizeStyle)((p=e.item,{color:t[p.类型]?.text||n.text}))},(0,a.toDisplayString)(e.item.名称),5),(0,a.createElementVNode)('div',i,[(0,a.createElementVNode)('span',{class:'tag',style:(0,a.normalizeStyle)(o(e.item))},(0,a.toDisplayString)(e.item.类型),5)]),(0,a.createElementVNode)('p',c,(0,a.toDisplayString)(e.item.描述),1),e.item.效果?((0,a.openBlock)(),(0,a.createElementBlock)('div',d,[u[0]||(u[0]=(0,a.createElementVNode)('h4',null,'效果',-1)),(0,a.createElementVNode)('p',null,(0,a.toDisplayString)(e.item.效果),1)])):(0,a.createCommentVNode)('v-if',!0)])):((0,a.openBlock)(),(0,a.createElementBlock)('div',m,[...u[1]||(u[1]=[(0,a.createElementVNode)('p',null,'选择一个物品查看详情',-1)])]))]);var p}}});var p=n(667);const v=(0,p.A)(u,[['__scopeId','data-v-b1c37b8c']]),g={class:'inventory-panel-container'},y={key:0,class:'inventory-layout'},f={class:'list-view-container'},h={class:'category-header'},k=['onClick'],E={class:'main-content'},N={class:'item-grid-container'},S={key:0,class:'item-grid'},b=['onClick'],V={class:'item-name'},B={key:0,class:'item-quantity'},w={key:1,class:'empty-grid'},C={key:1,class:'loading'},D=(0,a.defineComponent)({__name:'InventoryPanel',setup(e){const t=(0,a.ref)(null),n=(0,a.ref)(null),r=(0,a.computed)(()=>{const e=l.M_.worldState?.主角;return'object'==typeof e&&null!==e&&'物品栏'in e?e:null}),s=(0,a.computed)(()=>{if(!r.value)return[];const e=r.value.物品栏,t=(0,o.get)(l.M_.worldState,'物品数据库',{});return Object.entries(e).map(([e,n])=>{const a=t[e];return a?{...a,ID:e,数量:n.数量}:null}).filter(e=>null!==e)}),i=(0,a.computed)(()=>{const e={日常用品:[],书籍资料:[],个人物品:[],剧情道具:[],赠礼:[],服装饰品:[]};if(s.value.forEach(t=>{const n=t.类型;e[n]&&e[n].push(t)}),!n.value||!Object.keys(e).includes(n.value)){const t=Object.keys(e).find(t=>e[t].length>0);n.value=t||'日常用品'}return e}),c=(0,a.computed)(()=>n.value&&i.value[n.value]?i.value[n.value]:[]),d={日常用品:'#6c757d',书籍资料:'#3a8f9d',个人物品:'#d4af37',剧情道具:'#8a5db5',赠礼:'#dc3545',服装饰品:'#ffc107'},m=e=>({'--tier-border-color':d[e.类型]||'#a0a0a0'});return(e,o)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',g,[r.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',y,[(0,a.createElementVNode)('div',f,[(0,a.createElementVNode)('div',h,[(0,a.createElementVNode)('ul',null,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(Object.keys(i.value),e=>((0,a.openBlock)(),(0,a.createElementBlock)('li',{key:e,class:(0,a.normalizeClass)({active:n.value===e}),onClick:t=>(e=>{n.value=e})(e)},(0,a.toDisplayString)(e)+' ('+(0,a.toDisplayString)(i.value[e].length)+') ',11,k))),128))])]),(0,a.createElementVNode)('div',E,[(0,a.createElementVNode)('div',N,[c.value.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',S,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(c.value,e=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.ID,class:'item-cell',style:(0,a.normalizeStyle)(m(e)),onClick:n=>(e=>{t.value=e})(e)},[(0,a.createElementVNode)('div',V,(0,a.toDisplayString)(e.名称),1),e.数量?((0,a.openBlock)(),(0,a.createElementBlock)('div',B,'x'+(0,a.toDisplayString)(e.数量),1)):(0,a.createCommentVNode)('v-if',!0)],12,b))),128))])):((0,a.openBlock)(),(0,a.createElementBlock)('div',w,[...o[3]||(o[3]=[(0,a.createElementVNode)('p',null,'空空如也',-1)])]))])])])])):((0,a.openBlock)(),(0,a.createElementBlock)('div',C,'加载中...')),(0,a.createCommentVNode)(' Item Detail Modal '),t.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:2,class:'modal-overlay',onClick:o[2]||(o[2]=e=>t.value=null)},[(0,a.createElementVNode)('div',{class:'modal-content',onClick:o[1]||(o[1]=(0,a.withModifiers)(()=>{},['stop']))},[(0,a.createVNode)(v,{item:t.value},null,8,['item']),(0,a.createElementVNode)('button',{class:'close-button',onClick:o[0]||(o[0]=e=>t.value=null)},'×')])])):(0,a.createCommentVNode)('v-if',!0)]))}}),L=(0,p.A)(D,[['__scopeId','data-v-2ebd8a93']])},753(e,t,n){n.d(t,{default:()=>S}),n.r(t);var a=n(61),o=n(407);const l='reincarnation_followed_npcs',r=(0,a.ref)(new Set(JSON.parse(localStorage.getItem(l)||'[]')));function s(){const e=e=>r.value.has(e);return{followedNpcs:r,toggleFollow:t=>{e(t)?(e=>{r.value.delete(e)})(t):(e=>{r.value.add(e)})(t)},isFollowed:e}}(0,a.watch)(r,e=>{localStorage.setItem(l,JSON.stringify(Array.from(e)))},{deep:!0});n(380);const i=(0,a.defineComponent)({__name:'FollowButton',props:{npcId:{}},setup(e){const t=e,{toggleFollow:n,isFollowed:o}=s(),l=(0,a.ref)(!1);function r(){n(t.npcId)}return(0,a.watchEffect)(()=>{l.value=o(t.npcId)}),(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('button',{class:(0,a.normalizeClass)(['follow-btn',{followed:l.value}]),onClick:(0,a.withModifiers)(r,['stop'])},'★',2))}});var c=n(667);const d=(0,c.A)(i,[['__scopeId','data-v-69130bcd']]);var m=n(10);n(978);const u={class:'npc-directory-panel-mobile'},p={key:0,class:'npc-list-view'},v={key:0,class:'npc-list'},g=['onClick'],y={class:'npc-info'},f={class:'npc-name'},h={class:'npc-location'},k={key:1,class:'placeholder'},E={key:1,class:'npc-detail-view'},N=(0,a.defineComponent)({__name:'NpcDirectoryPanel',setup(e){const t=(0,a.ref)(null),n=(0,a.ref)(null),l=(0,a.ref)(''),{isFollowed:r}=s(),i=(0,a.computed)(()=>{let e=o.n.allNpcs.value.map(e=>({...e,id:e.id,locationName:o.n.getLocationName(e.位置)}));return e.sort((e,t)=>{const n=!!e.id&&r(e.id),a=!!t.id&&r(t.id);return n&&!a?-1:!n&&a?1:0}),l.value?e.filter(e=>e.名称&&e.名称.toLowerCase().includes(l.value.toLowerCase())):e});(0,a.watch)(i,e=>{e.length>0&&!t.value||0===e.length&&(t.value=null,n.value=null)},{immediate:!0});const c=()=>{t.value=null,n.value=null};return(e,o)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',u,[(0,a.createVNode)(a.Transition,{name:'slide-fade',mode:'out-in'},{default:(0,a.withCtx)(()=>[t.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',E,[(0,a.createElementVNode)('div',{class:'detail-header'},[(0,a.createElementVNode)('button',{onClick:c,class:'back-button'},[...o[1]||(o[1]=[(0,a.createElementVNode)('i',{class:'fas fa-arrow-left'},null,-1),(0,a.createTextVNode)(' 返回',-1)])])]),(0,a.createVNode)(m.A,{npc:t.value,'npc-id':n.value},null,8,['npc','npc-id'])])):((0,a.openBlock)(),(0,a.createElementBlock)('div',p,[(0,a.withDirectives)((0,a.createElementVNode)('input',{type:'text','onUpdate:modelValue':o[0]||(o[0]=e=>l.value=e),placeholder:'搜索联系人...',class:'search-input'},null,512),[[a.vModelText,l.value]]),i.value.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('ul',v,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(i.value,e=>((0,a.openBlock)(),(0,a.createElementBlock)('li',{key:e.id,onClick:a=>function(e){t.value=e,n.value=e.id}(e)},[(0,a.createElementVNode)('div',y,[(0,a.createElementVNode)('span',f,(0,a.toDisplayString)(e.名称),1),(0,a.createElementVNode)('span',h,(0,a.toDisplayString)(e.locationName),1)]),e.id?((0,a.openBlock)(),(0,a.createBlock)(d,{key:0,'npc-id':e.id},null,8,['npc-id'])):(0,a.createCommentVNode)('v-if',!0)],8,g))),128))])):((0,a.openBlock)(),(0,a.createElementBlock)('div',k,'没有找到联系人'))]))]),_:1})]))}}),S=(0,c.A)(N,[['__scopeId','data-v-6ec21cbc']])},326(e,t,n){n.d(t,{default:()=>i}),n.r(t);var a=n(61),o=n(941);const l={class:'reincarnation-panel'},r={class:'tab-content'},s=(0,a.defineComponent)({__name:'ReincarnationPanel',setup:e=>(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',l,[(0,a.createElementVNode)('div',r,[(0,a.createVNode)(o.A)])]))});const i=(0,n(667).A)(s,[['__scopeId','data-v-30be22b9']])},640(e,t,n){n.d(t,{default:()=>b}),n.r(t);var a=n(61),o=n(562);const l={class:'skills-panel'},r={key:0,class:'empty-state'},s={key:1,class:'skills-list'},i={class:'skill-header'},c={class:'skill-level'},d={class:'skill-description'},m={class:'skill-progress'},u={class:'progress-bar-wrapper'},p=['value','max'],v={class:'progress-text'},g={key:0,class:'associated-skills'},y=['onClick'],f={key:0,class:'associated-skills-list'},h={class:'skill-name'},k={class:'skill-detail skill-description-detail'},E={class:'skill-detail'},N={class:'skill-detail'},S=(0,a.defineComponent)({__name:'SkillsPanel',setup(e){const t=(0,a.computed)(()=>o.AE.value),n=(0,a.ref)({}),S=e=>!!n.value[e];return(e,o)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',l,[o[4]||(o[4]=(0,a.createElementVNode)('h2',null,'技艺',-1)),0===t.value.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',r,[...o[0]||(o[0]=[(0,a.createElementVNode)('p',null,'尚未掌握任何技艺。',-1)])])):((0,a.openBlock)(),(0,a.createElementBlock)('div',s,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.value,e=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.id,class:'skill-item'},[(0,a.createElementVNode)('div',i,[(0,a.createElementVNode)('h3',null,(0,a.toDisplayString)(e.name),1),(0,a.createElementVNode)('div',c,'等级 '+(0,a.toDisplayString)(e.level),1)]),(0,a.createElementVNode)('p',d,(0,a.toDisplayString)(e.description),1),(0,a.createElementVNode)('div',m,[(0,a.createElementVNode)('div',u,[(0,a.createElementVNode)('progress',{value:e.exp,max:'MAX'===e.expToNextLevel?e.exp:e.expToNextLevel},null,8,p),(0,a.createElementVNode)('span',v,(0,a.toDisplayString)(e.exp)+' / '+(0,a.toDisplayString)(e.expToNextLevel),1)])]),e.associatedSkills&&e.associatedSkills.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',g,[(0,a.createElementVNode)('button',{onClick:t=>{return a=e.id,void(n.value[a]=!n.value[a]);var a},class:'associated-skills-title'},[o[1]||(o[1]=(0,a.createTextVNode)(' 相关技能 ',-1)),(0,a.createElementVNode)('span',{class:(0,a.normalizeClass)(['arrow',{expanded:S(e.id)}])},null,2)],8,y),S(e.id)?((0,a.openBlock)(),(0,a.createElementBlock)('ul',f,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.associatedSkills,e=>((0,a.openBlock)(),(0,a.createElementBlock)('li',{key:e.ID,class:'associated-skill-item'},[(0,a.createElementVNode)('div',h,[(0,a.createElementVNode)('strong',null,(0,a.toDisplayString)(e.名称),1),(0,a.createTextVNode)(' ('+(0,a.toDisplayString)(e.类型)+') ',1)]),(0,a.createElementVNode)('div',k,(0,a.toDisplayString)(e.描述),1),(0,a.createElementVNode)('div',E,[o[2]||(o[2]=(0,a.createElementVNode)('strong',null,'基础效果:',-1)),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.基础效果),1)]),(0,a.createElementVNode)('div',N,[o[3]||(o[3]=(0,a.createElementVNode)('strong',null,'成长:',-1)),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.效果等级公式),1)])]))),128))])):(0,a.createCommentVNode)('v-if',!0)])):(0,a.createCommentVNode)('v-if',!0)]))),128))]))]))}});const b=(0,n(667).A)(S,[['__scopeId','data-v-14bf0e7c']])},344(e,t,n){n.d(t,{default:()=>le}),n.r(t);var a=n(61),o=n(632),l=n(691),r=n(445),s=n(131);const i={class:'panel-wrapper memory-panel-container'},c={class:'panel-content'},d={class:'section'},m={class:'setting-item'},u={class:'section'},p={class:'setting-item'},v={class:'setting-item'},g={class:'setting-item'},y={class:'section'},f={class:'tabs'},h={class:'memory-content'},k=['value'],E=(0,a.defineComponent)({__name:'MemoryPanel',setup(e){const t=(0,a.ref)(!0),n=(0,a.ref)({instantMemoryCount:3,shortTermMemoryCount:25,longTermMemoryCount:200}),E=(0,a.ref)('instant'),N=(0,a.ref)({instant:'加载中...',short:'加载中...',long:'加载中...'}),S=(0,a.computed)(()=>N.value[E.value]);async function b(e=!1){try{const[t,n,a]=await Promise.all([r.T.readFromLorebook('[系统]瞬时记忆',e),r.T.readFromLorebook('[系统]短期记忆',e),r.T.readFromLorebook('[系统]长期记忆',e)]);N.value.instant=t||'暂无内容',N.value.short=n||'暂无内容',N.value.long=a||'暂无内容'}catch(e){console.error('[MemoryPanel] Failed to fetch memory content:',e),o.error('无法加载记忆内容')}}function V(){s.H.setConfig(n.value),o.success('记忆系统配置已应用')}async function B(){o.info('正在手动更新所有记忆层级...'),console.log('[MemoryPanel] Forcing update via processDirectorLog...'),await s.H.processDirectorLog(),await b(!0),o.success('记忆层级更新完毕')}const w=()=>{console.log('[MemoryPanel] Detected memory update. Refreshing content...'),b(!0)};return(0,a.onMounted)(()=>{n.value=s.H.getConfig(),b(),l.B.on('memoryUpdated',w)}),(0,a.onUnmounted)(()=>{l.B.off('memoryUpdated',w)}),(e,o)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',i,[(0,a.createElementVNode)('div',c,[o[14]||(o[14]=(0,a.createElementVNode)('h3',{class:'panel-title'},'世界记忆系统',-1)),(0,a.createCommentVNode)(' Automation Control '),(0,a.createElementVNode)('div',d,[(0,a.createElementVNode)('div',m,[o[7]||(o[7]=(0,a.createElementVNode)('label',{for:'auto-memory-switch'},'启用自动记忆系统',-1)),(0,a.withDirectives)((0,a.createElementVNode)('input',{type:'checkbox',id:'auto-memory-switch','onUpdate:modelValue':o[0]||(o[0]=e=>t.value=e)},null,512),[[a.vModelCheckbox,t.value]])]),o[8]||(o[8]=(0,a.createElementVNode)('p',{class:'description'},'启用后，系统将在每次AI交互后自动更新所有记忆层级。',-1))]),(0,a.createCommentVNode)(' Configuration '),(0,a.createElementVNode)('div',u,[o[12]||(o[12]=(0,a.createElementVNode)('h4',null,'参数配置',-1)),(0,a.createElementVNode)('div',p,[o[9]||(o[9]=(0,a.createElementVNode)('label',{for:'instant-memory-count'},'瞬时记忆数量',-1)),(0,a.withDirectives)((0,a.createElementVNode)('input',{type:'number',id:'instant-memory-count','onUpdate:modelValue':o[1]||(o[1]=e=>n.value.instantMemoryCount=e)},null,512),[[a.vModelText,n.value.instantMemoryCount,void 0,{number:!0}]])]),(0,a.createElementVNode)('div',v,[o[10]||(o[10]=(0,a.createElementVNode)('label',{for:'short-term-count'},'短期记忆数量',-1)),(0,a.withDirectives)((0,a.createElementVNode)('input',{type:'number',id:'short-term-count','onUpdate:modelValue':o[2]||(o[2]=e=>n.value.shortTermMemoryCount=e)},null,512),[[a.vModelText,n.value.shortTermMemoryCount,void 0,{number:!0}]])]),(0,a.createElementVNode)('div',g,[o[11]||(o[11]=(0,a.createElementVNode)('label',{for:'long-term-count'},'长期记忆数量',-1)),(0,a.withDirectives)((0,a.createElementVNode)('input',{type:'number',id:'long-term-count','onUpdate:modelValue':o[3]||(o[3]=e=>n.value.longTermMemoryCount=e)},null,512),[[a.vModelText,n.value.longTermMemoryCount,void 0,{number:!0}]])]),(0,a.createElementVNode)('button',{onClick:V},'应用配置'),(0,a.createElementVNode)('button',{onClick:B},'立即更新所有记忆')]),(0,a.createCommentVNode)(' Memory Review '),(0,a.createElementVNode)('div',y,[o[13]||(o[13]=(0,a.createElementVNode)('h4',null,'记忆审查',-1)),(0,a.createElementVNode)('div',f,[(0,a.createElementVNode)('button',{class:(0,a.normalizeClass)({active:'instant'===E.value}),onClick:o[4]||(o[4]=e=>E.value='instant')},'瞬时记忆',2),(0,a.createElementVNode)('button',{class:(0,a.normalizeClass)({active:'short'===E.value}),onClick:o[5]||(o[5]=e=>E.value='short')},'短期记忆',2),(0,a.createElementVNode)('button',{class:(0,a.normalizeClass)({active:'long'===E.value}),onClick:o[6]||(o[6]=e=>E.value='long')},'长期记忆',2)]),(0,a.createElementVNode)('div',h,[(0,a.createElementVNode)('textarea',{readonly:'',value:S.value},null,8,k)])])])]))}});var N=n(667);const S=(0,N.A)(E,[['__scopeId','data-v-8153ab84']]),b={class:'save-load-panel'},V={class:'panel-header'},B={class:'header-actions'},w={class:'save-slots-container'},C={class:'slot-group'},D={class:'slot-info'},L={class:'slot-name'},M={class:'slot-timestamp'},x={key:0,class:'slot-diary'},I={class:'log-date'},T={class:'log-title'},A={class:'slot-actions'},F=['onClick'],j=['onClick','disabled'],O=['onClick','disabled'],R={class:'slot-group'},P={class:'slot-info'},W={class:'slot-name'},Y={class:'slot-timestamp'},H={key:0,class:'slot-diary'},U={class:'log-date'},G={class:'log-title'},J={class:'slot-actions'},q=['onClick','disabled'],K={class:'auto-save-toggle'};var Q=n(581);const Z=(0,a.defineComponent)({name:'SaveLoadPanel',setup(){const e=(0,a.ref)([]),t=(0,a.ref)([]),n=(0,a.ref)(!0),l=(0,a.ref)(null),r=async()=>{await Q.h.loadAllSaveSlots(),e.value=[...Q.h.manualSlots],t.value=[...Q.h.autoSlots]};(0,a.onMounted)(()=>{r(),n.value=Q.h.isAutoSaveEnabled});return{manualSlots:e,autoSlots:t,isAutoSaveEnabled:n,fileInput:l,formatTimestamp:e=>new Date(e).toLocaleString('zh-CN',{hour12:!1}),saveGame:async e=>{await Q.h.saveGame(e),await r()},loadGame:async e=>{await Q.h.loadGame(e)},deleteSave:async e=>{await Q.h.deleteSave(e),await r()},toggleAutoSave:()=>{Q.h.toggleAutoSave(n.value)},importSave:()=>{l.value?.click()},handleFileImport:e=>{const t=e.target;if(t.files&&t.files[0]){const e=t.files[0],n=new FileReader;n.onload=async e=>{try{const t=e.target?.result;await Q.h.importSave(t),await r()}catch(e){o.error('导入存档失败，文件格式可能不正确。'),console.error(e)}},n.readAsText(e),t.value=''}},exportSave:async()=>{const t=e.value.find(e=>e.data);t?Q.h.exportSave(t):o.warning('没有可导出的存档。')}}}}),X=(0,N.A)(Z,[['render',function(e,t,n,o,l,r){return(0,a.openBlock)(),(0,a.createElementBlock)('div',b,[(0,a.createElementVNode)('div',V,[t[5]||(t[5]=(0,a.createElementVNode)('h2',{class:'panel-title'},'游戏存档',-1)),(0,a.createElementVNode)('div',B,[(0,a.createElementVNode)('button',{onClick:t[0]||(t[0]=(...t)=>e.importSave&&e.importSave(...t)),class:'header-btn'},'导入'),(0,a.createElementVNode)('button',{onClick:t[1]||(t[1]=(...t)=>e.exportSave&&e.exportSave(...t)),class:'header-btn'},'导出')])]),(0,a.createElementVNode)('div',w,[(0,a.createElementVNode)('div',C,[t[6]||(t[6]=(0,a.createElementVNode)('h3',{class:'group-title'},'手动存档',-1)),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.manualSlots,t=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:t.id,class:'save-slot'},[(0,a.createElementVNode)('div',D,[(0,a.createElementVNode)('span',L,(0,a.toDisplayString)(t.name),1),(0,a.createElementVNode)('span',M,(0,a.toDisplayString)(t.timestamp?e.formatTimestamp(t.timestamp):'空槽位'),1),t.diaryDate||t.diaryTimeSegment||t.diaryTitle?((0,a.openBlock)(),(0,a.createElementBlock)('div',x,[(0,a.createElementVNode)('span',I,(0,a.toDisplayString)(t.diaryDate)+' '+(0,a.toDisplayString)(t.diaryTimeSegment),1),(0,a.createElementVNode)('span',T,(0,a.toDisplayString)(t.diaryTitle),1)])):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createElementVNode)('div',A,[(0,a.createElementVNode)('button',{onClick:n=>e.saveGame(t.id),class:'action-btn save-btn'},'保存',8,F),(0,a.createElementVNode)('button',{onClick:n=>e.loadGame(t),disabled:!t.data,class:'action-btn load-btn'},'读取',8,j),(0,a.createElementVNode)('button',{onClick:n=>e.deleteSave(t),disabled:!t.data,class:'action-btn delete-btn'},'删除',8,O)])]))),128))]),(0,a.createElementVNode)('div',R,[t[7]||(t[7]=(0,a.createElementVNode)('h3',{class:'group-title'},'自动存档',-1)),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.autoSlots,t=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:t.id,class:'save-slot auto-slot'},[(0,a.createElementVNode)('div',P,[(0,a.createElementVNode)('span',W,(0,a.toDisplayString)(t.name),1),(0,a.createElementVNode)('span',Y,(0,a.toDisplayString)(t.timestamp?e.formatTimestamp(t.timestamp):'空槽位'),1),t.diaryDate||t.diaryTimeSegment||t.diaryTitle?((0,a.openBlock)(),(0,a.createElementBlock)('div',H,[(0,a.createElementVNode)('span',U,(0,a.toDisplayString)(t.diaryDate)+' '+(0,a.toDisplayString)(t.diaryTimeSegment),1),(0,a.createElementVNode)('span',G,(0,a.toDisplayString)(t.diaryTitle),1)])):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createElementVNode)('div',J,[(0,a.createElementVNode)('button',{onClick:n=>e.loadGame(t),disabled:!t.data,class:'action-btn load-btn'},'读取',8,q)])]))),128))]),(0,a.createElementVNode)('div',K,[(0,a.createElementVNode)('label',null,[(0,a.withDirectives)((0,a.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':t[2]||(t[2]=t=>e.isAutoSaveEnabled=t),onChange:t[3]||(t[3]=(...t)=>e.toggleAutoSave&&e.toggleAutoSave(...t))},null,544),[[a.vModelCheckbox,e.isAutoSaveEnabled]]),t[8]||(t[8]=(0,a.createTextVNode)(' 开启自动存档 ',-1))])])]),(0,a.createElementVNode)('input',{type:'file',ref:'fileInput',onChange:t[4]||(t[4]=(...t)=>e.handleFileImport&&e.handleFileImport(...t)),style:{display:'none'},accept:'.json'},null,544)])}],['__scopeId','data-v-7bd14af8']]);var ee=n(269);const te={class:'system-panel'},ne={class:'panel-tabs'},ae={class:'panel-content'},oe=(0,a.defineComponent)({__name:'SystemPanel',setup(e){const t=(0,a.ref)('saveLoad');return(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',te,[(0,a.createElementVNode)('div',ne,[(0,a.createElementVNode)('button',{class:(0,a.normalizeClass)({active:'saveLoad'===t.value}),onClick:n[0]||(n[0]=e=>t.value='saveLoad')},'存档管理',2),(0,a.createElementVNode)('button',{class:(0,a.normalizeClass)({active:'memory'===t.value}),onClick:n[1]||(n[1]=e=>t.value='memory')},'记忆系统',2),(0,a.createElementVNode)('button',{class:(0,a.normalizeClass)({active:'debug'===t.value}),onClick:n[2]||(n[2]=e=>t.value='debug')},'调试',2)]),(0,a.createElementVNode)('div',ae,[(0,a.withDirectives)((0,a.createVNode)(X,null,null,512),[[a.vShow,'saveLoad'===t.value]]),(0,a.withDirectives)((0,a.createVNode)(S,null,null,512),[[a.vShow,'memory'===t.value]]),(0,a.withDirectives)((0,a.createVNode)(ee.default,null,null,512),[[a.vShow,'debug'===t.value]])])]))}}),le=(0,N.A)(oe,[['__scopeId','data-v-0bab00cc']])},914(e,t,n){n.d(t,{default:()=>X}),n.r(t);var a=n(61),o=n(380),l=n(445),r=n(562);const s={key:0,class:'realm-detail-card'},i={class:'info-item'},c={class:'info-item'},d={class:'info-item full-width'},m={class:'info-item full-width'},u={class:'info-item full-width'},p=(0,a.defineComponent)({__name:'RealmDetailCard',props:{realm:{type:Object,required:!0}},setup:e=>(t,n)=>e.realm?((0,a.openBlock)(),(0,a.createElementBlock)('div',s,[(0,a.createElementVNode)('div',i,[n[0]||(n[0]=(0,a.createElementVNode)('strong',null,'能级',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(e.realm.能级),1)]),(0,a.createElementVNode)('div',c,[n[1]||(n[1]=(0,a.createElementVNode)('strong',null,'名称',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(e.realm.名称),1)]),(0,a.createElementVNode)('div',d,[n[2]||(n[2]=(0,a.createElementVNode)('strong',null,'描述',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(e.realm.描述),1)]),(0,a.createElementVNode)('div',m,[n[3]||(n[3]=(0,a.createElementVNode)('strong',null,'解锁系统',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(e.realm.解锁系统?.名称&&'无'!==e.realm.解锁系统?.名称?`${e.realm.解锁系统.名称} - ${e.realm.解锁系统.描述}`:'无'),1)]),(0,a.createElementVNode)('div',u,[n[4]||(n[4]=(0,a.createElementVNode)('strong',null,'晋升需求',-1)),(0,a.createElementVNode)('ul',null,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.realm.晋升需求,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('li',{key:t},(0,a.toDisplayString)(e.描述),1))),128))])])])):(0,a.createCommentVNode)('v-if',!0)});var v=n(667);const g=(0,v.A)(p,[['__scopeId','data-v-155d0d21']]),y={key:0,class:'panel-wrapper world-detail-panel-content'},f={class:'scroll-container'},h={class:'world-section'},k={class:'rules-grid'},E={class:'rule-item'},N={class:'rule-value'},S={class:'rule-item'},b={class:'rule-value'},V={class:'world-section epoch-selection'},B={class:'tabs-container main-tabs'},w=['innerHTML'],C={class:'world-section'},D={class:'epoch-header'},L={class:'section-title'},M={class:'epoch-overview'},x={class:'rules-grid'},I={class:'rule-item'},T={class:'rule-value'},A={class:'rule-item'},F={class:'rule-value'},j={class:'rule-item'},O={class:'rule-value'},R={class:'rule-item'},P={class:'rule-value'},W={class:'world-section'},Y={class:'system-overview'},H={class:'subsection'},U={class:'ladder-container'},G={class:'境界-ladder'},J=['onClick'],q={class:'level-energy'},K={class:'level-name'},Q={key:1,class:'panel-wrapper loading-state'},Z=(0,a.defineComponent)({__name:'WorldDetailsPanel',props:{worldType:{}},setup(e){const t=e,n=(0,a.ref)('details'),s=(0,a.ref)('加载摘要中...'),i=(0,a.computed)(()=>'mainWorld'===t.worldType?r.mainWorld.value:r.avatarWorld.value),c=(0,a.computed)(()=>i.value&&i.value.定义.历史纪元?Object.values(i.value.定义.历史纪元).filter(e=>'object'==typeof e&&e.纪元ID):[]),d=(0,a.ref)(null);(0,a.onMounted)(async()=>{const e=await l.T.readFromLorebook('[系统]主世界摘要');s.value=e?e.split('\n\n---\n\n').map(e=>`<p>${e.replace(/\n/g,'<br>')}</p>`).join(''):'未能找到主世界摘要。'}),(0,a.watch)(i,e=>{e&&(d.value=e.定义.元规则.当前纪元ID||c.value[0]?.纪元ID||null)},{immediate:!0});const m=(0,a.computed)(()=>i.value&&d.value&&i.value.定义.历史纪元[d.value]||null),u=(0,a.computed)(()=>{if(!m.value?.力量体系?.境界定义)return[];const e=m.value.力量体系.境界定义;return Object.keys(e).filter(e=>'$meta'!==e).map(t=>e[t]).sort((e,t)=>e.能级-t.能级)});return(e,t)=>i.value&&m.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',y,[(0,a.createElementVNode)('div',f,[(0,a.createCommentVNode)(' 元规则 '),(0,a.createElementVNode)('section',h,[t[4]||(t[4]=(0,a.createElementVNode)('h3',{class:'section-title'},'元规则',-1)),(0,a.createElementVNode)('div',k,[(0,a.createElementVNode)('div',E,[t[2]||(t[2]=(0,a.createElementVNode)('div',{class:'rule-name'},'宇宙蓝图',-1)),(0,a.createElementVNode)('div',N,(0,a.toDisplayString)(i.value.定义.元规则.宇宙蓝图),1)]),(0,a.createElementVNode)('div',S,[t[3]||(t[3]=(0,a.createElementVNode)('div',{class:'rule-name'},'物理尺度',-1)),(0,a.createElementVNode)('div',b,(0,a.toDisplayString)(i.value.定义.元规则.物理尺度),1)])])]),(0,a.createCommentVNode)(' 纪元切换 '),(0,a.createElementVNode)('section',V,[t[5]||(t[5]=(0,a.createElementVNode)('h3',{class:'section-title'},'内容详情',-1)),(0,a.createElementVNode)('div',B,[(0,a.createElementVNode)('button',{class:(0,a.normalizeClass)(['epoch-tab',{active:'details'===n.value}]),onClick:t[0]||(t[0]=e=>n.value='details')},' 纪元详情 ',2),(0,a.createElementVNode)('button',{class:(0,a.normalizeClass)(['epoch-tab',{active:'summary'===n.value}]),onClick:t[1]||(t[1]=e=>n.value='summary')},' 世界摘要 ',2)])]),'summary'===n.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:0,class:'summary-content',innerHTML:s.value},null,8,w)):(0,a.createCommentVNode)('v-if',!0),'details'===n.value&&m.value?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createCommentVNode)(' 纪元规则 '),(0,a.createElementVNode)('section',C,[(0,a.createElementVNode)('div',D,[(0,a.createElementVNode)('h3',L,'纪元: '+(0,a.toDisplayString)(m.value.纪元名称),1),(0,a.createElementVNode)('p',M,(0,a.toDisplayString)(m.value.纪元概述),1)]),(0,a.createElementVNode)('div',x,[(0,a.createElementVNode)('div',I,[t[6]||(t[6]=(0,a.createElementVNode)('div',{class:'rule-name'},'世界能级',-1)),(0,a.createElementVNode)('div',T,(0,a.toDisplayString)(m.value.规则.世界能级),1)]),(0,a.createElementVNode)('div',A,[t[7]||(t[7]=(0,a.createElementVNode)('div',{class:'rule-name'},'时间流速',-1)),(0,a.createElementVNode)('div',F,(0,a.toDisplayString)(m.value.规则.时间流速)+'x',1)]),(0,a.createElementVNode)('div',j,[t[8]||(t[8]=(0,a.createElementVNode)('div',{class:'rule-name'},'空间稳定性',-1)),(0,a.createElementVNode)('div',O,(0,a.toDisplayString)(m.value.规则.空间稳定性)+'%',1)]),(0,a.createElementVNode)('div',R,[t[9]||(t[9]=(0,a.createElementVNode)('div',{class:'rule-name'},'生命位格',-1)),(0,a.createElementVNode)('div',P,(0,a.toDisplayString)(m.value.规则.生命位格.基准值),1)])])]),(0,a.createCommentVNode)(' 力量体系 '),(0,a.createElementVNode)('section',W,[t[11]||(t[11]=(0,a.createElementVNode)('h3',{class:'section-title'},'力量体系',-1)),(0,a.createElementVNode)('p',Y,(0,a.toDisplayString)(m.value.力量体系.体系概述),1),(0,a.createElementVNode)('div',H,[t[10]||(t[10]=(0,a.createElementVNode)('h4',{class:'subsection-title'},'境界定义',-1)),(0,a.createElementVNode)('div',U,[(0,a.createElementVNode)('ul',G,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(u.value,e=>((0,a.openBlock)(),(0,a.createElementBlock)('li',{key:e.名称,class:'ladder-step',onClick:t=>{var n;(n=e)&&o.U.show(n.名称,g,{realm:n})}},[(0,a.createElementVNode)('span',q,'能级 '+(0,a.toDisplayString)(e.能级),1),(0,a.createElementVNode)('span',K,(0,a.toDisplayString)(e.名称),1)],8,J))),128))])])])])],64)):(0,a.createCommentVNode)('v-if',!0)])])):((0,a.openBlock)(),(0,a.createElementBlock)('div',Q,'加载世界信息中...'))}}),X=(0,v.A)(Z,[['__scopeId','data-v-7a84edf6']])},667(e,t){t.A=(e,t)=>{const n=e.__vccOpts||e;for(const[e,a]of t)n[e]=a;return n}},423(t,n,a){t.exports=(e=>{var t={};return a.d(t,e),t})({default:()=>e.default})},61(e){e.exports=Vue},224(e){e.exports=_},632(e){e.exports=toastr},707(e){e.exports=z}},o={};function l(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={exports:{}};return a[e](n,n.exports,l),n.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};var r={};l.r(r),l.d(r,{f:()=>St});var s=l(61);const i=VueRouter,c={class:'main-layout'},d={class:'modal-content confirmation-modal'},m={class:'confirmation-title'},u={class:'confirmation-message'},p={class:'confirmation-buttons'},v={class:'modal-header'},g={class:'modal-title'},y={class:'modal-body'},f={class:'modal-content detail-modal'},h={class:'modal-header'},k={class:'modal-title'},E={class:'modal-body'},N={key:4,class:'modal-overlay input-modal-overlay'},S={class:'modal-content input-modal-content'},b={class:'input-area-container'},V={class:'input-area-with-buttons'},B={key:1,class:'command-queue-popup',style:{'background-color':'#0a0f1e',border:'1px solid #d4af37'}},w={class:'popup-header'},C={class:'popup-body'},D={key:0,class:'command-list'},L={key:1,class:'empty-queue'},M={key:0,class:'popup-footer'},x={class:'floating-cards-container'};var I=l(798);const T={class:'floating-card-wrapper'},A=(0,s.defineComponent)({__name:'FloatingCard',props:{card:{}},setup(e){const t=(0,s.ref)(!1),n=()=>{t.value=!t.value};return(a,o)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{class:(0,s.normalizeClass)(['floating-card-container',{zoomed:t.value}])},[t.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,class:'backdrop',onClick:o[0]||(o[0]=(0,s.withModifiers)(e=>t.value=!1,['stop']))})):(0,s.createCommentVNode)('v-if',!0),(0,s.createElementVNode)('div',T,[(0,s.createVNode)(I.A,{card:e.card,class:'the-card',onClick:n},null,8,['card'])])],2))}});var F=l(667);const j=(0,F.A)(A,[['__scopeId','data-v-161cd48e']]),O={class:'action-panel'},R={class:'button-container'},P=['disabled','onClick'],W=(0,s.defineComponent)({__name:'ActionPanel',props:{commandCount:{},options:{}},emits:['toggle-history','toggle-commands'],setup:e=>(t,n)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',O,[(0,s.createElementVNode)('div',R,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.options,e=>((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:e.id,class:'action-button',disabled:e.disabled&&e.disabled(),onClick:e.action},(0,s.toDisplayString)(e.text),9,P))),128)),(0,s.createElementVNode)('button',{class:'action-button',onClick:n[0]||(n[0]=e=>t.$emit('toggle-history'))},'历史'),(0,s.createElementVNode)('button',{class:'action-button',onClick:n[1]||(n[1]=e=>t.$emit('toggle-commands'))},'指令 ('+(0,s.toDisplayString)(e.commandCount)+')',1)])]))}),Y=(0,F.A)(W,[['__scopeId','data-v-06f56abf']]);const H=new class{commands=[];listeners=[];subscribe(e){this.listeners.push(e)}unsubscribe(e){this.listeners=this.listeners.filter(t=>t!==e)}notify(){this.listeners.forEach(e=>e([...this.commands]))}addCommand(e){this.commands.push(e),this.notify()}getCommands(){return[...this.commands]}clearCommands(){this.commands=[],this.notify()}},U='reincarnation_input_history_recent',G='reincarnation_input_history_saved';const J=new class{state=(0,s.reactive)({recent:[],saved:[]});constructor(){this.loadHistory()}loadHistory(){const e=localStorage.getItem(U),t=localStorage.getItem(G);e&&(this.state.recent=JSON.parse(e)),t&&(this.state.saved=JSON.parse(t))}saveHistory(){localStorage.setItem(U,JSON.stringify(this.state.recent)),localStorage.setItem(G,JSON.stringify(this.state.saved))}add(e){if(!e||''===e.trim())return;const t=this.state.recent.indexOf(e);t>-1&&this.state.recent.splice(t,1),this.state.recent.unshift(e),this.state.recent.length>5&&this.state.recent.pop(),this.saveHistory()}save(e){this.state.saved.includes(e)||(this.state.saved.unshift(e),this.state.saved.length>5&&this.state.saved.pop(),this.saveHistory())}deleteRecent(e){this.state.recent.splice(e,1),this.saveHistory()}deleteSaved(e){this.state.saved.splice(e,1),this.saveHistory()}clearAll(){this.state.recent=[],this.state.saved=[],this.saveHistory()}};var q=l(354);const K='reincarnation-simulator-input-value',Q='reincarnation-simulator-last-submitted',Z=(0,s.reactive)({isVisible:!1,inputValue:localStorage.getItem(K)||'',lastSubmittedValue:localStorage.getItem(Q)||''}),X={show(){q.M_.generationError&&(Z.inputValue=Z.lastSubmittedValue),Z.isVisible=!0},hide(){Z.isVisible=!1},setValue(e){Z.inputValue=e,localStorage.setItem(K,e)},setLastSubmittedValue(e){Z.lastSubmittedValue=e,localStorage.setItem(Q,e)},clearValue(){Z.inputValue='',localStorage.removeItem(K)}},ee=(0,s.readonly)(Z),te=X;var ne=l(393);const ae={class:'enhanced-input-box-container'},oe={class:'input-wrapper'},le=['value','placeholder','onKeypress'],re=(0,s.defineComponent)({__name:'EnhancedInputBox',props:{placeholder:{type:String,default:'请输入行动...'}},emits:['submit-action','toggle-history'],setup(e,{emit:t}){const n=t,a=(0,s.computed)(()=>ee.inputValue),o=(0,s.computed)(()=>H.getCommands()),l=e=>{const t=e.target;te.setValue(t.value)},r=()=>{const e=a.value.trim(),t=o.value.length>0;if(!e&&!t)return;e&&J.add(e);let l='';t&&(l+='[本轮行动指令]\n'+o.value.map(e=>`- ${e}`).join('\n')),e&&(t&&(l+='\n'),l+=`<行动选择>\n${e}\n</行动选择>`),ne.N.switchTo('NORMAL',!0),n('submit-action',l),H.clearCommands()};return(t,n)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',ae,[(0,s.createElementVNode)('div',oe,[(0,s.createElementVNode)('button',{class:'action-button activator',onClick:n[0]||(n[0]=e=>t.$emit('toggle-history'))},'历史'),(0,s.createElementVNode)('textarea',{value:a.value,onInput:l,placeholder:e.placeholder,onKeypress:(0,s.withKeys)((0,s.withModifiers)(r,['exact','prevent']),['enter'])},null,40,le),(0,s.createElementVNode)('button',{class:'action-button primary',onClick:r},'执行')])]))}}),se=(0,F.A)(re,[['__scopeId','data-v-ca7d1390']]),ie={class:'input-history-popup'},ce={class:'history-section'},de={key:0},me=['onClick'],ue={class:'actions'},pe=['onClick','disabled'],ve=['onClick'],ge={key:1,class:'empty-text'},ye={class:'history-section'},fe={key:0},he=['onClick'],ke={class:'actions'},Ee=['onClick'],Ne={key:1,class:'empty-text'},Se=(0,s.defineComponent)({__name:'InputHistoryPopup',emits:['select-entry','close'],setup(e,{emit:t}){const n=J.state,a=t,o=e=>{a('select-entry',e)},l=e=>n.saved.includes(e);return(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',ie,[(0,s.createElementVNode)('div',ce,[t[1]||(t[1]=(0,s.createElementVNode)('h4',null,'最近输入',-1)),(0,s.unref)(n).recent.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('ul',de,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(n).recent,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('li',{key:`recent-${t}`},[(0,s.createElementVNode)('span',{class:'entry-text',onClick:t=>o(e)},(0,s.toDisplayString)(e),9,me),(0,s.createElementVNode)('div',ue,[(0,s.createElementVNode)('button',{onClick:t=>(e=>{J.save(e)})(e),disabled:l(e)},'收藏',8,pe),(0,s.createElementVNode)('button',{onClick:e=>(e=>{J.deleteRecent(e)})(t)},'删除',8,ve)])]))),128))])):((0,s.openBlock)(),(0,s.createElementBlock)('p',ge,'暂无历史记录。'))]),(0,s.createElementVNode)('div',ye,[t[2]||(t[2]=(0,s.createElementVNode)('h4',null,'收藏内容',-1)),(0,s.unref)(n).saved.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('ul',fe,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(n).saved,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('li',{key:`saved-${t}`},[(0,s.createElementVNode)('span',{class:'entry-text',onClick:t=>o(e)},(0,s.toDisplayString)(e),9,he),(0,s.createElementVNode)('div',ke,[(0,s.createElementVNode)('button',{onClick:e=>(e=>{J.deleteSaved(e)})(t)},'取消收藏',8,Ee)])]))),128))])):((0,s.openBlock)(),(0,s.createElementBlock)('p',Ne,'暂无收藏内容。'))]),(0,s.createElementVNode)('button',{onClick:t[0]||(t[0]=t=>e.$emit('close')),class:'close-button-popup'},'关闭')]))}}),be=(0,F.A)(Se,[['__scopeId','data-v-1f596ce4']]);var Ve=l(711);const Be={class:'notification__content'},we={class:'notification__title'},Ce={class:'notification__message'},De=(0,s.defineComponent)({__name:'Notification',props:{notification:{}},setup(e){const t=e,n=()=>{Ve.l.hide(t.notification.id)};return(t,a)=>((0,s.openBlock)(),(0,s.createBlock)(s.Transition,{name:'notification-fade'},{default:(0,s.withCtx)(()=>[(0,s.createElementVNode)('div',{class:(0,s.normalizeClass)(['notification',`notification--${e.notification.type}`]),onClick:n},[(0,s.createElementVNode)('div',Be,[(0,s.createElementVNode)('h4',we,(0,s.toDisplayString)(e.notification.title),1),(0,s.createElementVNode)('p',Ce,(0,s.toDisplayString)(e.notification.message),1)]),a[0]||(a[0]=(0,s.createElementVNode)('div',{class:'notification__arrow'},null,-1))],2)]),_:1}))}}),_e={class:'notification-container'},Le=(0,s.defineComponent)({__name:'NotificationContainer',setup:e=>(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',_e,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(Ve.f).notifications,e=>((0,s.openBlock)(),(0,s.createBlock)(De,{key:e.id,notification:e},null,8,['notification']))),128))]))}),Me={class:'icon'},xe=(0,s.defineComponent)({__name:'SideMenuButton',props:{icon:{}},emits:['open'],setup(e,{emit:t}){const n=t,a=e=>{n('open',{x:e.clientX,y:e.clientY})};return(t,n)=>((0,s.openBlock)(),(0,s.createElementBlock)('button',{class:'side-menu-button',onClick:a},[(0,s.createElementVNode)('span',Me,(0,s.toDisplayString)(e.icon),1)]))}}),Ie=(0,F.A)(xe,[['__scopeId','data-v-fa6acc08']]);var Te=l(562),$e=l(407),ze=l(380),Ae=l(10),Fe=l(978),je=l(931);const Oe={class:'game-text-container'},Re=['onClick'],Pe=(0,s.defineComponent)({__name:'FormattedTextRenderer',props:{text:{type:String,required:!0}},setup(e){const t=e,n=(0,s.computed)(()=>{const e=$e.n.allNpcs.value.map(e=>Array.isArray(e.姓名)?e.姓名[0]:e.姓名).filter(Boolean);if(0===e.length)return null;const t=e.map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'));return new RegExp(`(${t.join('|')})`,'g')}),a=(0,s.computed)(()=>{const e=Array.from($e.n.locationCache.values()).map(e=>e.name);if(0===e.length)return null;const t=e.map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'));return new RegExp(`(${t.join('|')})`,'g')}),o=(0,s.computed)(()=>'mainWorld'===q.M_.activeView?Te.mainWorld.value:Te.avatarWorld.value),l=(0,s.computed)(()=>{const e=o.value?.数据库;if(!e)return null;const t=[];for(const n in e){if('$meta'===n)continue;const a=e[n];if(a)for(const e in a){if('$meta'===e)continue;const n=a[e];n&&n.名称&&t.push(n.名称)}}if(0===t.length)return null;const n=t.map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'));return new RegExp(`(${n.join('|')})`,'g')}),r=(0,s.computed)(()=>{if(!t.text)return[];return function(e){const t=[],n=/(【【.*?】】)|(【.*?】)|(「.*?」)|(\*.*?\*)/g;let a,o=0;for(;null!==(a=n.exec(e));){a.index>o&&t.push(...i(e.substring(o,a.index)));const n=a[0];let l='',r='';a[1]?(l=n.slice(2,-2),r='text-system-highlight'):a[2]?(l=n.slice(1,-1),r='text-scenery'):a[3]?(l=n.slice(1,-1),r='text-dialogue'):a[4]&&(l=n.slice(1,-1),r='text-psychology');i(l).forEach(e=>{const n=Array.isArray(e.class)?[r,...e.class]:[r,e.class].filter(Boolean);t.push({...e,class:n})}),o=a.index+n.length}o<e.length&&t.push(...i(e.substring(o)));return t}(t.text.replace(/<[^>]*>/g,''))});function i(e){const t=[],o=[];if(n.value&&o.push(n.value.source),a.value&&o.push(a.value.source),l.value&&o.push(l.value.source),0===o.length)return[{text:e,class:''}];const r=new RegExp(o.join('|'),'g');let s,i=0;for(;null!==(s=r.exec(e));){s.index>i&&t.push({text:e.substring(i,s.index),class:''});const n=s[0],a=$e.n.allNpcs.value.find(e=>(Array.isArray(e.姓名)?e.姓名[0]:e.姓名)===n),o=[...$e.n.locationCache.entries()].find(([e,t])=>t.name===n)?.[0],l=c(n);if(a){const e=d(a);t.push({text:n,class:['npc-name',e],npc:a})}else o?t.push({text:n,class:'location-name',locationId:o}):l?t.push({text:n,class:'database-item-name',item:l}):t.push({text:n,class:''});i=s.index+n.length}return i<e.length&&t.push({text:e.substring(i),class:''}),t}function c(e){const t=o.value?.数据库;if(!t)return null;for(const n in t){if('$meta'===n)continue;const a=t[n];if(a)for(const t in a){if('$meta'===t)continue;const n=a[t];if(n&&n.名称===e)return n}}return null}function d(e){const t=$e.n.getNpcId(e),n=o.value?.因果之网;if(!t||!n||!n[t]?.['本体'])return'npc-unknown';const a=n[t]['本体'],l=(a.情感层?.亲近感||0)+(a.情感层?.仰慕度||0);return l<=-150?'npc-hostile-intense':l<=-50?'npc-hostile':l<0?'npc-unfriendly':l<50?'npc-neutral':l<100?'npc-friendly':l<150?'npc-devoted':'npc-fanatical'}return(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',Oe,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.value,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('span',{key:t,class:(0,s.normalizeClass)(e.class),onClick:t=>{return e.npc?(e=>{if(!e)return;const t=$e.n.getNpcId(e),n=Array.isArray(e.姓名)?e.姓名[0]:e.姓名;ze.U.show(n,Ae.A,{npc:e,npcId:t})})(e.npc):e.locationId?(e=>{if(!e)return;const t=$e.n.getLocationName(e);ze.U.show(t,Fe.A,{locationId:e})})(e.locationId):e.item?void((n=e.item)&&ze.U.show(n.名称,je.A,{item:n})):null;var n}},(0,s.toDisplayString)(e.text),11,Re))),128))]))}}),We=(0,F.A)(Pe,[['__scopeId','data-v-316766ee']]),Ye={class:'main-content-wrapper',ref:'mainContentWrapper'},He=(0,s.defineComponent)({__name:'MainView',setup:e=>(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',Ye,[(0,s.createVNode)(We,{text:(0,s.unref)(Te.IL)},null,8,['text'])],512))}),Ue={class:'timeline-panel'},Ge={class:'calendar-header'},Je={class:'panel-title'},qe={key:0,class:'calendar-grid'},Ke=['onClick'],Qe={class:'day-number'},Ze={class:'events-container'},Xe={key:0,class:'event-marker'},et={key:1,class:'event-marker festival-marker'},tt={class:'details-content'},nt={key:0,class:'day-details'},at={key:0,class:'detail-section'},ot={key:1,class:'detail-section'},lt={class:'stage-summary'},rt={key:1,class:'no-selection-message'};var st=l(479);const it={class:'storyline-stage-detail'},ct={key:0,class:'detail-block'},dt={key:1,class:'detail-block'},mt={key:2,class:'detail-block'},ut={key:3,class:'detail-block'},pt={key:4,class:'detail-block'},vt={class:'key-points-list'};const gt=(0,s.defineComponent)({name:'StorylineStageDetail',props:{stage:{type:Object,required:!0}}}),yt=(0,F.A)(gt,[['render',function(e,t,n,a,o,l){return(0,s.openBlock)(),(0,s.createElementBlock)('div',it,[e.stage.阶段背景&&e.stage.阶段背景.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('div',ct,[t[0]||(t[0]=(0,s.createElementVNode)('strong',null,'阶段背景',-1)),(0,s.createElementVNode)('p',null,(0,s.toDisplayString)(e.stage.阶段背景.join(' ')),1)])):(0,s.createCommentVNode)('v-if',!0),e.stage.key_characters||e.stage.关键人物?((0,s.openBlock)(),(0,s.createElementBlock)('div',dt,[t[1]||(t[1]=(0,s.createElementVNode)('strong',null,'关键人物',-1)),(0,s.createElementVNode)('p',null,(0,s.toDisplayString)((e.stage.key_characters||e.stage.关键人物)?.join(', ')),1)])):(0,s.createCommentVNode)('v-if',!0),e.stage.key_locations||e.stage.关键地点?((0,s.openBlock)(),(0,s.createElementBlock)('div',mt,[t[2]||(t[2]=(0,s.createElementVNode)('strong',null,'关键地点',-1)),(0,s.createElementVNode)('p',null,(0,s.toDisplayString)((e.stage.key_locations||e.stage.关键地点)?.join(', ')),1)])):(0,s.createCommentVNode)('v-if',!0),e.stage.key_items||e.stage.关键道具?((0,s.openBlock)(),(0,s.createElementBlock)('div',ut,[t[3]||(t[3]=(0,s.createElementVNode)('strong',null,'关键道具',-1)),(0,s.createElementVNode)('p',null,(0,s.toDisplayString)((e.stage.key_items||e.stage.关键道具)?.join(', ')),1)])):(0,s.createCommentVNode)('v-if',!0),e.stage.关键情节&&e.stage.关键情节.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('div',pt,[t[4]||(t[4]=(0,s.createElementVNode)('strong',null,'关键情节',-1)),(0,s.createElementVNode)('ul',vt,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.stage.关键情节,e=>((0,s.openBlock)(),(0,s.createElementBlock)('li',{key:e.id},(0,s.toDisplayString)(e.描述),1))),128))])])):(0,s.createCommentVNode)('v-if',!0)])}]]),ft=(0,s.defineComponent)({name:'TimelinePanel',components:{StorylineStageDetail:yt},setup(){const e=(0,s.ref)([]),t=(0,s.ref)({}),n=(0,s.ref)(new Date),a=(0,s.ref)(null),o=(0,s.ref)(!1),l=(0,s.computed)(()=>n.value.getFullYear()),r=(0,s.computed)(()=>n.value.getMonth()),i=(0,s.computed)(()=>{const n=[],a=l.value,o=r.value,s=new Date(a,o,1),i=new Date(a,o+1,0),c=s.getDay(),d=i.getDate(),m=new Date(a,o,0).getDate();for(let e=c-1;e>=0;e--){const t=m-e,l=new Date(a,o-1,t);n.push({date:l.toLocaleDateString('sv'),day:t,isCurrentMonth:!1,events:[]})}for(let l=1;l<=d;l++){const r=new Date(a,o,l).toLocaleDateString('sv'),s=e.value.filter(e=>e.trigger_time?.date===r),i=`${String(o+1).padStart(2,'0')}-${String(l).padStart(2,'0')}`;n.push({date:r,day:l,isCurrentMonth:!0,events:s,fixedEvents:t.value[i]})}const u=6-i.getDay();for(let e=1;e<=u;e++){const t=new Date(a,o+1,e);n.push({date:t.toLocaleDateString('sv'),day:e,isCurrentMonth:!1,events:[]})}return n}),c=async()=>{if(q.M_.worldState){const a=await st.z.getAllTimelineStages(q.M_.worldState);e.value=a,t.value=await st.z.getFixedEvents();const o=a.filter(e=>'future'===e.status||'current'===e.status);if(o.length>0&&o[0].trigger_time?.date&&'N/A'!==o[0].trigger_time.date){const e=new Date(o[0].trigger_time.date.replace(/-/g,'/'));n.value=new Date(e.getFullYear(),e.getMonth(),1)}else if(q.M_.worldState.世界状态.时间.日期){const[e,t,a]=q.M_.worldState.世界状态.时间.日期.split('-').map(Number);n.value=new Date(e,t-1,a)}console.log('TimelinePanel refreshed:',e.value)}};return(0,s.onMounted)(c),(0,s.watch)(()=>q.M_.worldState?.叙事记录?.历史事件,(e,t)=>{e&&t&&e.length!==t.length&&(console.log('History changed, refreshing timeline...'),c())},{deep:!0}),(0,s.watch)(()=>q.M_.worldState,e=>{e&&(console.log('worldState became available, refreshing timeline...'),c())}),{storylines:e,refresh:c,currentYear:l,currentMonth:r,calendarDays:i,weekDays:['周日','周一','周二','周三','周四','周五','周六'],prevMonth:()=>{n.value=new Date(n.value.setMonth(n.value.getMonth()-1))},nextMonth:()=>{n.value=new Date(n.value.setMonth(n.value.getMonth()+1))},selectedDay:a,selectDay:e=>{a.value=e,(e.events.length>0||e.fixedEvents)&&(o.value=!0)},isDrawerOpen:o,toggleDrawer:()=>{o.value=!o.value}}}}),ht=(0,F.A)(ft,[['render',function(e,t,n,a,o,l){const r=(0,s.resolveComponent)('StorylineStageDetail');return(0,s.openBlock)(),(0,s.createElementBlock)('div',Ue,[(0,s.createElementVNode)('div',Ge,[(0,s.createElementVNode)('button',{onClick:t[0]||(t[0]=(...t)=>e.prevMonth&&e.prevMonth(...t))},'<'),(0,s.createElementVNode)('h2',Je,(0,s.toDisplayString)(e.currentYear)+'年 '+(0,s.toDisplayString)(e.currentMonth+1)+'月',1),(0,s.createElementVNode)('button',{onClick:t[1]||(t[1]=(...t)=>e.nextMonth&&e.nextMonth(...t))},'>')]),e.storylines.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('div',qe,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.weekDays,e=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:e,class:'day-header'},(0,s.toDisplayString)(e),1))),128)),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.calendarDays,t=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:t.date,class:(0,s.normalizeClass)(['day-cell',{'other-month':!t.isCurrentMonth,selected:e.selectedDay?.date===t.date}]),onClick:n=>e.selectDay(t)},[(0,s.createElementVNode)('div',Qe,(0,s.toDisplayString)(t.day),1),(0,s.createElementVNode)('div',Ze,[t.events.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('div',Xe)):(0,s.createCommentVNode)('v-if',!0),t.fixedEvents?((0,s.openBlock)(),(0,s.createElementBlock)('div',et)):(0,s.createCommentVNode)('v-if',!0)])],10,Ke))),128))])):(0,s.createCommentVNode)('v-if',!0),(0,s.createElementVNode)('div',{class:(0,s.normalizeClass)(['details-drawer',{'is-open':e.isDrawerOpen}])},[(0,s.createElementVNode)('div',{class:'drawer-handle',onClick:t[2]||(t[2]=(...t)=>e.toggleDrawer&&e.toggleDrawer(...t))}),(0,s.createElementVNode)('div',tt,[e.selectedDay&&(e.selectedDay.events.length>0||e.selectedDay.fixedEvents)?((0,s.openBlock)(),(0,s.createElementBlock)('div',nt,[e.selectedDay.fixedEvents?((0,s.openBlock)(),(0,s.createElementBlock)('div',at,[t[3]||(t[3]=(0,s.createElementVNode)('h4',null,'本日节日',-1)),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.selectedDay.fixedEvents,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('p',{key:`fixed-${t}`},(0,s.toDisplayString)(e),1))),128))])):(0,s.createCommentVNode)('v-if',!0),e.selectedDay.events.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('div',ot,[t[4]||(t[4]=(0,s.createElementVNode)('h4',null,'本日主线',-1)),(0,s.createElementVNode)('p',lt,(0,s.toDisplayString)(e.selectedDay.events[0].阶段摘要||e.selectedDay.events[0].summary||'无摘要'),1),(0,s.createVNode)(r,{stage:e.selectedDay.events[0]},null,8,['stage'])])):(0,s.createCommentVNode)('v-if',!0)])):((0,s.openBlock)(),(0,s.createElementBlock)('div',rt,[...t[5]||(t[5]=[(0,s.createElementVNode)('p',null,'点击包含事件的日期查看详情',-1)])]))])],2)])}]]),kt={world:{inventory:{component:(0,s.defineAsyncComponent)(()=>Promise.resolve().then(l.bind(l,587))),title:'背包'},skills:{component:(0,s.defineAsyncComponent)(()=>Promise.resolve().then(l.bind(l,640))),title:'技能'},worldDetails:{component:(0,s.defineAsyncComponent)(()=>Promise.resolve().then(l.bind(l,914))),title:'世界设定'},destiny:{component:(0,s.defineAsyncComponent)(()=>Promise.resolve().then(l.bind(l,248))),title:'命运卡牌'}},system:{npcDirectory:{component:(0,s.defineAsyncComponent)(()=>Promise.resolve().then(l.bind(l,753))),title:'众生名录'},saveLoad:{component:(0,s.defineAsyncComponent)(()=>Promise.resolve().then(l.bind(l,344))),title:'系统'},debug:{component:(0,s.defineAsyncComponent)(()=>Promise.resolve().then(l.bind(l,269))),title:'调试面板'},review:{component:(0,s.defineAsyncComponent)(()=>Promise.resolve().then(l.bind(l,326))),title:'回顾'}}};var Et=l(691);const Nt=new class{goldenLayout=null;hostElement=null;componentMap=new Map;onAction=null;initialize(e){if(!this.goldenLayout&&e){this.hostElement=e,this.goldenLayout=new t(this.hostElement),this.registerComponent('main-view',He),this.registerComponent('timeline-panel',ht);for(const e in kt)for(const t in kt[e]){const n=`${e}-${t}`.toLowerCase(),a=kt[e][t];this.registerComponent(n,a.component)}window.addEventListener('resize',()=>this.updateLayout())}}loadLayout(e){if(this.goldenLayout)try{this.goldenLayout.loadLayout(e)}catch(e){console.error('Failed to load layout:',e);try{this.goldenLayout.loadLayout(this.getDefaultLayout())}catch(e){console.error('Failed to load default layout on fallback:',e)}}}loadSavedLayout(){this.goldenLayout&&this.goldenLayout.loadLayout(this.getDefaultLayout())}registerComponent(e,t){this.componentMap.has(e)||(this.componentMap.set(e,t),this.goldenLayout?.registerComponent(e,(e,n)=>{const a=(0,s.defineComponent)({setup:()=>()=>(0,s.h)(t,n?.props||{})}),o=(0,s.h)(a);(0,s.render)(o,e.getElement()),n?.title&&e.setTitle(n.title),e.on('destroy',()=>{const e=n?.panelId;e&&Et.B.emit('panelClosed',e)})}))}openPanel(e,t,n,a={}){if(!this.goldenLayout)return void console.error('Golden Layout not initialized.');this.componentMap.get(n)?this.goldenLayout.addComponent(n,{title:t,props:a,panelId:e},e):console.error(`Component "${n}" is not registered.`)}updateLayout(){this.goldenLayout&&this.hostElement&&this.goldenLayout.updateSize(this.hostElement.clientWidth,this.hostElement.clientHeight)}closeAllPanels(){if(!this.goldenLayout?.rootItem)return;this.goldenLayout.rootItem.contentItems.filter(e=>e.isClosable).forEach(e=>{try{e.remove()}catch(t){console.error('Failed to remove panel item:',e,t)}})}destroy(){this.goldenLayout&&(this.goldenLayout.destroy(),this.goldenLayout=null),this.componentMap.clear(),window.removeEventListener('resize',()=>{})}unpinAllPanels(){this.goldenLayout&&this.goldenLayout.loadLayout(this.getDefaultLayout())}getDefaultLayout(){return{root:{type:'row',content:[{type:'component',componentType:'main-view',title:'主视图',isClosable:!1}]}}}getFullscreenLayout(){return{root:{type:'row',content:[{type:'component',componentType:'main-view',title:'主视图',isClosable:!1,width:100}]}}}};function St(){return{openPanel:(e,t,n={})=>{const a=kt[e]?.[t];if(a){const o=`${e}-${t}-${n.id||''}`.toLowerCase(),l=`${e}-${t}`.toLowerCase();Nt.registerComponent(l,a.component),Nt.openPanel(o,a.title,l,n),Et.B.emit('panelOpened',{category:e,panel:t,props:n,panelId:o})}else console.warn(`[PanelManager] Panel not found for category: ${e}, panel: ${t}`)}}}const bt=(0,s.defineComponent)({__name:'DockManager',setup(e){const t=(0,s.ref)(null);return(0,s.onMounted)(()=>{if(t.value){Nt.initialize(t.value);for(const e in r.panelRegistry)for(const t in r.panelRegistry[e]){const n=r.panelRegistry[e][t],a=`${e}-${t}`;Nt.registerComponent(a,n.component)}Nt.registerComponent('main-view',He),Nt.loadSavedLayout()}}),(0,s.onBeforeUnmount)(()=>{Nt.destroy()}),(e,n)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{ref_key:'dockHost',ref:t,class:'dock-manager-host'},null,512))}}),Vt={class:'loading-overlay'},Bt={class:'loading-content'},wt={key:0,class:'error-container'},Ct={class:'error-message'},Dt={key:1},_t={class:'tip'},Lt={class:'progress-bar-container'},Mt=(0,s.defineComponent)({__name:'LoadingIndicator',props:{error:{}},setup(e){const t=e,n=['正在确认二次元通道的链接稳定性...','雪之下雪乃正在暗中观察一只流浪猫。','由比滨结衣正在尝试制作某种形状不可名状的曲奇。','一色彩羽正在寻找可以帮忙搬运学生会杂物的“老好人学长”。','平冢静老师的相亲似乎又失败了，正在拉面店独自喝着闷酒。','比企谷八幡正在自动贩卖机前犹豫，今天要不要再来一罐MAX咖啡。','户塚彩加正在网球部被过度友好的男同学们包围着。','霞之丘诗羽学姐正在取材，请注意不要成为她下一本小说里的反派。','英梨梨的截稿日似乎又要到了，美术室里传来了悲鸣。','一个粉色头发的社恐吉他手正躲在楼梯拐角的纸箱里。','学生会长白银御行因睡眠不足，眼神变得更加凶恶了。','藤原书记又发明了新的桌游，学生会室充满了混沌的气息。'],a=(0,s.ref)(''),o=(0,s.ref)(0);let l=null;function r(){l&&(clearInterval(l),l=null)}return(0,s.onMounted)(()=>{t.error||(a.value=n[Math.floor(Math.random()*n.length)],o.value=0,l=window.setInterval(()=>{o.value<99?o.value+=1:r()},9e4/99))}),(0,s.onUnmounted)(()=>{r()}),(0,s.watch)(()=>t.error,e=>{e&&r()}),(t,n)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',Vt,[(0,s.createElementVNode)('div',Bt,[e.error?((0,s.openBlock)(),(0,s.createElementBlock)('div',wt,[n[0]||(n[0]=(0,s.createElementVNode)('h3',{class:'error-title'},'次元紊乱',-1)),(0,s.createElementVNode)('p',Ct,(0,s.toDisplayString)(e.error),1),n[1]||(n[1]=(0,s.createElementVNode)('p',{class:'error-tip'},'请检查网络连接或稍后再试。',-1))])):((0,s.openBlock)(),(0,s.createElementBlock)('div',Dt,[(0,s.createElementVNode)('p',_t,(0,s.toDisplayString)(a.value),1),(0,s.createElementVNode)('div',Lt,[(0,s.createElementVNode)('div',{class:'progress-bar',style:(0,s.normalizeStyle)({width:o.value+'%'})},null,4)]),n[2]||(n[2]=(0,s.createElementVNode)('span',{class:'progress-text'},'思考中...',-1))]))])]))}}),xt=(0,F.A)(Mt,[['__scopeId','data-v-2f88c8df']]),It={class:'npc-list-modal-content'},Tt={key:0,class:'npc-list-container'},$t={class:'npc-list'},zt={class:'npc-header'},At={class:'npc-name'},Ft={class:'npc-identity'},jt={class:'npc-description'},Ot={key:1,class:'no-npcs'},Rt=(0,s.defineComponent)({__name:'NpcListModal',props:{worldId:{}},setup(e){const t=e,n=(0,s.computed)(()=>$e.n.getNpcsByWorld(t.worldId));return(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',It,[n.value.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('div',Tt,[(0,s.createElementVNode)('ul',$t,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.value,e=>((0,s.openBlock)(),(0,s.createElementBlock)('li',{key:e.姓名[0],class:'npc-item'},[(0,s.createElementVNode)('div',zt,[(0,s.createElementVNode)('span',At,(0,s.toDisplayString)(e.姓名[0]),1),(0,s.createElementVNode)('span',Ft,(0,s.toDisplayString)(e.身份.join(', ')),1)]),(0,s.createElementVNode)('p',jt,(0,s.toDisplayString)(e.外观描述),1)]))),128))])])):((0,s.openBlock)(),(0,s.createElementBlock)('div',Ot,[...t[0]||(t[0]=[(0,s.createElementVNode)('p',null,'当前世界没有可供探查的NPC信息。',-1)])]))]))}}),Pt=(0,F.A)(Rt,[['__scopeId','data-v-b20458ac']]),Wt={class:'smartphone-shell'},Yt={class:'smartphone-screen'},Ht={class:'status-bar'},Ut={class:'time'},Gt={class:'battery-status'},Jt={class:'navigation-bar'};const qt={class:'attribute-display'},Kt={class:'attribute-header'},Qt={class:'attribute-name'},Zt={class:'attribute-level'},Xt={class:'xp-bar'},en={class:'attribute-details'},tn=(0,s.defineComponent)({__name:'AttributeDisplay',props:{name:{},value:{}},setup(e){const t=e,n={F:100,E:200,D:300,C:400,B:500,A:600,S:800,SS:1e3,SSS:1/0},a=(0,s.computed)(()=>n[t.value.等级]||100),o=(0,s.computed)(()=>0===a.value?0:Math.min(t.value.经验值/a.value*100,100));return(t,n)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',qt,[(0,s.createElementVNode)('div',Kt,[(0,s.createElementVNode)('span',Qt,(0,s.toDisplayString)(e.name),1),(0,s.createElementVNode)('span',Zt,(0,s.toDisplayString)(e.value.等级),1)]),(0,s.createElementVNode)('div',Xt,[(0,s.createElementVNode)('div',{class:'xp-bar-fill',style:(0,s.normalizeStyle)({width:o.value+'%'})},null,4)]),(0,s.createElementVNode)('div',en,[(0,s.createElementVNode)('span',null,'修正: '+(0,s.toDisplayString)(e.value.修正值>=0?'+':'')+(0,s.toDisplayString)(e.value.修正值),1),(0,s.createElementVNode)('span',null,'XP: '+(0,s.toDisplayString)(e.value.经验值)+' / '+(0,s.toDisplayString)(a.value),1)])]))}}),nn=(0,F.A)(tn,[['__scopeId','data-v-4be36c02']]);var an=l(707);const on={亲密度:[{name:'宿敌',threshold:-1/0},{name:'敌视',threshold:-500},{name:'嫌恶',threshold:-250},{name:'警惕',threshold:-100},{name:'生疏',threshold:-20},{name:'熟人',threshold:20},{name:'友人',threshold:150},{name:'挚友',threshold:400},{name:'恋人',threshold:700},{name:'挚爱',threshold:850},{name:'融合',threshold:1e3}],支配度:[{name:'反抗',threshold:-1/0},{name:'不屑',threshold:-100},{name:'无视',threshold:-60},{name:'平等',threshold:-30},{name:'顺从',threshold:40},{name:'信赖',threshold:150},{name:'崇拜',threshold:200},{name:'盲从',threshold:300},{name:'支配',threshold:400},{name:'奴役',threshold:500},{name:'刻印',threshold:700},{name:'傀儡',threshold:800}],信赖度:[{name:'背叛者',threshold:-1/0},{name:'不信',threshold:-500},{name:'猜忌',threshold:-250},{name:'怀疑',threshold:-100},{name:'中立',threshold:-20},{name:'认可',threshold:140},{name:'可靠',threshold:400},{name:'共犯',threshold:550},{name:'托付后背',threshold:700},{name:'绝对信赖',threshold:900},{name:'灵魂同步',threshold:1e3}]},ln=[{name:'崩溃',threshold:0,描述:'精神完全崩溃，行为极端且不可预测，所有检定有极高的失败率或出现意外的反效果。'},{name:'紊乱',threshold:25,描述:'精神高度不稳定，难以集中，时常做出非理性判断，所有检定受到显著的负面影响。'},{name:'承压',threshold:50,描述:'感到疲惫和压力，专注力下降，部分检定（尤其是社交和精神类）会受到轻微的负面影响。'},{name:'稳定',threshold:75,描述:'精神状态良好，能够理性思考和行动。'},{name:'高昂',threshold:90,描述:'精神振奋，充满自信，部分检定（尤其是行动力和魅力类）可能获得轻微的正面加成。'}],rn=[{等级:'F',修正值:-5,升级经验:100},{等级:'E',修正值:-3,升级经验:200},{等级:'D',修正值:-1,升级经验:300},{等级:'C',修正值:0,升级经验:400},{等级:'B',修正值:2,升级经验:500},{等级:'A',修正值:5,升级经验:600},{等级:'S',修正值:10,升级经验:800},{等级:'SS',修正值:15,升级经验:1e3},{等级:'SSS',修正值:20,升级经验:1/0}],sn=an.z.enum(['F','E','D','C','B','A','S','SS','SSS']),cn=(e,t)=>{let n=t[0];for(const a of t){if(!(e>=a.threshold))break;n=a}return n.name},dn=an.z.object({数值:an.z.object({亲密度:an.z.coerce.number().default(0),支配度:an.z.coerce.number().default(0),信赖度:an.z.coerce.number().default(0)}).default({亲密度:0,支配度:0,信赖度:0}),阶段:an.z.object({亲密度:an.z.string().default('生疏'),支配度:an.z.string().default('平等'),信赖度:an.z.string().default('中立')}).default({亲密度:'生疏',支配度:'平等',信赖度:'中立'}),最近互动:an.z.string().default('无'),动作冷却池:an.z.record(an.z.string().describe('动作ID'),an.z.string().regex(/^\d{4}-\d{2}-\d{2}$/).describe('YYYY-MM-DD 格式的日期')).optional().default({})}).default({数值:{亲密度:0,支配度:0,信赖度:0},阶段:{亲密度:'生疏',支配度:'平等',信赖度:'中立'},最近互动:'无',动作冷却池:{}}).transform(e=>(e.阶段.亲密度=cn(e.数值.亲密度,on.亲密度),e.阶段.支配度=cn(e.数值.支配度,on.支配度),e.阶段.信赖度=cn(e.数值.信赖度,on.信赖度),e)),mn=an.z.object({ID:an.z.string().default(()=>`card_${(new Date).getTime()}`),类型:an.z.enum(['任务卡','角色卡','物品卡','事件卡','命运卡','属性卡','技能卡','灾难卡','纪念卡']),等级:sn.default('F'),名称:an.z.string().default('未命名卡牌'),介绍:an.z.string().default(''),卡面:an.z.string().url().or(an.z.literal('')).default(''),效果:an.z.string().default('无')}),un=an.z.object({类型:an.z.enum(['被动技能','主动技能']),等级:sn.default('F'),介绍:an.z.string().default(''),经验值:an.z.coerce.number().default(0),修正值:an.z.coerce.number().default(0),效果:an.z.discriminatedUnion('类型',[an.z.object({类型:an.z.literal('数值'),目标属性:an.z.string(),计算方式:an.z.enum(['加','减','乘','除']),值:an.z.coerce.number(),概率:an.z.coerce.number().transform(e=>Math.max(0,Math.min(e,100))).default(100)}),an.z.object({类型:an.z.literal('文本'),描述:an.z.string()})])}),pn=an.z.object({等级:sn.default('C'),经验值:an.z.coerce.number().default(0),修正值:an.z.coerce.number().default(0)}).transform(e=>{const t=rn.find(t=>t.等级===e.等级);if(t&&(e.修正值=t.修正值,e.经验值>=t.升级经验&&t.升级经验!==1/0)){const n=rn.findIndex(t=>t.等级===e.等级)+1;if(n<rn.length){const a=rn[n];e.等级=a.等级,e.经验值-=t.升级经验,e.修正值=a.修正值}}return e}),vn=an.z.object({标识符:an.z.string().describe('一句话概括角色的核心人格'),行为逻辑:an.z.object({公开模式:an.z.string().describe('在通常社交场合下的行为总纲'),私密模式:an.z.array(an.z.object({对象:an.z.string().describe('特定角色ID或‘玩家’'),模式描述:an.z.string().describe('面对该特定对象时的特殊行为模式')})).optional()}),行为剖面:an.z.array(an.z.object({情境:an.z.string().describe('触发该行为模式的具体情境'),行为模式:an.z.string().describe('在该情境下会展现出的具体行为'),动机解释:an.z.string().describe('该行为背后的深层心理动机')})),对话风格:an.z.object({常用语:an.z.array(an.z.string()),口头禅:an.z.string().optional(),禁忌词:an.z.array(an.z.string()).optional()})}),gn=an.z.object({对特定角色的初始立场:an.z.record(an.z.string().describe('角色ID'),an.z.string().describe('对该角色的初始看法和态度')).optional(),对玩家的行为倾向:an.z.array(an.z.object({触发条件:an.z.string().describe('描述触发新行为模式的条件'),新行为模式:an.z.string().describe('解锁的新行为模式名称'),动机解释:an.z.string().describe('该转变背后的动机')})).optional()}),yn=an.z.object({名称:an.z.string().default('无名氏'),身份:an.z.array(an.z.object({组织:an.z.string(),职位:an.z.string()})).default([]),个人信息:an.z.object({出生日期:an.z.coerce.date().optional(),年龄:an.z.coerce.number().default(17),容貌:an.z.string().default('未描述'),身材:an.z.string().default('未描述'),衣着:an.z.string().default('未描述'),性别:an.z.enum(['男','女','其他']).default('男')}).default({年龄:17,容貌:'未描述',身材:'未描述',衣着:'未描述',性别:'男'}),属性:an.z.record(an.z.enum(['沟通','观察','行动力','精神力','知识','魅力']),pn).optional(),技能:an.z.record(an.z.string(),un).optional(),物品栏:an.z.record(an.z.string(),an.z.object({数量:an.z.coerce.number().default(1)})).optional(),当前状态:an.z.array(an.z.object({名称:an.z.string(),效果:an.z.string(),持续到:an.z.object({日期:an.z.string(),片段:an.z.string()}).nullable(),来源:an.z.string()})).default([]),位置:an.z.string().default('未知'),卡牌背包:an.z.array(mn).optional()}),fn=yn.extend({}),hn=yn.extend({内在世界:an.z.object({心理健康:an.z.coerce.number().transform(e=>Math.max(0,Math.min(e,100))).default(80),心理状态:an.z.string().default('稳定'),核心动机:an.z.record(an.z.enum(['生存','享乐','权力','关系','意义']),an.z.coerce.number()).default({关系:50,意义:30,生存:10,享乐:10,权力:10}),恐惧创伤:an.z.array(an.z.object({触发源:an.z.string(),应激反应:an.z.string()})).default([]),NSFW:an.z.object({phys:an.z.coerce.number().min(0).max(6).default(0).describe('身体演化等级'),mind:an.z.coerce.number().min(0).max(5).default(0).describe('精神演化等级')}).default({phys:0,mind:0})}).default({心理健康:80,心理状态:'稳定',核心动机:{关系:50,意义:30,生存:10,享乐:10,权力:10},恐惧创伤:[],NSFW:{phys:0,mind:0}}).transform(e=>(e.心理健康&&(e.心理状态=cn(e.心理健康,ln)),e)),人格内核:vn,关系动态:gn,记忆:an.z.array(an.z.object({时间:an.z.coerce.date(),事件摘要:an.z.string(),情感标签:an.z.enum(['喜悦','悲伤','愤怒','恐惧','屈辱','满足']),影响:an.z.string()})).default([])}),kn=an.z.object({特质名称:an.z.string(),描述:an.z.string(),效果:an.z.string(),触发条件:an.z.object({时间片段:an.z.array(an.z.string()).optional(),天气:an.z.array(an.z.string()).optional(),角色在场:an.z.array(an.z.string()).optional(),委托状态:an.z.enum(['有','无']).optional()}).optional()}),En=an.z.object({名称:an.z.string(),层级类型:an.z.enum(['城市','区域','建筑群','建筑','房间','地标']),所属:an.z.object({ID:an.z.string()}).nullable(),描述:an.z.string(),场景特质:an.z.array(kn).optional(),包含物品:an.z.array(an.z.string()).optional()}),Nn=(an.z.object({世界状态:an.z.object({时间:an.z.object({日期:an.z.string().regex(/^\d{4}-\d{2}-\d{2}$/).default('2012-04-08'),当前片段:an.z.enum(['早晨','上学路','午前','午休','午后','放学后','傍晚','夜']).default('早晨'),星期:an.z.enum(['日','一','二','三','四','五','六']).default('日')}).default({日期:'2012-04-08',当前片段:'早晨',星期:'日'}),行动点:an.z.object({当前:an.z.coerce.number().default(2),上限:an.z.coerce.number().default(2)}).default({当前:2,上限:2}),状态:an.z.string().default('日常的世界'),天气:an.z.enum(['晴天','多云','阴天','小雨','大雨','雷阵雨','雪','大风','雾']).default('晴天'),未来天气:an.z.enum(['晴天','多云','阴天','小雨','大雨','雷阵雨','雪','大风','雾']).default('晴天'),章节:an.z.object({所属作品:an.z.string().default('我的青春恋爱物语果然有问题'),册:an.z.coerce.number().default(1),章:an.z.coerce.number().default(1),标题:an.z.string().default('侍奉部的诞生')}).default({所属作品:'我的青春恋爱物语果然有问题',册:1,章:1,标题:'侍奉部的诞生'})}).default({时间:{日期:'2012-04-08',当前片段:'早晨',星期:'日'},行动点:{当前:2,上限:2},状态:'日常的世界',天气:'晴天',未来天气:'晴天',章节:{所属作品:'我的青春恋爱物语果然有问题',册:1,章:1,标题:'侍奉部的诞生'}}),主角:fn.or(an.z.literal('待初始化')).default('待初始化'),地点:an.z.record(an.z.string(),En).optional(),角色列表:an.z.record(an.z.string(),hn.or(an.z.literal('待初始化'))).default({}),关系:an.z.record(an.z.string(),an.z.record(an.z.string(),dn)).default({}),命运卡牌系统:an.z.object({下次抽卡时间:an.z.object({日期:an.z.string().regex(/^\d{4}-\d{2}-\d{2}$/).default('2013-04-08'),片段:an.z.enum(['早晨','上学路','午前','午休','午后','放学后','傍晚','夜']).default('上学路')}).default({日期:'2013-04-08',片段:'上学路'})}).default({下次抽卡时间:{日期:'2013-04-08',片段:'上学路'}}),叙事记录:an.z.object({委托系统:an.z.record(an.z.string(),an.z.object({委托人:an.z.string(),内容:an.z.string(),状态:an.z.enum(['待处理','处理中','已解决','已失败']),所属作品:an.z.string()})).default({}),历史事件:an.z.array(an.z.string()).default([]),当前激活卡牌:an.z.string().nullable().default(null)}).default({委托系统:{},历史事件:[],当前激活卡牌:null})}),{class:'character-app-container'}),Sn={key:0,class:'character-app'},bn={class:'card character-header'},Vn={class:'avatar'},Bn={class:'character-info'},wn={class:'character-name'},Cn={key:0,class:'character-identity'},Dn={class:'tabs'},_n={class:'tab-content'},Ln={key:0,class:'card status-section'},Mn={key:0,class:'status-list'},xn=['onClick'],In={class:'status-duration'},Tn={key:1,class:'empty-state'},$n={key:1,class:'card attributes-section'},zn={class:'attributes-grid'},An={key:2,class:'card skills-section'},Fn={key:0,class:'skills-list'},jn=['onClick'],On={class:'skill-header'},Rn={class:'skill-name'},Pn={class:'skill-description'},Wn={key:1,class:'empty-state'},Yn={key:1,class:'loading-pane'},Hn={class:'modal-header'},Un={class:'modal-body'},Gn={class:'modal-header'},Jn={class:'modal-body'},qn={class:'experience-bar'},Kn={class:'progress-text'},Qn=(0,s.defineComponent)({__name:'CharacterApp',setup(e){const t=(0,s.ref)('status'),n=(0,s.ref)(null),a=(0,s.ref)(null),o=(0,s.computed)(()=>{const e=q.M_.worldState?.主角;return'object'==typeof e&&null!==e&&'名称'in e?e:null}),l={沟通:'沟通',观察:'观察',行动力:'行动力',精神力:'精神力',知识:'知识',魅力:'魅力'},r=e=>l[e]||e,i=(e,t=!1)=>e?t?`${e.日期} ${e.片段}`:`至 ${e.日期}`:'永久',c=e=>{switch(e){case'S':case'SS':case'SSS':return'#ffd700';case'A':return'#da70d6';case'B':return'#87cefa';case'C':return'#90ee90';default:return'#a0a0a0'}},d=e=>{const t=rn.find(t=>t.等级===e.等级);return t?t.升级经验:'??'},m=e=>{const t=d(e);return'number'==typeof t&&t>0?e.经验值/t*100:0};return(e,l)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',Nn,[o.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',Sn,[(0,s.createElementVNode)('div',bn,[(0,s.createElementVNode)('div',Vn,[(0,s.createElementVNode)('span',null,(0,s.toDisplayString)(o.value.名称?o.value.名称.charAt(0):'?'),1)]),(0,s.createElementVNode)('div',Bn,[(0,s.createElementVNode)('h2',wn,(0,s.toDisplayString)(o.value.名称),1),o.value.身份&&o.value.身份.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('p',Cn,(0,s.toDisplayString)(o.value.身份[0].组织)+' - '+(0,s.toDisplayString)(o.value.身份[0].职位),1)):(0,s.createCommentVNode)('v-if',!0)])]),(0,s.createElementVNode)('div',Dn,[(0,s.createElementVNode)('button',{onClick:l[0]||(l[0]=e=>t.value='status'),class:(0,s.normalizeClass)({active:'status'===t.value})},'状态',2),(0,s.createElementVNode)('button',{onClick:l[1]||(l[1]=e=>t.value='attributes'),class:(0,s.normalizeClass)({active:'attributes'===t.value})},'属性',2),(0,s.createElementVNode)('button',{onClick:l[2]||(l[2]=e=>t.value='skills'),class:(0,s.normalizeClass)({active:'skills'===t.value})},'技能',2)]),(0,s.createElementVNode)('div',_n,['status'===t.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',Ln,[o.value.当前状态&&o.value.当前状态.length?((0,s.openBlock)(),(0,s.createElementBlock)('div',Mn,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.value.当前状态,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:t,class:'status-item',onClick:t=>n.value=e},[(0,s.createElementVNode)('span',null,(0,s.toDisplayString)(e.名称),1),(0,s.createElementVNode)('span',In,(0,s.toDisplayString)(i(e.持续到)),1)],8,xn))),128))])):((0,s.openBlock)(),(0,s.createElementBlock)('div',Tn,'无特殊状态'))])):(0,s.createCommentVNode)('v-if',!0),'attributes'===t.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',$n,[(0,s.createElementVNode)('div',zn,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.value.属性,(e,t)=>((0,s.openBlock)(),(0,s.createBlock)(nn,{key:t,name:r(t),value:e},null,8,['name','value']))),128))])])):(0,s.createCommentVNode)('v-if',!0),'skills'===t.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',An,[o.value.技能&&Object.keys(o.value.技能).length?((0,s.openBlock)(),(0,s.createElementBlock)('div',Fn,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.value.技能,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:t,class:'skill-item',onClick:n=>a.value={name:t,...e}},[(0,s.createElementVNode)('div',On,[(0,s.createElementVNode)('span',Rn,(0,s.toDisplayString)(t),1),(0,s.createElementVNode)('span',{class:'skill-level',style:(0,s.normalizeStyle)({color:c(e.等级)})},'Lv. '+(0,s.toDisplayString)(e.等级),5)]),(0,s.createElementVNode)('p',Pn,(0,s.toDisplayString)(e.介绍),1)],8,jn))),128))])):((0,s.openBlock)(),(0,s.createElementBlock)('div',Wn,'尚未习得任何技能'))])):(0,s.createCommentVNode)('v-if',!0)])])):((0,s.openBlock)(),(0,s.createElementBlock)('div',Yn,'正在加载角色数据...')),(0,s.createCommentVNode)(' Status Detail Modal '),n.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:2,class:'modal-overlay',onClick:l[5]||(l[5]=e=>n.value=null)},[(0,s.createElementVNode)('div',{class:'modal-content',onClick:l[4]||(l[4]=(0,s.withModifiers)(()=>{},['stop']))},[(0,s.createElementVNode)('div',Hn,[(0,s.createElementVNode)('h3',null,(0,s.toDisplayString)(n.value.名称),1),(0,s.createElementVNode)('button',{class:'close-button',onClick:l[3]||(l[3]=e=>n.value=null)},'×')]),(0,s.createElementVNode)('div',Un,[(0,s.createElementVNode)('p',null,[l[9]||(l[9]=(0,s.createElementVNode)('strong',null,'效果:',-1)),(0,s.createTextVNode)(' '+(0,s.toDisplayString)(n.value.效果),1)]),(0,s.createElementVNode)('p',null,[l[10]||(l[10]=(0,s.createElementVNode)('strong',null,'来源:',-1)),(0,s.createTextVNode)(' '+(0,s.toDisplayString)(n.value.来源),1)]),(0,s.createElementVNode)('p',null,[l[11]||(l[11]=(0,s.createElementVNode)('strong',null,'持续到:',-1)),(0,s.createTextVNode)(' '+(0,s.toDisplayString)(i(n.value.持续到,!0)),1)])])])])):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)(' Skill Detail Modal '),a.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:3,class:'modal-overlay',onClick:l[8]||(l[8]=e=>a.value=null)},[(0,s.createElementVNode)('div',{class:'modal-content',onClick:l[7]||(l[7]=(0,s.withModifiers)(()=>{},['stop']))},[(0,s.createElementVNode)('div',Gn,[(0,s.createElementVNode)('h3',null,(0,s.toDisplayString)(a.value.name),1),(0,s.createElementVNode)('button',{class:'close-button',onClick:l[6]||(l[6]=e=>a.value=null)},'×')]),(0,s.createElementVNode)('div',Jn,[(0,s.createElementVNode)('p',null,[l[12]||(l[12]=(0,s.createElementVNode)('strong',null,'等级:',-1)),(0,s.createElementVNode)('span',{style:(0,s.normalizeStyle)({color:c(a.value.等级)})},'Lv. '+(0,s.toDisplayString)(a.value.等级),5)]),(0,s.createElementVNode)('p',null,[l[13]||(l[13]=(0,s.createElementVNode)('strong',null,'类型:',-1)),(0,s.createTextVNode)(' '+(0,s.toDisplayString)(a.value.类型),1)]),(0,s.createElementVNode)('div',qn,[(0,s.createElementVNode)('div',{class:'progress-fill',style:(0,s.normalizeStyle)({width:`${m(a.value)}%`})},null,4),(0,s.createElementVNode)('span',Kn,'经验: '+(0,s.toDisplayString)(a.value.经验值)+' / '+(0,s.toDisplayString)(d(a.value)),1)]),(0,s.createElementVNode)('p',null,[l[14]||(l[14]=(0,s.createElementVNode)('strong',null,'介绍:',-1)),(0,s.createTextVNode)(' '+(0,s.toDisplayString)(a.value.介绍),1)])])])])):(0,s.createCommentVNode)('v-if',!0)]))}}),Zn=(0,F.A)(Qn,[['__scopeId','data-v-c70ebe1c']]);var Xn=l(224);const ea={key:0,class:'arrow'},ta={class:'node-name'},na={key:0,class:'node-details'},aa={class:'description'},oa={key:0,class:'characters'},la={key:1,class:'children-list'};const ra=(0,s.defineComponent)({name:'LocationNode',props:{location:{type:Object,required:!0},allLocations:{type:Object,required:!0},charactersByLocation:{type:Object,required:!0}},setup(e){const t=(0,s.ref)(!1),n=(0,s.computed)(()=>e.location.children&&e.location.children.length>0),a=(0,s.computed)(()=>e.charactersByLocation[e.location.id]||[]);return{isExpanded:t,toggle:()=>{t.value=!t.value},hasChildren:n,charactersHere:a}}}),sa=(0,F.A)(ra,[['render',function(e,t,n,a,o,l){const r=(0,s.resolveComponent)('LocationNode',!0);return(0,s.openBlock)(),(0,s.createElementBlock)('li',{class:(0,s.normalizeClass)(['location-node',{expanded:e.isExpanded}])},[(0,s.createElementVNode)('div',{class:'node-content',onClick:t[0]||(t[0]=(...t)=>e.toggle&&e.toggle(...t))},[e.hasChildren?((0,s.openBlock)(),(0,s.createElementBlock)('span',ea,'►')):(0,s.createCommentVNode)('v-if',!0),(0,s.createElementVNode)('span',ta,(0,s.toDisplayString)(e.location.名称),1)]),e.isExpanded?((0,s.openBlock)(),(0,s.createElementBlock)('div',na,[(0,s.createElementVNode)('p',aa,(0,s.toDisplayString)(e.location.描述),1),e.charactersHere.length?((0,s.openBlock)(),(0,s.createElementBlock)('div',oa,[t[1]||(t[1]=(0,s.createElementVNode)('strong',null,'在场角色:',-1)),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.charactersHere,e=>((0,s.openBlock)(),(0,s.createElementBlock)('span',{key:e.名称,class:'character-tag'},(0,s.toDisplayString)(e.名称),1))),128))])):(0,s.createCommentVNode)('v-if',!0),e.hasChildren?((0,s.openBlock)(),(0,s.createElementBlock)('ul',la,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.location.children,t=>((0,s.openBlock)(),(0,s.createBlock)(r,{key:t.id,location:t,'all-locations':e.allLocations,'characters-by-location':e.charactersByLocation},null,8,['location','all-locations','characters-by-location']))),128))])):(0,s.createCommentVNode)('v-if',!0)])):(0,s.createCommentVNode)('v-if',!0)],2)}],['__scopeId','data-v-67766190']]),ia={class:'map-app'},ca={class:'location-tree'},da=(0,s.defineComponent)({__name:'MapApp',setup(e){const t=(0,s.computed)(()=>(0,Xn.get)(q.M_.worldState,'地点',{})),n=(0,s.computed)(()=>(0,Xn.get)(q.M_.worldState,'角色列表',{})),a=(0,s.computed)(()=>{const e={};for(const t in n.value){const a=n.value[t];'object'==typeof a&&null!==a&&a.位置&&(e[a.位置]||(e[a.位置]=[]),e[a.位置].push(a))}return e}),o=(0,s.computed)(()=>{const e=t.value,n=[],a={};for(const t in e){const o={...e[t],id:t,children:[]};o.所属&&o.所属.ID?(a[o.所属.ID]||(a[o.所属.ID]=[]),a[o.所属.ID].push(o)):n.push(o)}const o=e=>e.map(e=>({...e,children:a[e.id]?o(a[e.id]):[]}));return o(n)});return(e,n)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',ia,[(0,s.createElementVNode)('ul',ca,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.value,e=>((0,s.openBlock)(),(0,s.createBlock)(sa,{key:e.id,location:e,'all-locations':t.value,'characters-by-location':a.value},null,8,['location','all-locations','characters-by-location']))),128))])]))}}),ma=(0,F.A)(da,[['__scopeId','data-v-de092378']]);var ua=l(248),pa=l(941),va=l(445);const ga=new class{posts=(0,s.ref)([]);reviews=(0,s.ref)([]);lastBbsLogContent='';lastReviewLogContent='';pollingInterval=null;constructor(){this.startPolling()}startPolling(e=5e3){this.pollingInterval&&clearInterval(this.pollingInterval),this.pollingInterval=setInterval(()=>{this.fetchBbsPostsFromLorebook(),this.fetchWeeklyReviewsFromLorebook()},e)}stopPolling(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null)}async fetchBbsPostsFromLorebook(){try{const e=await va.T.readFromLorebook('导演场记',!0);e&&e!==this.lastBbsLogContent&&(this.lastBbsLogContent=e,this.parseDirectorLogForBbs(e))}catch(e){}}async fetchWeeklyReviewsFromLorebook(){try{const e=await va.T.readFromLorebook('周刊',!0);e&&e!==this.lastReviewLogContent&&(this.lastReviewLogContent=e,this.parseWeeklyReviews(e))}catch(e){}}parseDirectorLogForBbs(e){const t=[];e.split('---').forEach((e,n)=>{const a=e.match(/剧本ID\|(\S+)/),o=a?a[1]:`log-${n}`;if(e.includes('【校园BBS】')){const n=e.split('【校园BBS】')[1].match(/- 帖子标题: "(.*?)"\s*发帖人: (.*?)\s*内容: "(.*?)"/g);n&&n.forEach(e=>{const n=/- 帖子标题: "(.*?)"\s*发帖人: (.*?)\s*内容: "(.*?)"/.exec(e);n&&t.push({id:`${o}-${n[1]}`,title:n[1],author:n[2],content:n[3]})})}}),this.posts.value=t.reverse()}parseWeeklyReviews(e){const t=[];e.split('<周刊>').slice(1).forEach(e=>{const n=e.match(/刊号\|(.*?)\n/),a=e.match(/发行日期\|(.*?)\n/),o=e.match(/本周头条\|(.*?)\n/),l=e.match(/【一周热点追击】\n([\s\S]*?)\n---/);n&&a&&o&&l&&t.push({刊号:n[1],发行日期:a[1],本周头条:o[1],一周热点追击:l[1].trim()})}),this.reviews.value=t.reverse()}},ya={class:'forum-panel'},fa={class:'tabs'},ha={class:'tab-content'},ka={key:0,class:'bbs-view'},Ea={key:0,class:'post-list'},Na={class:'post-title'},Sa={class:'post-content'},ba={class:'post-meta'},Va={key:1,class:'empty-state'},Ba={key:1,class:'weekly-review-view'},wa={key:0,class:'review-list'},Ca={class:'review-title'},Da={class:'review-meta'},_a={class:'review-content'},La={key:1,class:'empty-state'},Ma=(0,s.defineComponent)({__name:'ForumPanel',setup(e){const t=(0,s.ref)('bbs'),n=(0,s.computed)(()=>ga.posts.value),a=(0,s.computed)(()=>ga.reviews.value);return(e,o)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',ya,[(0,s.createElementVNode)('div',fa,[(0,s.createElementVNode)('button',{class:(0,s.normalizeClass)({active:'bbs'===t.value}),onClick:o[0]||(o[0]=e=>t.value='bbs')},'校园BBS',2),(0,s.createElementVNode)('button',{class:(0,s.normalizeClass)({active:'weekly'===t.value}),onClick:o[1]||(o[1]=e=>t.value='weekly')},'周刊回顾',2)]),(0,s.createElementVNode)('div',ha,['bbs'===t.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',ka,[n.value.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('div',Ea,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.value,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:t,class:'post-item'},[(0,s.createElementVNode)('h5',Na,(0,s.toDisplayString)(e.title),1),(0,s.createElementVNode)('p',Sa,(0,s.toDisplayString)(e.content),1),(0,s.createElementVNode)('div',ba,[(0,s.createElementVNode)('span',null,'发帖人: '+(0,s.toDisplayString)(e.author),1)])]))),128))])):((0,s.openBlock)(),(0,s.createElementBlock)('div',Va,[...o[2]||(o[2]=[(0,s.createElementVNode)('p',null,'BBS上还没有新帖子。',-1)])]))])):(0,s.createCommentVNode)('v-if',!0),'weekly'===t.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',Ba,[a.value.length>0?((0,s.openBlock)(),(0,s.createElementBlock)('div',wa,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(a.value,e=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:e.刊号,class:'review-item'},[(0,s.createElementVNode)('h4',Ca,(0,s.toDisplayString)(e.本周头条),1),(0,s.createElementVNode)('div',Da,[(0,s.createElementVNode)('span',null,'第'+(0,s.toDisplayString)(e.刊号)+'期 | '+(0,s.toDisplayString)(e.发行日期),1)]),(0,s.createElementVNode)('p',_a,(0,s.toDisplayString)(e.一周热点追击),1)]))),128))])):((0,s.openBlock)(),(0,s.createElementBlock)('div',La,[...o[3]||(o[3]=[(0,s.createElementVNode)('p',null,'还没有周刊发布。',-1)])]))])):(0,s.createCommentVNode)('v-if',!0)])]))}}),xa=(0,F.A)(Ma,[['__scopeId','data-v-573a9fa6']]);var Ia=l(587),Ta=l(753),$a=l(344);const za={class:'app-view-container'},Aa={class:'app-header'},Fa={class:'app-title'},ja={class:'header-actions'},Oa={class:'app-content'};const Ra=(0,s.defineComponent)({name:'AppViewContainer',props:{title:{type:String,required:!0}},emits:['back']}),Pa=(0,F.A)(Ra,[['render',function(e,t,n,a,o,l){return(0,s.openBlock)(),(0,s.createElementBlock)('div',za,[(0,s.createElementVNode)('div',Aa,[(0,s.createElementVNode)('button',{class:'back-btn',onClick:t[0]||(t[0]=t=>e.$emit('back'))},[...t[1]||(t[1]=[(0,s.createElementVNode)('i',{class:'fas fa-chevron-left'},null,-1)])]),(0,s.createElementVNode)('h3',Fa,(0,s.toDisplayString)(e.title),1),(0,s.createElementVNode)('div',ja,[(0,s.renderSlot)(e.$slots,'header-actions',{},void 0,!0)])]),(0,s.createElementVNode)('div',Oa,[(0,s.renderSlot)(e.$slots,'default',{},void 0,!0)])])}],['__scopeId','data-v-2cf8f05c']]),Wa={class:'home-screen'},Ya={class:'content-overlay'},Ha={class:'header-info'},Ua={class:'date'},Ga={class:'time'},Ja={class:'location-weather-widget'},qa={class:'app-grid'};const Ka=new class{state=(0,s.reactive)({wallpaperContent:'',isLoading:!1,error:null});wallpaperContent=(0,s.ref)('');async fetchWallpaperContent(){this.state.isLoading=!0,this.state.error=null;try{let e=await va.T.readFromLorebook('手机壁纸',!0);e&&(e=e.replace(/\[\/?img\]/g,'').trim()),this.wallpaperContent.value=e||'“即便如此，我还是想要真物。”',this.state.wallpaperContent=e||'“即便如此，我还是想要真物。”'}catch(e){this.state.error=e.message||'Failed to fetch wallpaper content.',console.error(this.state.error),this.wallpaperContent.value='“即便如此，我还是想要真物。”'}finally{this.state.isLoading=!1}}getState(){return this.state}},Qa={class:'icon-visual'},Za={class:'app-name'};const Xa=(0,s.defineComponent)({name:'AppIcon',props:{iconClass:{type:String,required:!0},name:{type:String,required:!0}},emits:['click']}),eo=(0,F.A)(Xa,[['render',function(e,t,n,a,o,l){return(0,s.openBlock)(),(0,s.createElementBlock)('div',{class:'app-icon',onClick:t[0]||(t[0]=t=>e.$emit('click'))},[(0,s.createElementVNode)('div',Qa,[(0,s.createElementVNode)('i',{class:(0,s.normalizeClass)(e.iconClass)},null,2)]),(0,s.createElementVNode)('span',Za,(0,s.toDisplayString)(e.name),1)])}],['__scopeId','data-v-43ed2323']]),to=(0,s.defineComponent)({name:'HomeScreen',components:{AppIcon:eo},emits:['open-app'],setup(){const e=Ka.wallpaperContent;(0,s.onMounted)(()=>{Ka.fetchWallpaperContent()});const t=(0,s.computed)(()=>e.value&&(e.value.startsWith('http')||e.value.startsWith('/'))),n=(0,s.computed)(()=>t.value?{backgroundImage:`url(${e.value})`,backgroundSize:'cover',backgroundPosition:'center',backgroundRepeat:'no-repeat'}:{});return{apps:(0,s.ref)([{id:'contacts',name:'通讯录',icon:'fas fa-address-book'},{id:'calendar',name:'日历',icon:'fas fa-calendar-alt'},{id:'character',name:'角色',icon:'fas fa-user'},{id:'destiny',name:'命运',icon:'fas fa-star'},{id:'diary',name:'日记',icon:'fas fa-book'},{id:'inventory',name:'背包',icon:'fas fa-briefcase'},{id:'forum',name:'论坛',icon:'fas fa-comments'},{id:'map',name:'地图',icon:'fas fa-map-marked-alt'},{id:'system',name:'系统',icon:'fas fa-cog'}]),formattedDate:(0,s.computed)(()=>{const e=q.M_.worldState?.世界状态?.时间?.日期;if(!e)return'';const t=new Date(e);return`${t.getMonth()+1}月${t.getDate()}日 星期${['日','一','二','三','四','五','六'][t.getDay()]}`}),worldTime:(0,s.computed)(()=>q.M_.worldState?.世界状态?.时间?.当前片段||''),currentLocation:(0,s.computed)(()=>{const e=q.M_.worldState?.主角;if(e&&'object'==typeof e&&'位置'in e){const t=e.位置;return t?$e.n.getLocationName(t):'未知'}return'未知'}),currentWeather:(0,s.computed)(()=>q.M_.worldState?.世界状态?.天气||'未知'),futureWeather:(0,s.computed)(()=>q.M_.worldState?.世界状态?.未来天气||'未知'),wallpaper:e,wallpaperStyle:n,isWallpaperUrl:t}}}),no=(0,F.A)(to,[['render',function(e,t,n,a,o,l){const r=(0,s.resolveComponent)('AppIcon');return(0,s.openBlock)(),(0,s.createElementBlock)('div',Wa,[(0,s.createElementVNode)('div',{class:'wallpaper-background',style:(0,s.normalizeStyle)(e.wallpaperStyle)},null,4),(0,s.createElementVNode)('div',Ya,[(0,s.createElementVNode)('div',Ha,[(0,s.createElementVNode)('div',Ua,(0,s.toDisplayString)(e.formattedDate),1),(0,s.createElementVNode)('div',Ga,(0,s.toDisplayString)(e.worldTime),1),(0,s.createElementVNode)('div',Ja,[(0,s.createElementVNode)('span',null,[t[0]||(t[0]=(0,s.createElementVNode)('i',{class:'fas fa-map-marker-alt'},null,-1)),(0,s.createTextVNode)(' '+(0,s.toDisplayString)(e.currentLocation),1)]),(0,s.createElementVNode)('span',null,[t[1]||(t[1]=(0,s.createElementVNode)('i',{class:'fas fa-cloud-sun'},null,-1)),(0,s.createTextVNode)(' '+(0,s.toDisplayString)(e.currentWeather)+' → '+(0,s.toDisplayString)(e.futureWeather),1)])])]),(0,s.createElementVNode)('div',qa,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.apps,t=>((0,s.openBlock)(),(0,s.createBlock)(r,{key:t.id,'icon-class':t.icon,name:t.name,onClick:n=>e.$emit('open-app',t.id)},null,8,['icon-class','name','onClick']))),128))])])])}],['__scopeId','data-v-6b541c26']]),ao=no,oo={contacts:Ta.default,calendar:ht,character:Zn,destiny:ua.default,diary:pa.A,inventory:Ia.default,forum:xa,map:ma,system:$a.default},lo=(0,s.defineComponent)({name:'SmartphoneShell',components:{HomeScreen:ao,AppViewContainer:Pa},emits:['close-smartphone'],setup(){const e=(0,s.ref)(null),t=(0,s.shallowRef)(null),n=(0,s.ref)(!1),a=(0,s.ref)(''),o=()=>{const e=new Date;a.value=e.toTimeString().slice(0,5)};(0,s.onMounted)(()=>{o(),setInterval(o,6e4)});const l=(0,s.computed)(()=>{const e=q.M_.worldState?.世界状态?.行动点;if(!e)return 100;const t={早晨:2,上学路:1,午前:2,午休:3,午后:2,放学后:5,傍晚:3,夜:3},n=['早晨','上学路','午前','午休','午后','放学后','傍晚','夜'],a=q.M_.worldState?.世界状态?.时间?.当前片段||'早晨',o=n.indexOf(a);let l=0;for(let e=0;e<o;e++)l+=t[n[e]];l+=t[a]-e.当前;const r=100-Math.round(l/21*100);return Math.max(0,r)}),r=(0,s.computed)(()=>l.value>80?'fa-battery-full':l.value>60?'fa-battery-three-quarters':l.value>40?'fa-battery-half':l.value>10?'fa-battery-quarter':'fa-battery-empty');return{activeAppId:e,activeApp:t,openApp:a=>{oo[a]?(t.value=oo[a],e.value=a,'diary'!==a&&(n.value=!1)):(console.warn(`App not found: ${a}`),t.value=null,e.value=a)},goHome:()=>{e.value=null,t.value=null,n.value=!1},getAppName:e=>({contacts:'通讯录',calendar:'日历',character:'角色',destiny:'命运',diary:'日记',forum:'论坛',system:'系统',map:'地图',inventory:'背包'}[e]||'应用'),currentTime:a,batteryLevel:l,batteryIcon:r,isDiaryNavOpen:n}}}),ro=(0,F.A)(lo,[['render',function(e,t,n,a,o,l){const r=(0,s.resolveComponent)('HomeScreen'),i=(0,s.resolveComponent)('AppViewContainer');return(0,s.openBlock)(),(0,s.createElementBlock)('div',Wt,[(0,s.createElementVNode)('div',Yt,[(0,s.createElementVNode)('div',Ht,[(0,s.createElementVNode)('div',Ut,(0,s.toDisplayString)(e.currentTime),1),(0,s.createElementVNode)('div',Gt,[(0,s.createElementVNode)('span',null,(0,s.toDisplayString)(e.batteryLevel)+'%',1),(0,s.createElementVNode)('i',{class:(0,s.normalizeClass)(['fas',e.batteryIcon])},null,2)])]),(0,s.createVNode)(s.Transition,{name:'app-fade',mode:'out-in'},{default:(0,s.withCtx)(()=>[e.activeAppId?((0,s.openBlock)(),(0,s.createBlock)(i,{key:1,title:e.getAppName(e.activeAppId),onBack:e.goHome},{'header-actions':(0,s.withCtx)(()=>['diary'===e.activeAppId?((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:0,class:'header-action-btn',onClick:t[0]||(t[0]=t=>e.isDiaryNavOpen=!e.isDiaryNavOpen)},[...t[4]||(t[4]=[(0,s.createElementVNode)('i',{class:'fas fa-bars'},null,-1)])])):(0,s.createCommentVNode)('v-if',!0)]),default:(0,s.withCtx)(()=>[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.activeApp),{'is-diary-nav-open':e.isDiaryNavOpen,onCloseDiaryNav:t[1]||(t[1]=t=>e.isDiaryNavOpen=!1)},null,40,['is-diary-nav-open']))]),_:1},8,['title','onBack'])):((0,s.openBlock)(),(0,s.createBlock)(r,{key:0,onOpenApp:e.openApp},null,8,['onOpenApp']))]),_:1})]),(0,s.createElementVNode)('div',Jt,[t[5]||(t[5]=(0,s.createElementVNode)('button',{class:'nav-btn menu-btn'},[(0,s.createElementVNode)('span',{class:'bar'}),(0,s.createElementVNode)('span',{class:'bar'}),(0,s.createElementVNode)('span',{class:'bar'})],-1)),(0,s.createElementVNode)('button',{class:'nav-btn home-btn',onClick:t[2]||(t[2]=t=>e.$emit('close-smartphone'))}),(0,s.createElementVNode)('button',{class:'nav-btn back-btn',onClick:t[3]||(t[3]=(...t)=>e.goHome&&e.goHome(...t))})])])}],['__scopeId','data-v-437b950a']]),so={class:'action-points-display'},io=(0,s.defineComponent)({__name:'ActionPointDisplay',props:{当前:{type:Number,required:!0},上限:{type:Number,required:!0}},setup(e){const t=e,n=(0,s.computed)(()=>Array.from({length:t.上限},(_,e)=>({id:e,active:e<t.当前})));return(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',so,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.value,e=>((0,s.openBlock)(),(0,s.createElementBlock)('span',{key:e.id,class:(0,s.normalizeClass)(['ap-dot',{used:!e.active}])},null,2))),128))]))}}),co=(0,F.A)(io,[['__scopeId','data-v-0bb0013f']]),mo=(0,s.reactive)({isVisible:!1,title:'',message:'',onConfirm:null,onCancel:null,hideCancel:!1}),uo={get state(){return mo},show(e,t,n,a=!1){return new Promise(o=>{mo.title=e,mo.message=t,mo.onConfirm=()=>{n(),o(!0)},mo.onCancel=()=>{this.hide(),o(!1)},mo.hideCancel=a,mo.isVisible=!0})},hide(){mo.isVisible=!1,mo.title='',mo.message='',mo.onConfirm=null,mo.onCancel=null,mo.hideCancel=!1},confirm(){mo.onConfirm&&mo.onConfirm()},cancel(){mo.onCancel&&mo.onCancel()}},po=$;var vo=l.n(po);let go={};const yo={enterWeb:function(){const e=function(){const e=parent.document.getElementsByTagName('iframe');for(let t=0;t<e.length;t++)if(e[t].contentWindow===window){const n=e[t];if(n.id)return`#${n.id}`;const a=n.getAttribute('src');if(a){const e=a.split('/').pop();if(e)return`iframe[src*="${e}"]`}return null}return null}();if(!e)return void console.warn('无法找到应用 iframe，无法进入网页全屏模式。');const t={[e]:{position:'fixed',top:'0',left:'0',width:'100vw',height:'100vh',zIndex:'99999',border:'none',borderRadius:'0'},'#top-settings-holder':{display:'none'},'#form_sheld > :not(#chat)':{display:'none'},'#top-bar':{display:'none'},'#chat':{height:'100vh',maxHeight:'100vh'},'#chat_fullscreen_button':{display:'none'}};go={};for(const e in t){const n=vo()(e,parent.document);if(n.length>0){go[e]={};const a=t[e];for(const t in a)go[e][t]=n.css(t);n.css(a)}}vo()(parent.document.documentElement).addClass('web-fullscreen-active'),vo()(parent.document.body).addClass('web-fullscreen-active')},exitWeb:function(){for(const e in go){const t=vo()(e,parent.document);t.length>0&&t.css(go[e])}go={},vo()(parent.document.documentElement).removeClass('web-fullscreen-active'),vo()(parent.document.body).removeClass('web-fullscreen-active')},toggleBrowser:function(){n.isEnabled?n.toggle():console.warn('浏览器不支持或不允许全屏功能。')},onBrowserChange:function(e){n.isEnabled&&n.on('change',()=>{e(n.isFullscreen)})},get isBrowserFullscreen(){return n.isEnabled&&n.isFullscreen}},fo=(0,s.reactive)({isVisible:!1,title:'',props:{worldId:''}}),ho={state:fo,show:e=>{fo.title='NPC 列表',fo.props={worldId:e},fo.isVisible=!0},hide:()=>{fo.isVisible=!1}},ko=(0,s.reactive)({isWebFullscreen:!1,isBrowserFullscreen:!1});yo.onBrowserChange(e=>{ko.isBrowserFullscreen&&!e&&TavernHelper.setChatMessages([],{refresh:'all'}),ko.isBrowserFullscreen=e});const Eo={toggleBrowserFullscreen(){Nt.closeAllPanels(),uo.hide(),ze.U.hide(),ho.hide(),te.hide(),yo.toggleBrowser()},toggleWebFullscreen(){const e=!ko.isWebFullscreen;ko.isWebFullscreen=e,e?yo.enterWeb():yo.exitWeb(),Et.B.emit('fullscreenChanged',e)},unpinAllPanels(){Nt.unpinAllPanels()}},No=(0,s.readonly)(ko),So=Eo,bo={class:'top-status'},Vo={class:'status-left'},Bo={class:'chapter-info'},wo={class:'work-title'},Co={class:'chapter-title'},Do={class:'status-center'},_o=['title'],Lo={class:'status-right'},Mo={class:'date-time-info'},xo={class:'date-time'},Io={class:'day-weather'},To=(0,s.defineComponent)({__name:'TopStatusBar',setup(e){const t=(0,s.computed)(()=>No.isBrowserFullscreen),{openPanel:n}=St(),a=(0,s.computed)(()=>{const e=(0,Te.dn)('世界状态.章节').value;return e?{workTitle:e.所属作品||'未知作品',fullChapterTitle:`第${e.册??'?'}册 第${e.章??'?'}章: ${e.标题||'未知标题'}`}:{workTitle:'未知作品',fullChapterTitle:'未知章节'}}),o=(0,s.computed)(()=>{const e=q.M_.worldState?.世界状态;if(!e||!e.时间||!e.时间.日期)return{date:'----年--月--日',timeSegment:'未知',dayOfWeek:'星期?',weather:'未知'};return{date:new Date(e.时间.日期).toLocaleDateString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit'}).replace(/\//g,'-'),timeSegment:e.时间.当前片段||'未知',dayOfWeek:`星期${e.时间.星期}`||'星期?',weather:e.天气||'未知'}}),l=()=>{So.toggleBrowserFullscreen(),So.toggleWebFullscreen()},r=()=>{n('system','saveLoad')},i=()=>{ee.isVisible?te.hide():te.show()},c=(0,s.computed)(()=>t.value?'退出全屏':'浏览器全屏'),d=(0,s.computed)(()=>t.value?'fas fa-compress':'fas fa-expand'),m=(0,s.computed)(()=>{const e=(0,Te.dn)('世界状态.行动点').value;return e?{当前:e.当前??0,上限:e.上限??0}:{当前:0,上限:0}});return(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',bo,[(0,s.createElementVNode)('div',Vo,[(0,s.createElementVNode)('div',Bo,[(0,s.createElementVNode)('span',wo,(0,s.toDisplayString)(a.value.workTitle),1),(0,s.createElementVNode)('span',Co,(0,s.toDisplayString)(a.value.fullChapterTitle),1)])]),(0,s.createElementVNode)('div',Do,[(0,s.createElementVNode)('button',{onClick:r,class:'view-toggle-btn',title:'系统管理'},[...t[1]||(t[1]=[(0,s.createElementVNode)('i',{class:'fas fa-cog'},null,-1)])]),(0,s.createElementVNode)('button',{onClick:i,class:'view-toggle-btn',title:'输入指令'},[...t[2]||(t[2]=[(0,s.createElementVNode)('i',{class:'fas fa-keyboard'},null,-1)])]),(0,s.createElementVNode)('button',{onClick:l,class:'view-toggle-btn',title:c.value},[(0,s.createElementVNode)('i',{class:(0,s.normalizeClass)(d.value)},null,2)],8,_o),(0,s.createElementVNode)('button',{onClick:t[0]||(t[0]=(...e)=>(0,s.unref)(q.o1).rerollLastAction&&(0,s.unref)(q.o1).rerollLastAction(...e)),class:'view-toggle-btn',title:'重来'},[...t[3]||(t[3]=[(0,s.createElementVNode)('i',{class:'fas fa-undo'},null,-1)])])]),(0,s.createElementVNode)('div',Lo,[(0,s.createVNode)(co,{当前:m.value.当前,上限:m.value.上限},null,8,['当前','上限']),(0,s.createElementVNode)('div',Mo,[(0,s.createElementVNode)('span',xo,(0,s.toDisplayString)(o.value.date)+' '+(0,s.toDisplayString)(o.value.timeSegment),1),(0,s.createElementVNode)('span',Io,(0,s.toDisplayString)(o.value.dayOfWeek)+' | '+(0,s.toDisplayString)(o.value.weather),1)])])]))}}),$o=(0,F.A)(To,[['__scopeId','data-v-a72d5322']]),zo={class:'world-time-display'},Ao={class:'world-name'},Fo={class:'time-string'},jo=(0,s.defineComponent)({__name:'WorldTimeDisplay',props:{worldType:{}},setup(e){const t=e,{worldType:n}=(0,s.toRefs)(t),a=(0,s.computed)(()=>'main'===n.value?'主世界':'化身世界'),o=(0,s.computed)(()=>'main'===n.value?Te.mainWorldTimeStr.value:Te.timeStr.value);return(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',zo,[(0,s.createElementVNode)('span',Ao,(0,s.toDisplayString)(a.value),1),(0,s.createElementVNode)('span',Fo,(0,s.toDisplayString)(o.value),1)]))}}),Oo=(0,F.A)(jo,[['__scopeId','data-v-7a5f6689']]);var Ro=l(994);const Po='youth-romcom-simulator-layout-state-v1-normal',Wo='youth-romcom-simulator-layout-state-v1-fullscreen';const Yo=new class{activePanels=new Map;fullscreenPanels=new Map;isFullscreen=!1;constructor(){this.loadAllLayouts(),Et.B.on('panelOpened',e=>this.addPanel(e)),Et.B.on('panelClosed',e=>this.removePanel(e)),Et.B.on('fullscreenChanged',e=>this.handleFullscreenChange(e))}loadAllLayouts(){try{const e=localStorage.getItem(Po);e&&(this.activePanels=new Map(JSON.parse(e)));const t=localStorage.getItem(Wo);t&&(this.fullscreenPanels=new Map(JSON.parse(t)))}catch(e){console.error('Failed to load layout states:',e)}}saveLayoutState(){this.isFullscreen?localStorage.setItem(Wo,JSON.stringify(Array.from(this.fullscreenPanels.entries()))):localStorage.setItem(Po,JSON.stringify(Array.from(this.activePanels.entries())))}addPanel(e){const t=this.isFullscreen?this.fullscreenPanels:this.activePanels;t.has(e.panelId)||(t.set(e.panelId,e),this.saveLayoutState())}removePanel(e){const t=this.isFullscreen?this.fullscreenPanels:this.activePanels;t.has(e)&&(t.delete(e),this.saveLayoutState())}handleFullscreenChange(e){this.isFullscreen=e,this.restoreLayout()}restoreLayout(){const e=this.isFullscreen?this.fullscreenPanels:this.activePanels;console.log(`[LayoutService] Broadcasting restore ${this.isFullscreen?'fullscreen':'normal'} layout event...`),Et.B.emit('restoreLayout',Array.from(e.values()))}setCurrentFullscreenState(e){this.isFullscreen=e}},Ho=(0,s.defineComponent)({name:'App',components:{DockManager:bt,EnhancedInputBox:se,LoadingIndicator:xt,NpcListModal:Pt,TopStatusBar:$o,WorldTimeDisplay:Oo,SideMenuButton:Ie,NotificationContainer:Le,ActionPanel:Y,InputHistoryPopup:be,SmartphoneShell:ro,FloatingCard:j},setup(){const{openPanel:e}=St(),t=Ro.q.activeCards,n=(0,s.ref)(!1),a=(0,s.computed)(()=>uo.state),o=(0,s.computed)(()=>ze.U.state),l=(0,s.computed)(()=>ho.state),r=(0,s.computed)(()=>No.isWebFullscreen),i=(0,s.computed)(()=>ee),c=(0,s.ref)(!1),d=(0,s.ref)(!1),m=(0,s.ref)(!1),u=(0,s.ref)([]),p=(0,s.computed)(()=>u.value.length),v=[{id:'inventory',icon:'物',text:'背包',action:()=>e('world','inventory'),disabled:()=>!q.M_.isReady},{id:'skills',icon:'技',text:'技能',action:()=>e('world','skills'),disabled:()=>!q.M_.isReady},{id:'destiny',icon:'命',text:'命运',action:()=>e('world','destiny'),disabled:()=>!q.M_.isReady},{id:'review',icon:'记',text:'回顾',action:()=>e('system','review'),disabled:()=>!q.M_.isReady},{id:'npcDirectory',icon:'众',text:'名录',action:()=>e('system','npcDirectory'),disabled:()=>!q.M_.isReady},{id:'worldDetails',icon:'世',text:'世界',action:()=>e('world','worldDetails'),disabled:()=>!q.M_.isReady},{id:'timeline',icon:'预',text:'预言',action:()=>Nt.openPanel('timeline','未来预言','timeline-panel'),disabled:()=>!q.M_.isReady},{id:'debug',icon:'虫',text:'调试',action:()=>e('system','debug'),disabled:()=>!q.M_.isReady}],g=async e=>{console.log('Submitting to AI:',e),await q.o1.handleAction(e)},y=()=>{u.value=H.getCommands()};return(0,s.onMounted)(()=>{const e=document.getElementById('app');e?Nt.initialize(e):console.error('Dock host element not found.'),q.o1.loadAllData(),Nt.onAction=g,H.subscribe(y),y(),Et.B.on('restoreLayout',e=>{const{openPanel:t}=St();Nt.closeAllPanels(),e.forEach(e=>{try{const n='mainWorld'===e.world||'avatarWorld'===e.world?'world':'system';t(n,e.panel,e.props||{})}catch(t){console.error(`Failed to restore panel: ${e.world}-${e.panel}`,t)}})}),Yo.setCurrentFullscreenState(No.isWebFullscreen),Yo.restoreLayout()}),{confirmation:a,detailModal:o,npcModal:l,isWebFullscreen:r,inputModal:i,inputModalActions:te,allOptions:v,handleAction:g,handleSubmit:async e=>{const t=i.value.inputValue;te.setLastSubmittedValue(t),await g(e),te.hide(),te.clearValue()},handleOverlayClick:()=>{i.value.isVisible&&te.hide()},store:q.M_,confirmationService:uo,detailModalService:ze.U,npcModalService:ho,isActionPanelVisible:c,isHistoryVisible:d,toggleHistory:()=>{d.value=!d.value,d.value&&(m.value=!1)},selectHistoryEntry:e=>{te.setValue(e),d.value=!1},isQueueVisible:m,toggleCommandQueue:()=>{m.value=!m.value,m.value&&(d.value=!1)},commands:u,commandCount:p,clearCommands:()=>{H.clearCommands()},isSmartphoneOpen:n,toggleSmartphone:()=>{n.value=!n.value},activeCards:t}}}),Uo=(0,F.A)(Ho,[['render',function(e,t,n,a,o,l){const r=(0,s.resolveComponent)('TopStatusBar'),i=(0,s.resolveComponent)('DockManager'),I=(0,s.resolveComponent)('LoadingIndicator'),T=(0,s.resolveComponent)('NpcListModal'),A=(0,s.resolveComponent)('EnhancedInputBox'),F=(0,s.resolveComponent)('InputHistoryPopup'),j=(0,s.resolveComponent)('NotificationContainer'),O=(0,s.resolveComponent)('SmartphoneShell'),R=(0,s.resolveComponent)('FloatingCard');return(0,s.openBlock)(),(0,s.createElementBlock)('div',{class:(0,s.normalizeClass)(['guixu-root-container',{'web-fullscreen':e.isWebFullscreen}])},[(0,s.createVNode)(r),(0,s.createElementVNode)('div',c,[(0,s.createVNode)(i)]),(0,s.createCommentVNode)(' Global Modals '),e.confirmation.isVisible?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,class:'modal-overlay',onClick:t[2]||(t[2]=(0,s.withModifiers)(t=>e.confirmationService.hide(),['self']))},[(0,s.createElementVNode)('div',d,[(0,s.createElementVNode)('h3',m,(0,s.toDisplayString)(e.confirmation.title),1),(0,s.createElementVNode)('p',u,(0,s.toDisplayString)(e.confirmation.message),1),(0,s.createElementVNode)('div',p,[(0,s.createElementVNode)('button',{onClick:t[0]||(t[0]=t=>e.confirmationService.hide())},'取消'),(0,s.createElementVNode)('button',{class:'primary',onClick:t[1]||(t[1]=t=>e.confirmationService.confirm())},'确认')])])])):(0,s.createCommentVNode)('v-if',!0),e.detailModal.isVisible?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:1,class:'modal-overlay',onClick:t[4]||(t[4]=(0,s.withModifiers)(t=>e.detailModalService.hide(),['self']))},[(0,s.createElementVNode)('div',{class:(0,s.normalizeClass)(['modal-content detail-modal',[e.detailModal.props?.modalClass]])},[(0,s.createElementVNode)('div',v,[(0,s.createElementVNode)('h3',g,(0,s.toDisplayString)(e.detailModal.title),1),(0,s.createElementVNode)('button',{class:'close-button',onClick:t[3]||(t[3]=t=>e.detailModalService.hide())},'×')]),(0,s.createElementVNode)('div',y,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.detailModal.component),(0,s.normalizeProps)((0,s.guardReactiveProps)(e.detailModal.props)),null,16))])],2)])):(0,s.createCommentVNode)('v-if',!0),e.store.isGenerating?((0,s.openBlock)(),(0,s.createBlock)(I,{key:2,error:e.store.generationError},null,8,['error'])):(0,s.createCommentVNode)('v-if',!0),e.npcModal.isVisible?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:3,class:'modal-overlay',onClick:t[6]||(t[6]=(0,s.withModifiers)(t=>e.npcModalService.hide(),['self']))},[(0,s.createElementVNode)('div',f,[(0,s.createElementVNode)('div',h,[(0,s.createElementVNode)('h3',k,(0,s.toDisplayString)(e.npcModal.title),1),(0,s.createElementVNode)('button',{class:'close-button',onClick:t[5]||(t[5]=t=>e.npcModalService.hide())},'×')]),(0,s.createElementVNode)('div',E,[(0,s.createVNode)(T,(0,s.normalizeProps)((0,s.guardReactiveProps)(e.npcModal.props)),null,16)])])])):(0,s.createCommentVNode)('v-if',!0),e.inputModal.isVisible?((0,s.openBlock)(),(0,s.createElementBlock)('div',N,[(0,s.createElementVNode)('div',S,[(0,s.createElementVNode)('div',b,[(0,s.createElementVNode)('div',V,[(0,s.createVNode)(A,{onSubmitAction:e.handleSubmit,onToggleHistory:e.toggleHistory},null,8,['onSubmitAction','onToggleHistory'])]),e.isHistoryVisible?((0,s.openBlock)(),(0,s.createBlock)(F,{key:0,onClose:e.toggleHistory,onSelectEntry:e.selectHistoryEntry},null,8,['onClose','onSelectEntry'])):(0,s.createCommentVNode)('v-if',!0),e.isQueueVisible?((0,s.openBlock)(),(0,s.createElementBlock)('div',B,[(0,s.createElementVNode)('div',w,[t[10]||(t[10]=(0,s.createElementVNode)('h3',null,'指令队列',-1)),(0,s.createElementVNode)('button',{class:'close-popup-button',onClick:t[7]||(t[7]=(...t)=>e.toggleCommandQueue&&e.toggleCommandQueue(...t))},'×')]),(0,s.createElementVNode)('div',C,[e.commandCount>0?((0,s.openBlock)(),(0,s.createElementBlock)('div',D,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.commands,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:t,class:'command-item'},(0,s.toDisplayString)(e),1))),128))])):((0,s.openBlock)(),(0,s.createElementBlock)('div',L,'暂无待执行指令。'))]),e.commandCount>0?((0,s.openBlock)(),(0,s.createElementBlock)('div',M,[(0,s.createElementVNode)('button',{class:'clear-button',onClick:t[8]||(t[8]=(...t)=>e.clearCommands&&e.clearCommands(...t))},'清空所有指令')])):(0,s.createCommentVNode)('v-if',!0)])):(0,s.createCommentVNode)('v-if',!0)])])])):(0,s.createCommentVNode)('v-if',!0),(0,s.createVNode)(j),(0,s.createCommentVNode)(' Smartphone UI '),(0,s.createVNode)(s.Transition,{name:'fade'},{default:(0,s.withCtx)(()=>[e.isSmartphoneOpen?((0,s.openBlock)(),(0,s.createBlock)(O,{key:0,onCloseSmartphone:e.toggleSmartphone},null,8,['onCloseSmartphone'])):(0,s.createCommentVNode)('v-if',!0)]),_:1}),(0,s.createCommentVNode)(' Smartphone Toggle Button '),e.isSmartphoneOpen?(0,s.createCommentVNode)('v-if',!0):((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:5,class:'smartphone-toggle-btn',onClick:t[9]||(t[9]=(...t)=>e.toggleSmartphone&&e.toggleSmartphone(...t))},[...t[11]||(t[11]=[(0,s.createElementVNode)('i',{class:'fas fa-mobile-alt'},null,-1)])])),(0,s.createCommentVNode)(' Floating Active Cards '),(0,s.createElementVNode)('div',x,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.activeCards,e=>((0,s.openBlock)(),(0,s.createBlock)(R,{key:e.ID,card:e},null,8,['card']))),128))])],2)}]]),Go={class:'attribute-item'},Jo={class:'attribute-name'},qo={class:'attribute-value'},Ko=(0,s.defineComponent)({__name:'AttributeDisplay',props:{name:{},value:{}},setup:e=>(t,n)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',Go,[(0,s.createElementVNode)('span',Jo,(0,s.toDisplayString)(e.name),1),(0,s.createElementVNode)('span',qo,(0,s.toDisplayString)(e.value),1)]))}),Qo=(0,F.A)(Ko,[['__scopeId','data-v-1b452a49']]),Zo={class:'character-panel'},Xo={class:'panel-section'},el={id:'base-attributes-list',class:'attributes-list'},tl={class:'panel-section'},nl={id:'secondary-attributes-list',class:'attributes-list'},al={class:'panel-section'},ol={id:'grades-list',class:'attributes-list'},ll={class:'panel-section'},rl={id:'skills-list',class:'attributes-list'},sl={class:'panel-section'},il={id:'talents-list',class:'attributes-list'},cl={class:'panel-section'},dl={id:'schedule-list',class:'attributes-list'},ml={class:'panel-section'},ul={id:'relations-list',class:'attributes-list'},pl={class:'attribute-name'},vl={class:'attribute-value'},gl=(0,s.defineComponent)({__name:'CharacterView',setup(e){const{character:t,secondaryAttributes:n,todayCourses:a,getBaseAttributes:o,getSubjects:l,getSkills:r,getTalents:i,getRelationships:c}=q.getters,d=o(t),m=l(t),u=r(t),p=q.getters.getTalents(t),v=c(t);return(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',Zo,[(0,s.createElementVNode)('div',Xo,[t[0]||(t[0]=(0,s.createElementVNode)('div',{class:'section-title'},'基础属性',-1)),(0,s.createElementVNode)('div',el,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(d).value,(e,t)=>((0,s.openBlock)(),(0,s.createBlock)(Qo,{key:t,name:String(t),value:`${e.值} / ${e.软上限}`},null,8,['name','value']))),128))])]),(0,s.createElementVNode)('div',tl,[t[1]||(t[1]=(0,s.createElementVNode)('div',{class:'section-title'},'二级属性',-1)),(0,s.createElementVNode)('div',nl,[(0,s.createVNode)(Qo,{name:'财力',value:`¥ ${(0,s.unref)(n).财力}`},null,8,['value']),(0,s.createVNode)(Qo,{name:'声望',value:(0,s.unref)(n).声望},null,8,['value'])])]),(0,s.createElementVNode)('div',al,[t[2]||(t[2]=(0,s.createElementVNode)('div',{class:'section-title'},'各科成绩',-1)),(0,s.createElementVNode)('div',ol,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(m).value,(e,t)=>((0,s.openBlock)(),(0,s.createBlock)(Qo,{key:t,name:String(t),value:`${e.知识水平} (${e.最近一次分数})`},null,8,['name','value']))),128))])]),(0,s.createElementVNode)('div',ll,[t[3]||(t[3]=(0,s.createElementVNode)('div',{class:'section-title'},'技能与知识',-1)),(0,s.createElementVNode)('div',rl,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(u).value,(e,t)=>((0,s.openBlock)(),(0,s.createBlock)(Qo,{key:t,name:String(t),value:`Lv.${e.等级} / ${e.软上限}`},null,8,['name','value']))),128))])]),(0,s.createElementVNode)('div',sl,[t[4]||(t[4]=(0,s.createElementVNode)('div',{class:'section-title'},'天赋与特长',-1)),(0,s.createElementVNode)('div',il,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(p),(e,t)=>((0,s.openBlock)(),(0,s.createBlock)(Qo,{key:t,name:e.名称,value:e.描述},null,8,['name','value']))),128))])]),(0,s.createElementVNode)('div',cl,[t[5]||(t[5]=(0,s.createElementVNode)('div',{class:'section-title'},'今日课程',-1)),(0,s.createElementVNode)('div',dl,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(a),(e,t)=>((0,s.openBlock)(),(0,s.createBlock)(Qo,{key:t,name:e.标题,value:e.时间段},null,8,['name','value']))),128))])]),(0,s.createElementVNode)('div',ml,[t[6]||(t[6]=(0,s.createElementVNode)('div',{class:'section-title'},'人际关系',-1)),(0,s.createElementVNode)('div',ul,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(v).value,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:t,class:'attribute-item'},[(0,s.createElementVNode)('span',pl,(0,s.toDisplayString)(t),1),(0,s.createElementVNode)('span',vl,' 亲密:'+(0,s.toDisplayString)(e.亲密)+' 信赖:'+(0,s.toDisplayString)(e.信赖),1)]))),128))])])]))}}),yl=(0,F.A)(gl,[['__scopeId','data-v-1c5d8637']]),fl={class:'inventory-panel'},hl={class:'panel-section'},kl={class:'inventory-grid'},El={class:'item-name'},Nl={class:'item-quantity'},Sl=(0,s.defineComponent)({__name:'InventoryView',setup(e){const t=(0,s.ref)([]);return(0,s.onMounted)(()=>{t.value=[{id:'food001',name:'学生A套餐',quantity:1},{id:'snack002',name:'Pocky巧克力棒',quantity:3},{id:'study001',name:'《高等数学辅导》',quantity:1}]}),(e,n)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',fl,[(0,s.createElementVNode)('div',hl,[n[0]||(n[0]=(0,s.createElementVNode)('div',{class:'section-title'},'我的背包',-1)),(0,s.createElementVNode)('div',kl,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(t.value,e=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:e.id,class:'inventory-item'},[(0,s.createElementVNode)('div',El,(0,s.toDisplayString)(e.name),1),(0,s.createElementVNode)('div',Nl,'x'+(0,s.toDisplayString)(e.quantity),1)]))),128))])])]))}}),bl=(0,F.A)(Sl,[['__scopeId','data-v-d797c64c']]),Vl={class:'main-content-view'},Bl=['innerHTML'],wl=['innerHTML'],Cl=(0,s.defineComponent)({__name:'MainContentView',emits:['submit-action'],setup(e,{emit:t}){const n=t,a=(0,s.reactive)({visible:!1,content:'',style:{top:'0px',left:'0px'}}),o=(0,s.computed)(()=>{let e=Te.IL.value;return e=e.replace(/<item name="([^"]+)">(.+?)<\/item>/g,(e,t,n)=>`<span class="highlighted-item" data-type="item" data-name="${t}">${n}</span>`),e=e.replace(/<npc name="([^"]+)">(.+?)<\/npc>/g,(e,t,n)=>`<span class="highlighted-npc" data-type="npc" data-name="${t}">${n}</span>`),e}),l=e=>{const t=e.target,n=t.dataset.type,o=t.dataset.name;if(!n||!o)return;let l;'item'===n?l=(0,Te.getItemByName)(o):'npc'===n&&(l=(0,Te.qE)(o)),l&&(a.content=i(l,n),a.style.top=`${e.clientY+15}px`,a.style.left=`${e.clientX+15}px`,a.visible=!0)},r=()=>{a.visible=!1},i=(e,t)=>'item'===t?`\n      <div class="tooltip-title">${e.名称} [${e.类型}]</div>\n      <div class="tooltip-description">${e.描述}</div>\n      <div class="tooltip-level">能级: ${e.能级}</div>\n    `:'npc'===t?`\n      <div class="tooltip-title">${e.姓名}</div>\n      <div class="tooltip-description">${e.外观描述}</div>\n      <div class="tooltip-identity">身份: ${e.身份.join(', ')}</div>\n    `:'',c=e=>{n('submit-action',e)};return(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',Vl,[(0,s.createElementVNode)('div',{class:'narrative-container',innerHTML:o.value,onMouseover:l,onMouseout:r},null,40,Bl),(0,s.createVNode)(se,{placeholder:'请输入行动...',onSubmitAction:c}),(0,s.createCommentVNode)(' Tooltip '),a.visible?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,class:'narrative-tooltip',style:(0,s.normalizeStyle)(a.style),innerHTML:a.content},null,12,wl)):(0,s.createCommentVNode)('v-if',!0)]))}}),Dl=(0,F.A)(Cl,[['__scopeId','data-v-4453ae69']]),_l={class:'npc-list-panel'},Ll={class:'panel-section'},Ml={class:'npc-list'},xl={class:'npc-name'},Il={class:'npc-relationship'},Tl=(0,s.defineComponent)({__name:'NpcListView',setup(e){const t=(0,s.ref)([]);return(0,s.onMounted)(()=>{t.value=[{id:'yukinoshita_yukino',name:'雪之下雪乃',favorability:55},{id:'yuigahama_yui',name:'由比滨结衣',favorability:60}]}),(e,n)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',_l,[(0,s.createElementVNode)('div',Ll,[n[0]||(n[0]=(0,s.createElementVNode)('div',{class:'section-title'},'NPC 列表',-1)),(0,s.createElementVNode)('div',Ml,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(t.value,e=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:e.id,class:'npc-item'},[(0,s.createElementVNode)('div',xl,(0,s.toDisplayString)(e.name),1),(0,s.createElementVNode)('div',Il,'好感度: '+(0,s.toDisplayString)(e.favorability),1)]))),128))])])]))}}),$l=(0,F.A)(Tl,[['__scopeId','data-v-e354837a']]),zl={class:'world-state-panel'},Al={class:'panel-section'},Fl={class:'state-list'},jl=(0,s.defineComponent)({__name:'WorldStateView',setup(e){const t=(0,s.ref)(null),n=(0,s.computed)(()=>{if(!t.value)return'';const e=t.value.当前时间;return`${e.年}-${e.月}-${e.日} ${e.时}:${e.分} (${e.星期})`});return(0,s.onMounted)(()=>{t.value={当前时间:{年:2024,月:9,日:1,时:8,分:0,星期:'周一'},季节:'秋',天气:'晴',温度:22,经济指数:100,流行趋势:'复古Y2K穿搭'}}),(e,a)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',zl,[(0,s.createElementVNode)('div',Al,[a[0]||(a[0]=(0,s.createElementVNode)('div',{class:'section-title'},'世界状态',-1)),(0,s.createElementVNode)('div',Fl,[(0,s.createVNode)(Qo,{name:'当前时间',value:n.value},null,8,['value']),(0,s.createVNode)(Qo,{name:'季节',value:t.value?.季节||'N/A'},null,8,['value']),(0,s.createVNode)(Qo,{name:'天气',value:t.value?.天气||'N/A'},null,8,['value']),(0,s.createVNode)(Qo,{name:'温度',value:`${t.value?.温度||'N/A'}°C`},null,8,['value']),(0,s.createVNode)(Qo,{name:'经济指数',value:t.value?.经济指数||0},null,8,['value']),(0,s.createVNode)(Qo,{name:'流行趋势',value:t.value?.流行趋势||'N/A'},null,8,['value'])])])]))}}),Ol=[{path:'/',component:Dl},{path:'/character',component:yl},{path:'/npc-list',component:$l},{path:'/inventory',component:bl},{path:'/world-state',component:(0,F.A)(jl,[['__scopeId','data-v-e33a51b8']])}],Rl=(0,i.createRouter)({history:(0,i.createMemoryHistory)(),routes:Ol});Rl.replace('/'),$(()=>{(0,s.createApp)(Uo).use(Rl).mount('#app')});var Pl=l(783),Wl=l(861),Yl=l(487);function Hl(e){const t=e.trim().split('\n'),n={};let a=null,o=null,l=null;for(const e of t){if('---'===e.trim()){a=null,o=null,l=null;continue}const t=e.indexOf('|');if(-1!==t&&!a){const a=e.substring(0,t).trim(),o=e.substring(t+1).trim();n[a]=o;continue}if(e.trim().startsWith('【')&&e.trim().endsWith('】'))a=e.trim(),n[a]=[],o=n[a],l=null;else if(o&&a){const t=e.trim();if(t.startsWith('- ')){const e=t.substring(2).trim(),n=e.indexOf(':');if(-1!==n){const t=e.substring(0,n).trim(),a=e.substring(n+1).trim();l={[t]:a},o.push(l)}else o.push(e),l=null}else if(l&&t){const e=Object.keys(l).pop();e&&(l[e]+='\n'+t)}else if(t)if(n[a].length>0){'string'==typeof n[a][n[a].length-1]&&(n[a][n[a].length-1]+='\n'+t)}else n[a].push(t)}}for(const e in n)Array.isArray(n[e])&&1===n[e].length&&'string'==typeof n[e][0]&&(n[e]=n[e][0]);return n}const Ul=new class{pollingInterval=null;isSyncing=!1;startPolling(e=15e3){this.pollingInterval&&this.stopPolling(),console.log(`[LogSyncService] Starting to poll chat history every ${e}ms.`),this.pollingInterval=setInterval(()=>this.syncLogsFromChat(),e),this.syncLogsFromChat()}stopPolling(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null,console.log('[LogSyncService] Stopped polling chat history.'))}async processLogs(e,t){const{tagName:n,lorebookEntry:a,storeKey:o,idKey:l,idParser:r=e=>String(e),onNewLogFound:s}=t,i=new RegExp(`<${n}>([\\s\\S]+?)<\\/${n}>`,'g');let c=[];for(const t of e){if(t.is_user)continue;let e;for(;null!==(e=i.exec(t.message));)c.push(e[1].trim())}if(0===c.length)return;const d=await va.T.readFromLorebook(a)||'',m=await va.T.readFromLorebook(`${a}-禁开`)||'',u=new Set,p=(d+m).split('\n\n---\n\n');for(const e of p){const t=e.match(new RegExp(`^\\s*${l}\\|(.+)$`,'m'));t&&t[1]&&u.add(r(t[1].trim()))}const v=q.M_[o];for(const e of v)e[l]&&u.add(r(e[l]));const g=[],y=[];for(const e of c)try{const t=Hl(e),n=t[l]?r(t[l]):null;n&&!u.has(n)&&(g.push(t),y.push(e),u.add(n))}catch(t){console.error(`[LogSyncService] Error parsing block for <${n}>`,t,'Block:',e)}if(g.length>0){q.M_[o]=[...v,...g].sort((e,t)=>e[l]>t[l]?1:-1);const e=y.join('\n\n---\n\n');await va.T.appendToEntry(a,e,'\n\n---\n\n'),Ve.l.success(`${a}同步`,`同步了 ${g.length} 条新记录。`),s&&await s(g)}}async syncLogsFromChat(){if(!this.isSyncing){this.isSyncing=!0,console.log('[LogSyncService] Starting log sync...');try{const e=await Yl._.fetchTavernData();if(!e)return;await this.processLogs(e,{tagName:'日记片段',lorebookEntry:'日记片段',storeKey:'diaryFragments',idKey:'序号',idParser:e=>parseInt(e,10)}),await this.processLogs(e,{tagName:'导演场记',lorebookEntry:'导演场记',storeKey:'directorLogs',idKey:'剧本ID'}),await this.processLogs(e,{tagName:'日记',lorebookEntry:'日记',storeKey:'diary',idKey:'日期',onNewLogFound:async e=>{const t=new Set(e.map(e=>e.日期)),n=await va.T.readFromLorebook('日记片段');if(!n)return;const a=n.split('\n\n---\n\n'),o=a.filter(e=>{const n=e.match(/^日期\|(.+)$/m);return n&&t.has(n[1].trim())}),l=a.filter(e=>{const n=e.match(/^日期\|(.+)$/m);return!n||!t.has(n[1].trim())});o.length>0&&(await va.T.appendToEntry('日记片段-禁开',o.join('\n\n---\n\n'),'\n\n---\n\n'),await va.T.writeToLorebook('日记片段',l.join('\n\n---\n\n')),Ve.l.info('日记片段存档',`已将 ${o.length} 条旧片段移入存档。`))}}),await this.processLogs(e,{tagName:'周刊',lorebookEntry:'周刊',storeKey:'weeklyReviews',idKey:'刊号',idParser:e=>parseInt(e,10)})}catch(e){console.error('[LogSyncService] Error during log sync:',e)}finally{this.isSyncing=!1,console.log('[LogSyncService] Log sync finished.')}}}};var Gl=l(131),Jl=l(581),ql=l(725);(async function(){ql.S.register('saveLoadService',Jl.h),ql.S.register('inputModalState',ee),ql.S.register('inputModalActions',te),ql.S.register('store',q.M_),ql.S.register('actions',q.o1),ql.S.register('diarySynthesisService',Pl.R),await $e.n.initializeWorldAndLocationData(),q.M_.worldState||await new Promise(e=>{const t=(0,s.watch)(()=>q.M_.worldState,n=>{n&&(t(),e(!0))})}),await Wl.$.buildIndex(q.M_.worldState),Pl.R.initialize()})().then(()=>{console.log('All services initialized.'),function(){if('true'===localStorage.getItem('reincarnation-simulator-restore-input')){console.log('[Startup] Restore flag found, restoring last input.');const e=localStorage.getItem('reincarnation-simulator-last-submitted');e&&(te.setValue(e),te.show()),localStorage.removeItem('reincarnation-simulator-restore-input')}}(),Ul.startPolling(15e3);let e='';setInterval(async()=>{const t=await va.T.readFromLorebook('导演场记',!0);t&&t!==e&&(console.log('[Auto-Memory Polling] Detected change in "导演场记", processing...'),await Gl.H.processDirectorLog(),e=t)},5e3)}),Jl.h,Yl._;
//# sourceMappingURL=index.js.map</script><style>@keyframes legendary-glow-2bc79802{0%{box-shadow:0 0 8px var(--card-level-color),0 0 16px var(--card-level-color),0 0 24px var(--card-level-color)}50%{box-shadow:0 0 16px var(--card-level-color),0 0 32px var(--card-level-color),0 0 48px var(--card-level-color)}100%{box-shadow:0 0 8px var(--card-level-color),0 0 16px var(--card-level-color),0 0 24px var(--card-level-color)}}@keyframes epic-glow-2bc79802{0%{box-shadow:0 0 4px var(--card-level-color),0 0 8px var(--card-level-color)}50%{box-shadow:0 0 8px var(--card-level-color),0 0 16px var(--card-level-color)}100%{box-shadow:0 0 4px var(--card-level-color),0 0 8px var(--card-level-color)}}.destiny-card[data-v-2bc79802]{border:2px solid var(--card-type-color);border-radius:15px;background:linear-gradient(145deg,#2d2d3a,#1b1b26);position:relative;overflow:hidden;width:100%;max-width:380px;aspect-ratio:3/5;display:flex;flex-direction:column;transition:all .3s ease}.destiny-card.rarity-legendary[data-v-2bc79802]{animation:legendary-glow-2bc79802 2.5s infinite ease-in-out}.destiny-card.rarity-epic[data-v-2bc79802]{animation:epic-glow-2bc79802 3.5s infinite ease-in-out}.destiny-card.rarity-rare[data-v-2bc79802]{box-shadow:0 0 8px var(--card-level-color)}.card-header[data-v-2bc79802]{padding:.5em 1em;display:flex;justify-content:space-between;align-items:center;font-size:.9em;color:#ccc;background-color:rgba(0,0,0,.3);border-bottom:1px solid var(--card-type-color)}.card-type[data-v-2bc79802]{font-weight:bold;color:var(--card-type-color)}.card-level[data-v-2bc79802]{font-weight:bold;color:var(--card-level-color)}.card-content[data-v-2bc79802]{padding:1em;flex-grow:1;display:flex;flex-direction:column}.card-face[data-v-2bc79802]{flex-grow:1;min-height:120px;display:flex;align-items:center;justify-content:center;margin-bottom:1em;border-radius:8px;background-color:rgba(10,15,30,.4);min-height:100px}.card-image[data-v-2bc79802]{width:100%;height:100%;background-size:cover;background-position:center}.card-text-face[data-v-2bc79802]{font-size:1.1em;color:#eee;padding:.5em}.card-info[data-v-2bc79802]{text-align:center;flex-shrink:0;margin-top:auto;padding-top:1em}.card-name[data-v-2bc79802]{font-size:1.4em;color:var(--card-type-color);font-weight:bold;padding-bottom:.5em;margin-bottom:.5em;border-bottom:1px solid var(--card-type-color,#444)}.card-description[data-v-2bc79802],.card-effect[data-v-2bc79802]{font-size:.85em;color:#ccc;line-height:1.4;margin:0}.card-effect[data-v-2bc79802]{margin-top:.8em;padding-top:.8em;border-top:1px solid #444;color:#a0e8ff}
.floating-card-container[data-v-161cd48e]{position:relative;z-index:1000}.backdrop[data-v-161cd48e]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:rgba(0,0,0,.7);backdrop-filter:blur(5px);z-index:1000}.floating-card-wrapper[data-v-161cd48e]{position:relative;z-index:1001;width:190px;height:316.6666666667px;transition:all .3s ease;pointer-events:none}.floating-card-wrapper .the-card[data-v-161cd48e]{pointer-events:auto;cursor:pointer;transform:scale(0.2);transform-origin:top right;transition:transform .3s ease-in-out}.floating-card-wrapper:hover .the-card[data-v-161cd48e]{transform:scale(0.22)}.zoomed .floating-card-wrapper:hover .the-card[data-v-161cd48e]{transform:scale(1.1)}.zoomed .floating-card-wrapper[data-v-161cd48e]{position:fixed;top:50%;left:50%;width:auto;height:auto;transform:translate(-50%,-50%)}.zoomed .floating-card-wrapper .the-card[data-v-161cd48e]{transform:scale(1.1)}
.action-panel[data-v-06f56abf]{display:flex;flex-direction:column;gap:8px;padding:16px;background-color:rgba(10,15,30,.7);border-radius:5px;border:1px solid rgba(212,175,55,.3);box-shadow:0 -4px 15px rgba(0,0,0,.2)}.button-container[data-v-06f56abf]{display:flex;flex-wrap:wrap;justify-content:center;gap:16px}.action-button[data-v-06f56abf]{background:rgba(0,0,0,0);border:1px solid rgba(212,175,55,.5);color:#f0e6d2;padding:8px 24px;border-radius:3px;font-family:"Siyuan Song","Source Han Serif SC",serif;font-size:14px;cursor:pointer;transition:all .2s ease-in-out}.action-button[data-v-06f56abf]:hover{background-color:rgba(212,175,55,.2);border-color:#d4af37;color:#e0e0e0;box-shadow:0 0 8px rgba(212,175,55,.5)}.action-button.primary[data-v-06f56abf]{background-color:rgba(212,175,55,.8);border-color:#f0e6d2;color:#0a0f1e;font-weight:bold}.action-button.primary[data-v-06f56abf]:hover{background-color:#f0e6d2;box-shadow:0 0 12px rgba(240,230,210,.7)}
.input-wrapper[data-v-ca7d1390]{display:flex;align-items:center;padding:8px;gap:8px}textarea[data-v-ca7d1390]{flex-grow:1}.action-button[data-v-ca7d1390]{height:40px;min-width:40px;padding:0 10px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:1px solid rgba(212,175,55,.5);color:#f0e6d2;border-radius:3px;font-family:"Siyuan Song","Source Han Serif SC",serif;font-size:14px;cursor:pointer;transition:all .2s ease-in-out;white-space:nowrap}.action-button.activator[data-v-ca7d1390]{width:40px;height:40px;padding:0;display:flex;align-items:center;justify-content:center;font-family:"Siyuan Song","Source Han Serif SC",serif;font-size:14px;height:40px;background-color:rgba(212,175,55,.8);border-color:#f0e6d2;color:#0a0f1e;font-weight:bold}.action-button.activator[data-v-ca7d1390]:hover{background-color:#f0e6d2;box-shadow:0 0 12px rgba(240,230,210,.7)}.action-button[data-v-ca7d1390]:hover{background-color:rgba(212,175,55,.2);border-color:#d4af37;color:#e0e0e0;box-shadow:0 0 8px rgba(212,175,55,.5)}.action-button.primary[data-v-ca7d1390]{background-color:rgba(212,175,55,.8);border-color:#f0e6d2;color:#0a0f1e;font-weight:bold}.action-button.primary[data-v-ca7d1390]:hover{background-color:#f0e6d2;box-shadow:0 0 12px rgba(240,230,210,.7)}

.notification{position:relative;background-color:rgba(22,33,44,.5);border:1px solid rgba(212,175,55,.4);border-radius:5px;padding:8px 16px;margin-bottom:16px;width:280px;box-shadow:0 6px 25px rgba(10,15,30,.5);transition:all .4s ease-in-out}.notification__content{position:relative;z-index:1}.notification__title{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;font-size:16px;margin:0 0 4px 0}.notification__message{color:#e0e0e0;font-size:14px;margin:0;line-height:1.5}.notification__arrow{position:absolute;top:50%;right:-10px;width:0;height:0;border-top:10px solid rgba(0,0,0,0);border-bottom:10px solid rgba(0,0,0,0);border-left:10px solid rgba(212,175,55,.4);transform:translateY(-50%)}.notification__arrow::before{content:"";position:absolute;top:-9px;left:-11px;width:0;height:0;border-top:9px solid rgba(0,0,0,0);border-bottom:9px solid rgba(0,0,0,0);border-left:9px solid #16212c}.notification--success{border-left-color:#3a8f9d}.notification--info{border-left-color:#8a5db5}.notification--warning{border-left-color:#d4af37}.notification--error{border-left-color:#c74343}.notification-fade-enter-active,.notification-fade-leave-active{transition:all .5s cubic-bezier(0.55,0,0.1,1)}.notification-fade-enter-from,.notification-fade-leave-to{opacity:0;transform:scale(0.5) translateX(100%)}
.notification-container{position:fixed;top:80px;right:20px;z-index:100000;display:flex;flex-direction:column;align-items:flex-end}
.side-menu-button[data-v-fa6acc08]{position:absolute;top:50%;transform:translateY(-50%);width:50px;height:50px;background-color:rgba(22,33,44,.85);border:1px solid rgba(212,175,55,.5);border-radius:50%;cursor:pointer;padding:0;z-index:10;display:flex;justify-content:center;align-items:center;transition:all .3s ease}.side-menu-button.left[data-v-fa6acc08]{left:0}.side-menu-button.right[data-v-fa6acc08]{right:0}.side-menu-button[data-v-fa6acc08]:hover{background-color:#16212c;border-color:#d4af37;box-shadow:0 0 12px rgba(212,175,55,.6)}.side-menu-button .icon[data-v-fa6acc08]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:1.8rem;color:#f0e6d2;text-shadow:0 0 8px rgba(240,230,210,.5);transition:all .3s ease}.side-menu-button:hover .icon[data-v-fa6acc08]{color:#e0e0e0;transform:scale(1.1);text-shadow:0 0 15px #f0e6d2}
.attribute-grid[data-v-321a611a]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:16px;width:100%}.attribute-item[data-v-321a611a]{display:flex;flex-direction:column;background:rgba(22,33,44,.5);border-radius:5px;padding:16px;border:1px solid rgba(212,175,55,.2);transition:all .3s ease;position:relative;overflow:hidden}.attribute-item[data-v-321a611a]::before{content:"";position:absolute;top:0;left:-80%;width:60%;height:100%;background:linear-gradient(90deg,transparent,rgba(240,230,210,0.08),transparent);transform:skewX(-25deg);transition:left .6s ease}.attribute-item[data-v-321a611a]:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(240,230,210,.08);border-color:rgba(240,230,210,.3)}.attribute-item[data-v-321a611a]:hover::before{left:120%}.attribute-key[data-v-321a611a]{font-size:14px;color:#a0a0a0;margin-bottom:8px;font-family:"Siyuan Song","Source Han Serif SC",serif}.attribute-value[data-v-321a611a]{font-size:18px;font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;font-weight:400;text-shadow:0 0 8px rgba(212,175,55,.5);margin-bottom:8px}.progress-bar-container[data-v-321a611a]{width:100%;height:18px;background-color:rgba(10,15,30,.5);border-radius:3px;border:1px solid rgba(212,175,55,.1);position:relative;display:flex;align-items:center;justify-content:center}.progress-bar[data-v-321a611a]{position:absolute;top:0;left:0;height:100%;background:linear-gradient(90deg,#3a8f9d,rgb(37.3627906977,92.1186046512,101.1372093023));border-radius:3px;transition:width .5s ease-in-out}.progress-text[data-v-321a611a]{position:relative;z-index:1;font-size:10px;color:#e0e0e0;text-shadow:0 0 2px #0a0f1e}
.grid-layout[data-v-502908ed]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:24px}.detail-item .detail-key[data-v-502908ed]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:16px;display:block;margin-bottom:16px}.detail-item .detail-value[data-v-502908ed]{color:#e0e0e0;font-size:14px;line-height:1.7}.detail-item .detail-value p[data-v-502908ed]{margin:0;white-space:pre-wrap}.detail-item .detail-value .tag[data-v-502908ed]{display:inline-block;background-color:rgba(58,143,157,.15);color:#3a8f9d;padding:4px 8px;border-radius:3px;margin-right:8px;margin-bottom:8px}.history-list[data-v-502908ed]{list-style:none;padding:0}.history-list li[data-v-502908ed]{margin-bottom:16px}.history-list li strong[data-v-502908ed]{color:#f0e6d2}.history-list li p[data-v-502908ed]{color:#a0a0a0;font-size:12px}.influence-text[data-v-502908ed]{color:#3a8f9d;font-style:italic;font-size:12px;margin-top:8px}.influence-text[data-v-502908ed]::before{content:"影响：";font-weight:bold}.evolution-level .evolution-tracks[data-v-502908ed]{display:flex;flex-direction:column;gap:8px}.evolution-level .track[data-v-502908ed]{display:flex;align-items:center;gap:16px}.evolution-level .track .track-label[data-v-502908ed]{font-weight:bold;color:#a0a0a0;width:40px}.evolution-level .track .track-level[data-v-502908ed]{font-size:16px;font-weight:bold;color:#f0e6d2;width:20px;text-align:center}.evolution-level .track .track-status[data-v-502908ed]{color:#e0e0e0}
.complex-attribute[data-v-5bb115c3]{background:rgba(22,33,44,.3);border-radius:5px;width:150%;border:1px solid rgba(212,175,55,.15);padding:16px;margin-bottom:24px}.header[data-v-5bb115c3]{border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:16px;margin-bottom:16px}.name[data-v-5bb115c3]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:18px;color:#f0e6d2;margin:0 0 8px 0}.description[data-v-5bb115c3]{font-size:12px;color:#a0a0a0;margin:0}.child-key[data-v-5bb115c3]{font-weight:bold;color:#e0e0e0}.child-value[data-v-5bb115c3]{min-width:0}
li[data-v-02469c81]{display:contents}.object-key[data-v-02469c81]{color:#f0e6d2;font-weight:bold;cursor:help;text-align:right;white-space:nowrap;padding-bottom:24px}.value-cell[data-v-02469c81]{padding-bottom:24px;min-width:0}.value-cell>ul[data-v-02469c81]{list-style-type:none;padding-left:16px;margin-top:8px;border-left:1px solid rgba(212,175,55,.2);display:grid;grid-template-columns:auto 1fr;gap:8px 16px}.value-cell>ul.multi-column[data-v-02469c81]{grid-template-columns:repeat(2,auto 1fr);gap:8px 24px}.object-value[data-v-02469c81]{color:#e0e0e0}.progress-bar-container[data-v-02469c81]{width:100%;background-color:rgba(10,15,30,.5);border-radius:3px;position:relative;height:24px;border:1px solid rgba(212,175,55,.3)}.progress-bar[data-v-02469c81]{background:linear-gradient(90deg,rgba(58,143,157,0.5) 0%,rgba(58,143,157,0.8) 100%);height:100%;border-radius:3px;transition:width .3s ease}.progress-text[data-v-02469c81]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#e0e0e0;font-size:12px;text-shadow:1px 1px 2px #0a0f1e}.data-item[data-v-02469c81]{display:flex;flex-direction:column;gap:4px}.data-item-row[data-v-02469c81]{display:grid;grid-template-columns:80px 1fr}.data-item-key[data-v-02469c81]{color:#d4af37;font-weight:normal;text-align:right;padding-right:8px}.data-item-value[data-v-02469c81]{color:#e0e0e0}
.object-renderer:not(.is-nested)>ul.multi-column[data-v-6f2991f8]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px 32px}ul[data-v-6f2991f8]{list-style-type:none;padding:0;margin:0;display:grid;grid-template-columns:auto 1fr;gap:8px 16px}ul.multi-column[data-v-6f2991f8]{grid-template-columns:repeat(2,auto 1fr);gap:8px 24px}li[data-v-6f2991f8]{display:contents}.object-key[data-v-6f2991f8]{color:#f0e6d2;font-weight:bold;cursor:help;text-align:right;white-space:nowrap;padding-bottom:24px}.value-cell[data-v-6f2991f8]{padding-bottom:24px}.value-cell[data-v-6f2991f8]{min-width:0}.object-value[data-v-6f2991f8]{color:#e0e0e0}.is-nested ul[data-v-6f2991f8]{padding-left:16px;margin-top:8px;border-left:1px solid rgba(212,175,55,.2)}.progress-bar-container[data-v-6f2991f8]{width:100%;background-color:rgba(10,15,30,.5);border-radius:3px;position:relative;height:24px;border:1px solid rgba(212,175,55,.3)}.progress-bar[data-v-6f2991f8]{background:linear-gradient(90deg,rgba(58,143,157,0.5) 0%,rgba(58,143,157,0.8) 100%);height:100%;border-radius:3px;transition:width .3s ease}.progress-text[data-v-6f2991f8]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#e0e0e0;font-size:12px;text-shadow:1px 1px 2px #0a0f1e}
.grid-layout[data-v-0cc0afb0]{display:grid;grid-template-columns:1fr;gap:24px}.personality-kernel .kernel-content[data-v-0cc0afb0]{display:flex;flex-direction:column;gap:24px}.personality-kernel .kernel-section .kernel-title[data-v-0cc0afb0]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:14px;color:#f0e6d2;margin-bottom:8px;border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:8px}.personality-kernel .kernel-section .kernel-text[data-v-0cc0afb0]{white-space:pre-wrap}.personality-kernel .kernel-section .kernel-text.identifier[data-v-0cc0afb0]{font-style:italic;color:#3a8f9d}.profile-list[data-v-0cc0afb0]{list-style:none;padding-left:16px}.profile-list .profile-item[data-v-0cc0afb0]{margin-bottom:16px;border-left:3px solid rgba(212,175,55,.3);padding-left:16px}.profile-list .profile-item .profile-context[data-v-0cc0afb0]{font-weight:bold;color:#e0e0e0}.profile-list .profile-item .profile-behavior[data-v-0cc0afb0],.profile-list .profile-item .profile-motivation[data-v-0cc0afb0]{font-size:12px;color:#a0a0a0}.profile-list .profile-item .profile-behavior span[data-v-0cc0afb0],.profile-list .profile-item .profile-motivation span[data-v-0cc0afb0]{color:#f0e6d2;font-weight:bold}.dialogue-style p[data-v-0cc0afb0]{margin-bottom:8px}.dialogue-style .phrase-tag[data-v-0cc0afb0]{background-color:rgba(58,143,157,.15);color:#3a8f9d;cursor:default}.detail-item.full-width[data-v-0cc0afb0]{grid-column:1/-1}.detail-item .detail-key[data-v-0cc0afb0]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:16px;display:block;margin-bottom:16px}.placeholder[data-v-0cc0afb0]{color:#a0a0a0;font-style:italic}.tags-container[data-v-0cc0afb0]{display:flex;flex-wrap:wrap;gap:8px}.tag[data-v-0cc0afb0]{display:inline-block;background-color:rgba(58,143,157,.15);color:#3a8f9d;padding:4px 8px;border-radius:3px}.talent-tag[data-v-0cc0afb0]{background-color:rgba(212,175,55,.2);color:#f0e6d2;cursor:help}.skills-list[data-v-0cc0afb0]{display:flex;flex-direction:column;gap:8px}.skill-item[data-v-0cc0afb0]{background:rgba(10,15,30,.4);border-radius:3px;padding:8px 16px;cursor:pointer;transition:background-color .2s ease}.skill-item[data-v-0cc0afb0]:hover{background:rgba(58,143,157,.1)}.skill-header[data-v-0cc0afb0]{display:flex;justify-content:space-between;align-items:center}.skill-header h3[data-v-0cc0afb0]{margin:0;font-size:14px;color:#e0e0e0}.skill-level[data-v-0cc0afb0]{font-size:12px;color:#a0a0a0}.personality-kernel .kernel-content[data-v-0cc0afb0]{display:flex;flex-direction:column;gap:24px}.personality-kernel .kernel-section .kernel-title[data-v-0cc0afb0]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:14px;color:#f0e6d2;margin-bottom:8px;border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:8px}.personality-kernel .kernel-section .kernel-text[data-v-0cc0afb0]{white-space:pre-wrap}.personality-kernel .kernel-section .kernel-text.identifier[data-v-0cc0afb0]{font-style:italic;color:#3a8f9d}.profile-list[data-v-0cc0afb0]{list-style:none;padding-left:16px}.profile-list .profile-item[data-v-0cc0afb0]{margin-bottom:16px;border-left:3px solid rgba(212,175,55,.3);padding-left:16px}.profile-list .profile-item .profile-context[data-v-0cc0afb0]{font-weight:bold;color:#e0e0e0}.profile-list .profile-item .profile-behavior[data-v-0cc0afb0],.profile-list .profile-item .profile-motivation[data-v-0cc0afb0]{font-size:12px;color:#a0a0a0}.profile-list .profile-item .profile-behavior span[data-v-0cc0afb0],.profile-list .profile-item .profile-motivation span[data-v-0cc0afb0]{color:#f0e6d2;font-weight:bold}.profile-list .profile-details[data-v-0cc0afb0]{padding-top:8px}.profile-list .toggle-icon[data-v-0cc0afb0]{display:inline-block;transition:transform .2s ease-in-out;font-size:.8em;margin-left:8px}.profile-list .toggle-icon.is-open[data-v-0cc0afb0]{transform:rotate(90deg)}.dialogue-style p[data-v-0cc0afb0]{margin-bottom:8px}.dialogue-style .phrase-tag[data-v-0cc0afb0]{background-color:rgba(22,33,44,.3);color:#e0e0e0;cursor:default}
.progress-bar-container[data-v-a2763620]{display:flex;align-items:center;gap:16px;width:100%}.label[data-v-a2763620]{color:#a0a0a0;font-size:12px;flex-basis:60px;flex-shrink:0;white-space:nowrap}.progress-track[data-v-a2763620]{position:relative;flex-grow:1;height:8px;background-color:rgba(10,15,30,.5);border-radius:4px;overflow:hidden}.center-tick[data-v-a2763620]{position:absolute;left:50%;top:0;bottom:0;width:1px;background-color:rgba(160,160,160,.5)}.progress-fill[data-v-a2763620]{position:absolute;top:0;bottom:0;height:100%;border-radius:4px;transition:width .5s ease,left .5s ease,right .5s ease}.value[data-v-a2763620]{color:#e0e0e0;font-size:12px;font-weight:bold;flex-basis:40px;flex-shrink:0;text-align:right}
.relations-display[data-v-37746a86]{padding-top:16px}.relation-list[data-v-37746a86]{list-style:none;padding:0;margin:0}.relation-item[data-v-37746a86]{border-bottom:1px solid rgba(212,175,55,.1);padding:16px 0}.relation-header[data-v-37746a86]{display:flex;justify-content:space-between;align-items:center;cursor:pointer}.relation-name[data-v-37746a86]{font-weight:bold;color:#e0e0e0}.relation-tags .tag[data-v-37746a86]{font-size:12px;background-color:rgba(58,143,157,.2);color:#3a8f9d;padding:2px 6px;border-radius:3px;margin-left:8px}.relation-details[data-v-37746a86]{margin-top:16px;padding:16px;background-color:rgba(10,15,30,.3);border-radius:5px;display:grid;grid-template-columns:1fr;gap:24px}.vector-group[data-v-37746a86]{display:flex;flex-direction:column;gap:16px}.group-title[data-v-37746a86]{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;margin-bottom:8px;border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:8px}.placeholder[data-v-37746a86]{color:#a0a0a0;text-align:center;padding:32px 0}
.database-item-card[data-v-58039cc0]{padding:16px;min-width:350px}.database-item-card .info-grid[data-v-58039cc0]{display:grid;grid-template-columns:repeat(2,1fr);gap:24px}.database-item-card .info-item[data-v-58039cc0]{display:flex;flex-direction:column;gap:4px}.database-item-card .info-item strong[data-v-58039cc0]{font-family:"Siyuan Song","Source Han Serif SC",serif;color:#f0e6d2;font-size:12px;text-transform:uppercase;letter-spacing:1px;opacity:.7}.database-item-card .info-item span[data-v-58039cc0]{font-size:14px;color:#e0e0e0;line-height:1.6;white-space:pre-wrap}.database-item-card .info-item.full-width[data-v-58039cc0]{grid-column:1/-1}
.inventory-grid[data-v-f5d19dc2]{width:100%}.grid-container[data-v-f5d19dc2]{display:grid;grid-template-columns:repeat(5,1fr);gap:16px}.item-cell[data-v-f5d19dc2]{position:relative;background-color:rgba(10,15,30,.4);border:1px solid rgba(212,175,55,.2);border-radius:5px;padding:8px;aspect-ratio:1/1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;font-size:12px}.item-name[data-v-f5d19dc2]{color:#e0e0e0;font-weight:bold}.item-quantity[data-v-f5d19dc2]{position:absolute;bottom:4px;right:6px;font-size:10px;color:#a0a0a0}.empty-inventory[data-v-f5d19dc2]{color:#a0a0a0;text-align:center;padding:24px 0}
.grid-layout[data-v-1c024944]{display:grid;grid-template-columns:1fr;gap:24px}.detail-item.full-width[data-v-1c024944]{grid-column:1/-1}.detail-item .detail-key[data-v-1c024944]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:16px;display:block;margin-bottom:16px}.memory-timeline[data-v-1c024944]{position:relative;padding-left:24px}.memory-timeline[data-v-1c024944]::before{content:"";position:absolute;top:0;left:10px;bottom:0;width:2px;background-color:rgba(212,175,55,.15)}.year-group h5[data-v-1c024944]{cursor:pointer;font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;margin:24px 0 16px;-webkit-user-select:none;user-select:none;position:relative}.year-group h5[data-v-1c024944]::before{content:"▼";display:inline-block;margin-right:8px;transition:transform .2s ease}.year-group h5.collapsed[data-v-1c024944]::before{transform:rotate(-90deg)}.memory-list[data-v-1c024944]{display:flex;flex-direction:column;gap:16px;padding-left:24px}.memory-item[data-v-1c024944]{position:relative;background-color:rgba(10,15,30,.4);padding:16px;border-radius:3px}.memory-item[data-v-1c024944]::before{content:"";position:absolute;top:18px;left:-22px;width:8px;height:8px;border-radius:50%;background-color:#8a5db5;border:2px solid #0a0f1e}.memory-event .tag[data-v-1c024944]{margin-right:8px;font-size:12px;padding:2px 6px}.emotion-tag-anger[data-v-1c024944]{background-color:rgba(211,47,47,.2);color:#f44336}.emotion-tag-sadness[data-v-1c024944]{background-color:rgba(33,150,243,.2);color:#2196f3}.emotion-tag-fear[data-v-1c024944]{background-color:rgba(156,39,176,.2);color:#9c27b0}.emotion-tag-humiliation[data-v-1c024944]{background-color:rgba(130,119,23,.2);color:#afad70}.emotion-tag-satisfaction[data-v-1c024944]{background-color:rgba(76,175,80,.2);color:#4caf50}.emotion-tag-joy[data-v-1c024944]{background-color:rgba(255,193,7,.2);color:#ffc107}.memory-event[data-v-1c024944],.memory-influence[data-v-1c024944]{margin:0;padding:2px 0;color:#a0a0a0;line-height:1.6}.memory-event strong[data-v-1c024944],.memory-influence strong[data-v-1c024944]{color:#8a5db5;font-weight:bold}.placeholder[data-v-1c024944]{color:#a0a0a0;font-style:italic}
.npc-detail-display[data-v-3d67675a]{display:flex;flex-direction:column;height:100%}.tabs[data-v-3d67675a]{display:flex;flex-shrink:0;border-bottom:1px solid rgba(212,175,55,.3)}.tabs button[data-v-3d67675a]{background:none;border:none;color:#a0a0a0;padding:16px 24px;cursor:pointer;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:16px;transition:all .2s ease;border-bottom:2px solid rgba(0,0,0,0)}.tabs button.active[data-v-3d67675a]{color:#f0e6d2;border-bottom-color:#d4af37}.tabs button[data-v-3d67675a]:hover{color:#e0e0e0}.tab-content[data-v-3d67675a]{flex-grow:1;overflow-y:auto;padding:24px}.tab-content[data-v-3d67675a]::-webkit-scrollbar{width:6px;height:6px}.tab-content[data-v-3d67675a]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.tab-content[data-v-3d67675a]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.tab-content[data-v-3d67675a]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.placeholder[data-v-3d67675a]{display:flex;justify-content:center;align-items:center;height:100%;color:#a0a0a0;font-size:16px}
.location-info-card[data-v-4aea10f8]{padding:16px;min-width:300px}.location-info-card h4[data-v-4aea10f8]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:18px;margin-top:0;margin-bottom:24px;border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:16px}.location-info-card .info-grid[data-v-4aea10f8]{display:grid;grid-template-columns:repeat(2,1fr);gap:24px}.location-info-card .info-item[data-v-4aea10f8]{display:flex;flex-direction:column;gap:4px}.location-info-card .info-item strong[data-v-4aea10f8]{font-family:"Siyuan Song","Source Han Serif SC",serif;color:#f0e6d2;font-size:12px;text-transform:uppercase;letter-spacing:1px;opacity:.7}.location-info-card .info-item span[data-v-4aea10f8]{font-size:14px;color:#e0e0e0;line-height:1.6}.location-info-card .info-item.full-width[data-v-4aea10f8]{grid-column:1/-1}.loading-placeholder[data-v-4aea10f8]{padding:32px;color:#a0a0a0;text-align:center}
.game-text-container[data-v-316766ee]{font-size:15px;line-height:1.8;color:#000;white-space:pre-wrap}.game-text-container .text-dialogue[data-v-316766ee]{color:#d4af37}.game-text-container .text-psychology[data-v-316766ee]{color:#8a5db5;font-style:italic}.game-text-container .text-scenery[data-v-316766ee]{color:#3a8f9d}.game-text-container .text-system-highlight[data-v-316766ee]{color:#d4af37;font-weight:bold}.game-text-container[data-v-316766ee] .npc-name{font-family:"ZCOOL KuaiLe","篆书",cursive;cursor:pointer;text-decoration:underline;text-decoration-color:hsla(0,0%,100%,.5);transition:all .2s ease;text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000}.game-text-container[data-v-316766ee] .npc-name:hover{background-color:hsla(0,0%,100%,.15);text-decoration-color:#fff}.game-text-container[data-v-316766ee] .npc-name.npc-hostile-intense{color:#ff4d4d}.game-text-container[data-v-316766ee] .npc-name.npc-hostile{color:#ff8c66}.game-text-container[data-v-316766ee] .npc-name.npc-unfriendly{color:gold}.game-text-container[data-v-316766ee] .npc-name.npc-neutral{color:#fff}.game-text-container[data-v-316766ee] .npc-name.npc-friendly{color:#90ee90}.game-text-container[data-v-316766ee] .npc-name.npc-devoted{color:#87cefa}.game-text-container[data-v-316766ee] .npc-name.npc-fanatical{color:hotpink}.game-text-container[data-v-316766ee] .npc-name.npc-unknown{color:#9e9e9e}.game-text-container[data-v-316766ee] .location-name{color:#80b9ea;cursor:pointer;text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;text-decoration:underline;text-decoration-color:rgba(128,222,234,.5)}.game-text-container[data-v-316766ee] .location-name:hover{background-color:rgba(128,151,234,.15);text-decoration-color:#80b5ea}.game-text-container[data-v-316766ee] .database-item-name{color:#f8cbad;cursor:pointer;text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;text-decoration:underline;text-decoration-color:rgba(248,203,173,.5)}.game-text-container[data-v-316766ee] .database-item-name:hover{background-color:rgba(248,203,173,.15);text-decoration-color:#f8cbad}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}html{font-family:"Noto Serif SC",serif;font-size:14px;line-height:1.7;color:#0a0f1e}body{min-height:100vh;overflow:hidden}h1,h2,h3,h4,h5,h6{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#d4af37;font-weight:normal;margin-bottom:16px}h1{font-size:24px}h2{font-size:20px}h3{font-size:18px}a{color:#3a8f9d;text-decoration:none;transition:color .3s ease}a:hover{color:rgb(95.4441860465,181.8279069767,196.0558139535);text-decoration:underline}button,input,textarea,select{font-family:inherit;font-size:inherit;background-color:rgba(10,15,30,.5);border:1px solid rgba(212,175,55,.3);color:#e0e0e0;padding:8px 16px;border-radius:5px;transition:all .3s ease}button:focus,input:focus,textarea:focus,select:focus{outline:none;border-color:#d4af37;box-shadow:0 0 5px rgba(212,175,55,.5)}button:disabled,input:disabled,textarea:disabled,select:disabled{opacity:.5;cursor:not-allowed}button{cursor:pointer;background-color:rgba(58,143,157,.2);border-color:#3a8f9d}button:hover{background-color:rgba(58,143,157,.4);border-color:rgb(76.823255814,173.288372093,189.176744186)}button.primary{background-color:rgba(212,175,55,.8);border-color:#d4af37;color:#0a0f1e;font-weight:bold}button.primary:hover{background-color:#d4af37;box-shadow:0 0 8px rgba(212,175,55,.7)}*::-webkit-scrollbar{width:6px;height:6px}*::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}*::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}*::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}#toast-container>.toast{border:1px solid #d4af37;color:#0a0f1e;text-shadow:none;font-family:"Siyuan Song","Source Han Serif SC",serif;font-weight:bold;border-radius:5px;box-shadow:0 5px 20px rgba(212,175,55,.5);opacity:.9}#toast-container>.toast .toast-title{font-family:"ZCOOL KuaiLe","篆书",cursive;font-weight:bold}#toast-container>.toast .toast-message{font-weight:normal}#toast-container>.toast.toast-info{background-color:rgba(58,143,157,.8);border-color:#3a8f9d;color:#fff}#toast-container>.toast.toast-error{background-color:rgba(199,67,67,.8);border-color:#c74343;color:#fff}#toast-container>.toast.toast-success{background-color:rgba(92,184,92,.8);border-color:#5cb85c;color:#fff}@keyframes border-flow{0%{border-image-source:linear-gradient(to right,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}25%{border-image-source:linear-gradient(to bottom,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}50%{border-image-source:linear-gradient(to left,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}75%{border-image-source:linear-gradient(to top,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}100%{border-image-source:linear-gradient(to right,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}}.panel-base{border-radius:5px;box-shadow:0 8px 35px rgba(10,15,30,.5);color:#000;border-style:solid;border-width:2px;border-image-slice:1;animation:border-flow 8s infinite linear}.panel-titlebar{background-color:rgba(10,15,30,.5);border-bottom:1px solid rgba(212,175,55,.3);height:40px;font-family:"ZCOOL KuaiLe","篆书",cursive;display:flex;align-items:center;padding:0 16px}.panel-titlebar-text{color:#f0e6d2;font-size:18px;font-weight:normal;padding:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.panel-titlebar-button-close{color:#a0a0a0;font-size:16px}.panel-titlebar-button-close::after{content:"×";padding:0}.panel-titlebar-button-close:hover{color:#c74343;transform:scale(1.2)}.panel-titlebar-button-pin{color:#a0a0a0;font-size:14px;cursor:pointer;margin-right:16px;transition:all .3s ease}.panel-titlebar-button-pin.locked{color:#3a8f9d;transform:rotate(45deg)}.panel-titlebar-button-pin:hover{color:#3a8f9d;transform:scale(1.2)}.panel-content{background-color:rgba(0,0,0,0)}.panel-content::-webkit-scrollbar{width:6px;height:6px}.panel-content::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.panel-content::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.panel-content::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.dockspan-tab-host{background-color:rgba(0,0,0,0)}.dockspan-tab-handle-list-container{background-color:rgba(10,15,30,.3);border-bottom:1px solid rgba(212,175,55,.2)}.dockspan-tab-handle{background-color:rgba(0,0,0,0);color:#a0a0a0;border-right:1px solid rgba(212,175,55,.2);padding:16px;transition:all .3s ease}.dockspan-tab-handle:hover{background-color:rgba(58,143,157,.2);color:#3a8f9d}.dockspan-tab-handle-selected{background-color:rgba(212,175,55,.2);color:#f0e6d2;border-bottom:2px solid #d4af37}.dockspan-tab-handle-close-button{color:#a0a0a0}.dockspan-tab-handle-close-button:hover{color:#c74343}.splitbar-horizontal,.splitbar-vertical{background-color:rgba(212,175,55,.3);transition:background-color .3s ease}.splitbar-horizontal:hover,.splitbar-vertical:hover{background-color:#d4af37}.dock-wheel-panel-preview,.panel-grayout{display:none !important}.game-container{display:grid;grid-template-columns:1fr;width:100%;height:100%;overflow:hidden;gap:1px}.character-panel,.interaction-panel{background:#f5f1e9;padding:15px;overflow-y:auto;box-shadow:inset 0 0 10px rgba(58,63,75,.03)}.character-panel{border-right:1px solid #eae6dd}.interaction-panel{border-left:1px solid #eae6dd}.main-content{padding:25px;overflow-y:auto;background:#fdfbf6;position:relative}#tablet-trigger{position:fixed;right:0;top:45%;transform:translateY(-50%);width:32px;height:80px;background-color:#fff;border:1px solid #eae6dd;border-right:none;border-radius:8px 0 0 8px;cursor:pointer;transition:all .3s ease;font-size:24px;display:flex;align-items:center;justify-content:center;color:#6c757d;z-index:1001;box-shadow:-2px 0 8px rgba(58,63,75,.08)}#tablet-trigger:hover{background-color:#f5f1e9;color:#4169e1}#tablet-container{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;background-color:rgba(58,63,75,.4);backdrop-filter:blur(5px);opacity:0;visibility:hidden;transform:scale(1.1);transition:opacity .3s ease,visibility .3s ease,transform .3s ease;z-index:200}#tablet-container.is-visible{opacity:1;visibility:visible;transform:scale(1)}#tablet-container .tablet-case{width:90%;max-width:380px;height:90vh;max-height:800px;background-color:#1a1a1a;border-radius:40px;padding:12px;box-shadow:0 20px 50px rgba(0,0,0,.3),inset 0 0 15px hsla(0,0%,100%,.1);display:flex;flex-direction:column}#tablet-container .phone-screen{width:100%;height:100%;background:linear-gradient(160deg,#f87171 0%,#a855f7 100%);border-radius:28px;overflow:hidden;position:relative;display:flex;flex-direction:column;color:#fff}#tablet-container .phone-content-area{flex-grow:1;position:relative;display:flex;flex-direction:column}#tablet-container .phone-desktop{display:flex;flex-direction:column;height:100%;padding:20px;box-sizing:border-box}#tablet-container .desktop-header{flex-shrink:0;padding:40px 0;text-align:center}#tablet-container .desktop-header .time-display #desktop-time{font-size:72px;font-weight:300;letter-spacing:1px;display:block;line-height:1}#tablet-container .desktop-header .time-display #desktop-date{font-size:16px;font-weight:400;opacity:.9}#tablet-container .app-grid{flex-grow:1;display:grid;grid-template-columns:repeat(4,1fr);gap:20px;align-content:flex-start}#tablet-container .desktop-dock-indicator{flex-shrink:0;display:flex;justify-content:center;padding:15px 0}#tablet-container .desktop-dock-indicator span{width:8px;height:8px;background-color:hsla(0,0%,100%,.5);border-radius:50%}#tablet-container .app-view-container{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background-color:#fdfbf6;z-index:10;flex-direction:column;color:#3a3f4b}#tablet-container .app-view-container.active{display:flex}#tablet-container .phone-nav-bar{height:50px;flex-shrink:0;display:flex;justify-content:space-around;align-items:center;padding:0 20px;background:rgba(0,0,0,.1)}#tablet-container .phone-nav-bar .nav-btn{background:none;border:none;color:#fff;opacity:.8;cursor:pointer;padding:5px}#tablet-container .phone-nav-bar .nav-btn svg{width:20px;height:20px}#tablet-container .app-icon{display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;text-decoration:none}#tablet-container .app-icon .app-icon-visual{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;box-shadow:0 5px 15px rgba(0,0,0,.15);transition:transform .2s ease}#tablet-container .app-icon .app-icon-visual svg{width:28px;height:28px}#tablet-container .app-icon .app-icon-name{font-size:12px;color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.3)}#tablet-container .app-icon:hover .app-icon-visual{transform:scale(1.1)}#tablet-container .app-icon[data-app-id=tianhuachat] .app-icon-visual{background-color:#3b82f6}#tablet-container .app-icon[data-app-id=campus-pass] .app-icon-visual{background-color:#14b8a6}#tablet-container .app-icon[data-app-id=schedule] .app-icon-visual{background-color:#8b5cf6}#tablet-container .app-icon[data-app-id=health] .app-icon-visual{background-color:#ef4444}#tablet-container .app-icon[data-app-id=forum] .app-icon-visual{background-color:#0ea5e9}#tablet-container .app-icon[data-app-id=shopping] .app-icon-visual{background-color:#f97316}#tablet-container .app-icon[data-app-id=inventory] .app-icon-visual{background-color:#ec4899}#tablet-container .app-icon[data-app-id=map] .app-icon-visual{background-color:#22c55e}#tablet-container .app-icon[data-app-id=settings] .app-icon-visual{background-color:#6b7280}#tablet-container .app-icon[data-app-id=saveload] .app-icon-visual{background-color:#f39c12}#tablet-container .app-icon[data-app-id=diary] .app-icon-visual{background-color:#9b59b6}#tablet-container .app-icon[data-app-id=character-annals] .app-icon-visual{background-color:#34495e}#tablet-container .app-icon[data-app-id=calendar] .app-icon-visual{background-color:#1abc9c}#tablet-container .app-icon[data-app-id=mall] .app-icon-visual{background-color:#e67e22}.phone-status-bar{display:flex;justify-content:space-between;align-items:center;padding:4px 12px;background-color:rgba(0,0,0,.1);color:#fff;font-size:12px;position:absolute;top:0;left:0;right:0;z-index:100}.phone-status-bar .status-left,.phone-status-bar .status-right{display:flex;align-items:center;gap:6px}.phone-status-bar .status-center{font-weight:500}.phone-status-bar .battery-icon{width:22px;height:11px;border:1px solid #fff;border-radius:3px;position:relative;padding:1px}.phone-status-bar .battery-icon::after{content:"";position:absolute;right:-3px;top:2px;width:2px;height:5px;background-color:#fff;border-top-right-radius:1px;border-bottom-right-radius:1px}.phone-status-bar .battery-icon .battery-fill{height:100%;background-color:#fff;border-radius:1px;transition:width .3s ease}.phone-content-area{padding-top:24px}.panel-base{pointer-events:none}.panel-base:focus{outline:0}.panel-titlebar{width:100%;overflow:hidden;height:25px;pointer-events:auto}.panel-titlebar-icon{height:16px;margin-right:3px}.panel-titlebar-text{float:left;padding-left:10px;padding-top:5px;text-overflow:ellipsis;overflow:hidden;width:calc(100% - 30px);white-space:nowrap}.panel-titlebar-text>span{vertical-align:top}.panel-titlebar-button-close{display:flex;justify-content:flex-end;align-items:center;width:25px;height:25px;position:absolute;right:0;top:0}.panel-titlebar-button-close::after{float:right;cursor:pointer;padding-right:8px;content:"x";font-weight:normal;font-family:Verdana,Geneva,Tahoma,sans-serif;display:flex;height:100%;align-items:center}.panel-titlebar-button-close:hover{color:#000}.panel-content{width:100%;overflow:hidden}.panel-content-wrapper{width:100%;height:100%;position:relative}.panel-grayout{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:10;pointer-events:all}.panel-has-changes{font-style:italic}.panel-has-changes::before{content:"* "}.dialog-floating{position:absolute}.dialog-floating:focus{outline:0}.resize-handle{position:absolute;width:6px;height:6px;z-index:10}.resize-handle-corner{position:absolute;width:12px;height:12px;z-index:10}.resize-handle-e{cursor:e-resize}.resize-handle-w{cursor:w-resize}.resize-handle-s{cursor:s-resize}.resize-handle-n{cursor:n-resize}.resize-handle-ne{cursor:ne-resize}.resize-handle-nw{cursor:nw-resize}.resize-handle-se{cursor:se-resize}.resize-handle-sw{cursor:sw-resize}.dock-container{position:relative}.dock-wheel-base{position:absolute}.dock-wheel-item{position:absolute;width:32px;height:32px}.dock-wheel-fill{margin-left:-16px;margin-top:-16px}.dock-wheel-left{margin-left:-48px;margin-top:-16px}.dock-wheel-right{margin-left:16px;margin-top:-16px}.dock-wheel-top{margin-left:-16px;margin-top:-48px}.dock-wheel-down{margin-left:-16px;margin-top:16px}.dock-wheel-panel-preview{position:absolute;background-color:rgba(128,128,255,.5)}.dock-wheel-fill-icon{background:url("placeholder.png") 0 0}.dock-wheel-left-icon{background:url("placeholder.png") 0 0}.dock-wheel-right-icon{background:url("placeholder.png") 0 0}.dock-wheel-top-icon{background:url("placeholder.png") 0 0}.dock-wheel-down-icon{background:url("placeholder.png") 0 0}.dock-wheel-fill-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-left-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-right-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-top-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-down-icon-hover{background:url("placeholder.png") 0 0}.splitter-container-horizontal{float:left;position:relative;pointer-events:none}.splitter-container-vertical{position:relative;pointer-events:none}.splitbar-horizontal{width:100%;height:5px;cursor:n-resize;position:relative;pointer-events:auto}.splitbar-vertical{width:5px;height:100%;float:left;cursor:e-resize;position:relative;pointer-events:auto}.splitbar-horizontal-ghoust{width:100%;height:5px;cursor:n-resize;position:absolute}.splitbar-vertical-ghoust{width:5px;height:100%;position:absolute;cursor:e-resize}.dockspan-tab-host{display:inline-block;position:absolute}.dockspan-tab-content{position:relative}.dockspan-tab-content:focus{outline:0}.dockspan-tab-handle{position:relative;height:22px;float:left;overflow:hidden;cursor:pointer;padding-right:16px}.dockspan-tab-handle:hover{cursor:pointer}.dockspan-tab-handle-text{margin-top:3px;margin-left:6px;margin-right:6px;white-space:nowrap;overflow:hidden;float:left;text-overflow:ellipsis;width:calc(100% - 3px);display:block}.dockspan-tab-handle-text>span{vertical-align:top}.dockspan-tab-handle-close-button::after{margin-right:5px;float:right;position:absolute;right:0;content:"x";font-weight:normal;font-family:Verdana,Geneva,Tahoma,sans-serif;cursor:pointer;display:flex;height:100%;align-items:center}.dockspan-tab-handle-close-button:hover{color:#000}.dockspan-tab-handle-list-container{height:22px;overflow:hidden;display:none;pointer-events:auto}.dockspan-tab-handle-list-container-visible{display:flex}.dockspan-tab-handle-content-seperator{height:4px;display:none}.dockspan-tab-handle-content-seperator-visible{display:block}.dockspab-tab-handle-context-menu{position:absolute;z-index:10000000;background-color:#fff;border:#fff;border:#000 solid 2px;padding:5px}.dockspab-tab-handle-context-menu>div{cursor:pointer;padding:2px}.dockspab-tab-handle-context-menu>div:hover{background-color:gray;cursor:pointer;padding:2px}.disable-selection{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:default}.panel-titlebar{background-color:#333;pointer-events:auto}.panel-titlebar-text{font-weight:bold;color:#aaa}.panel-titlebar-button-close{color:#aaa}.panel-titlebar-button-close:hover{color:red}.panel-content{overflow:auto}.panel-element-content-container{background-color:#fff}.dialog-floating{box-shadow:5px 5px 20px #000;pointer-events:none}.draggable-dragging-active{opacity:.95}.resize-handle{pointer-events:auto}.resize-handle-corner{pointer-events:auto}.dock-container{background-color:#888}.document-manager{background-color:#666}.splitbar-horizontal{background-color:#000}.splitbar-horizontal:hover{background-color:#5b636c}.splitbar-horizontal:active{background-color:#5b636c}.splitbar-vertical{background-color:#000}.splitbar-vertical:hover{background-color:#5b636c}.splitbar-vertical:active{background-color:#5b636c}.splitbar-horizontal-ghoust{background-color:#fc0}.splitbar-vertical-ghoust{background-color:#fc0}.dockspan-tab-host{background-color:#fff}.dockspan-tab-content{background-color:#fff}.dockspan-tab-content>*{background-color:#fff}.dockspan-tab-handle{background-color:gray;color:#d5d5d5;box-shadow:0px 5px 20px #000}.dockspan-tab-handle:hover{background-color:#006729;color:#fff}.dockspan-tab-handle-selected{background-color:#333;color:#fff}.dockspan-tab-handle-selected:hover{background-color:#008749;color:#fff}.dockspan-tab-handle-close-button:hover{color:red}.dockspan-tab-handle-list-container{background-color:#fff}.dockspan-tab-handle-content-seperator{background-color:#333}.dockspan-tab-handle-content-seperator-active{background-color:#008749}.dockspan-tab-handle-active{background-color:#008749}.dockspan-panel-active{background-color:#008749}.dockspan-panel-titlebar-text-active{color:#fff}.dockspab-tab-handle-context-menu{position:absolute;z-index:10000000;background-color:#fff;border:#fff;border:#000 solid 2px;padding:5px}.dockspab-tab-handle-context-menu>div{cursor:pointer;padding:2px}.dockspab-tab-handle-context-menu>div:hover{background-color:gray;cursor:pointer;padding:2px}.mall-app{background-color:#f8f9fa}.mall-home-view .search-bar{border-radius:9999px;border:1px solid #e5e7eb;background-color:#fff;box-shadow:0 1px 3px rgba(0,0,0,.05)}.mall-home-view .search-bar:focus{outline:none;border-color:#4f46e5;box-shadow:0 0 0 2px rgba(79,70,229,.2)}.mall-home-view .product-grid{padding-bottom:4rem}.product-card{border:none;border-radius:12px;background-color:#fff;overflow:hidden;display:flex;flex-direction:row;transition:transform .2s ease-in-out,box-shadow .2s ease-in-out;padding:.75rem;gap:.75rem;align-items:flex-start;box-shadow:0 2px 4px rgba(0,0,0,.05)}.product-card .product-image-container{flex-shrink:0;width:90px;height:90px}.product-card .product-image{width:100%;height:100%;border-radius:8px;background-color:#f0f2f5}.product-card .product-details{display:flex;flex-direction:column;flex-grow:1;min-width:0}.product-card .product-name{font-size:1rem;font-weight:600;color:#1f2937}.product-card .product-description{font-size:.8rem;color:#6b7280;margin:.25rem 0;flex-grow:1;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;line-height:1.4}.product-card .product-footer{display:flex;justify-content:space-between;align-items:center;margin-top:auto}.product-card .product-price{font-size:1.1rem;font-weight:bold;color:#ef4444;margin:0}.product-card .product-stock{font-size:.75rem;color:#6b7280}.product-card button{margin:0;background-color:#4f46e5;color:#fff;border:none;width:32px;height:32px;border-radius:50%;cursor:pointer;font-weight:bold;font-size:1.5rem;line-height:1;display:flex;align-items:center;justify-content:center;transition:background-color .2s}.product-card button:hover{background-color:#4338ca}.product-card button:disabled{background-color:#9ca3af;cursor:not-allowed}.mall-page-container{padding:1rem;height:100%;overflow-y:auto}.mall-page-container .page-title{font-size:1.5rem;font-weight:700;margin-bottom:1.5rem}.mall-page-container .empty-state{text-align:center;color:#6b7280;margin-top:4rem;font-size:1rem}.cart-view .cart-item{display:flex;align-items:center;gap:1rem;padding:1rem 0;border-bottom:1px solid #e5e7eb}.cart-view .cart-item .item-name{flex-grow:1;font-weight:500}.cart-view .cart-item .item-quantity{color:#6b7280}.cart-view .cart-item .item-price{font-weight:600;min-width:60px;text-align:right}.cart-view .cart-summary{margin-top:1.5rem;padding:1rem;background-color:#fff;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.05)}.cart-view .cart-summary .summary-row{display:flex;justify-content:space-between;margin-bottom:.5rem}.cart-view .cart-summary .summary-row.total{font-weight:bold;font-size:1.1rem;margin-top:1rem}.cart-view .checkout-btn{width:100%;padding:.875rem;border-radius:8px;border:none;background-color:#10b981;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;margin-top:1.5rem}.cart-view .checkout-btn:disabled{background-color:#9ca3af;cursor:not-allowed}.my-mall-view .user-info-card{background:linear-gradient(to right,#6366f1,#8b5cf6);color:#fff;padding:1.5rem;border-radius:12px;margin-bottom:1.5rem}.my-mall-view .user-info-card h2{margin:0;font-size:1.5rem}.my-mall-view .user-info-card p{margin:.25rem 0 0;font-size:1rem;opacity:.9}.my-mall-view .section-title{font-size:1.2rem;font-weight:600;margin-bottom:1rem}.my-mall-view .order-item{display:flex;justify-content:space-between;align-items:center;padding:1rem;background-color:#fff;border-radius:8px;margin-bottom:.75rem;box-shadow:0 1px 3px rgba(0,0,0,.05)}.my-mall-view .order-item .order-details{font-weight:500}.my-mall-view .order-item .order-delivery-time{font-size:.8rem;color:#6b7280}.character-annals-app{display:flex;height:100%;width:100%;background-color:#f9f9f9;font-family:sans-serif}.character-annals-app .character-list-view{width:280px;flex-shrink:0;background-color:#fff;border-right:1px solid #e0e0e0;display:flex;flex-direction:column}.character-annals-app .character-list-view .search-bar{padding:12px;border-bottom:1px solid #e0e0e0}.character-annals-app .character-list-view .search-bar input{width:100%;padding:8px 12px;border-radius:15px;border:1px solid #ccc;box-sizing:border-box}.character-annals-app .character-list-view .search-bar input:focus{outline:none;border-color:#0d6efd}.character-annals-app .character-list-view .character-list{list-style:none;padding:0;margin:0;overflow-y:auto;flex-grow:1}.character-annals-app .character-list-view .character-list .character-card{padding:15px;border-bottom:1px solid #f0f0f0;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:background-color .2s ease}.character-annals-app .character-list-view .character-list .character-card:hover{background-color:#e7f0fe}.character-annals-app .character-list-view .character-list .character-card .character-name{font-weight:600;color:#333}.character-annals-app .character-list-view .character-list .character-card .character-class{font-size:.85em;color:#777;background-color:#eee;padding:2px 6px;border-radius:8px}.character-annals-app .detail-view-container{flex-grow:1;overflow-y:auto}.character-annals-app .detail-view-container .character-detail-view{padding:24px}.character-annals-app .detail-view-container .placeholder{display:flex;justify-content:center;align-items:center;height:100%;color:#aaa;font-size:1.2em}.detail-header{border-bottom:1px solid #e0e0e0;padding-bottom:20px;margin-bottom:20px}.detail-header h1{margin:0 0 8px 0;font-size:2em;color:#2c3e50}.detail-header .signature{font-style:italic;color:#666;margin:5px 0}.detail-header .tags{margin-top:12px}.detail-header .tags .tag{display:inline-block;background-color:#e0e0e0;padding:4px 10px;border-radius:12px;font-size:.8em;margin-right:8px}.detail-header .tags .tag.identity{background-color:#4169e1;color:#fff}.detail-header .header-main{display:flex;justify-content:space-between;align-items:flex-start}.detail-header .avatar-container{flex-shrink:0;width:60px;height:80px}.detail-header .character-avatar,.detail-header .character-avatar-placeholder{width:100%;height:100%;object-fit:cover;border-radius:8px}.detail-header .character-avatar-placeholder{font-size:2rem}.detail-tabs{display:flex;border-bottom:1px solid #ccc;margin-bottom:20px}.detail-tabs button{padding:12px 24px;border:none;background:none;cursor:pointer;font-size:1em;color:#666;border-bottom:3px solid rgba(0,0,0,0);transition:all .2s ease}.detail-tabs button.active{border-bottom-color:#0d6efd;color:#0d6efd;font-weight:600}.attribute-section{margin-bottom:25px}.attribute-section h3{margin-bottom:15px;font-size:1.2em;color:#333;border-bottom:1px solid #eee;padding-bottom:8px}.attribute-section ul{list-style:none;padding:0}.attribute-section ul li{display:flex;justify-content:space-between;padding:8px 0;font-size:.95em;border-bottom:1px dashed #f0f0f0}.attribute-section ul li:last-child{border-bottom:none}.relationships-panel{width:100%;height:100%}.enhanced-input-box-container{width:100%;position:relative}.input-wrapper{display:flex;width:100%;align-items:center;position:relative;padding:8px;background-color:rgba(10,15,30,.8);border:1px solid rgba(212,175,55,.3);border-radius:30px;box-shadow:0 0 15px rgba(10,15,30,.5),inset 0 0 5px rgba(10,15,30,.5);padding-left:55px;padding-right:55px}textarea{flex-grow:1;resize:none;padding:.5rem 1rem;border:none;background-color:rgba(0,0,0,0);font-size:1rem;line-height:1.5;color:#e0e0e0;min-height:40px;font-family:"Siyuan Song","Source Han Serif SC",serif;outline:none}textarea::placeholder{color:rgba(224,224,224,.4)}.button-group{display:flex;gap:8px;padding-left:8px}.action-button{padding:.5rem 1.2rem;font-size:.9rem;border-radius:20px;font-family:"ZCOOL KuaiLe","篆书",cursive;min-width:90px;text-align:center}.action-button.primary{background-color:#d4af37;color:#0a0f1e;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.action-button.primary:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);box-shadow:0 0 10px rgba(212,175,55,.5)}.action-button.primary{background-color:#d4af37;color:#0a0f1e}.action-button.primary:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);box-shadow:0 0 12px rgba(212,175,55,.7)}.action-button:not(.primary){background-color:rgba(0,0,0,0);color:#f0e6d2;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.action-button:not(.primary):hover{background-color:rgba(212,175,55,.1);border-color:rgb(221.024691358,191.7901234568,96.975308642)}.action-button:not(.primary){background-color:rgba(22,33,44,.7);border-color:rgba(212,175,55,.4);color:#f0e6d2}.action-button:not(.primary):hover{background-color:#16212c;border-color:#d4af37}.command-queue-popup{position:absolute;bottom:100%;right:1rem;width:300px;margin-bottom:.5rem;z-index:10;border:1px solid rgba(212,175,55,.4);border-radius:5px;box-shadow:0 5px 20px rgba(0,0,0,.2);padding:16px}.command-list{max-height:150px;overflow-y:auto;margin-bottom:16px}.command-item{padding:8px;border-bottom:1px solid rgba(212,175,55,.2);font-size:.9rem;color:#e0e0e0}.command-item:last-child{border-bottom:none}.empty-queue{color:rgba(224,224,224,.6);font-style:italic;text-align:center;padding:24px 0}.clear-button{width:100%;padding:8px;background-color:rgba(199,67,67,.6);color:#e0e0e0;border:1px solid rgba(199,67,67,.8);border-radius:3px;cursor:pointer;transition:all .2s ease}.clear-button:hover{background-color:#c74343;box-shadow:0 0 10px rgba(199,67,67,.5)}.input-history-popup{background-color:rgba(10,15,30,.95);backdrop-filter:blur(8px);border:1px solid rgba(212,175,55,.5);border-radius:5px;padding:24px;box-shadow:0 8px 30px rgba(0,0,0,.4);width:450px;max-width:90vw;display:flex;flex-direction:column;gap:24px;position:absolute;bottom:calc(100% + 16px);left:50%;transform:translateX(-50%);z-index:1000}.input-history-popup .history-section h4{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;font-size:16px;margin-bottom:16px;border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:8px}.input-history-popup .history-section ul{list-style:none;padding:0;margin:0;max-height:150px;overflow-y:auto;display:flex;flex-direction:column;gap:8px}.input-history-popup .history-section li{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:3px;background-color:rgba(10,15,30,.2);transition:background-color .2s ease}.input-history-popup .history-section li:hover{background-color:rgba(240,230,210,.1)}.input-history-popup .history-section .entry-text{color:#e0e0e0;cursor:pointer;flex-grow:1;margin-right:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.input-history-popup .history-section .actions{display:flex;gap:8px;flex-shrink:0}.input-history-popup .history-section .actions button{font-size:12px;padding:4px 8px}.input-history-popup .history-section .actions button:disabled{opacity:.5;cursor:not-allowed}.input-history-popup .history-section .empty-text{color:#a0a0a0;font-style:italic}.input-history-popup .close-button-popup{align-self:flex-end;margin-top:16px}@keyframes orbit{from{transform:rotate(0deg) translateX(150px) rotate(0deg)}to{transform:rotate(360deg) translateX(150px) rotate(-360deg)}}.world-detail-modal-content{width:500px;max-width:90vw;color:#e0e0e0;background:radial-gradient(ellipse at top,rgb(30.5,45.75,61),#0a0f1e 80%);padding:24px;border:1px solid rgba(212,175,55,.2)}.world-detail-modal-content .scroll-container{max-height:70vh;overflow-y:auto;padding-right:8px}.world-detail-modal-content .scroll-container::-webkit-scrollbar{width:6px;height:6px}.world-detail-modal-content .scroll-container::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.world-detail-modal-content .scroll-container::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.world-detail-modal-content .scroll-container::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.world-detail-modal-content .world-section{margin-bottom:32px;position:relative}.world-detail-modal-content .section-title{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px;color:#f0e6d2;padding-bottom:16px;margin-bottom:24px;text-align:center;letter-spacing:2px;border-bottom:1px solid rgba(212,175,55,.3)}.world-detail-modal-content .rules-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:24px;text-align:center;padding:16px;border-radius:5px;background:rgba(10,15,30,.3)}.world-detail-modal-content .rule-item .rule-name{font-size:12px;color:#a0a0a0;margin-bottom:8px}.world-detail-modal-content .rule-item .rule-value{font-size:18px;font-weight:bold;color:#e0e0e0}.world-detail-modal-content .system-overview{font-style:italic;color:#a0a0a0;text-align:center;margin-bottom:32px;padding:0 24px}.world-detail-modal-content .ladder-container{position:relative;height:350px;margin:32px 0}.world-detail-modal-content .ladder-container::before{content:"";position:absolute;top:0;bottom:0;left:50%;transform:translateX(-50%);width:2px;background:linear-gradient(to bottom,transparent,#d4af37 50%,transparent 100%);opacity:.7}.world-detail-modal-content .境界-ladder{list-style:none;padding:0;margin:0;position:absolute;top:50%;left:50%;width:1px;height:1px}.world-detail-modal-content .ladder-step{position:absolute;display:flex;flex-direction:column;align-items:center;gap:4px}.world-detail-modal-content .ladder-step:nth-child(1){transform:rotate(0deg) translateX(95px) rotate(-0deg);animation:orbit 25s linear infinite;animation-direction:normal}.world-detail-modal-content .ladder-step:nth-child(2){transform:rotate(72deg) translateX(110px) rotate(-72deg);animation:orbit 30s linear infinite;animation-direction:reverse}.world-detail-modal-content .ladder-step:nth-child(3){transform:rotate(144deg) translateX(125px) rotate(-144deg);animation:orbit 35s linear infinite;animation-direction:normal}.world-detail-modal-content .ladder-step:nth-child(4){transform:rotate(216deg) translateX(140px) rotate(-216deg);animation:orbit 40s linear infinite;animation-direction:reverse}.world-detail-modal-content .ladder-step:nth-child(5){transform:rotate(288deg) translateX(155px) rotate(-288deg);animation:orbit 45s linear infinite;animation-direction:normal}.world-detail-modal-content .ladder-step::before{content:"";width:10px;height:10px;border-radius:50%;background:#f0e6d2;box-shadow:0 0 8px #f0e6d2,0 0 15px #d4af37}.world-detail-modal-content .ladder-step .level-name,.world-detail-modal-content .ladder-step .level-energy{position:absolute;top:-30px;white-space:nowrap;background:rgba(22,33,44,.8);padding:2px 6px;border-radius:3px}.world-detail-modal-content .ladder-step .level-name{font-weight:bold;color:#f0e6d2;font-size:14px}.world-detail-modal-content .ladder-step .level-energy{display:none}.settlement-choice-card{background-color:rgba(22,33,44,.6);border:1px solid rgba(212,175,55,.3);border-radius:5px;padding:16px;cursor:pointer;transition:all .3s ease;backdrop-filter:blur(8px);display:flex;flex-direction:column;justify-content:space-between;min-height:240px}.settlement-choice-card:hover{border-color:rgba(240,230,210,.7);background-color:rgba(22,33,44,.8);box-shadow:0 5px 25px rgba(10,15,30,.6);transform:translateY(-5px)}.settlement-choice-card.is-selected{border-color:#f0e6d2;box-shadow:0 0 20px rgba(240,230,210,.4);background:rgba(22,33,44,.9)}.settlement-choice-card .card-header{text-align:center;padding-bottom:8px;border-bottom:1px solid rgba(212,175,55,.2);margin-bottom:16px}.settlement-choice-card .card-header .choice-type{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;font-size:20px;text-shadow:0 0 8px rgba(240,230,210,.7)}.settlement-choice-card .card-body{flex-grow:1}.settlement-choice-card .card-body .description{color:#e0e0e0;font-size:14px;line-height:1.7;margin-bottom:16px}.settlement-choice-card .card-body .data-details{background-color:rgba(10,15,30,.4);padding:16px;border-radius:3px;border-left:3px solid #3a8f9d}.settlement-choice-card .card-body .data-details .data-name{color:#3a8f9d;font-weight:bold;font-size:16px;margin-bottom:8px;display:block}.settlement-choice-card .card-body .data-details .data-description{color:hsl(0,0%,77.7450980392%);font-size:14px;line-height:1.6}.settlement-choice-card .card-footer{text-align:right;padding-top:16px;margin-top:16px;border-top:1px solid rgba(212,175,55,.1)}.settlement-choice-card .card-footer .cost{color:#c74343;font-size:14px;font-weight:bold;text-shadow:0 0 5px rgba(199,67,67,.5)}.settlement-view{display:flex;flex-direction:column;height:100%;padding:24px}.settlement-view .choices-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:24px;overflow-y:auto;padding-bottom:24px}.settlement-view .choices-grid::-webkit-scrollbar{width:6px;height:6px}.settlement-view .choices-grid::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.settlement-view .choices-grid::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.settlement-view .choices-grid::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.settlement-view .no-choices{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;height:100%;color:#a0a0a0;font-size:16px}.settlement-view .no-choices p{margin:8px 0}.settlement-view .actions-footer{padding-top:24px;margin-top:auto;display:flex;justify-content:flex-end;border-top:1px solid rgba(58,143,157,.2)}.settlement-view .actions-footer .confirm-button{background-color:#d4af37;color:#0a0f1e;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.settlement-view .actions-footer .confirm-button:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);box-shadow:0 0 10px rgba(212,175,55,.5)}.settlement-view .actions-footer .confirm-button{padding:16px 32px;font-size:16px}.settlement-view .actions-footer .confirm-button:disabled{background-color:#a0a0a0;color:rgba(10,15,30,.7);border-color:#a0a0a0;cursor:not-allowed}.guixu-root-container.mobile-view .main-layout{display:grid !important;grid-template-columns:1fr !important}.guixu-root-container.mobile-view .top-overlays{padding:4px 8px}.guixu-root-container.mobile-view .side-panel.is-mobile-overlay,.guixu-root-container.mobile-view .right-side-panel.is-mobile-overlay{position:fixed;top:0;bottom:0;width:280px;max-width:75%;z-index:800;overflow:hidden}.guixu-root-container.mobile-view .side-panel.is-mobile-overlay{left:0}.guixu-root-container.mobile-view .right-side-panel.is-mobile-overlay{right:0}.guixu-root-container.mobile-view .is-mobile-overlay .side-panel-container{background-color:rgba(22,33,44,.95) !important;backdrop-filter:blur(12px) !important;-webkit-backdrop-filter:blur(12px) !important;border:1px solid rgba(212,175,55,.3) !important;box-shadow:0 5px 50px rgba(0,0,0,.7) !important;height:100% !important;padding-top:24px !important}.guixu-root-container.mobile-view .mobile-time-display{padding:8px 16px;margin-bottom:16px;border-bottom:1px solid rgba(212,175,55,.2)}.guixu-root-container.mobile-view .slide-left-enter-active,.guixu-root-container.mobile-view .slide-left-leave-active,.guixu-root-container.mobile-view .slide-right-enter-active,.guixu-root-container.mobile-view .slide-right-leave-active{transition:transform .35s cubic-bezier(0.23,1,0.32,1)}.guixu-root-container.mobile-view .slide-left-enter-from,.guixu-root-container.mobile-view .slide-left-leave-to{transform:translateX(-100%)}.guixu-root-container.mobile-view .slide-right-enter-from,.guixu-root-container.mobile-view .slide-right-leave-to{transform:translateX(100%)}.text-dialogue{color:#f0e6d2}.enhanced-input-box-container .input-wrapper{display:flex;align-items:stretch;gap:8px}.enhanced-input-box-container .button-group{display:flex;gap:8px}.enhanced-input-box-container .side-buttons{display:flex;flex-direction:column;gap:4px}.enhanced-input-box-container .side-buttons .action-button{flex-grow:1}.enhanced-input-box-container .lm_header .lm_tab .lm_close_tab,.enhanced-input-box-container .lm_controls .lm_popout,.enhanced-input-box-container .lm_controls .lm_maximise,.enhanced-input-box-container .lm_controls .lm_close{background-image:none !important}.text-psychology{color:#8a5db5;font-style:italic}.text-scenery{color:#3a8f9d}.text-system-highlight{color:#d4af37;font-weight:bold}.lm_header{height:32px !important}.lm_tab{height:30px !important;line-height:30px !important;padding-bottom:0 !important}.lm_tab .lm_close_tab{width:20px !important;height:20px !important;right:6px !important;top:5px !important;background-size:16px 16px;background-repeat:no-repeat;background-position:center;background-image:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23a0a0a0"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>') !important}.lm_tab .lm_close_tab:hover{background-image:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffffff"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>') !important}.main-content-wrapper{position:absolute;top:0;left:0;right:0;bottom:0;box-sizing:border-box;overflow-y:auto;padding:25px;background:#fdfbf6}
.storyline-stage-detail{display:flex;flex-direction:column;gap:24px}.storyline-stage-detail .detail-block strong{display:block;color:#f0e6d2;font-weight:bold;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:16px;margin-bottom:8px;padding-bottom:4px;border-bottom:1px solid rgba(212,175,55,.3)}.storyline-stage-detail .detail-block p,.storyline-stage-detail .detail-block span{color:#e0e0e0;line-height:1.7;margin:0}.storyline-stage-detail .detail-block .key-points-list{list-style-type:disc;padding-left:24px;margin:0;color:#e0e0e0}.storyline-stage-detail .detail-block .key-points-list li{margin-bottom:8px}
.timeline-panel{color:#e0e0e0;height:100%;display:flex;flex-direction:column;position:relative;overflow:hidden}.timeline-panel .calendar-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.timeline-panel .calendar-header .panel-title{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px;color:#f0e6d2;margin:0}.timeline-panel .calendar-header button{background:rgba(0,0,0,0);border:1px solid #f0e6d2;color:#f0e6d2;cursor:pointer}.timeline-panel .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:2px}.timeline-panel .calendar-grid .day-header{text-align:center;font-weight:bold;color:#a0a0a0;padding-bottom:8px}.timeline-panel .calendar-grid .day-cell{border:1px solid rgba(212,175,55,.2);padding:4px;display:flex;flex-direction:column;min-height:50px;cursor:pointer;transition:background-color .2s}.timeline-panel .calendar-grid .day-cell:hover{background-color:rgba(240,230,210,.05)}.timeline-panel .calendar-grid .day-cell.selected{background-color:rgba(240,230,210,.1);border-color:#f0e6d2}.timeline-panel .calendar-grid .day-cell.other-month .day-number{color:#a0a0a0;opacity:.5}.timeline-panel .calendar-grid .day-number{font-weight:bold;margin-bottom:8px}.timeline-panel .calendar-grid .events-container{flex-grow:1;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:4px}.timeline-panel .calendar-grid .event-marker{background-color:#d4af37;border-radius:50%;width:8px;height:8px}.timeline-panel .calendar-grid .festival-marker{background-color:#3a8f9d}.timeline-panel .details-drawer{position:absolute;bottom:0;left:0;right:0;height:auto;top:calc(100% - 40px);background-color:#101828;border-top:1px solid #d4af37;transition:top .4s ease-in-out;display:flex;flex-direction:column}.timeline-panel .details-drawer.is-open{top:120px}.timeline-panel .drawer-handle{flex-shrink:0;height:40px;cursor:pointer;position:relative}.timeline-panel .drawer-handle::before{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:40px;height:4px;background-color:rgba(212,175,55,.7);border-radius:2px}.timeline-panel .details-content{flex-grow:1;overflow-y:auto;padding:0 16px 16px}.timeline-panel .details-content::-webkit-scrollbar{width:6px;height:6px}.timeline-panel .details-content::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.timeline-panel .details-content::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.timeline-panel .details-content::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.timeline-panel .no-selection-message{text-align:center;color:#a0a0a0;height:100%;display:flex;justify-content:center;align-items:center}.timeline-panel .day-details .detail-section{margin-bottom:24px}.timeline-panel .day-details .detail-section h4{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:18px;color:#f0e6d2;margin-bottom:16px}.timeline-panel .day-details .detail-section p{color:#e0e0e0;line-height:1.6}.timeline-panel .day-details .detail-section .stage-summary{font-style:italic;color:#a0a0a0;margin-bottom:16px}
.dock-manager-host{width:100%;height:100%;position:absolute;top:0;left:0}.dock-manager-host .lm_goldenlayout{background:rgba(0,0,0,0)}.dock-manager-host .lm_root{position:absolute !important}.dock-manager-host .lm_header{background-color:rgba(25,30,45,.8)}.dock-manager-host .lm_header .lm_tab{background-color:rgba(0,0,0,0);color:#ccc;border-right:1px solid #111}.dock-manager-host .lm_header .lm_tab.lm_active{background-color:rgba(45,55,80,.8);color:#fff}.dock-manager-host .lm_content{background:rgba(15,20,35,.85);border:1px solid rgba(180,160,120,.2)}.dock-manager-host .lm_close_tab{font-size:1.2rem;font-weight:bold;color:#ff6b6b}.dock-manager-host .lm_close_tab:hover{background:#ff6b6b;color:#111}
.loading-overlay[data-v-2f88c8df]{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;z-index:9999}.loading-content[data-v-2f88c8df]{background-color:#16212c;border:1px solid rgba(212,175,55,.5);border-radius:5px;padding:32px;box-shadow:0 12px 40px rgba(0,0,0,.4);display:flex;flex-direction:column;align-items:center;gap:24px;width:80%;max-width:500px;text-align:center}.loading-content .tip[data-v-2f88c8df]{font-family:"Siyuan Song","Source Han Serif SC",serif;font-size:15px;color:#a9a9a9;line-height:1.7;font-style:italic}.loading-content .progress-bar-container[data-v-2f88c8df]{width:100%;height:4px;background-color:hsla(0,0%,100%,.1);border-radius:2px;margin-top:5px}.loading-content .progress-bar[data-v-2f88c8df]{height:100%;background-color:#a9a9a9;transition:width .2s linear;border-radius:2px}.loading-content .progress-text[data-v-2f88c8df]{font-family:"Siyuan Song","Source Han Serif SC",serif;font-size:13px;color:#6c757d;margin-top:10px}.loading-content .error-container .error-title[data-v-2f88c8df]{color:#c74343;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:24px;margin-bottom:16px;text-shadow:0 0 8px rgba(199,67,67,.6)}.loading-content .error-container .error-message[data-v-2f88c8df]{color:#e0e0e0;font-size:14px;margin-bottom:24px}.loading-content .error-container .error-tip[data-v-2f88c8df]{color:#a0a0a0;font-size:12px}
.npc-list-modal-content[data-v-b20458ac]{width:100%;max-height:60vh;overflow-y:auto}.npc-list-modal-content[data-v-b20458ac]::-webkit-scrollbar{width:6px;height:6px}.npc-list-modal-content[data-v-b20458ac]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.npc-list-modal-content[data-v-b20458ac]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.npc-list-modal-content[data-v-b20458ac]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.npc-list[data-v-b20458ac]{list-style:none;padding:0;margin:0}.npc-item[data-v-b20458ac]{padding:16px;border-bottom:1px solid rgba(212,175,55,.2)}.npc-item[data-v-b20458ac]:last-child{border-bottom:none}.npc-header[data-v-b20458ac]{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:8px}.npc-name[data-v-b20458ac]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:16px;color:#f0e6d2}.npc-identity[data-v-b20458ac]{font-size:12px;color:#a0a0a0;font-style:italic}.npc-description[data-v-b20458ac]{font-size:14px;color:#e0e0e0;line-height:1.7;margin:0}.no-npcs[data-v-b20458ac]{text-align:center;padding:32px;color:#a0a0a0}
.attribute-display[data-v-4be36c02]{background-color:rgba(22,33,44,.5);border:1px solid rgba(212,175,55,.2);border-radius:5px;padding:12px}.attribute-header[data-v-4be36c02]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.attribute-header .attribute-name[data-v-4be36c02]{font-weight:bold;color:#e0e0e0}.attribute-header .attribute-level[data-v-4be36c02]{font-size:18px;font-weight:bold;font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2}.xp-bar[data-v-4be36c02]{width:100%;height:6px;background-color:rgba(10,15,30,.5);border-radius:3px;overflow:hidden;margin-bottom:8px}.xp-bar .xp-bar-fill[data-v-4be36c02]{height:100%;background:linear-gradient(90deg,#f0e6d2,#d4af37);border-radius:3px;transition:width .5s ease}.attribute-details[data-v-4be36c02]{display:flex;justify-content:space-between;font-size:12px;color:#a0a0a0}
.experience-bar[data-v-c70ebe1c]{position:relative;height:20px;background-color:#2a2f45;border-radius:4px;overflow:hidden;margin:10px 0;border:1px solid rgba(212,175,55,.2)}.experience-bar .progress-fill[data-v-c70ebe1c]{height:100%;background:linear-gradient(90deg,rgba(212,175,55,0.5) 0%,rgba(212,175,55,0.8) 100%);transition:width .5s ease}.experience-bar .progress-text[data-v-c70ebe1c]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:12px;font-weight:bold;text-shadow:1px 1px 2px rgba(0,0,0,.7)}.character-app-container[data-v-c70ebe1c]{padding:15px;height:100%;overflow-y:auto;background-color:#10141d;color:#e0e0e0;position:relative}.character-app[data-v-c70ebe1c]{display:flex;flex-direction:column;gap:15px}.card[data-v-c70ebe1c]{background-color:rgba(21,26,48,.4);border:1px solid rgba(212,175,55,.15);border-radius:12px;padding:15px}.character-header[data-v-c70ebe1c]{display:flex;align-items:center}.avatar[data-v-c70ebe1c]{width:60px;height:60px;border-radius:50%;background-color:#151a30;display:flex;justify-content:center;align-items:center;font-size:30px;font-weight:bold;color:#fafad2;margin-right:15px;flex-shrink:0;border:2px solid rgba(212,175,55,.5)}.character-info .character-name[data-v-c70ebe1c]{font-family:"Noto Serif SC",serif;font-size:22px;margin:0;color:#f0f0f0}.character-info .character-identity[data-v-c70ebe1c]{font-size:13px;margin:4px 0 0;color:#a0a0a0}.tabs[data-v-c70ebe1c]{display:flex;background-color:rgba(21,26,48,.4);border-radius:10px;padding:4px}.tabs button[data-v-c70ebe1c]{flex:1;padding:8px;border:none;background-color:rgba(0,0,0,0);color:#a0a0a0;cursor:pointer;transition:background-color .3s,color .3s;border-radius:8px}.tabs button.active[data-v-c70ebe1c]{background-color:rgba(212,175,55,.2);color:#fafad2;font-weight:bold}.tab-content .card[data-v-c70ebe1c]{min-height:300px}.status-list[data-v-c70ebe1c]{display:flex;flex-direction:column;gap:8px}.status-item[data-v-c70ebe1c]{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background-color:rgba(220,20,60,.15);border-left:3px solid crimson;border-radius:4px;cursor:pointer;transition:background-color .3s;font-size:14px}.status-item[data-v-c70ebe1c]:hover{background-color:rgba(220,20,60,.25)}.status-item .status-duration[data-v-c70ebe1c]{font-size:12px;color:#a0a0a0}.attributes-grid[data-v-c70ebe1c]{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}.skills-list[data-v-c70ebe1c]{display:flex;flex-direction:column;gap:12px}.skill-item[data-v-c70ebe1c]{padding:12px;background-color:rgba(30,35,55,.5);border-radius:8px;border-left:3px solid rgba(0,0,0,0);cursor:pointer;transition:all .3s}.skill-item[data-v-c70ebe1c]:hover{background-color:rgba(45,50,75,.7);border-left-color:#d4af37}.skill-item .skill-header[data-v-c70ebe1c]{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:6px}.skill-item .skill-name[data-v-c70ebe1c]{font-weight:bold;color:#f0f0f0;font-size:15px}.skill-item .skill-level[data-v-c70ebe1c]{font-size:14px;font-weight:bold}.skill-item .skill-description[data-v-c70ebe1c]{font-size:13px;color:#a0a0a0;margin:0;line-height:1.5}.loading-pane[data-v-c70ebe1c],.empty-state[data-v-c70ebe1c]{display:flex;justify-content:center;align-items:center;height:100%;font-size:14px;color:#a0a0a0}.empty-state[data-v-c70ebe1c]{height:auto;padding:20px}.modal-overlay[data-v-c70ebe1c]{position:absolute;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.7);display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[data-v-c70ebe1c]{background-color:#1c2135;border:1px solid rgba(212,175,55,.3);border-radius:8px;padding:20px;width:90%;max-width:400px}.modal-header[data-v-c70ebe1c]{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:10px;margin-bottom:15px}.modal-header h3[data-v-c70ebe1c]{margin:0;font-size:18px;color:#fafad2}.modal-header .close-button[data-v-c70ebe1c]{background:none;border:none;color:#a0a0a0;font-size:24px;cursor:pointer}.modal-body p[data-v-c70ebe1c]{margin:0 0 10px;font-size:14px;line-height:1.6;color:silver}.modal-body p strong[data-v-c70ebe1c]{color:#fafad2}
.location-node[data-v-67766190]{margin-left:20px;list-style:none;position:relative}.location-node[data-v-67766190]::before{content:"";position:absolute;top:15px;left:-12px;width:10px;height:1px;background-color:#444}.node-content[data-v-67766190]{cursor:pointer;padding:5px 0;display:flex;align-items:center}.node-content .arrow[data-v-67766190]{display:inline-block;transition:transform .2s;margin-right:8px;font-size:10px}.expanded>.node-content .arrow[data-v-67766190]{transform:rotate(90deg)}.node-details[data-v-67766190]{padding-left:15px;border-left:1px solid #444;margin-left:-7px}.node-details .description[data-v-67766190]{font-size:13px;color:#a0a0a0;margin:5px 0;padding-left:5px}.node-details .characters[data-v-67766190]{font-size:13px;margin:10px 0;padding-left:5px}.node-details .characters .character-tag[data-v-67766190]{background-color:rgba(58,143,157,.2);color:#3a8f9d;padding:2px 6px;border-radius:5px;margin-left:8px}.children-list[data-v-67766190]{padding:0;margin:10px 0 0 0;list-style:none}
.map-app[data-v-de092378]{height:100%;overflow-y:auto;background-color:#10141d;color:#e0e0e0;padding:15px}.location-tree[data-v-de092378]{list-style:none;padding:0;margin:0}
.destiny-card-panel-layout[data-v-ed5d0826]{height:100%;width:100%;background-color:#10141d;color:#fff}.list-view-container[data-v-ed5d0826]{display:grid;grid-template-columns:300px 1fr;height:100%;gap:1em;padding:1em}@media (max-width:600px){.list-view-container[data-v-ed5d0826]{grid-template-columns:1fr;padding:0;gap:0}}.card-list-section[data-v-ed5d0826]{display:flex;flex-direction:column;background-color:#1a1f2e;border-radius:8px;overflow:hidden}@media (max-width:600px){.card-list-section[data-v-ed5d0826]{border-radius:0}}.card-list[data-v-ed5d0826]{list-style:none;padding:0;margin:0;overflow-y:auto;flex-grow:1}.card-list .empty-list[data-v-ed5d0826]{padding:1em;text-align:center;color:#7f8c8d;font-style:italic}.card-list li[data-v-ed5d0826]{padding:1em;cursor:pointer;border-bottom:1px solid #4a4a5e;display:flex;justify-content:space-between;align-items:center;transition:background-color .2s ease}.card-list li[data-v-ed5d0826]:not(.empty-list):hover{background-color:#4a4a5e}.card-list li.active[data-v-ed5d0826]{background-color:#f1c40f;color:#2c3e50;font-weight:bold}.card-display-section-desktop[data-v-ed5d0826]{display:flex;justify-content:center;align-items:center;background-color:rgba(0,0,0,0);border-radius:8px;padding:1em}.card-display-section-desktop .placeholder[data-v-ed5d0826]{color:#95a5a6;font-style:italic;font-size:1.2em}.card-display-section-desktop[data-v-ed5d0826] .destiny-card{transform:scale(1);max-width:400px;width:100%}@media (max-width:600px){.card-display-section-desktop[data-v-ed5d0826]{display:none}}.card-display-section-mobile[data-v-ed5d0826]{display:flex;justify-content:center;align-items:center;padding:10px;width:100%;height:100%;position:relative}.card-display-section-mobile .back-to-list-btn[data-v-ed5d0826]{position:absolute;top:10px;left:10px;background:rgba(0,0,0,.4);color:#fff;border:1px solid hsla(0,0%,100%,.5);border-radius:20px;padding:5px 12px;cursor:pointer;z-index:10}.card-display-section-mobile[data-v-ed5d0826] .destiny-card{transform:scale(0.9);margin-top:30px}
.destiny-card-panel[data-v-5dc88b4c]{display:flex;flex-direction:column;height:100%;background-color:#0a0f1e;color:#e0e0e0}.tab-navigation[data-v-5dc88b4c]{display:flex;flex-shrink:0;border-bottom:1px solid rgba(212,175,55,.3)}.tab-navigation button[data-v-5dc88b4c]{padding:12px 24px;border:none;background-color:rgba(0,0,0,0);color:#a0a0a0;cursor:pointer;font-size:16px;position:relative;transition:color .3s ease}.tab-navigation button[data-v-5dc88b4c]::after{content:"";position:absolute;bottom:-1px;left:0;right:0;height:2px;background-color:#d4af37;transform:scaleX(0);transition:transform .3s ease}.tab-navigation button.active[data-v-5dc88b4c]{color:#f0e6d2;font-weight:bold}.tab-navigation button.active[data-v-5dc88b4c]::after{transform:scaleX(1)}.tab-navigation button[data-v-5dc88b4c]:hover:not(.active){color:#e0e0e0}.tab-content[data-v-5dc88b4c]{flex-grow:1;overflow-y:auto;position:relative}
.diary-app-container[data-v-2abe18ac]{display:flex;flex-direction:column;height:100%;background-color:#1a1d2e;color:#c8c8d4;overflow:hidden;position:relative}.app-content[data-v-2abe18ac]{flex-grow:1;overflow-y:auto;padding:20px}.side-nav-overlay[data-v-2abe18ac]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:100}.side-nav[data-v-2abe18ac]{position:absolute;top:0;left:0;width:250px;height:100%;background-color:#141726;padding:20px;z-index:101;transform:translateX(0);box-shadow:5px 0 15px rgba(0,0,0,.3)}.side-nav h3[data-v-2abe18ac]{color:#d4af37}.side-nav ul[data-v-2abe18ac]{list-style:none;padding:0;margin:0}.side-nav li[data-v-2abe18ac]{padding:10px;cursor:pointer;border-radius:4px;margin-bottom:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.side-nav li.active[data-v-2abe18ac]{background-color:#d4af37;color:#141726}.slide-enter-active[data-v-2abe18ac],.slide-leave-active[data-v-2abe18ac],.slide-fade-enter-active[data-v-2abe18ac],.slide-fade-leave-active[data-v-2abe18ac]{transition:all .3s ease}.slide-enter-from[data-v-2abe18ac],.slide-leave-to[data-v-2abe18ac]{transform:translateX(-100%)}.slide-fade-enter-from[data-v-2abe18ac],.slide-fade-leave-to[data-v-2abe18ac]{opacity:0}.diary-header[data-v-2abe18ac]{text-align:center;margin-bottom:30px;padding-bottom:20px;border-bottom:1px solid hsla(0,0%,100%,.1)}.diary-header .date-weather[data-v-2abe18ac]{font-size:14px;color:#8a8a9e;margin-bottom:10px}.diary-header .title[data-v-2abe18ac]{font-size:24px;color:#e0e0e0;margin:0;font-weight:600}.diary-section[data-v-2abe18ac]{margin-bottom:15px}.diary-section.collapsible h2[data-v-2abe18ac]{cursor:pointer;display:flex;justify-content:space-between;align-items:center;-webkit-user-select:none;user-select:none}.diary-section.collapsible h2 .arrow[data-v-2abe18ac]{transition:transform .3s ease;display:inline-block}.diary-section.collapsible h2 .arrow.open[data-v-2abe18ac]{transform:rotate(90deg)}.diary-section h2[data-v-2abe18ac]{font-size:18px;color:#d4af37;border-bottom:1px solid #d4af37;padding-bottom:8px;margin-top:0;margin-bottom:15px}.diary-section p[data-v-2abe18ac],.diary-section ul[data-v-2abe18ac]{font-size:15px;line-height:1.8;white-space:pre-wrap}.diary-section ul[data-v-2abe18ac]{padding-left:20px}.diary-section li[data-v-2abe18ac]{margin-bottom:8px}.collapsible-content[data-v-2abe18ac]{padding-top:10px}.event-item[data-v-2abe18ac],.relation-item[data-v-2abe18ac]{background-color:hsla(0,0%,100%,.03);border-radius:8px;padding:15px;margin-bottom:15px;border-left:3px solid #3a8f9d}.event-item p[data-v-2abe18ac],.relation-item p[data-v-2abe18ac]{margin:5px 0}.event-item strong[data-v-2abe18ac],.relation-item strong[data-v-2abe18ac]{color:#a9a9c8}.event-item .t吐槽[data-v-2abe18ac],.relation-item .t吐槽[data-v-2abe18ac]{font-style:italic;color:#8a8a9e}.relation-item[data-v-2abe18ac]{border-left-color:#8a5db5}.empty-state[data-v-2abe18ac]{text-align:center;color:#888;padding-top:5em;font-style:italic}
.forum-panel[data-v-573a9fa6]{display:flex;flex-direction:column;height:100%}.tabs[data-v-573a9fa6]{display:flex;gap:16px;border-bottom:1px solid rgba(58,143,157,.2);margin-bottom:16px}.tabs button[data-v-573a9fa6]{padding:8px 16px;border:none;background:none;cursor:pointer;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:16px;color:#a0a0a0;position:relative;transition:color .3s ease}.tabs button[data-v-573a9fa6]::after{content:"";position:absolute;bottom:-1px;left:0;width:100%;height:2px;background-color:#d4af37;transform:scaleX(0);transition:transform .3s ease}.tabs button[data-v-573a9fa6]:hover{color:#e0e0e0}.tabs button.active[data-v-573a9fa6]{color:#f0e6d2}.tabs button.active[data-v-573a9fa6]::after{transform:scaleX(1)}.tab-content[data-v-573a9fa6]{flex-grow:1;overflow-y:auto}.tab-content[data-v-573a9fa6]::-webkit-scrollbar{width:6px;height:6px}.tab-content[data-v-573a9fa6]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.tab-content[data-v-573a9fa6]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.tab-content[data-v-573a9fa6]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.tab-content[data-v-573a9fa6]{padding:16px}.post-list[data-v-573a9fa6]{display:flex;flex-direction:column;gap:24px}.post-item[data-v-573a9fa6]{background-color:rgba(10,15,30,.3);border:1px solid rgba(58,143,157,.2);border-radius:5px;padding:16px}.post-title[data-v-573a9fa6]{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;font-size:16px;margin:0 0 16px 0}.post-content[data-v-573a9fa6]{line-height:1.6;margin-bottom:16px;color:#e0e0e0}.post-meta[data-v-573a9fa6]{font-size:12px;color:#a0a0a0;text-align:right}.review-list[data-v-573a9fa6]{display:flex;flex-direction:column;gap:32px}.review-item[data-v-573a9fa6]{border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:24px}.review-title[data-v-573a9fa6]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:18px;color:#f0e6d2;margin:0 0 8px 0}.review-meta[data-v-573a9fa6]{font-size:12px;color:#a0a0a0;margin-bottom:16px}.review-content[data-v-573a9fa6]{line-height:1.7;white-space:pre-wrap}.empty-state[data-v-573a9fa6]{text-align:center;color:#a0a0a0;padding-top:5em}
.item-detail-panel[data-v-b1c37b8c]{background-color:rgba(21,26,48,.6);border-radius:12px;padding:20px;color:#e0e0e0;height:100%;overflow-y:auto;border:1px solid hsla(0,0%,100%,.1)}.item-details .item-name[data-v-b1c37b8c]{font-family:"Noto Serif SC",serif;font-size:22px;margin:0 0 10px 0}.item-details .item-tags[data-v-b1c37b8c]{display:flex;gap:10px;margin-bottom:20px}.item-details .item-tags .tag[data-v-b1c37b8c]{padding:4px 10px;border-radius:20px;font-size:12px;font-weight:bold}.item-details .item-description[data-v-b1c37b8c]{font-size:14px;line-height:1.6;color:silver;margin-bottom:20px;white-space:pre-wrap}.item-details .item-effects[data-v-b1c37b8c]{margin-top:20px;padding-top:15px;border-top:1px solid hsla(0,0%,100%,.1)}.item-details .item-effects h4[data-v-b1c37b8c]{font-family:"Noto Serif SC",serif;font-size:16px;color:#fafad2;margin:0 0 8px 0}.item-details .item-effects p[data-v-b1c37b8c]{font-size:14px;color:silver;margin:0;white-space:pre-wrap}.placeholder[data-v-b1c37b8c]{display:flex;justify-content:center;align-items:center;height:100%;color:#a0a0a0;font-style:italic}
.inventory-panel-container[data-v-2ebd8a93]{padding:15px;height:100%;overflow:hidden;background-color:#10141d;color:#e0e0e0}@media (max-width:600px){.inventory-panel-container[data-v-2ebd8a93]{padding:0}}.inventory-layout[data-v-2ebd8a93]{height:100%;width:100%;position:relative}.list-view-container[data-v-2ebd8a93]{display:grid;grid-template-rows:auto 1fr;gap:15px;height:100%;padding:15px}@media (max-width:600px){.list-view-container[data-v-2ebd8a93]{padding:0}}.category-header[data-v-2ebd8a93]{flex-shrink:0;background-color:rgba(21,26,48,.4);border-radius:10px;padding:5px}.category-header ul[data-v-2ebd8a93]{list-style:none;padding:0;margin:0;display:flex;gap:5px}.category-header li[data-v-2ebd8a93]{padding:8px 12px;cursor:pointer;border-radius:8px;transition:background-color .3s ease;color:#a0a0a0;font-size:14px}.category-header li[data-v-2ebd8a93]:hover{background-color:rgba(58,143,157,.1)}.category-header li.active[data-v-2ebd8a93]{background-color:rgba(58,143,157,.2);color:#3a8f9d;font-weight:bold}.main-content[data-v-2ebd8a93]{display:grid;grid-template-columns:1fr;gap:15px;min-height:0}.item-grid-container[data-v-2ebd8a93]{overflow-y:auto;padding-right:5px}.item-grid[data-v-2ebd8a93]{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:10px}.item-cell[data-v-2ebd8a93]{aspect-ratio:1;border:1px solid var(--tier-border-color,#a0a0a0);background-color:rgba(21,26,48,.5);border-radius:8px;cursor:pointer;transition:all .3s ease;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:8px;text-align:center}.item-cell[data-v-2ebd8a93]:hover{transform:translateY(-2px);box-shadow:0 4px 10px rgba(0,0,0,.4)}.item-cell .item-name[data-v-2ebd8a93]{font-size:14px}.item-cell .item-quantity[data-v-2ebd8a93]{font-size:12px;color:#a0a0a0;margin-top:5px}.empty-grid[data-v-2ebd8a93]{display:flex;justify-content:center;align-items:center;height:100%;color:#a0a0a0}.modal-overlay[data-v-2ebd8a93]{position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.7);backdrop-filter:blur(5px);display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[data-v-2ebd8a93]{position:relative;background-color:rgba(0,0,0,0);border:none;width:90%;max-width:380px}.modal-content .close-button[data-v-2ebd8a93]{position:absolute;top:5px;right:5px;background:rgba(0,0,0,0);border:none;color:hsla(0,0%,100%,.5);font-size:28px;font-weight:bold;line-height:1;cursor:pointer;padding:5px;transition:color .3s ease}.modal-content .close-button[data-v-2ebd8a93]:hover{color:hsla(0,0%,100%,.9)}
.follow-btn[data-v-69130bcd]{background:none;border:none;color:#a0a0a0;cursor:pointer;font-size:1.2rem;transition:color .2s ease,transform .2s ease}.follow-btn[data-v-69130bcd]:hover{color:#d4af37;transform:scale(1.2)}.follow-btn.followed[data-v-69130bcd]{color:#d4af37;text-shadow:0 0 5px #d4af37}
.npc-directory-panel-mobile[data-v-6ec21cbc]{height:100%;color:#e0e0e0;display:flex;flex-direction:column}.npc-list-view[data-v-6ec21cbc],.npc-detail-view[data-v-6ec21cbc]{display:flex;flex-direction:column;height:100%}.search-input[data-v-6ec21cbc]{width:100%;padding:16px;margin-bottom:16px;background-color:rgba(10,15,30,.8);border:1px solid #d4af37;color:#e0e0e0;border-radius:5px;font-size:14px}.npc-list[data-v-6ec21cbc]{list-style:none;padding:0;margin:0;flex-grow:1;overflow-y:auto}.npc-list li[data-v-6ec21cbc]{padding:16px;cursor:pointer;border-bottom:1px solid rgba(212,175,55,.2);display:flex;justify-content:space-between;align-items:center;transition:background-color .2s ease}.npc-list li[data-v-6ec21cbc]:hover{background-color:rgba(240,230,210,.1)}.npc-info[data-v-6ec21cbc]{display:flex;flex-direction:column}.npc-name[data-v-6ec21cbc]{font-weight:bold;font-size:16px}.npc-location[data-v-6ec21cbc]{font-size:12px;color:#a0a0a0;margin-top:4px}.detail-header[data-v-6ec21cbc]{padding:8px 0;margin-bottom:16px}.back-button[data-v-6ec21cbc]{background:none;border:none;color:#f0e6d2;font-size:14px;cursor:pointer}.back-button i[data-v-6ec21cbc]{margin-right:8px}.slide-fade-enter-active[data-v-6ec21cbc]{transition:all .3s ease-out}.slide-fade-leave-active[data-v-6ec21cbc]{transition:all .3s cubic-bezier(1,0.5,0.8,1)}.slide-fade-enter-from[data-v-6ec21cbc],.slide-fade-leave-to[data-v-6ec21cbc]{transform:translateX(10px);opacity:0}
.memory-panel-container[data-v-8153ab84]{padding:0;background-color:rgba(0,0,0,0);color:#e0e0e0;overflow-y:auto;height:100%;display:flex;flex-direction:column}.panel-content[data-v-8153ab84]{display:flex;flex-direction:column;gap:24px;height:100%}.panel-title[data-v-8153ab84]{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;text-align:center;margin-bottom:24px;flex-shrink:0}.section[data-v-8153ab84]{margin-bottom:24px;padding-bottom:24px;border-bottom:1px solid rgba(212,175,55,.2)}.section[data-v-8153ab84]:last-child{border-bottom:none;margin-bottom:0;flex-grow:1;display:flex;flex-direction:column}.section h4[data-v-8153ab84]{color:#d4af37;margin-bottom:16px}.section .description[data-v-8153ab84]{font-size:12px;color:#a0a0a0;line-height:1.6;margin-top:8px}.setting-item[data-v-8153ab84]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.setting-item label[data-v-8153ab84]{color:#a0a0a0}.setting-item input[type=number][data-v-8153ab84]{width:80px;text-align:right}button[data-v-8153ab84]{margin-right:16px}.tabs[data-v-8153ab84]{display:flex;margin-bottom:16px;border-bottom:1px solid rgba(212,175,55,.3);flex-shrink:0}.tabs button[data-v-8153ab84]{background:none;border:none;color:#a0a0a0;padding:8px 16px;cursor:pointer;transition:all .2s ease;border-bottom:2px solid rgba(0,0,0,0)}.tabs button.active[data-v-8153ab84]{color:#f0e6d2;border-bottom-color:#f0e6d2}.memory-content[data-v-8153ab84]{flex-grow:1}.memory-content textarea[data-v-8153ab84]{width:100%;height:100%;min-height:200px;resize:none;background-color:rgba(10,15,30,.5);color:#e0e0e0;border:1px solid rgba(212,175,55,.2);border-radius:3px}
.save-load-panel[data-v-7bd14af8]{background-color:rgba(0,0,0,0);padding:0;display:flex;flex-direction:column;gap:24px;height:100%;border:none;border-radius:0}.panel-header[data-v-7bd14af8]{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(212,175,55,.3);padding-bottom:16px}.panel-title[data-v-7bd14af8]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px}.header-actions[data-v-7bd14af8]{display:flex;gap:16px}.header-btn[data-v-7bd14af8]{background-color:#d4af37;color:#0a0f1e;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.header-btn[data-v-7bd14af8]:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);box-shadow:0 0 10px rgba(212,175,55,.5)}.header-btn[data-v-7bd14af8]{padding:8px 24px}.save-slots-container[data-v-7bd14af8]{overflow-y:auto;display:flex;flex-direction:column;gap:32px}.slot-group[data-v-7bd14af8]{display:flex;flex-direction:column;gap:16px}.group-title[data-v-7bd14af8]{color:#e0e0e0;font-family:"Siyuan Song","Source Han Serif SC",serif;font-size:16px;font-weight:bold;border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:8px;margin-bottom:8px}.save-slot[data-v-7bd14af8]{border:1px solid rgba(212,175,55,.2);border-radius:3px;padding:16px;display:flex;justify-content:space-between;align-items:center;transition:all .2s ease-in-out}.save-slot[data-v-7bd14af8]:hover{background-color:rgba(212,175,55,.05);border-color:rgba(212,175,55,.4)}.slot-info[data-v-7bd14af8]{display:flex;flex-direction:column;gap:4px}.slot-name[data-v-7bd14af8]{color:#e0e0e0;font-weight:bold}.slot-timestamp[data-v-7bd14af8]{color:#a0a0a0;font-size:12px}.slot-diary[data-v-7bd14af8]{margin-top:4px;padding-top:4px;border-top:1px solid rgba(212,175,55,.1);font-size:12px;color:#e0e0e0}.slot-diary .log-date[data-v-7bd14af8]{font-style:italic;color:#a0a0a0}.slot-diary .log-title[data-v-7bd14af8]{display:block;margin-top:2px;color:#e0e0e0;font-weight:500}.slot-actions[data-v-7bd14af8]{display:flex;gap:8px}.action-btn[data-v-7bd14af8]{background-color:rgba(0,0,0,0);color:#f0e6d2;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.action-btn[data-v-7bd14af8]:hover{background-color:rgba(212,175,55,.1);border-color:rgb(221.024691358,191.7901234568,96.975308642)}.action-btn[data-v-7bd14af8]{padding:4px 16px;font-size:12px}.action-btn.delete-btn[data-v-7bd14af8]{border-color:rgba(199,67,67,.6);color:rgba(199,67,67,.8)}.action-btn.delete-btn[data-v-7bd14af8]:hover:not(:disabled){background-color:rgba(199,67,67,.15);border-color:#c74343;color:#c74343}.action-btn[data-v-7bd14af8]:disabled{opacity:.4;cursor:not-allowed;border-color:#a0a0a0;color:#a0a0a0}.auto-save-toggle[data-v-7bd14af8]{margin-top:16px;color:#e0e0e0}.auto-save-toggle label[data-v-7bd14af8]{display:flex;align-items:center;gap:8px;cursor:pointer}
.debug-panel[data-v-1f4f8a7d]{padding:16px;background-color:#1a1a2e;color:#e0e0e0;height:100%;overflow:auto;font-family:"Courier New",Courier,monospace}h2[data-v-1f4f8a7d],h3[data-v-1f4f8a7d]{color:#fca311;border-bottom:1px solid #4a4a5e;padding-bottom:8px}.section[data-v-1f4f8a7d]{margin-top:16px;background-color:#2a2a3e;border:1px solid #4a4a5e;border-radius:4px;padding:12px}pre[data-v-1f4f8a7d]{white-space:pre-wrap;word-break:break-all;background-color:#0f0f1e;padding:8px;border-radius:4px;max-height:300px;overflow-y:auto}button[data-v-1f4f8a7d]{background-color:#fca311;color:#1a1a2e;border:none;padding:8px 12px;cursor:pointer;border-radius:4px;font-weight:bold;margin-bottom:16px}button[data-v-1f4f8a7d]:hover{background-color:#e0930a}.status-success[data-v-1f4f8a7d]{color:#2ecc71;font-weight:bold}.story-stats[data-v-1f4f8a7d]{font-size:.8em;color:#999;margin-left:1em;margin-top:-8px;margin-bottom:8px}.status-error[data-v-1f4f8a7d]{color:#e74c3c;font-weight:bold}
.system-panel[data-v-0bab00cc]{display:flex;flex-direction:column;height:100%;background-color:rgba(0,0,0,0)}.panel-tabs[data-v-0bab00cc]{display:flex;border-bottom:1px solid rgba(212,175,55,.3);padding:0 24px}.panel-tabs button[data-v-0bab00cc]{background-color:rgba(0,0,0,0);color:#f0e6d2;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.panel-tabs button[data-v-0bab00cc]:hover{background-color:rgba(212,175,55,.1);border-color:rgb(221.024691358,191.7901234568,96.975308642)}.panel-tabs button[data-v-0bab00cc]{border-radius:0;border-bottom:2px solid rgba(0,0,0,0);margin-bottom:-1px}.panel-tabs button.active[data-v-0bab00cc]{color:#f0e6d2;border-bottom-color:#f0e6d2;background-color:rgba(212,175,55,.05)}.panel-content[data-v-0bab00cc]{flex-grow:1;overflow:hidden;padding:24px}
.app-view-container[data-v-2cf8f05c]{display:flex;flex-direction:column;height:100%;background-color:#0a0f1e}.app-header[data-v-2cf8f05c]{display:flex;align-items:center;justify-content:space-between;padding:16px 24px;background-color:rgba(22,33,44,.7);border-bottom:1px solid rgba(212,175,55,.3);flex-shrink:0}.app-header .back-btn[data-v-2cf8f05c]{background:none;border:none;color:#f0e6d2;font-size:18px;cursor:pointer}.app-header .app-title[data-v-2cf8f05c]{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:18px;margin:0}.app-header .header-actions[data-v-2cf8f05c]{width:24px}.app-content[data-v-2cf8f05c]{flex-grow:1;overflow-y:auto}.app-content[data-v-2cf8f05c]::-webkit-scrollbar{width:6px;height:6px}.app-content[data-v-2cf8f05c]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.app-content[data-v-2cf8f05c]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.app-content[data-v-2cf8f05c]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.app-content[data-v-2cf8f05c]{padding:16px}
.app-icon[data-v-43ed2323]{display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer;padding:8px;border-radius:5px;transition:background-color .2s ease}.app-icon[data-v-43ed2323]:hover{background-color:rgba(224,224,224,.1)}.app-icon .icon-visual[data-v-43ed2323]{width:60px;height:60px;border-radius:15px;background-image:linear-gradient(145deg,rgba(255,255,255,0.1),rgba(255,255,255,0.05));display:flex;justify-content:center;align-items:center;font-size:28px;color:#f0e6d2;box-shadow:0 4px 10px rgba(0,0,0,.3)}.app-icon .app-name[data-v-43ed2323]{font-size:12px;color:#e0e0e0;text-align:center}
.home-screen[data-v-6b541c26]{position:relative;display:flex;flex-direction:column;height:100%;padding:24px;padding-top:40px}.wallpaper-background[data-v-6b541c26]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:1;background-size:cover;background-position:center;transition:background-image .5s ease-in-out}.wallpaper-background[data-v-6b541c26]::after{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle,rgba(0,0,0,0) 50%,rgba(0,0,0,0.4) 100%)}.content-overlay[data-v-6b541c26]{position:relative;z-index:2;height:100%;display:flex;flex-direction:column}.header-info[data-v-6b541c26]{text-align:center;color:#e0e0e0;padding:24px 0;flex-shrink:0}.header-info .date[data-v-6b541c26]{font-size:14px;opacity:.7}.header-info .time[data-v-6b541c26]{font-size:28.8px;font-weight:300;margin-top:4px;color:#e0e0e0}.app-grid[data-v-6b541c26]{display:flex;flex-wrap:wrap;justify-content:center;align-content:center;flex-grow:1;gap:24px;padding:32px 0}
.smartphone-shell[data-v-437b950a]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:380px;height:800px;background-color:#1a1a1a;border-radius:40px;box-shadow:0 10px 40px rgba(0,0,0,.5),inset 0 0 5px rgba(0,0,0,.8);padding:15px;display:flex;justify-content:center;align-items:center;transition:transform .4s ease-in-out,opacity .4s ease-in-out;z-index:10000}.status-bar[data-v-437b950a]{position:absolute;top:0;left:0;right:0;height:30px;padding:0 20px;display:flex;justify-content:space-between;align-items:center;font-size:13px;color:#fff;z-index:20}.status-bar .time[data-v-437b950a]{font-weight:bold}.status-bar .battery-status[data-v-437b950a]{display:flex;align-items:center;gap:6px;opacity:.8}.smartphone-screen[data-v-437b950a]{width:100%;height:100%;background-color:#050a15;border-radius:25px;overflow:hidden;position:relative}.smartphone-screen[data-v-437b950a]::-webkit-scrollbar{width:6px;height:6px}.smartphone-screen[data-v-437b950a]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.smartphone-screen[data-v-437b950a]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.smartphone-screen[data-v-437b950a]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.smartphone-screen[data-v-437b950a]{display:flex;flex-direction:column}.app-fade-enter-active[data-v-437b950a],.app-fade-leave-active[data-v-437b950a]{transition:opacity .2s ease}.app-fade-enter-from[data-v-437b950a],.app-fade-leave-to[data-v-437b950a]{opacity:0}.navigation-bar[data-v-437b950a]{position:absolute;bottom:0;left:0;right:0;height:48px;background-color:#1a1a1a;display:flex;justify-content:space-around;align-items:center;z-index:100;border-bottom-left-radius:25px;border-bottom-right-radius:25px}.nav-btn[data-v-437b950a]{background:none;border:none;cursor:pointer;width:48px;height:48px;display:flex;justify-content:center;align-items:center;opacity:.7;transition:opacity .2s ease,background-color .2s ease}.nav-btn[data-v-437b950a]:hover{opacity:1;background-color:hsla(0,0%,100%,.1)}.menu-btn[data-v-437b950a]{position:relative}.menu-btn[data-v-437b950a]::before,.menu-btn[data-v-437b950a]::after{content:"";position:absolute;left:50%;transform:translateX(-50%);width:20px;height:2px;background-color:#fff;border-radius:1px}.menu-btn[data-v-437b950a]::before{top:16px;box-shadow:0 5px 0 #fff,0 10px 0 #fff}.home-btn[data-v-437b950a]{width:26px;height:26px;border:2px solid #fff;border-radius:50%}.back-btn[data-v-437b950a]{width:24px;height:24px}.back-btn[data-v-437b950a]::before{content:"";display:block;width:0;height:0;border-left:8px solid #fff;border-top:6px solid rgba(0,0,0,0);border-bottom:6px solid rgba(0,0,0,0)}
.action-points-display[data-v-0bb0013f]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px}.ap-dot[data-v-0bb0013f]{width:10px;height:10px;border-radius:50%;background-color:#e0e0e0;border:1px solid rgba(212,175,55,.5);transition:background-color .3s ease}.ap-dot.used[data-v-0bb0013f]{background-color:rgba(160,160,160,.5);border-color:rgba(160,160,160,.3)}
.top-status[data-v-a72d5322]{border-bottom:1px solid rgba(212,175,55,.2);box-shadow:0 4px 15px rgba(0,0,0,.3);display:flex;align-items:center;justify-content:space-between;padding:8px 16px;position:relative;z-index:100}.top-status[data-v-a72d5322]::before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;border-radius:inherit;box-shadow:inset 0 1px 1px rgba(230.049382716,208.5802469136,138.950617284,.1)}.status-left[data-v-a72d5322],.status-right[data-v-a72d5322]{flex:1;display:flex;align-items:center;gap:16px;color:#a0a0a0}.chapter-info[data-v-a72d5322],.date-time-info[data-v-a72d5322]{display:flex;flex-direction:column}.status-left[data-v-a72d5322]{align-items:flex-start}.status-left .work-title[data-v-a72d5322]{font-size:12px;color:#a0a0a0}.status-left .chapter-title[data-v-a72d5322]{font-size:14px;font-weight:bold;color:#e0e0e0}.status-right[data-v-a72d5322]{align-items:flex-end}.status-right .date-time[data-v-a72d5322]{font-size:14px;font-weight:bold;color:#e0e0e0}.status-right .day-weather[data-v-a72d5322]{font-size:12px;color:#a0a0a0}.status-left[data-v-a72d5322]{justify-content:flex-start}.status-right[data-v-a72d5322]{justify-content:flex-end}.status-center[data-v-a72d5322]{position:absolute;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:32px}.view-toggle-btn[data-v-a72d5322]{background:none;border:1px solid rgba(0,0,0,0);color:#a0a0a0;font-size:18px;padding:4px 8px;border-radius:3px;cursor:pointer;transition:all .2s ease-in-out}.view-toggle-btn[data-v-a72d5322]:hover{color:#e0e0e0;background-color:rgba(212,175,55,.1);border-color:rgba(212,175,55,.3)}
.world-time-display[data-v-7a5f6689]{padding:4px 16px;background:rgba(10,15,30,.5);border:1px solid rgba(212,175,55,.2);border-radius:3px;color:#a0a0a0;font-size:12px;display:flex;gap:16px;align-items:center}.world-time-display .world-name[data-v-7a5f6689]{font-weight:bold;color:#f0e6d2}.world-time-display .time-string[data-v-7a5f6689]{font-family:monospace}
.guixu-root-container{display:grid;grid-template-rows:auto 1fr;width:100%;max-width:1400px;margin:auto;overflow:hidden;aspect-ratio:16/12;min-height:900px;max-height:90vh;border:1px solid rgba(212,175,55,.2);border-radius:12px;box-shadow:0 8px 35px rgba(10,15,30,.5);background:#0a0f1e;position:relative}.web-fullscreen{position:fixed !important;top:0 !important;left:0 !important;width:100vw !important;height:100vh !important;aspect-ratio:auto !important;overflow:visible !important;border-radius:0 !important;border:none !important;z-index:1}.main-layout{position:relative;display:grid;grid-template-columns:1fr;grid-template-rows:1fr;overflow:hidden}.main-layout>*{grid-column:1/-1;grid-row:1/-1}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(10,15,30,.7);backdrop-filter:blur(5px);display:flex;justify-content:center;align-items:center;z-index:90000}.modal-content{border:1px solid rgba(212,175,55,.4);border-radius:5px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.3);min-width:320px;max-width:500px}.modal-content .confirmation-title{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px;text-align:center;margin-bottom:16px}.modal-content .confirmation-message{color:#e0e0e0;font-size:14px;line-height:1.7;margin-bottom:32px;text-align:center}.modal-content .confirmation-buttons{display:flex;justify-content:flex-end;gap:16px}.detail-modal{width:800px;max-width:90vw;height:600px;max-height:80vh;display:flex;flex-direction:column}.detail-modal .modal-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:16px;margin-bottom:24px;border-bottom:1px solid rgba(212,175,55,.3)}.detail-modal .modal-header .modal-title{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px}.detail-modal .modal-header .close-button{background:none;border:none;color:#a0a0a0;font-size:24px;cursor:pointer}.detail-modal .modal-header .close-button:hover{color:#e0e0e0}.detail-modal .modal-body{overflow-y:auto;padding-right:8px;color:#e0e0e0;flex-grow:1;min-height:0}.small-detail-modal{max-width:400px !important;height:auto !important;max-height:80vh}.card-detail-modal{width:auto;max-width:400px;height:auto;max-height:90vh;padding:0;background:rgba(0,0,0,0);border:none;box-shadow:none}.card-detail-modal :deep(.modal-header){display:none}.card-detail-modal :deep(.modal-body){padding:0;overflow:visible}.input-modal-overlay{align-items:flex-end;padding-bottom:5vh;background-color:rgba(0,0,0,0);backdrop-filter:none;pointer-events:none}.input-modal-content{pointer-events:auto;border:1px solid rgba(212,175,55,.4);border-radius:5px;box-shadow:0 10px 30px rgba(0,0,0,.3);padding:0;width:70%;max-width:900px}.input-area-container{position:relative}.input-area-with-buttons{position:relative;display:flex;align-items:center;width:100%}.action-panel{position:absolute;bottom:calc(100% + 16px);left:50%;transform:translateX(-50%);z-index:10}.command-queue-popup,:deep(.input-history-popup){position:absolute;bottom:calc(100% + 16px);left:50%;transform:translateX(-50%);width:80%;max-width:600px;z-index:20;border-radius:5px;box-shadow:0 10px 30px rgba(0,0,0,.3);padding:16px;display:flex;flex-direction:column;gap:16px}.command-queue-popup .popup-header,:deep(.input-history-popup) .popup-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:8px;border-bottom:1px solid rgba(212,175,55,.2)}.command-queue-popup .popup-header h3,:deep(.input-history-popup) .popup-header h3{color:#f0e6d2;font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:18px;margin:0}.command-queue-popup .popup-header .close-popup-button,:deep(.input-history-popup) .popup-header .close-popup-button{background:none;border:none;color:#a0a0a0;font-size:22px;cursor:pointer;line-height:1}.command-queue-popup .popup-header .close-popup-button:hover,:deep(.input-history-popup) .popup-header .close-popup-button:hover{color:#e0e0e0}.command-queue-popup .popup-body .command-list,:deep(.input-history-popup) .popup-body .command-list{max-height:200px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;padding-right:8px}.command-queue-popup .popup-body .command-item,:deep(.input-history-popup) .popup-body .command-item{background-color:rgba(10,15,30,.3);padding:8px 16px;border-radius:3px;font-family:"Siyuan Song","Source Han Serif SC",serif;color:#e0e0e0;word-break:break-all}.command-queue-popup .popup-body .empty-queue,:deep(.input-history-popup) .popup-body .empty-queue{text-align:center;color:#a0a0a0;padding:24px 0}.command-queue-popup .popup-footer,:deep(.input-history-popup) .popup-footer{display:flex;justify-content:flex-end;padding-top:8px;border-top:1px solid rgba(212,175,55,.2)}:global(html.web-fullscreen-active),:global(body.web-fullscreen-active){overflow:hidden !important}:global(body.web-fullscreen-active #chat){padding:0 !important;margin:0 !important;height:100vh !important;max-height:100vh !important}:global(body.web-fullscreen-active #chat>div){padding:0 !important;margin:0 !important}:global(body.web-fullscreen-active .mes_block){padding:0 !important;margin:0 !important}:global(body.web-fullscreen-active .mes_text){padding:0 !important;margin:0 !important}.floating-cards-container{position:absolute;top:60px;right:20px;z-index:1000;display:flex;flex-direction:column;align-items:flex-end;gap:-80px}.smartphone-toggle-btn{position:fixed;bottom:30px;right:30px;width:60px;height:60px;border-radius:50%;background-color:#d4af37;color:#0a0f1e;border:none;font-size:24px;cursor:pointer;box-shadow:0 4px 15px rgba(0,0,0,.4);display:flex;justify-content:center;align-items:center;z-index:80000;transition:background-color .3s ease,transform .3s ease}.smartphone-toggle-btn:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);transform:scale(1.1)}.fade-enter-active,.fade-leave-active{transition:opacity .3s ease}.fade-enter-from,.fade-leave-to{opacity:0}.fade-enter-active .smartphone-shell,.fade-leave-active .smartphone-shell{transition:transform .4s ease-out}.fade-enter-from .smartphone-shell,.fade-leave-to .smartphone-shell{transform:translateY(20px) scale(0.95)}
.attribute-item[data-v-1b452a49]{display:flex;justify-content:space-between;font-size:13px}.attribute-name[data-v-1b452a49]{color:#6c757d}.attribute-value[data-v-1b452a49]{color:#3a3f4b;font-weight:500}
.character-panel[data-v-1c5d8637]{background:#f5f1e9;padding:15px;overflow-y:auto;box-shadow:inset 0 0 10px rgba(58,63,75,.03);border-right:1px solid #eae6dd}.panel-section[data-v-1c5d8637]{margin-bottom:20px;padding:15px;background:#fff;border-radius:8px;border:1px solid #eae6dd;box-shadow:0 2px 8px rgba(58,63,75,.05);transition:box-shadow .3s ease}.panel-section[data-v-1c5d8637]:hover{box-shadow:0 4px 12px rgba(58,63,75,.08)}.section-title[data-v-1c5d8637]{font-size:14px;font-weight:600;color:#3a3f4b;margin-bottom:12px;text-align:left;border-bottom:2px solid #4169e1;padding-bottom:8px;display:inline-block}.attributes-list[data-v-1c5d8637]{display:flex;flex-direction:column;gap:8px}.attribute-item[data-v-1c5d8637]{display:flex;justify-content:space-between;font-size:13px}.attribute-name[data-v-1c5d8637]{color:#6c757d}.attribute-value[data-v-1c5d8637]{color:#3a3f4b;font-weight:500}
.inventory-panel[data-v-d797c64c]{padding:15px}.panel-section[data-v-d797c64c]{margin-bottom:20px;padding:15px;background:#fff;border-radius:8px;border:1px solid #eae6dd}.section-title[data-v-d797c64c]{font-size:14px;font-weight:600;color:#3a3f4b;margin-bottom:12px}.inventory-grid[data-v-d797c64c]{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px}.inventory-item[data-v-d797c64c]{padding:10px;background-color:#f8f9fa;border-radius:6px;text-align:center}.item-name[data-v-d797c64c]{font-weight:500}.item-quantity[data-v-d797c64c]{color:#6c757d;font-size:12px}
.main-content-view[data-v-4453ae69]{display:flex;flex-direction:column;height:100%;width:100%;box-sizing:border-box;overflow:hidden;position:relative}.narrative-container[data-v-4453ae69]{flex-grow:1;overflow-y:auto;padding:1.5rem;white-space:pre-wrap;line-height:1.8;font-size:1rem}.narrative-container[data-v-4453ae69] .highlighted-item{color:#007bff;cursor:pointer;text-decoration:underline;text-decoration-style:dotted}.narrative-container[data-v-4453ae69] .highlighted-npc{color:#28a745;cursor:pointer;font-weight:600}.narrative-tooltip[data-v-4453ae69]{position:fixed;background-color:#333;color:#fff;border:1px solid #555;border-radius:6px;padding:.75rem;z-index:1100;pointer-events:none;font-size:.9rem;max-width:350px;box-shadow:0 4px 12px rgba(0,0,0,.4)}.narrative-tooltip[data-v-4453ae69] .tooltip-title{font-weight:bold;margin-bottom:.5rem;color:#ffc107;border-bottom:1px solid #555;padding-bottom:.5rem}.narrative-tooltip[data-v-4453ae69] .tooltip-description{margin-bottom:.5rem;color:#eee}.narrative-tooltip[data-v-4453ae69] .tooltip-level,.narrative-tooltip[data-v-4453ae69] .tooltip-identity{font-style:italic;color:#aaa;font-size:.8rem}
.npc-list-panel[data-v-e354837a]{padding:15px}.panel-section[data-v-e354837a]{margin-bottom:20px;padding:15px;background:#fff;border-radius:8px;border:1px solid #eae6dd}.section-title[data-v-e354837a]{font-size:14px;font-weight:600;color:#3a3f4b;margin-bottom:12px}.npc-list[data-v-e354837a]{display:flex;flex-direction:column;gap:10px}.npc-item[data-v-e354837a]{display:flex;justify-content:space-between;padding:10px;background-color:#f8f9fa;border-radius:6px}.npc-name[data-v-e354837a]{font-weight:500}.npc-relationship[data-v-e354837a]{color:#6c757d}
.world-state-panel[data-v-e33a51b8]{padding:15px}.panel-section[data-v-e33a51b8]{margin-bottom:20px;padding:15px;background:#fff;border-radius:8px;border:1px solid #eae6dd}.section-title[data-v-e33a51b8]{font-size:14px;font-weight:600;color:#3a3f4b;margin-bottom:12px}.state-list[data-v-e33a51b8]{display:flex;flex-direction:column;gap:8px}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}html{font-family:"Noto Serif SC",serif;font-size:14px;line-height:1.7;color:#0a0f1e}body{min-height:100vh;overflow:hidden}h1,h2,h3,h4,h5,h6{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#d4af37;font-weight:normal;margin-bottom:16px}h1{font-size:24px}h2{font-size:20px}h3{font-size:18px}a{color:#3a8f9d;text-decoration:none;transition:color .3s ease}a:hover{color:rgb(95.4441860465,181.8279069767,196.0558139535);text-decoration:underline}button,input,textarea,select{font-family:inherit;font-size:inherit;background-color:rgba(10,15,30,.5);border:1px solid rgba(212,175,55,.3);color:#e0e0e0;padding:8px 16px;border-radius:5px;transition:all .3s ease}button:focus,input:focus,textarea:focus,select:focus{outline:none;border-color:#d4af37;box-shadow:0 0 5px rgba(212,175,55,.5)}button:disabled,input:disabled,textarea:disabled,select:disabled{opacity:.5;cursor:not-allowed}button{cursor:pointer;background-color:rgba(58,143,157,.2);border-color:#3a8f9d}button:hover{background-color:rgba(58,143,157,.4);border-color:rgb(76.823255814,173.288372093,189.176744186)}button.primary{background-color:rgba(212,175,55,.8);border-color:#d4af37;color:#0a0f1e;font-weight:bold}button.primary:hover{background-color:#d4af37;box-shadow:0 0 8px rgba(212,175,55,.7)}*::-webkit-scrollbar{width:6px;height:6px}*::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}*::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}*::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}#toast-container>.toast{border:1px solid #d4af37;color:#0a0f1e;text-shadow:none;font-family:"Siyuan Song","Source Han Serif SC",serif;font-weight:bold;border-radius:5px;box-shadow:0 5px 20px rgba(212,175,55,.5);opacity:.9}#toast-container>.toast .toast-title{font-family:"ZCOOL KuaiLe","篆书",cursive;font-weight:bold}#toast-container>.toast .toast-message{font-weight:normal}#toast-container>.toast.toast-info{background-color:rgba(58,143,157,.8);border-color:#3a8f9d;color:#fff}#toast-container>.toast.toast-error{background-color:rgba(199,67,67,.8);border-color:#c74343;color:#fff}#toast-container>.toast.toast-success{background-color:rgba(92,184,92,.8);border-color:#5cb85c;color:#fff}@keyframes border-flow{0%{border-image-source:linear-gradient(to right,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}25%{border-image-source:linear-gradient(to bottom,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}50%{border-image-source:linear-gradient(to left,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}75%{border-image-source:linear-gradient(to top,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}100%{border-image-source:linear-gradient(to right,#d4af37,rgb(230.049382716,208.5802469136,138.950617284),#d4af37)}}.panel-base{border-radius:5px;box-shadow:0 8px 35px rgba(10,15,30,.5);color:#000;border-style:solid;border-width:2px;border-image-slice:1;animation:border-flow 8s infinite linear}.panel-titlebar{background-color:rgba(10,15,30,.5);border-bottom:1px solid rgba(212,175,55,.3);height:40px;font-family:"ZCOOL KuaiLe","篆书",cursive;display:flex;align-items:center;padding:0 16px}.panel-titlebar-text{color:#f0e6d2;font-size:18px;font-weight:normal;padding:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.panel-titlebar-button-close{color:#a0a0a0;font-size:16px}.panel-titlebar-button-close::after{content:"×";padding:0}.panel-titlebar-button-close:hover{color:#c74343;transform:scale(1.2)}.panel-titlebar-button-pin{color:#a0a0a0;font-size:14px;cursor:pointer;margin-right:16px;transition:all .3s ease}.panel-titlebar-button-pin.locked{color:#3a8f9d;transform:rotate(45deg)}.panel-titlebar-button-pin:hover{color:#3a8f9d;transform:scale(1.2)}.panel-content{background-color:rgba(0,0,0,0)}.panel-content::-webkit-scrollbar{width:6px;height:6px}.panel-content::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.panel-content::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.panel-content::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.dockspan-tab-host{background-color:rgba(0,0,0,0)}.dockspan-tab-handle-list-container{background-color:rgba(10,15,30,.3);border-bottom:1px solid rgba(212,175,55,.2)}.dockspan-tab-handle{background-color:rgba(0,0,0,0);color:#a0a0a0;border-right:1px solid rgba(212,175,55,.2);padding:16px;transition:all .3s ease}.dockspan-tab-handle:hover{background-color:rgba(58,143,157,.2);color:#3a8f9d}.dockspan-tab-handle-selected{background-color:rgba(212,175,55,.2);color:#f0e6d2;border-bottom:2px solid #d4af37}.dockspan-tab-handle-close-button{color:#a0a0a0}.dockspan-tab-handle-close-button:hover{color:#c74343}.splitbar-horizontal,.splitbar-vertical{background-color:rgba(212,175,55,.3);transition:background-color .3s ease}.splitbar-horizontal:hover,.splitbar-vertical:hover{background-color:#d4af37}.dock-wheel-panel-preview,.panel-grayout{display:none !important}.game-container{display:grid;grid-template-columns:1fr;width:100%;height:100%;overflow:hidden;gap:1px}.character-panel,.interaction-panel{background:#f5f1e9;padding:15px;overflow-y:auto;box-shadow:inset 0 0 10px rgba(58,63,75,.03)}.character-panel{border-right:1px solid #eae6dd}.interaction-panel{border-left:1px solid #eae6dd}.main-content{padding:25px;overflow-y:auto;background:#fdfbf6;position:relative}#tablet-trigger{position:fixed;right:0;top:45%;transform:translateY(-50%);width:32px;height:80px;background-color:#fff;border:1px solid #eae6dd;border-right:none;border-radius:8px 0 0 8px;cursor:pointer;transition:all .3s ease;font-size:24px;display:flex;align-items:center;justify-content:center;color:#6c757d;z-index:1001;box-shadow:-2px 0 8px rgba(58,63,75,.08)}#tablet-trigger:hover{background-color:#f5f1e9;color:#4169e1}#tablet-container{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;background-color:rgba(58,63,75,.4);backdrop-filter:blur(5px);opacity:0;visibility:hidden;transform:scale(1.1);transition:opacity .3s ease,visibility .3s ease,transform .3s ease;z-index:200}#tablet-container.is-visible{opacity:1;visibility:visible;transform:scale(1)}#tablet-container .tablet-case{width:90%;max-width:380px;height:90vh;max-height:800px;background-color:#1a1a1a;border-radius:40px;padding:12px;box-shadow:0 20px 50px rgba(0,0,0,.3),inset 0 0 15px hsla(0,0%,100%,.1);display:flex;flex-direction:column}#tablet-container .phone-screen{width:100%;height:100%;background:linear-gradient(160deg,#f87171 0%,#a855f7 100%);border-radius:28px;overflow:hidden;position:relative;display:flex;flex-direction:column;color:#fff}#tablet-container .phone-content-area{flex-grow:1;position:relative;display:flex;flex-direction:column}#tablet-container .phone-desktop{display:flex;flex-direction:column;height:100%;padding:20px;box-sizing:border-box}#tablet-container .desktop-header{flex-shrink:0;padding:40px 0;text-align:center}#tablet-container .desktop-header .time-display #desktop-time{font-size:72px;font-weight:300;letter-spacing:1px;display:block;line-height:1}#tablet-container .desktop-header .time-display #desktop-date{font-size:16px;font-weight:400;opacity:.9}#tablet-container .app-grid{flex-grow:1;display:grid;grid-template-columns:repeat(4,1fr);gap:20px;align-content:flex-start}#tablet-container .desktop-dock-indicator{flex-shrink:0;display:flex;justify-content:center;padding:15px 0}#tablet-container .desktop-dock-indicator span{width:8px;height:8px;background-color:hsla(0,0%,100%,.5);border-radius:50%}#tablet-container .app-view-container{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background-color:#fdfbf6;z-index:10;flex-direction:column;color:#3a3f4b}#tablet-container .app-view-container.active{display:flex}#tablet-container .phone-nav-bar{height:50px;flex-shrink:0;display:flex;justify-content:space-around;align-items:center;padding:0 20px;background:rgba(0,0,0,.1)}#tablet-container .phone-nav-bar .nav-btn{background:none;border:none;color:#fff;opacity:.8;cursor:pointer;padding:5px}#tablet-container .phone-nav-bar .nav-btn svg{width:20px;height:20px}#tablet-container .app-icon{display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;text-decoration:none}#tablet-container .app-icon .app-icon-visual{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;box-shadow:0 5px 15px rgba(0,0,0,.15);transition:transform .2s ease}#tablet-container .app-icon .app-icon-visual svg{width:28px;height:28px}#tablet-container .app-icon .app-icon-name{font-size:12px;color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.3)}#tablet-container .app-icon:hover .app-icon-visual{transform:scale(1.1)}#tablet-container .app-icon[data-app-id=tianhuachat] .app-icon-visual{background-color:#3b82f6}#tablet-container .app-icon[data-app-id=campus-pass] .app-icon-visual{background-color:#14b8a6}#tablet-container .app-icon[data-app-id=schedule] .app-icon-visual{background-color:#8b5cf6}#tablet-container .app-icon[data-app-id=health] .app-icon-visual{background-color:#ef4444}#tablet-container .app-icon[data-app-id=forum] .app-icon-visual{background-color:#0ea5e9}#tablet-container .app-icon[data-app-id=shopping] .app-icon-visual{background-color:#f97316}#tablet-container .app-icon[data-app-id=inventory] .app-icon-visual{background-color:#ec4899}#tablet-container .app-icon[data-app-id=map] .app-icon-visual{background-color:#22c55e}#tablet-container .app-icon[data-app-id=settings] .app-icon-visual{background-color:#6b7280}#tablet-container .app-icon[data-app-id=saveload] .app-icon-visual{background-color:#f39c12}#tablet-container .app-icon[data-app-id=diary] .app-icon-visual{background-color:#9b59b6}#tablet-container .app-icon[data-app-id=character-annals] .app-icon-visual{background-color:#34495e}#tablet-container .app-icon[data-app-id=calendar] .app-icon-visual{background-color:#1abc9c}#tablet-container .app-icon[data-app-id=mall] .app-icon-visual{background-color:#e67e22}.phone-status-bar{display:flex;justify-content:space-between;align-items:center;padding:4px 12px;background-color:rgba(0,0,0,.1);color:#fff;font-size:12px;position:absolute;top:0;left:0;right:0;z-index:100}.phone-status-bar .status-left,.phone-status-bar .status-right{display:flex;align-items:center;gap:6px}.phone-status-bar .status-center{font-weight:500}.phone-status-bar .battery-icon{width:22px;height:11px;border:1px solid #fff;border-radius:3px;position:relative;padding:1px}.phone-status-bar .battery-icon::after{content:"";position:absolute;right:-3px;top:2px;width:2px;height:5px;background-color:#fff;border-top-right-radius:1px;border-bottom-right-radius:1px}.phone-status-bar .battery-icon .battery-fill{height:100%;background-color:#fff;border-radius:1px;transition:width .3s ease}.phone-content-area{padding-top:24px}.panel-base{pointer-events:none}.panel-base:focus{outline:0}.panel-titlebar{width:100%;overflow:hidden;height:25px;pointer-events:auto}.panel-titlebar-icon{height:16px;margin-right:3px}.panel-titlebar-text{float:left;padding-left:10px;padding-top:5px;text-overflow:ellipsis;overflow:hidden;width:calc(100% - 30px);white-space:nowrap}.panel-titlebar-text>span{vertical-align:top}.panel-titlebar-button-close{display:flex;justify-content:flex-end;align-items:center;width:25px;height:25px;position:absolute;right:0;top:0}.panel-titlebar-button-close::after{float:right;cursor:pointer;padding-right:8px;content:"x";font-weight:normal;font-family:Verdana,Geneva,Tahoma,sans-serif;display:flex;height:100%;align-items:center}.panel-titlebar-button-close:hover{color:#000}.panel-content{width:100%;overflow:hidden}.panel-content-wrapper{width:100%;height:100%;position:relative}.panel-grayout{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:10;pointer-events:all}.panel-has-changes{font-style:italic}.panel-has-changes::before{content:"* "}.dialog-floating{position:absolute}.dialog-floating:focus{outline:0}.resize-handle{position:absolute;width:6px;height:6px;z-index:10}.resize-handle-corner{position:absolute;width:12px;height:12px;z-index:10}.resize-handle-e{cursor:e-resize}.resize-handle-w{cursor:w-resize}.resize-handle-s{cursor:s-resize}.resize-handle-n{cursor:n-resize}.resize-handle-ne{cursor:ne-resize}.resize-handle-nw{cursor:nw-resize}.resize-handle-se{cursor:se-resize}.resize-handle-sw{cursor:sw-resize}.dock-container{position:relative}.dock-wheel-base{position:absolute}.dock-wheel-item{position:absolute;width:32px;height:32px}.dock-wheel-fill{margin-left:-16px;margin-top:-16px}.dock-wheel-left{margin-left:-48px;margin-top:-16px}.dock-wheel-right{margin-left:16px;margin-top:-16px}.dock-wheel-top{margin-left:-16px;margin-top:-48px}.dock-wheel-down{margin-left:-16px;margin-top:16px}.dock-wheel-panel-preview{position:absolute;background-color:rgba(128,128,255,.5)}.dock-wheel-fill-icon{background:url("placeholder.png") 0 0}.dock-wheel-left-icon{background:url("placeholder.png") 0 0}.dock-wheel-right-icon{background:url("placeholder.png") 0 0}.dock-wheel-top-icon{background:url("placeholder.png") 0 0}.dock-wheel-down-icon{background:url("placeholder.png") 0 0}.dock-wheel-fill-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-left-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-right-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-top-icon-hover{background:url("placeholder.png") 0 0}.dock-wheel-down-icon-hover{background:url("placeholder.png") 0 0}.splitter-container-horizontal{float:left;position:relative;pointer-events:none}.splitter-container-vertical{position:relative;pointer-events:none}.splitbar-horizontal{width:100%;height:5px;cursor:n-resize;position:relative;pointer-events:auto}.splitbar-vertical{width:5px;height:100%;float:left;cursor:e-resize;position:relative;pointer-events:auto}.splitbar-horizontal-ghoust{width:100%;height:5px;cursor:n-resize;position:absolute}.splitbar-vertical-ghoust{width:5px;height:100%;position:absolute;cursor:e-resize}.dockspan-tab-host{display:inline-block;position:absolute}.dockspan-tab-content{position:relative}.dockspan-tab-content:focus{outline:0}.dockspan-tab-handle{position:relative;height:22px;float:left;overflow:hidden;cursor:pointer;padding-right:16px}.dockspan-tab-handle:hover{cursor:pointer}.dockspan-tab-handle-text{margin-top:3px;margin-left:6px;margin-right:6px;white-space:nowrap;overflow:hidden;float:left;text-overflow:ellipsis;width:calc(100% - 3px);display:block}.dockspan-tab-handle-text>span{vertical-align:top}.dockspan-tab-handle-close-button::after{margin-right:5px;float:right;position:absolute;right:0;content:"x";font-weight:normal;font-family:Verdana,Geneva,Tahoma,sans-serif;cursor:pointer;display:flex;height:100%;align-items:center}.dockspan-tab-handle-close-button:hover{color:#000}.dockspan-tab-handle-list-container{height:22px;overflow:hidden;display:none;pointer-events:auto}.dockspan-tab-handle-list-container-visible{display:flex}.dockspan-tab-handle-content-seperator{height:4px;display:none}.dockspan-tab-handle-content-seperator-visible{display:block}.dockspab-tab-handle-context-menu{position:absolute;z-index:10000000;background-color:#fff;border:#fff;border:#000 solid 2px;padding:5px}.dockspab-tab-handle-context-menu>div{cursor:pointer;padding:2px}.dockspab-tab-handle-context-menu>div:hover{background-color:gray;cursor:pointer;padding:2px}.disable-selection{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:default}.panel-titlebar{background-color:#333;pointer-events:auto}.panel-titlebar-text{font-weight:bold;color:#aaa}.panel-titlebar-button-close{color:#aaa}.panel-titlebar-button-close:hover{color:red}.panel-content{overflow:auto}.panel-element-content-container{background-color:#fff}.dialog-floating{box-shadow:5px 5px 20px #000;pointer-events:none}.draggable-dragging-active{opacity:.95}.resize-handle{pointer-events:auto}.resize-handle-corner{pointer-events:auto}.dock-container{background-color:#888}.document-manager{background-color:#666}.splitbar-horizontal{background-color:#000}.splitbar-horizontal:hover{background-color:#5b636c}.splitbar-horizontal:active{background-color:#5b636c}.splitbar-vertical{background-color:#000}.splitbar-vertical:hover{background-color:#5b636c}.splitbar-vertical:active{background-color:#5b636c}.splitbar-horizontal-ghoust{background-color:#fc0}.splitbar-vertical-ghoust{background-color:#fc0}.dockspan-tab-host{background-color:#fff}.dockspan-tab-content{background-color:#fff}.dockspan-tab-content>*{background-color:#fff}.dockspan-tab-handle{background-color:gray;color:#d5d5d5;box-shadow:0px 5px 20px #000}.dockspan-tab-handle:hover{background-color:#006729;color:#fff}.dockspan-tab-handle-selected{background-color:#333;color:#fff}.dockspan-tab-handle-selected:hover{background-color:#008749;color:#fff}.dockspan-tab-handle-close-button:hover{color:red}.dockspan-tab-handle-list-container{background-color:#fff}.dockspan-tab-handle-content-seperator{background-color:#333}.dockspan-tab-handle-content-seperator-active{background-color:#008749}.dockspan-tab-handle-active{background-color:#008749}.dockspan-panel-active{background-color:#008749}.dockspan-panel-titlebar-text-active{color:#fff}.dockspab-tab-handle-context-menu{position:absolute;z-index:10000000;background-color:#fff;border:#fff;border:#000 solid 2px;padding:5px}.dockspab-tab-handle-context-menu>div{cursor:pointer;padding:2px}.dockspab-tab-handle-context-menu>div:hover{background-color:gray;cursor:pointer;padding:2px}.mall-app{background-color:#f8f9fa}.mall-home-view .search-bar{border-radius:9999px;border:1px solid #e5e7eb;background-color:#fff;box-shadow:0 1px 3px rgba(0,0,0,.05)}.mall-home-view .search-bar:focus{outline:none;border-color:#4f46e5;box-shadow:0 0 0 2px rgba(79,70,229,.2)}.mall-home-view .product-grid{padding-bottom:4rem}.product-card{border:none;border-radius:12px;background-color:#fff;overflow:hidden;display:flex;flex-direction:row;transition:transform .2s ease-in-out,box-shadow .2s ease-in-out;padding:.75rem;gap:.75rem;align-items:flex-start;box-shadow:0 2px 4px rgba(0,0,0,.05)}.product-card .product-image-container{flex-shrink:0;width:90px;height:90px}.product-card .product-image{width:100%;height:100%;border-radius:8px;background-color:#f0f2f5}.product-card .product-details{display:flex;flex-direction:column;flex-grow:1;min-width:0}.product-card .product-name{font-size:1rem;font-weight:600;color:#1f2937}.product-card .product-description{font-size:.8rem;color:#6b7280;margin:.25rem 0;flex-grow:1;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;line-height:1.4}.product-card .product-footer{display:flex;justify-content:space-between;align-items:center;margin-top:auto}.product-card .product-price{font-size:1.1rem;font-weight:bold;color:#ef4444;margin:0}.product-card .product-stock{font-size:.75rem;color:#6b7280}.product-card button{margin:0;background-color:#4f46e5;color:#fff;border:none;width:32px;height:32px;border-radius:50%;cursor:pointer;font-weight:bold;font-size:1.5rem;line-height:1;display:flex;align-items:center;justify-content:center;transition:background-color .2s}.product-card button:hover{background-color:#4338ca}.product-card button:disabled{background-color:#9ca3af;cursor:not-allowed}.mall-page-container{padding:1rem;height:100%;overflow-y:auto}.mall-page-container .page-title{font-size:1.5rem;font-weight:700;margin-bottom:1.5rem}.mall-page-container .empty-state{text-align:center;color:#6b7280;margin-top:4rem;font-size:1rem}.cart-view .cart-item{display:flex;align-items:center;gap:1rem;padding:1rem 0;border-bottom:1px solid #e5e7eb}.cart-view .cart-item .item-name{flex-grow:1;font-weight:500}.cart-view .cart-item .item-quantity{color:#6b7280}.cart-view .cart-item .item-price{font-weight:600;min-width:60px;text-align:right}.cart-view .cart-summary{margin-top:1.5rem;padding:1rem;background-color:#fff;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.05)}.cart-view .cart-summary .summary-row{display:flex;justify-content:space-between;margin-bottom:.5rem}.cart-view .cart-summary .summary-row.total{font-weight:bold;font-size:1.1rem;margin-top:1rem}.cart-view .checkout-btn{width:100%;padding:.875rem;border-radius:8px;border:none;background-color:#10b981;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;margin-top:1.5rem}.cart-view .checkout-btn:disabled{background-color:#9ca3af;cursor:not-allowed}.my-mall-view .user-info-card{background:linear-gradient(to right,#6366f1,#8b5cf6);color:#fff;padding:1.5rem;border-radius:12px;margin-bottom:1.5rem}.my-mall-view .user-info-card h2{margin:0;font-size:1.5rem}.my-mall-view .user-info-card p{margin:.25rem 0 0;font-size:1rem;opacity:.9}.my-mall-view .section-title{font-size:1.2rem;font-weight:600;margin-bottom:1rem}.my-mall-view .order-item{display:flex;justify-content:space-between;align-items:center;padding:1rem;background-color:#fff;border-radius:8px;margin-bottom:.75rem;box-shadow:0 1px 3px rgba(0,0,0,.05)}.my-mall-view .order-item .order-details{font-weight:500}.my-mall-view .order-item .order-delivery-time{font-size:.8rem;color:#6b7280}.character-annals-app{display:flex;height:100%;width:100%;background-color:#f9f9f9;font-family:sans-serif}.character-annals-app .character-list-view{width:280px;flex-shrink:0;background-color:#fff;border-right:1px solid #e0e0e0;display:flex;flex-direction:column}.character-annals-app .character-list-view .search-bar{padding:12px;border-bottom:1px solid #e0e0e0}.character-annals-app .character-list-view .search-bar input{width:100%;padding:8px 12px;border-radius:15px;border:1px solid #ccc;box-sizing:border-box}.character-annals-app .character-list-view .search-bar input:focus{outline:none;border-color:#0d6efd}.character-annals-app .character-list-view .character-list{list-style:none;padding:0;margin:0;overflow-y:auto;flex-grow:1}.character-annals-app .character-list-view .character-list .character-card{padding:15px;border-bottom:1px solid #f0f0f0;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:background-color .2s ease}.character-annals-app .character-list-view .character-list .character-card:hover{background-color:#e7f0fe}.character-annals-app .character-list-view .character-list .character-card .character-name{font-weight:600;color:#333}.character-annals-app .character-list-view .character-list .character-card .character-class{font-size:.85em;color:#777;background-color:#eee;padding:2px 6px;border-radius:8px}.character-annals-app .detail-view-container{flex-grow:1;overflow-y:auto}.character-annals-app .detail-view-container .character-detail-view{padding:24px}.character-annals-app .detail-view-container .placeholder{display:flex;justify-content:center;align-items:center;height:100%;color:#aaa;font-size:1.2em}.detail-header{border-bottom:1px solid #e0e0e0;padding-bottom:20px;margin-bottom:20px}.detail-header h1{margin:0 0 8px 0;font-size:2em;color:#2c3e50}.detail-header .signature{font-style:italic;color:#666;margin:5px 0}.detail-header .tags{margin-top:12px}.detail-header .tags .tag{display:inline-block;background-color:#e0e0e0;padding:4px 10px;border-radius:12px;font-size:.8em;margin-right:8px}.detail-header .tags .tag.identity{background-color:#4169e1;color:#fff}.detail-header .header-main{display:flex;justify-content:space-between;align-items:flex-start}.detail-header .avatar-container{flex-shrink:0;width:60px;height:80px}.detail-header .character-avatar,.detail-header .character-avatar-placeholder{width:100%;height:100%;object-fit:cover;border-radius:8px}.detail-header .character-avatar-placeholder{font-size:2rem}.detail-tabs{display:flex;border-bottom:1px solid #ccc;margin-bottom:20px}.detail-tabs button{padding:12px 24px;border:none;background:none;cursor:pointer;font-size:1em;color:#666;border-bottom:3px solid rgba(0,0,0,0);transition:all .2s ease}.detail-tabs button.active{border-bottom-color:#0d6efd;color:#0d6efd;font-weight:600}.attribute-section{margin-bottom:25px}.attribute-section h3{margin-bottom:15px;font-size:1.2em;color:#333;border-bottom:1px solid #eee;padding-bottom:8px}.attribute-section ul{list-style:none;padding:0}.attribute-section ul li{display:flex;justify-content:space-between;padding:8px 0;font-size:.95em;border-bottom:1px dashed #f0f0f0}.attribute-section ul li:last-child{border-bottom:none}.relationships-panel{width:100%;height:100%}.enhanced-input-box-container{width:100%;position:relative}.input-wrapper{display:flex;width:100%;align-items:center;position:relative;padding:8px;background-color:rgba(10,15,30,.8);border:1px solid rgba(212,175,55,.3);border-radius:30px;box-shadow:0 0 15px rgba(10,15,30,.5),inset 0 0 5px rgba(10,15,30,.5);padding-left:55px;padding-right:55px}textarea{flex-grow:1;resize:none;padding:.5rem 1rem;border:none;background-color:rgba(0,0,0,0);font-size:1rem;line-height:1.5;color:#e0e0e0;min-height:40px;font-family:"Siyuan Song","Source Han Serif SC",serif;outline:none}textarea::placeholder{color:rgba(224,224,224,.4)}.button-group{display:flex;gap:8px;padding-left:8px}.action-button{padding:.5rem 1.2rem;font-size:.9rem;border-radius:20px;font-family:"ZCOOL KuaiLe","篆书",cursive;min-width:90px;text-align:center}.action-button.primary{background-color:#d4af37;color:#0a0f1e;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.action-button.primary:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);box-shadow:0 0 10px rgba(212,175,55,.5)}.action-button.primary{background-color:#d4af37;color:#0a0f1e}.action-button.primary:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);box-shadow:0 0 12px rgba(212,175,55,.7)}.action-button:not(.primary){background-color:rgba(0,0,0,0);color:#f0e6d2;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.action-button:not(.primary):hover{background-color:rgba(212,175,55,.1);border-color:rgb(221.024691358,191.7901234568,96.975308642)}.action-button:not(.primary){background-color:rgba(22,33,44,.7);border-color:rgba(212,175,55,.4);color:#f0e6d2}.action-button:not(.primary):hover{background-color:#16212c;border-color:#d4af37}.command-queue-popup{position:absolute;bottom:100%;right:1rem;width:300px;margin-bottom:.5rem;z-index:10;border:1px solid rgba(212,175,55,.4);border-radius:5px;box-shadow:0 5px 20px rgba(0,0,0,.2);padding:16px}.command-list{max-height:150px;overflow-y:auto;margin-bottom:16px}.command-item{padding:8px;border-bottom:1px solid rgba(212,175,55,.2);font-size:.9rem;color:#e0e0e0}.command-item:last-child{border-bottom:none}.empty-queue{color:rgba(224,224,224,.6);font-style:italic;text-align:center;padding:24px 0}.clear-button{width:100%;padding:8px;background-color:rgba(199,67,67,.6);color:#e0e0e0;border:1px solid rgba(199,67,67,.8);border-radius:3px;cursor:pointer;transition:all .2s ease}.clear-button:hover{background-color:#c74343;box-shadow:0 0 10px rgba(199,67,67,.5)}.input-history-popup{background-color:rgba(10,15,30,.95);backdrop-filter:blur(8px);border:1px solid rgba(212,175,55,.5);border-radius:5px;padding:24px;box-shadow:0 8px 30px rgba(0,0,0,.4);width:450px;max-width:90vw;display:flex;flex-direction:column;gap:24px;position:absolute;bottom:calc(100% + 16px);left:50%;transform:translateX(-50%);z-index:1000}.input-history-popup .history-section h4{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;font-size:16px;margin-bottom:16px;border-bottom:1px solid rgba(212,175,55,.2);padding-bottom:8px}.input-history-popup .history-section ul{list-style:none;padding:0;margin:0;max-height:150px;overflow-y:auto;display:flex;flex-direction:column;gap:8px}.input-history-popup .history-section li{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:3px;background-color:rgba(10,15,30,.2);transition:background-color .2s ease}.input-history-popup .history-section li:hover{background-color:rgba(240,230,210,.1)}.input-history-popup .history-section .entry-text{color:#e0e0e0;cursor:pointer;flex-grow:1;margin-right:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.input-history-popup .history-section .actions{display:flex;gap:8px;flex-shrink:0}.input-history-popup .history-section .actions button{font-size:12px;padding:4px 8px}.input-history-popup .history-section .actions button:disabled{opacity:.5;cursor:not-allowed}.input-history-popup .history-section .empty-text{color:#a0a0a0;font-style:italic}.input-history-popup .close-button-popup{align-self:flex-end;margin-top:16px}@keyframes orbit{from{transform:rotate(0deg) translateX(150px) rotate(0deg)}to{transform:rotate(360deg) translateX(150px) rotate(-360deg)}}.world-detail-modal-content{width:500px;max-width:90vw;color:#e0e0e0;background:radial-gradient(ellipse at top,rgb(30.5,45.75,61),#0a0f1e 80%);padding:24px;border:1px solid rgba(212,175,55,.2)}.world-detail-modal-content .scroll-container{max-height:70vh;overflow-y:auto;padding-right:8px}.world-detail-modal-content .scroll-container::-webkit-scrollbar{width:6px;height:6px}.world-detail-modal-content .scroll-container::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.world-detail-modal-content .scroll-container::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.world-detail-modal-content .scroll-container::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.world-detail-modal-content .world-section{margin-bottom:32px;position:relative}.world-detail-modal-content .section-title{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px;color:#f0e6d2;padding-bottom:16px;margin-bottom:24px;text-align:center;letter-spacing:2px;border-bottom:1px solid rgba(212,175,55,.3)}.world-detail-modal-content .rules-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:24px;text-align:center;padding:16px;border-radius:5px;background:rgba(10,15,30,.3)}.world-detail-modal-content .rule-item .rule-name{font-size:12px;color:#a0a0a0;margin-bottom:8px}.world-detail-modal-content .rule-item .rule-value{font-size:18px;font-weight:bold;color:#e0e0e0}.world-detail-modal-content .system-overview{font-style:italic;color:#a0a0a0;text-align:center;margin-bottom:32px;padding:0 24px}.world-detail-modal-content .ladder-container{position:relative;height:350px;margin:32px 0}.world-detail-modal-content .ladder-container::before{content:"";position:absolute;top:0;bottom:0;left:50%;transform:translateX(-50%);width:2px;background:linear-gradient(to bottom,transparent,#d4af37 50%,transparent 100%);opacity:.7}.world-detail-modal-content .境界-ladder{list-style:none;padding:0;margin:0;position:absolute;top:50%;left:50%;width:1px;height:1px}.world-detail-modal-content .ladder-step{position:absolute;display:flex;flex-direction:column;align-items:center;gap:4px}.world-detail-modal-content .ladder-step:nth-child(1){transform:rotate(0deg) translateX(95px) rotate(-0deg);animation:orbit 25s linear infinite;animation-direction:normal}.world-detail-modal-content .ladder-step:nth-child(2){transform:rotate(72deg) translateX(110px) rotate(-72deg);animation:orbit 30s linear infinite;animation-direction:reverse}.world-detail-modal-content .ladder-step:nth-child(3){transform:rotate(144deg) translateX(125px) rotate(-144deg);animation:orbit 35s linear infinite;animation-direction:normal}.world-detail-modal-content .ladder-step:nth-child(4){transform:rotate(216deg) translateX(140px) rotate(-216deg);animation:orbit 40s linear infinite;animation-direction:reverse}.world-detail-modal-content .ladder-step:nth-child(5){transform:rotate(288deg) translateX(155px) rotate(-288deg);animation:orbit 45s linear infinite;animation-direction:normal}.world-detail-modal-content .ladder-step::before{content:"";width:10px;height:10px;border-radius:50%;background:#f0e6d2;box-shadow:0 0 8px #f0e6d2,0 0 15px #d4af37}.world-detail-modal-content .ladder-step .level-name,.world-detail-modal-content .ladder-step .level-energy{position:absolute;top:-30px;white-space:nowrap;background:rgba(22,33,44,.8);padding:2px 6px;border-radius:3px}.world-detail-modal-content .ladder-step .level-name{font-weight:bold;color:#f0e6d2;font-size:14px}.world-detail-modal-content .ladder-step .level-energy{display:none}.settlement-choice-card{background-color:rgba(22,33,44,.6);border:1px solid rgba(212,175,55,.3);border-radius:5px;padding:16px;cursor:pointer;transition:all .3s ease;backdrop-filter:blur(8px);display:flex;flex-direction:column;justify-content:space-between;min-height:240px}.settlement-choice-card:hover{border-color:rgba(240,230,210,.7);background-color:rgba(22,33,44,.8);box-shadow:0 5px 25px rgba(10,15,30,.6);transform:translateY(-5px)}.settlement-choice-card.is-selected{border-color:#f0e6d2;box-shadow:0 0 20px rgba(240,230,210,.4);background:rgba(22,33,44,.9)}.settlement-choice-card .card-header{text-align:center;padding-bottom:8px;border-bottom:1px solid rgba(212,175,55,.2);margin-bottom:16px}.settlement-choice-card .card-header .choice-type{font-family:"ZCOOL KuaiLe","篆书",cursive;color:#f0e6d2;font-size:20px;text-shadow:0 0 8px rgba(240,230,210,.7)}.settlement-choice-card .card-body{flex-grow:1}.settlement-choice-card .card-body .description{color:#e0e0e0;font-size:14px;line-height:1.7;margin-bottom:16px}.settlement-choice-card .card-body .data-details{background-color:rgba(10,15,30,.4);padding:16px;border-radius:3px;border-left:3px solid #3a8f9d}.settlement-choice-card .card-body .data-details .data-name{color:#3a8f9d;font-weight:bold;font-size:16px;margin-bottom:8px;display:block}.settlement-choice-card .card-body .data-details .data-description{color:hsl(0,0%,77.7450980392%);font-size:14px;line-height:1.6}.settlement-choice-card .card-footer{text-align:right;padding-top:16px;margin-top:16px;border-top:1px solid rgba(212,175,55,.1)}.settlement-choice-card .card-footer .cost{color:#c74343;font-size:14px;font-weight:bold;text-shadow:0 0 5px rgba(199,67,67,.5)}.settlement-view{display:flex;flex-direction:column;height:100%;padding:24px}.settlement-view .choices-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:24px;overflow-y:auto;padding-bottom:24px}.settlement-view .choices-grid::-webkit-scrollbar{width:6px;height:6px}.settlement-view .choices-grid::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.settlement-view .choices-grid::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.settlement-view .choices-grid::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.settlement-view .no-choices{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;height:100%;color:#a0a0a0;font-size:16px}.settlement-view .no-choices p{margin:8px 0}.settlement-view .actions-footer{padding-top:24px;margin-top:auto;display:flex;justify-content:flex-end;border-top:1px solid rgba(58,143,157,.2)}.settlement-view .actions-footer .confirm-button{background-color:#d4af37;color:#0a0f1e;border:1px solid #d4af37;border-radius:5px;font-family:"Siyuan Song","Source Han Serif SC",serif;cursor:pointer;transition:all .3s ease}.settlement-view .actions-footer .confirm-button:hover{background-color:rgb(221.024691358,191.7901234568,96.975308642);box-shadow:0 0 10px rgba(212,175,55,.5)}.settlement-view .actions-footer .confirm-button{padding:16px 32px;font-size:16px}.settlement-view .actions-footer .confirm-button:disabled{background-color:#a0a0a0;color:rgba(10,15,30,.7);border-color:#a0a0a0;cursor:not-allowed}.guixu-root-container.mobile-view .main-layout{display:grid !important;grid-template-columns:1fr !important}.guixu-root-container.mobile-view .top-overlays{padding:4px 8px}.guixu-root-container.mobile-view .side-panel.is-mobile-overlay,.guixu-root-container.mobile-view .right-side-panel.is-mobile-overlay{position:fixed;top:0;bottom:0;width:280px;max-width:75%;z-index:800;overflow:hidden}.guixu-root-container.mobile-view .side-panel.is-mobile-overlay{left:0}.guixu-root-container.mobile-view .right-side-panel.is-mobile-overlay{right:0}.guixu-root-container.mobile-view .is-mobile-overlay .side-panel-container{background-color:rgba(22,33,44,.95) !important;backdrop-filter:blur(12px) !important;-webkit-backdrop-filter:blur(12px) !important;border:1px solid rgba(212,175,55,.3) !important;box-shadow:0 5px 50px rgba(0,0,0,.7) !important;height:100% !important;padding-top:24px !important}.guixu-root-container.mobile-view .mobile-time-display{padding:8px 16px;margin-bottom:16px;border-bottom:1px solid rgba(212,175,55,.2)}.guixu-root-container.mobile-view .slide-left-enter-active,.guixu-root-container.mobile-view .slide-left-leave-active,.guixu-root-container.mobile-view .slide-right-enter-active,.guixu-root-container.mobile-view .slide-right-leave-active{transition:transform .35s cubic-bezier(0.23,1,0.32,1)}.guixu-root-container.mobile-view .slide-left-enter-from,.guixu-root-container.mobile-view .slide-left-leave-to{transform:translateX(-100%)}.guixu-root-container.mobile-view .slide-right-enter-from,.guixu-root-container.mobile-view .slide-right-leave-to{transform:translateX(100%)}.text-dialogue{color:#f0e6d2}.enhanced-input-box-container .input-wrapper{display:flex;align-items:stretch;gap:8px}.enhanced-input-box-container .button-group{display:flex;gap:8px}.enhanced-input-box-container .side-buttons{display:flex;flex-direction:column;gap:4px}.enhanced-input-box-container .side-buttons .action-button{flex-grow:1}.enhanced-input-box-container .lm_header .lm_tab .lm_close_tab,.enhanced-input-box-container .lm_controls .lm_popout,.enhanced-input-box-container .lm_controls .lm_maximise,.enhanced-input-box-container .lm_controls .lm_close{background-image:none !important}.text-psychology{color:#8a5db5;font-style:italic}.text-scenery{color:#3a8f9d}.text-system-highlight{color:#d4af37;font-weight:bold}.lm_header{height:32px !important}.lm_tab{height:30px !important;line-height:30px !important;padding-bottom:0 !important}.lm_tab .lm_close_tab{width:20px !important;height:20px !important;right:6px !important;top:5px !important;background-size:16px 16px;background-repeat:no-repeat;background-position:center;background-image:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23a0a0a0"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>') !important}.lm_tab .lm_close_tab:hover{background-image:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffffff"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>') !important}
.skills-panel[data-v-14bf0e7c]{height:100%;padding:24px;box-sizing:border-box;overflow-y:auto}.skills-panel[data-v-14bf0e7c]::-webkit-scrollbar{width:6px;height:6px}.skills-panel[data-v-14bf0e7c]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.skills-panel[data-v-14bf0e7c]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.skills-panel[data-v-14bf0e7c]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}.skills-panel h2[data-v-14bf0e7c]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:24px;color:rgb(252.75,251.25,248.25);text-align:center;margin-bottom:32px;text-shadow:0 0 15px rgba(212,175,55,.7),0 0 5px rgba(212,175,55,.5)}.skills-panel .empty-state[data-v-14bf0e7c]{display:flex;justify-content:center;align-items:center;height:100%;color:#a0a0a0;font-size:16px}.skills-panel .skills-list[data-v-14bf0e7c]{display:flex;flex-direction:column;gap:24px}.skills-panel .skill-item[data-v-14bf0e7c]{background:linear-gradient(145deg,rgba(22,33,44,0.5),rgba(10,15,30,0.5));border:1px solid rgba(212,175,55,.2);border-radius:5px;padding:16px;box-shadow:0 4px 15px rgba(0,0,0,.4);transition:all .3s ease}.skills-panel .skill-item[data-v-14bf0e7c]:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(212,175,55,.2);border-color:rgba(212,175,55,.4)}.skills-panel .skill-header[data-v-14bf0e7c]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.skills-panel .skill-header h3[data-v-14bf0e7c]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:20px;color:#f0e6d2;margin:0}.skills-panel .skill-header .skill-level[data-v-14bf0e7c]{font-size:14px;font-weight:bold;color:rgb(95.4441860465,181.8279069767,196.0558139535);background-color:rgba(58,143,157,.15);padding:4px 8px;border-radius:3px;border:1px solid rgba(58,143,157,.4);text-shadow:0 0 5px rgba(58,143,157,.5)}.skills-panel .skill-description[data-v-14bf0e7c]{font-size:14px;color:#e0e0e0;line-height:1.7;margin-bottom:16px}.skills-panel .skill-progress .progress-bar-wrapper[data-v-14bf0e7c]{display:flex;align-items:center;gap:16px}.skills-panel .skill-progress .progress-bar-wrapper progress[data-v-14bf0e7c]{flex-grow:1;height:10px;-webkit-appearance:none;appearance:none}.skills-panel .skill-progress .progress-bar-wrapper progress[data-v-14bf0e7c]::-webkit-progress-bar{background-color:rgba(10,15,30,.7);border-radius:5px;box-shadow:inset 0 1px 3px rgba(0,0,0,.5)}.skills-panel .skill-progress .progress-bar-wrapper progress[data-v-14bf0e7c]::-webkit-progress-value{background-image:linear-gradient(to right,#3a8f9d,rgb(95.4441860465,181.8279069767,196.0558139535));border-radius:5px;box-shadow:0 0 5px rgba(58,143,157,.7);-webkit-transition:width .3s ease;transition:width .3s ease}.skills-panel .skill-progress .progress-bar-wrapper .progress-text[data-v-14bf0e7c]{font-size:12px;color:rgb(185.5,185.5,185.5);font-weight:bold;white-space:nowrap;min-width:80px;text-align:right}.skills-panel .associated-skills[data-v-14bf0e7c]{margin-top:24px;padding-top:16px;border-top:1px solid rgba(212,175,55,.15)}.skills-panel .associated-skills-title[data-v-14bf0e7c]{font-family:"ZCOOL KuaiLe","篆书",cursive;font-size:18px;color:rgb(95.4441860465,181.8279069767,196.0558139535);margin-bottom:16px;padding-bottom:8px;background:none;border:none;border-bottom:1px solid rgba(58,143,157,.2);cursor:pointer;width:100%;text-align:left;display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:3px;transition:background-color .3s ease}.skills-panel .associated-skills-title[data-v-14bf0e7c]:hover{background-color:rgba(58,143,157,.1)}.skills-panel .associated-skills-title .arrow[data-v-14bf0e7c]{border:solid rgb(76.823255814,173.288372093,189.176744186);border-width:0 2px 2px 0;display:inline-block;padding:3px;transform:rotate(45deg);transition:transform .3s ease}.skills-panel .associated-skills-title .arrow.expanded[data-v-14bf0e7c]{transform:rotate(-135deg)}.skills-panel .associated-skills-list[data-v-14bf0e7c]{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}.skills-panel .associated-skill-item[data-v-14bf0e7c]{display:flex;flex-direction:column;padding:16px;background-color:rgba(10,15,30,.5);border-radius:5px;border:1px solid rgba(10,15,30,.7);box-shadow:inset 0 2px 5px rgba(0,0,0,.5)}.skills-panel .associated-skill-item .skill-name[data-v-14bf0e7c]{font-size:14px;color:#e0e0e0;margin-bottom:8px}.skills-panel .associated-skill-item .skill-name strong[data-v-14bf0e7c]{font-weight:bold;color:#f0e6d2}.skills-panel .associated-skill-item .skill-detail[data-v-14bf0e7c]{font-size:12px;color:#a0a0a0;line-height:1.6;margin-top:4px}.skills-panel .associated-skill-item .skill-detail strong[data-v-14bf0e7c]{color:#3a8f9d;font-weight:normal}.skills-panel .associated-skill-item .skill-description-detail[data-v-14bf0e7c]{font-style:italic;color:rgb(134.5,134.5,134.5);margin-bottom:8px}
.realm-detail-card[data-v-155d0d21]{padding:16px;min-width:400px;display:grid;grid-template-columns:repeat(2,1fr);gap:24px}.realm-detail-card .info-item[data-v-155d0d21]{display:flex;flex-direction:column;gap:4px}.realm-detail-card .info-item strong[data-v-155d0d21]{font-family:"Siyuan Song","Source Han Serif SC",serif;color:#f0e6d2;font-size:12px;text-transform:uppercase;letter-spacing:1px;opacity:.7}.realm-detail-card .info-item span[data-v-155d0d21],.realm-detail-card .info-item ul[data-v-155d0d21]{font-size:14px;color:#e0e0e0;line-height:1.6}.realm-detail-card .info-item ul[data-v-155d0d21]{padding-left:20px}.realm-detail-card .info-item.full-width[data-v-155d0d21]{grid-column:1/-1}
.world-detail-panel-content[data-v-7a84edf6]{color:#e0e0e0;padding:16px;height:100%;overflow:hidden;background:rgba(0,0,0,0);font-family:"Noto Sans SC",sans-serif}.scroll-container[data-v-7a84edf6]{height:100%;overflow-y:auto;padding-right:12px}.world-section[data-v-7a84edf6]{margin-bottom:24px}.world-section[data-v-7a84edf6]:last-child{margin-bottom:0}.epoch-header[data-v-7a84edf6]{text-align:center;margin-bottom:16px}.epoch-header .section-title[data-v-7a84edf6]{margin-bottom:8px}.epoch-header .epoch-overview[data-v-7a84edf6]{font-size:.9em;color:#a0a0a0;max-width:600px;margin:0 auto;line-height:1.5}.section-title[data-v-7a84edf6]{font-family:"Noto Serif SC",serif;font-size:1.5em;color:#f0e6d2;text-align:center;margin-bottom:16px;text-shadow:0 0 10px rgba(184,134,11,.5)}.rules-grid[data-v-7a84edf6]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px}.rule-item[data-v-7a84edf6]{background-color:rgba(40,42,58,.7);backdrop-filter:blur(8px);padding:12px;border-radius:8px;text-align:center;border:1px solid rgba(17,233,225,.2)}.rule-item .rule-name[data-v-7a84edf6]{font-size:.8em;color:#a0a0a0;margin-bottom:8px}.rule-item .rule-value[data-v-7a84edf6]{font-size:1.25em;font-weight:bold;color:#82d8d8}.system-overview[data-v-7a84edf6]{font-size:1em;line-height:1.6;text-align:justify;margin-bottom:16px;padding:12px;background-color:rgba(10,10,15,.3);border-radius:4px}.subsection-title[data-v-7a84edf6]{font-family:"Noto Serif SC",serif;font-size:1.25em;color:#b8860b;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid rgba(184,134,11,.3)}.tags-container[data-v-7a84edf6]{display:flex;flex-wrap:wrap;gap:8px}.tag[data-v-7a84edf6]{background-color:rgba(17,233,225,.2);color:#82d8d8;padding:4px 8px;border-radius:4px;font-size:.8em}.ladder-container[data-v-7a84edf6]{background:linear-gradient(to top,rgba(10,10,15,0.5) 0%,transparent 100%);padding:12px;border-radius:8px}.境界-ladder[data-v-7a84edf6]{list-style:none;padding:0;margin:0;display:flex;flex-direction:column-reverse;gap:8px}.ladder-step[data-v-7a84edf6]{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:4px;background-color:rgba(28,32,53,.5);border-left:3px solid #b8860b;cursor:help;transition:all .2s ease}.ladder-step[data-v-7a84edf6]:hover{background-color:rgba(62,71,112,.5);transform:translateX(5px)}.ladder-step .level-name[data-v-7a84edf6]{font-size:1.1em;font-weight:bold}.ladder-step .level-energy[data-v-7a84edf6]{font-size:.8em;color:#a0a0a0;background-color:rgba(10,10,15,.5);padding:4px 8px;border-radius:4px}.epoch-selection .tabs-container[data-v-7a84edf6]{display:flex;justify-content:center;gap:12px;margin-bottom:16px}.epoch-selection .epoch-tab[data-v-7a84edf6]{background-color:rgba(40,42,58,.7);backdrop-filter:blur(8px);border:1px solid rgba(17,233,225,.2);color:#a0a0a0;padding:8px 12px;border-radius:8px;cursor:pointer;transition:all .3s ease}.epoch-selection .epoch-tab.active[data-v-7a84edf6]{color:#82d8d8;border-color:#11e9e1;background-color:rgba(17,233,225,.2)}.epoch-selection .epoch-tab[data-v-7a84edf6]:hover:not(.active){background-color:rgba(62,71,112,.3)}.loading-state[data-v-7a84edf6]{display:flex;justify-content:center;align-items:center;height:100%;font-family:"Noto Serif SC",serif;color:#f0e6d2}.summary-content[data-v-7a84edf6]{padding:16px;line-height:1.7;white-space:normal}[data-v-7a84edf6] .summary-content p{margin-bottom:1.5em}[data-v-7a84edf6] .summary-content p:last-child{margin-bottom:0}
.reincarnation-panel[data-v-30be22b9]{display:flex;flex-direction:column;height:100%}.tab-content[data-v-30be22b9]{flex-grow:1;overflow-y:auto}.tab-content[data-v-30be22b9]::-webkit-scrollbar{width:6px;height:6px}.tab-content[data-v-30be22b9]::-webkit-scrollbar-track{background:rgba(0,0,0,0);border-radius:3px}.tab-content[data-v-30be22b9]::-webkit-scrollbar-thumb{background:#d4af37;border-radius:3px;-webkit-transition:background .3s ease;transition:background .3s ease}.tab-content[data-v-30be22b9]::-webkit-scrollbar-thumb:hover{background:rgb(221.024691358,191.7901234568,96.975308642)}

/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"></div><script type="module" src="0fb8f935d88a4c9e291e.ts"></script></body></html>