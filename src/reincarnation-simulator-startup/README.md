# 轮回模拟器 - 开局设定模块 V5.0 (数据持久化 & UI美化)

本项目是一个独立的Vue 3应用，专门用于“轮回-诸天万界”世界观的开局设定流程。它允许玩家在正式开始游戏前，通过一个多步骤的向导来构筑自己的世界和角色。

## 近期重要更新 (V5.0)

V5.0 版本在 V4.0 “AI辅助创想”的基础上，进行了一次彻底的**数据流重构**和**用户体验优化**，核心目标是提升数据持久化的健壮性和界面的信息密度与美观度。

1.  **【核心架构】变量驱动的创世流程**:
    *   **告别Lorebook**: `buildWorld` 和 `startReincarnation` 函数现在完全摒弃了对世界书（Lorebook）的读写操作。
    *   **原子性更新**: 所有世界的创建和角色的生成，现在都通过向酒馆发送包含 `UpdateVariable` (JSON Patch) 的消息来完成。这确保了变量状态的**原子性**和**一致性**，从根本上解决了旧流程中可能因异步读写Lorebook导致的数据覆盖或丢失问题。

2.  **【体验优化】无缝的方案持久化**:
    *   **引入 `PersistenceService.ts`**: 新增并重构了此服务，现在它专门负责将用户的**完整创世方案**（包括所有步骤的选择和潜力点数分配）保存到浏览器本地存储中。
    *   **自动保存与加载**: 现在，当用户点击“构筑世界”时，其所有选择都会被**自动保存**。刷新或重新打开页面后，所有配置都会被**自动恢复**，实现了无缝的创世体验。

3.  **【UI/UX】动态数据展示与界面美化**:
    *   **动态世界信息**: “世界确认”页面 (`WorldConfirmationPage.vue`) 已被完全重构。它不再从任何静态来源读取数据，而是通过 `TavernHelper` **实时**从酒馆的核心变量中查找 `定位` 为 `主世界` 的那个世界，并动态展示其详细信息。
    *   **交互式信息展示**:
        *   引入了可重用的 `Tooltip.vue` 组件。
        *   对 `WorldInfoCard.vue` 和 `BackpackManager.vue` 进行了美化重构。现在，`核心法则`、`权柄`、`开局物品` 等拥有详细描述的项目，都会以更紧凑、美观的**“标签”**形式显示。
        *   当用户的鼠标悬停在这些标签上时，会以一个风格化的**浮动弹窗**来展示其详细描述，极大地提升了信息密度和界面的清爽度。
    *   **移除无用信息**: 界面上不再显示对用户无意义的世界ID和纪元ID。

## 开局流程 (V5.0 更新)

1.  **封面 (`CoverPage.vue`)**: 展示游戏标题和开始按钮。
2.  **世界构想 (`WorldVisionPage.vue`)**: 玩家输入构想，AI返回多个开局方案。
3.  **难度选择与世界构筑 (`WorldBuilder.vue`)**: 玩家微调所选方案。
4.  **角色创建 (`CharacterCreatorPage.vue`)**: 玩家微调角色设定。
5.  **潜力与背包 (`PotentialAllocator.vue` / `BackpackManager.vue`)**: 分配点数，选择物品。
6.  **最终总览 (`SummaryPage.vue`)**: 汇总并展示所有选择。
7.  **【步骤一】构筑世界**:
    *   点击“构筑世界”，`TavernService.ts` 的 `buildWorld()` 被触发。
    *   **(V5.0变更)** 函数首先调用 `PersistenceService` 保存当前用户的全部选择。
    *   **(V5.0变更)** 然后，将世界设定发送给AI，AI返回包含 `UpdateVariable` 的消息。此消息被**完整地写入酒馆聊天记录**，创建了“主世界”变量。
8.  **世界确认 (`WorldConfirmationPage.vue`)**:
    *   **(V5.0变更)** 此页面现在从酒馆变量中动态加载并以全新的、美化后的交互方式展示世界设定。
9.  **【步骤二】开启轮回**:
    *   点击“开启轮回”，`TavernService.ts` 的 `startReincarnation()` 被触发。
    *   **(V5.0变更)** 函数从 `store` 中读取暂存的世界数据，结合角色设定，一同发送给AI。
    *   **(V5.0变更)** AI返回的开局剧情和角色增量变量，会与现有的世界变量合并，并通过 `setChatMessages` **覆盖**聊天记录，完成最终的原子性开局。
