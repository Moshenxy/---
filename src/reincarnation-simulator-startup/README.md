# 轮回模拟器 - 开局设定模块 V4.1

本项目是一个独立的Vue 3应用，专门用于“轮回-诸天万界”世界观的开局设定流程。它允许玩家在正式开始游戏前，通过一个多步骤的向导来构筑自己的世界和角色。

## 核心设计哲学 (V4.0)

在V3.0“分步构筑”的基础上，V4.0引入了“**AI辅助创想**”的核心理念，旨在解决玩家从零开始构筑世界观的困难，同时提升开局设定的独特性和沉浸感。

1. **降低构想门槛**：玩家不再需要凭空设计所有细节，只需输入一段模糊的世界构想 (`WorldVision`)。
2. **激发创意**：由AI（天衍）基于玩家的构想，演绎并生成一套或多套完整的、包含全新自定义选项的开局方案。
3. **方案管理**：引入了强大的方案管理系统 (`PresetService`)，允许玩家保存、加载、导入和导出由AI生成或自己调整的完整开局设定。

## 开局流程 (V4.0)

1. **封面 (`CoverPage.vue`)**: 展示游戏标题和开始按钮。

2. **世界构想 (`WorldVisionPage.vue`)**: **(核心新增)**
    * 玩家输入一段关于本次轮回世界的初步构想与期望。
    * `WorldEvolutionService.ts` 将构想发送给AI，并请求AI生成1个或多个包含全新自定义选项（如宇宙蓝图、文明基调、天赋、物品等）的完整开局方案。
    * `OptionPlanDisplay.vue` 负责将AI返回的多个方案以卡片形式展示给玩家。
    * 玩家可以选择一个最喜欢的方案，并将其保存为个人方案（Preset）。

3. **难度选择与世界构筑 (`WorldBuilderPage.vue`)**:
    * 玩家选择游戏难度。
    * 此页面的所有选项（宇宙蓝图、文明基调等）现在会**自动填充**上一步所选方案中的设定。
    * 玩家可以在此基础上进行微调。

4. **角色创建 (`CharacterCreatorPage.vue`)**:
    * 此页面的选项同样会自动填充所选方案中的设定。
    * 玩家可以进行微调。

5. **潜力与背包 (`PotentialAllocator.vue` / `BackpackManager.vue`)**:
    * 分配潜力值，并选择或调整初始背包物品。
    * **功能增强**: 现在支持添加和删除完全自定义的背包物品。

6. **最终总览 (`SummaryPage.vue`)**: 汇总并展示所有选择。按钮为“**构筑世界**”。

7. **【步骤一】构筑世界**:
    * 点击“构筑世界”，`TavernService.ts` 的 `buildWorld()` 函数被触发。
    * 该函数将世界相关的设定发送给AI，AI返回`<主世界>`标签并保存。

8. **世界确认 (`WorldConfirmationPage.vue`)**:
    * 展示由AI生成并解析后的世界设定，供玩家最终确认。
    * 按钮为“**开启轮回**”。

9. **【步骤二】开启轮回**:
    * 点击“开启轮回”，`TavernService.ts` 的 `startReincarnation()` 函数被触发。
    * 该函数将角色相关的设定和已构筑的世界信息一同发送给AI，生成开局剧情和变量，正式开始游戏。

## 核心服务与组件 (V4.1 变更)

* **`WorldVisionPage.vue`**: 核心新增页面，是“AI辅助创想”流程的入口。
* **`WorldEvolutionService.ts`**: 新增服务，负责与AI交互，根据玩家输入生成动态的、全新的开局方案。其内部的 **Prompt 已被强化**，以确保AI返回的数据格式（如`技艺`包含`技能`，`物品`包含`type`）更规范、更可靠。
* **`PresetService.ts`**: 新增服务，提供了强大的方案管理功能，包括对自定义选项的提取、保存、加载、导入/导出。修复了在处理AI生成的、包含新自定义属性的方案时可能出错的问题。
* **`TavernService.ts`**: 其内部的Prompt模板已根据最新的变量规则 (`[InitVar].txt` v6.0+) 进行了全面更新和强化，增加了多条**【至高指令】**和**【数据溯源铁律】**，以确保生成的变量结构与世界观规则严格一致。
* **`store.ts`**:
  * `removeCustomItem` 函数已修复并扩展，现在支持删除所有类型的自定义项目，包括背包物品。
  * `selections` 对象的数据结构已扩展，加入了 `character_traits` 和 `core_need`，以支持更完整的角色设定方案。
* **`BackpackManager.vue`**: 界面已更新，现在会为玩家自定义的背包物品显示一个删除按钮，允许直接在界面上进行管理。
