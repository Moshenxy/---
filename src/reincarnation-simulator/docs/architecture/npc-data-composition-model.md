# NPC 数据结构优化方案：三板块组合模型

## 1. 问题诊断

当前在 `[InitVar].txt` 中定义的NPC模板过于庞大和统一，所有NPC（无论主次）都共享一套完整的数据结构。这导致了以下核心问题：

1.  **数据冗余**: 大量路人NPC携带了永不使用的字段（如`心流`、`战斗参数`），造成`stat_data`体积臃肿。
2.  **AI负担过重**: AI在创建NPC时，面对庞大的模板，倾向于只填充部分关键字段，常常会“偷懒”忽略如`天赋`、`技艺`等重要但非即时的属性，导致角色数据不完整。
3.  **维护困难**: 模板的任何修改都难以追溯应用于已生成的角色。

## 2. 核心思想：“数据板块组合” (Data Block Composition)

为了解决上述问题，我们引入一种全新的、由**叙事重要性**驱动的数据结构模型。其核心思想是：**一个NPC的数据不再是一个固定的庞大整体，而是由1到3个可按需组合的“数据板块”动态构成。**

AI在创造一个NPC之前，必须先判断其在故事中的定位（路人、支线角色、主线角色），然后为其“装配”相应数量的数据板块。

## 3. 三大板块定义

我们将NPC的所有属性划分为三个独立的、层层递进的板块。

```mermaid
graph TD
    subgraph NPC数据构成
        A["<b>基础板块 (Basic)</b><br>- 姓名<br>- 性别<br>- 身份<br>- 相貌<br>- 着装<br>- 当前位置"]
        B["<b>进阶板块 (Advanced)</b><br>- 背景故事<br>- 性格特质<br>- 完整心流 (目标/需求/记忆)<br>- 世界专属属性"]
        C["<b>核心板块 (Core)</b><br>- 基础潜力<br>- 战斗参数<br>- 天赋<br>- 技艺<br>- 背包"]
    end

    subgraph 角色定位
        D[<b>路人 NPC</b><br>(Passerby)]
        E[<b>支线 NPC</b><br>(Side Character)]
        F[<b>主线 NPC</b><br>(Main Character)]
    end

    A --> D
    
    subgraph 支线NPC构成
        direction TB
        A_sub(基础板块)
        B_sub(进阶板块)
    end
    
    A_sub --> E
    B_sub --> E
    
    subgraph 主线NPC构成
        direction TB
        A_main(基础板块)
        B_main(进阶板块)
        C_main(核心板块)
    end

    A_main --> F
    B_main --> F
    C_main --> F
```

### 3.1. 基础板块 (Basic Block)

*   **定位**: 构成一个NPC的基本身份标识。
*   **适用对象**: **所有NPC**，包括最简单的路人。
*   **包含字段**: `姓名`, `性别`, `身份`, `相貌`, `着装`, `当前位置`, `所属世界`。
*   **AI职责**: 快速生成一个有基本外观和身份的背景板，无需为其构思复杂的内心世界。

### 5.2. 进阶板块 (Advanced Block)

*   **定位**: 赋予NPC内在世界和与世界的独特联系，使其行为具备逻辑和动机。
*   **适用对象**: **支线NPC** 和 **主线NPC**。
*   **包含字段**:
    *   `背景` (过去经历)
    *   `性格特质`
    *   完整的 `心流` 模块 (包含驱动力、目标、秘密、记忆等)
    *   `世界专属属性` (**注意**: 对于支线NPC，此项为**静态赋值**；对于主线NPC，此项为**动态计算**)
*   **AI职责**: 为角色构思独特的背景故事和性格，使其成为一个有血有肉、有自己生活和追求的“人”。

### 5.3. 核心板块 (Core Block)

*   **定位**: 定义NPC的核心成长与战斗能力，使其能深度参与游戏的核心系统。
*   **适用对象**: **仅限主线NPC**。
*   **包含字段**:
    *   `基础潜力` (`精`, `气`, `神`, `运`)
    *   `战斗参数` (`权能`, `根基`等)
    *   `天赋`
    *   `技艺`
    *   `背包`
*   **AI职责**: 为角色精心设计其战斗风格、成长路线和初始资源，使其成为世界故事中不可或缺的核心参与者或挑战者。

## 6. AI行为准则更新

为了实施此模型，AI（天衍）的思考链将被更新，在创建NPC时遵循以下新规则：

1.  **叙事定位判断**: 在生成任何新NPC之前，必须先在`thinking`标签内明确其定位：“此NPC在当前及可预见的未来中，扮演何等角色？是匆匆一瞥的**路人**，是某段剧情的关键**支线**，还是贯穿始终的**主线**？”
2.  **按需装配与赋值**: 根据判断结果，执行相应的生成逻辑：
    *   **路人**: 只生成`基础板块`。
    *   **支线**: 生成`基础板块` + `进阶板块`。其中，`世界专属属性`由AI**静态赋值**。
    *   **主线**: 生成全部三个板块。其中，`世界专属属性`和`战斗参数`必须由`基础潜力`通过公式**动态计算**。
3.  **角色“晋升”**: 当一个NPC在剧情中的重要性提升时（例如，一个路人被卷入重要事件，成为支线角色），AI有责任为其“补全”缺失的板块。这本身也将成为一个重要的叙事节点（例如，“你突然发现，这个一直不起眼的酒馆老板，竟然隐藏着不为人知的过去和力量”）。如果一个支线角色晋升为主线，AI需要为其补全`核心板块`，并根据新赋予的`基础潜力`重新**计算**其`世界专属属性`。

## 7. 优势总结

*   **精准指导AI**: 为AI提供了关于“详略得当”的明确、可执行的规则，从根本上解决了“AI偷懒”和数据不完整的问题。
*   **极致的性能优化**: 对于构成世界绝大多数的“路人NPC”，只存储最少量的数据，极大地精简了`stat_data`的体积。
*   **叙事驱动设计**: 数据结构的复杂度完全由其在故事中的重要性决定，使得技术实现与叙事设计完美统一。
*   **动态成长性**: “角色晋升”机制允许NPC的重要性随着故事发展而动态提升，为世界演化提供了更丰富的可能性。