# 综漫-春物模拟器 - 前端界面

本项目是“综漫-春物”世界观的前端UI实现，基于Vue 3、TypeScript和SCSS构建，旨在提供一个沉浸式、数据驱动的交互体验。

## 近期重要更新 (V20.0 - “综漫-春物”世界观适配)

本次更新是一次彻底的底层重构，旨在将项目从原有的“轮回-诸天万界”世界观，完全适配到以《我的青春恋爱物语果然有问题》为核心的“综漫-春物”世界观。

1.  **【核心】数据结构与类型系统重构**:
    *   **废弃旧结构**: 彻底废弃了以“玩家/世界”为顶级命名空间的、复杂的多世界嵌套数据结构。
    *   **拥抱新结构**: 引入了以“世界状态”、“角色列表”、“关系”为核心的、更适合单世界校园模拟的扁平化数据模型。
    *   **类型安全**: 基于新的 `[initvar].txt` 和 `变量结构.txt`，使用 Zod 重写了 `/types/index.ts` 中的所有核心类型定义，确保了编译时类型安全和运行时数据校验。

2.  **【核心】状态管理(Store)重构**:
    *   **`state.ts`**: 移除了所有与“轮回”、“化身”等旧玩法相关的状态，如 `reincarnationOptions`, `settlementData` 等，使状态树更清晰。
    *   **`getters.ts`**: 彻底重写了所有计算属性，使其能够从新的 `worldState` 中正确派生数据，例如 `playerCharacter` 现在从 `角色列表` 中获取，而不是旧的 `玩家.本体`。
    *   **`actions.ts`**: 对核心数据流操作进行了外科手术式的重构，保留了复杂的 `handleAction` 流程，但将其内部的数据处理逻辑（如上下文构建、数据解析）完全适配到新的“春物”数据结构。

3.  **【服务层】全面适配**:
    *   **`NpcService.ts`**: 重写了NPC的获取逻辑，现在直接从扁平化的 `角色列表` 中读取数据，移除了过时的多世界过滤功能。
    *   **`EntityIndexService.ts`**: 重写了实体索引的构建逻辑，以适应新的数据源，解决了因时序问题导致的初始化崩溃。
    *   **`SaveLoadService.ts`**: 将其指向的世界书从“轮回-诸天万界”修正为“综漫-春物”，并更新了需要备份的核心条目列表。

4.  **【UI/UX】修复与调整**:
    *   **解决了大量连锁错误**: 通过以上重构，修复了因数据结构不匹配导致的白屏、“未知视图”、NPC列表无法加载、NPC详情无法显示等一系列致命错误。
    *   **顶部状态栏更新**: 根据要求，将顶部状态栏的显示内容从旧的“主世界/化身世界”更新为显示当前的“章节信息”和格式化的“游戏内时间”。
    *   **NPC详情面板重构**:
        *   将“【权能】”标签页重命名为“【能力】”。
        *   重写了“【档案】”、“【能力】”和“【因果】”三个标签页的内部实现，使其能够正确地展示新 `角色` 类型下的属性、技能、个人信息和人际关系。
        *   为“属性”部分增加了经验值进度条，优化了视觉表现。

## 项目结构

*   **/components**: 存放Vue通用组件。
    *   `TopStatusBar.vue`: **(已修改)** 顶部状态栏，现在显示章节和时间。
    *   `DockManager.vue`: 核心布局管理器。
    *   `NpcDirectoryPanel.vue`: **(已重构)** 众生名录面板，现在从新的服务获取数据。
    *   `npc-details/`: **(已重构)** NPC详情的三个标签页（档案、能力、因果）均已重写。
*   **/services**: 存放与后端和数据处理相关的服务。
    *   `NpcService.ts`: **(已重构)** 适配新的NPC数据结构。
    *   `EntityIndexService.ts`: **(已重构)** 适配新的实体索引逻辑。
    *   `saveLoadService.ts`: **(已修改)** 更新了世界书指向。
*   **/store**: **(已重构)** 状态管理中心，适配了全新的数据模型。
*   **/types**: **(已重构)** 项目的核心类型定义，现在由Zod驱动，完全匹配“综漫-春物”世界观。
*   `app.vue`: 应用的根组件。
*   `index.ts`: **(已重构)** 调整了服务的初始化时序，解决了启动时的崩溃问题。

## 开发规范

*   **类型优先**: 所有核心数据结构都必须在 `/types` 目录中定义清晰的TypeScript接口和Zod Schema。
*   **逻辑分离**: 业务逻辑、数据获取和转换应尽可能放在 `store/actions.ts` 和 `store/getters.ts` 中。
*   **注释清晰**: 所有新添加的文件和复杂逻辑都应有清晰的JSDoc注释。
