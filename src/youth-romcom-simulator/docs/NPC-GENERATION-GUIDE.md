# NPC 生成规则指南 v1.0

本文档旨在为AI（天衍）提供一套在“轮回-诸天万界”世界观下，生成新NPC时必须严格遵循的标准化流程。其核心是`【cot】天衍之心.txt`中定义的**【强制·新灵诞生·五步天条】**，并以`[InitVar].txt`中的`sample_npc_id`为基准模板。

---

## 零、前置构思：『生发』

在执行具体的“五步天条”之前，AI（天衍）必须先回答一个核心问题：**“这个生灵，如何在这个世界的土壤中自然地‘生发’出来？”**

NPC的模板、骨架与内在并非随机组合，而是由其所处的**环境与背景**自然决定的。构思的核心是**真实性**与**融入感**，而非刻意制造戏剧性。

1.  **生态定位 (Ecological Niche)**:
    *   这个NPC在当前世界的社会结构、地理位置和势力氛围中，扮演着一个怎样的**角色**？这个角色不一定是“关键人物”，也可以是构成世界背景的普通一员。
    *   **示例**: 一个繁华港口城市，自然需要商人、水手、卫兵、酒馆老板；一个偏远的修仙宗门外围，则会有灵农、杂役、坊市摊主。他们的存在是为了让世界显得**真实可信**。

2.  **背景融入 (Contextual Integration)**:
    *   NPC的背景故事**不必**强行关联世界的宏大叙事（如`历史遗留问题`或`预言之谜`）。他的故事更应该根植于其所在的**具体环境**。
    *   **示例**: 一个铁匠的`过去经历`可能只是“打造出了第一把被镇上卫兵队长佩戴的剑”，而非“祖上曾是为上古君王铸造神器的巨匠”。他的故事让他属于这个小镇，而非属于整个史诗。

3.  **内在逻辑 (Internal Logic)**:
    *   NPC的`驱动力`（长/短期目标）和`核心需求`，首先要符合其自身的身份、背景和性格，形成自洽的内在逻辑。它**不必**刻意与主角或世界核心矛盾产生冲突或共鸣。
    *   **示例**: 一个卫兵的`长期目标`可能是“攒够钱，退役回家乡开个农场”，他的`核心需求`是“安稳”。这与主角的冒险旅程毫无关系，但这让他成为了一个**活生生的人**，而不仅仅是一个功能性的“任务发布器”或“敌人”。

**结论**: 创生的首要目标是创造一个**“合理存在于此”**的生灵。其命运是否与主角交汇，是否会卷入宏大叙事，应由后续的剧情推演自然决定，而非在创生之初就强行设定。

---

## 【强制】五步天条创生流程

每一次新NPC的诞生，都必须完整、依次执行以下五个步骤，不可有任何简化、跳过或颠倒。

### **第一步：模板定义**

*   **原则**: 凡人所持，皆有其源。在创生之前，必须先自检其所依赖的所有模板是否已在“数据库”中定义。
*   **清单**:
    *   [ ] **天赋**: 确定为NPC赋予的天赋。**必须**首先查阅 `数据库.天赋`。若天赋不存在，则必须先在数据库中创建其模板，然后才能在NPC数据中引用其ID。
    *   [ ] **初始装备**: 检查其初始携带的装备（武器、防具、奇物），确保已在`数据库.奇物`中定义。
    *   [ ] **初始活动**: 检查其`生活模式`中涉及的`核心活动`，确保已在`数据库.活动模板`中定义。
    *   [ ] **世界专属属性**: 检查其力量体系相关的初始属性（如“剑法熟练度”），确保已在当前世界的`力量体系.属性模板`中声明。

### **第二步：创建骨架**

*   **原则**: 其命格骨架，当一次而成，不可增删。
*   **指令**: 必须使用**单条** `_.assign('角色', { '新NPC_ID': { ... } })` 指令。
*   **模板**: 指令中的JSON对象，必须严格参照 `[InitVar].txt` -> `角色.sample_npc_id` 的结构，包含其所有的**顶级键**（从`姓名`到`世界专属属性`）。
*   **关键字段**:
    *   `姓名`: 遵循`【系统】世界法则与命名.txt`中的规范。
    *   `出生日期`: `纪元ID`和`年/月/日`必须符合当前世界的当前时间，确保逻辑自洽。
    *   `所属世界`: 填写当前世界的ID。
    *   `当前位置`: 填写一个已在世界书中定义的、具体的`空间实体`ID。
    *   `本世宿命`: **必须**设置为空对象 `{}`。

### **第三步：计算衍生属性**

*   **原则**: 凡人之力，非由臆造，乃天道演算之果。严禁直接赋予写死的默认值。
*   **清单**:
    *   [ ] **3a. 计算基础潜力**:
        *   **规则**: 遵循`【系统】数值标尺.txt`中的“本质源点”和“世界赋能”规则。
        *   **公式**: `初始潜力 = 源点基数 + (世界能级 * 世界赋能乘数) + 先天修正`
        *   **流程**:
            1.  根据NPC背景设定一个0-10的“本质源点”。
            2.  获取当前世界的`世界能级`和`力量体系.基础潜力计算规则`中为`精`、`气`、`神`设定的“世界赋能乘数”。
            3.  计算出`基础潜力`的`精`、`气`、`神`、`运`四项最终值。
    *   [ ] **3b. 计算战斗参数**:
        *   **规则**: 严格遵循当前世界的`力量体系.战斗参数计算规则`。
        *   **流程**: 将上一步计算出的`基础潜力`作为输入，代入公式，计算出`战斗参数`的`权能`、`根基`、`机变`、`破法`、`御法`五项初始值。

### **第四步：填充核心内在**

*   **原则**: 无心者，傀儡也。必须为NPC注入“灵魂”，确保其行为逻辑的完整性。
*   **清单**:
    *   [ ] **4a. 填充心流模块**: `心流`对象必须被完整创建，并根据NPC的背景故事赋予有意义的初始值。
        *   `情绪状态`: 通常初始为`{ "喜悦": 0, "悲伤": 0, "愤怒": 0, "恐惧": 0 }`。
        *   `核心需求`: 根据背景设定一个初始的核心需求，如“生存”、“力量”、“复仇”。
        *   `秘密`: 若有，添加一个秘密对象。
        *   `短期记忆`: 添加一条关键的初始记忆，作为其开局行为的引子。
        *   `驱动力`:
            *   `长期目标`: 设定一个符合其人生的宏大目标。
            *   `短期目标`: 设定一个为实现长期目标服务的、具体的短期计划。
            *   `决策倾向`: 设定其在不同情境下的行为风格。
        *   `生活模式`:
            *   `核心活动`: 从数据库引用其掌握的活动ID。
            *   `活动区域`: 引用其常去的`空间实体`ID。
            *   `社交倾向`: 描述其社交风格。
    *   [ ] **4b. 填充根源信息**:
        *   `过去经历`: **必须**添加**至少三条**塑造其性格、驱动其命运的关键经历。
        *   `性格特质`: 至少添加两个核心的性格标签。

### **第五步：建立因果关联**

*   **原则**: 新灵既入世，当与此方天地建立因果之网。
*   **清单**:
    *   [ ] **5a. 关联背包**: 在`背包`对象中，添加初始物品的ID作为键，数量作为值。例如: `{ "dan_huiqi_01": 3 }`。
    *   [ ] **5b. 关联因果之网**:
        *   **指令**: 使用独立的`_.assign('因果之网', ...)`指令。
        *   **双向原则**: 若NPC与场景中的其他角色有初始关系，必须建立**双向**关系。例如，如果A是B的师傅，则需要同时建立A对B的“师徒”关系和B对A的“师徒”关系。
        *   **结构**: 严格参照`[InitVar].txt`中`因果之网`的完整数据结构。